Notebook[
 {Cell[BoxData[RowBox[{RowBox[{"tensorcontainer", "=", 
        RowBox[{"Object", "[", "\[IndentingNewLine]", 
          RowBox[{RowBox[{"\"Description\"", "\[Rule]", 
              "\"This is the head used for tensorcontainer objects.\""}], 
            ",", "\[IndentingNewLine]", RowBox[{"\"CacheActivated\"", 
              "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
            RowBox[{"\"PersistentCacheActivated\"", "\[Rule]", "False"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {3.632690985190308*^9, {3.632827401136145*^9, 
      3.6328274148330107*^9}, {3.633193833628323*^9, 3.633193837961084*^9}, 
     {3.633194008763186*^9, 3.633194011785421*^9}, {3.6678867086860037*^9, 
      3.6678867494858418*^9}, {3.6863904372662983*^9, 3.686390440513628*^9}, 
     {3.686747429673184*^9, 3.6867474304905033*^9}, 
     {3.687189798290908*^9, 3.6871897994097137*^9}, 
     {3.689579029625271*^9, 3.689579034773673*^9}, {3.707994014441744*^9, 
      3.7079940185394573*^9}, {3.709194411271244*^9, 3.7091944149833508*^9}, 
     3.709203583432884*^9, 3.72130845400181*^9, {3.721310028657968*^9, 
      3.721310030842506*^9}, {3.721535565551453*^9, 3.721535568468872*^9}, 
     {3.72153706290589*^9, 3.721537065611257*^9}, {3.721537468668483*^9, 
      3.721537470980715*^9}}, ExpressionUUID -> 
    "53979ee4-1ac5-4432-bd59-5583cfd11f70"], 
  Cell[BoxData[RowBox[{"VerbatimRegion", "[", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", RowBox[{RowBox[{"CreateFormat", "[", 
          RowBox[{"tensorcontainer", ",", "\[IndentingNewLine]", 
            RowBox[{"{", "\[IndentingNewLine]", RowBox[{RowBox[
                 {"{", RowBox[{RowBox[{"\[LeftAssociation]", RowBox[
                       {RowBox[{"\"Caption\"", "\[Rule]", 
                          "\"Dimensions: \""}], ",", RowBox[{"\"Function\"", 
                          "\[Rule]", "TensorDimensions"}]}], 
                      "\[RightAssociation]"}], ",", "SpanFromLeft"}], "}"}], 
                ",", "\[IndentingNewLine]", RowBox[{"{", 
                  "\[IndentingNewLine]", RowBox[{RowBox[
                     {"\[LeftAssociation]", RowBox[{RowBox[{"\"Caption\"", 
                          "\[Rule]", "\"PackedQ: \""}], ",", RowBox[
                         {"\"Function\"", "\[Rule]", "PackedQ"}]}], 
                      "\[RightAssociation]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"\[LeftAssociation]", RowBox[{RowBox[
                         {"\"Caption\"", "\[Rule]", "\"Type: \""}], ",", 
                        RowBox[{"\"Function\"", "\[Rule]", "TensorType"}]}], 
                      "\[RightAssociation]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"\[LeftAssociation]", RowBox[{RowBox[
                         {"\"Caption\"", "\[Rule]", "\"MaxAbs: \""}], ",", 
                        RowBox[{"\"Function\"", "\[Rule]", "MaxAbs"}]}], 
                      "\[RightAssociation]"}]}], "\[IndentingNewLine]", 
                  "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
            "\[IndentingNewLine]", RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{"{", RowBox[{"\[LeftAssociation]", RowBox[
                   {RowBox[{"\"Caption\"", "\[Rule]", "\"MBCount: \""}], ",", 
                    RowBox[{"\"Function\"", "\[Rule]", "MBCount"}]}], 
                  "\[RightAssociation]"}], "}"}], "\[IndentingNewLine]", 
              "}"}], ",", "\[IndentingNewLine]", RowBox[
             {"\"EvaluationCondition\"", "\[Rule]", RowBox[{"Function", "[", 
                RowBox[{"z", ",", RowBox[{"ArrayQ", "[", RowBox[{"z", 
                      "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", RowBox[{RowBox[{"tensorcontainer", "/:", 
              RowBox[{"MakeBoxes", "[", RowBox[{"x_tensorcontainer", ",", 
                  "StandardForm"}], "]"}], ":=", RowBox[{RowBox[
                 {"BoxForm`ArrangeSummaryBox", "[", RowBox[
                   {"tensorcontainer", ",", "\"\"", ",", RowBox[{"\"ID:  \"", 
                      "<>", RowBox[{"ToString", "[", RowBox[{"IDNumber", "[", 
                          "x", "]"}], "]"}]}], ",", RowBox[{"{", 
                      "\[IndentingNewLine]", RowBox[{RowBox[{"{", 
                          "\[IndentingNewLine]", RowBox[{RowBox[
                          {"BoxForm`MakeSummaryItem", "[", RowBox[{RowBox[
                          {"{", "\[IndentingNewLine]", RowBox[
                          {"\"Dimensions: \"", ",", RowBox[{"With", "[", 
                          RowBox[{RowBox[{"{", RowBox[{"data", "=", RowBox[
                          {"TensorDimensions", "[", "x", "]"}]}], "}"}], ",", 
                          RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", 
                          "[", "data", "]"}], "===", "TensorDimensions"}], 
                          ",", RowBox[{"Missing", "[", "]"}], ",", "data"}], 
                          "]"}]}], "]"}]}], "}"}], ",", "StandardForm"}], 
                          "]"}], ",", "SpanFromLeft"}], "}"}], ",", 
                        "\[IndentingNewLine]", RowBox[{"{", 
                          "\[IndentingNewLine]", RowBox[{RowBox[
                          {"BoxForm`MakeSummaryItem", "[", RowBox[{RowBox[
                          {"{", "\[IndentingNewLine]", RowBox[
                          {"\"PackedQ: \"", ",", RowBox[{"With", "[", RowBox[
                          {RowBox[{"{", RowBox[{"data", "=", RowBox[
                          {"Developer`PackedArrayQ", "[", "x", "]"}]}], 
                          "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[
                          {RowBox[{"Head", "[", "data", "]"}], "===", 
                          "Developer`PackedArrayQ"}], ",", RowBox[{"Missing", 
                          "[", "]"}], ",", "data"}], "]"}]}], "]"}]}], "}"}], 
                          ",", "StandardForm"}], "]"}], ",", RowBox[
                          {"BoxForm`MakeSummaryItem", "[", RowBox[{RowBox[
                          {"{", RowBox[{"\"Type: \"", ",", RowBox[{"With", 
                          "[", RowBox[{RowBox[{"{", RowBox[{"data", "=", 
                          RowBox[{"TensorType", "[", "x", "]"}]}], "}"}], 
                          ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[
                          {"Head", "[", "data", "]"}], "===", "TensorType"}], 
                          ",", RowBox[{"Missing", "[", "]"}], ",", "data"}], 
                          "]"}]}], "]"}]}], "}"}], ",", "StandardForm"}], 
                          "]"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], 
                    ",", RowBox[{"{", "\[IndentingNewLine]", RowBox[
                       {"{", "\[IndentingNewLine]", RowBox[
                         {"BoxForm`MakeSummaryItem", "[", RowBox[{RowBox[
                          {"{", RowBox[{"\"MBCount: \"", ",", RowBox[{"With", 
                          "[", RowBox[{RowBox[{"{", RowBox[{"data", "=", 
                          RowBox[{"MBCount", "[", "x", "]"}]}], "}"}], ",", 
                          RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", 
                          "[", "data", "]"}], "===", "MBCount"}], ",", RowBox[
                          {"Missing", "[", "]"}], ",", "data"}], "]"}]}], 
                          "]"}]}], "}"}], ",", "StandardForm"}], "]"}], 
                        "}"}], "\[IndentingNewLine]", "}"}], ",", 
                    "StandardForm", ",", RowBox[{"\"Interpretable\"", 
                      "\[Rule]", "False"}]}], "]"}], "/;", RowBox[
                 {"ArrayQ", "[", RowBox[{"x", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tensorcontainer", "/:", RowBox[{"Initialize", "[", 
            RowBox[{"tensorcontainer", ",", "PM`Private`data0_Association"}], 
            "]"}], "=."}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tensorcontainer", "/:", RowBox[{"Initialize", "[", 
            RowBox[{"tensorcontainer", ",", RowBox[{"A_", "?", "ArrayQ"}]}], 
            "]"}], ":=", RowBox[{"With", "[", RowBox[
             {RowBox[{"{", "\[IndentingNewLine]", RowBox[{"c", "=", 
                  RowBox[{"ToExpression", "[", RowBox[{"\"++PM`Private`$\"", 
                      "<>", "\"tensorcontainer\"", "<>", "\"Counter\""}], 
                    "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"ToExpression", "[", "\[IndentingNewLine]", 
                RowBox[{RowBox[{"StringJoin", "[", RowBox[{"\"$\"", ",", 
                      "\"tensorcontainer\"", ",", "\"$\"", ",", RowBox[
                       {"ToString", "[", "c", "]"}]}], "]"}], ",", 
                  "\[IndentingNewLine]", "InputForm", ",", 
                  "\[IndentingNewLine]", RowBox[{"Function", "[", RowBox[
                     {"data", ",", "\[IndentingNewLine]", RowBox[
                       {RowBox[{"SetAttributes", "[", RowBox[{"data", ",", 
                          "Temporary"}], "]"}], ";", "\[IndentingNewLine]", 
                        RowBox[{"data", "=", "A"}], ";", 
                        "\[IndentingNewLine]", RowBox[{"tensorcontainer", 
                          "[", "data", "]"}]}], ",", "\[IndentingNewLine]", 
                      "HoldAll"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", RowBox[{"tensorcontainer", "/:", 
          RowBox[{"Init", "[", RowBox[{"tensorcontainer", ",", 
              RowBox[{"A_", "?", "ArrayQ"}]}], "]"}], ":=", 
          RowBox[{"Initialize", "[", RowBox[{"tensorcontainer", ",", 
              RowBox[{"ToPack", "[", "A", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tensorcontainer", "/:", RowBox[{"Init", "[", 
            RowBox[{"tensorcontainer", ",", "val_", ",", "dims_"}], "]"}], 
          ":=", RowBox[{"Initialize", "[", RowBox[{"tensorcontainer", ",", 
              RowBox[{"ConstantArray", "[", RowBox[{"val", ",", "dims"}], 
                "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", RowBox[{"(*", 
          RowBox[{RowBox[{"tensorcontainer", "/:", RowBox[{"Init", "[", 
                RowBox[{"tensorcontainer", ",", RowBox[{"A_", "?", 
                    "ArrayQ"}]}], "]"}], ":=", RowBox[{"Initialize", "[", 
                RowBox[{"tensorcontainer", ",", RowBox[{"\[LeftAssociation]", 
                    RowBox[{"\"Values\"", "\[Rule]", RowBox[{"ToPack", "[", 
                        "A", "]"}]}], "\[RightAssociation]"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"tensorcontainer", "/:", RowBox[{"Init", "[", 
                RowBox[{"tensorcontainer", ",", "val_", ",", "dims_"}], 
                "]"}], ":=", RowBox[{"Initialize", "[", RowBox[
                 {"tensorcontainer", ",", "\[IndentingNewLine]", 
                  RowBox[{"\[LeftAssociation]", RowBox[{"\"Values\"", 
                      "\[Rule]", RowBox[{"ConstantArray", "[", RowBox[
                         {"val", ",", "dims"}], "]"}]}], 
                    "\[RightAssociation]"}]}], "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{RowBox[{"tensorcontainer", "::", "setdim"}], "=", "\"Tensor \
to be written to has dimension `1`, but tensor to be read from has dimensions \
`2`.\""}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{RowBox[{"UpdateValues", "::", "usage"}], "=", "\"\""}], ";", 
        "\[IndentingNewLine]", RowBox[{RowBox[{"Inject", "::", "usage"}], 
          "=", "\"\""}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", RowBox[{"tensorcontainer", "/:", 
          RowBox[{"MBCount", "[", 
            "LinearAlgebraTools`Private`T_tensorcontainer", "]"}], "=."}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tensorcontainer", "/:", RowBox[{"MBCount", "[", 
            "T_tensorcontainer", "]"}], ":=", RowBox[{"MBCount", "[", 
            RowBox[{"T", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", RowBox[{"tensorcontainer", "/:", 
          RowBox[{"UpdateValues", "[", RowBox[{RowBox[{"x", ":", 
                RowBox[{"tensorcontainer", "[", "$tensorcontainer_", "]"}]}], 
              ",", RowBox[{"y_", "?", "ArrayQ"}]}], "]"}], ":=", 
          "\[IndentingNewLine]", RowBox[{"(", RowBox[
             {RowBox[{"$tensorcontainer", "=", RowBox[{"ToPack", "[", "y", 
                  "]"}]}], ";"}], ")"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", RowBox[{"tensorcontainer", "/:", 
          RowBox[{"UpdateValues", "[", RowBox[{RowBox[{"x", ":", 
                RowBox[{"tensorcontainer", "[", "$tensorcontainer_", "]"}]}], 
              ",", "args__", ",", RowBox[{"y_", "?", "ArrayQ"}]}], "]"}], 
          ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Dimensions", "[", 
                  RowBox[{"$tensorcontainer", "\[LeftDoubleBracket]", "args", 
                    "\[RightDoubleBracket]"}], "]"}], "\[Equal]", 
                RowBox[{"Dimensions", "[", "y", "]"}]}], ",", 
              "\[IndentingNewLine]", RowBox[{"(", RowBox[
                 {RowBox[{RowBox[{"$tensorcontainer", "\[LeftDoubleBracket]", 
                      "args", "\[RightDoubleBracket]"}], "=", RowBox[
                     {"ToPack", "[", "y", "]"}]}], ";"}], ")"}], ",", 
              "\[IndentingNewLine]", RowBox[{RowBox[{"Message", "[", 
                  RowBox[{RowBox[{"tensorcontainer", "::", "setdim"}], ",", 
                    RowBox[{"TensorDimensions", "[", RowBox[
                       {"$tensorcontainer", "\[LeftDoubleBracket]", "args", 
                        "\[RightDoubleBracket]"}], "]"}], ",", RowBox[
                     {"TensorDimensions", "[", "y", "]"}]}], "]"}], ";", 
                RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tensorcontainer", "/:", RowBox[{"UpdateValues", "[", 
            RowBox[{RowBox[{"x", ":", RowBox[{"tensorcontainer", "[", 
                  "$tensorcontainer_", "]"}]}], ",", RowBox[{"i_Integer", 
                "\[Rule]", RowBox[{"y_", "?", "ArrayQ"}]}]}], "]"}], ":=", 
          "\[IndentingNewLine]", RowBox[{"If", "[", 
            RowBox[{RowBox[{RowBox[{"Dimensions", "[", RowBox[
                   {"$tensorcontainer", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "]"}], "\[Equal]", 
                RowBox[{"Dimensions", "[", "y", "]"}]}], ",", 
              "\[IndentingNewLine]", RowBox[{"(", RowBox[
                 {RowBox[{RowBox[{"$tensorcontainer", "\[LeftDoubleBracket]", 
                      "i", "\[RightDoubleBracket]"}], "=", RowBox[{"ToPack", 
                      "[", "y", "]"}]}], ";"}], ")"}], ",", 
              "\[IndentingNewLine]", RowBox[{RowBox[{"Message", "[", 
                  RowBox[{RowBox[{"tensorcontainer", "::", "setdim"}], ",", 
                    RowBox[{"TensorDimensions", "[", RowBox[
                       {"$tensorcontainer", "\[LeftDoubleBracket]", "i", 
                        "\[RightDoubleBracket]"}], "]"}], ",", RowBox[
                     {"TensorDimensions", "[", "y", "]"}]}], "]"}], ";", 
                RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tensorcontainer", "/:", RowBox[{"UpdateValues", "[", 
            RowBox[{RowBox[{"x", ":", RowBox[{"tensorcontainer", "[", 
                  "$tensorcontainer_", "]"}]}], ",", RowBox[{"Rule", "[", 
                RowBox[{RowBox[{"ilist_", "?", "ArrayQ"}], ",", RowBox[
                   {"y_", "?", "ArrayQ"}]}], "]"}]}], "]"}], ":=", 
          "\[IndentingNewLine]", RowBox[{"Do", "[", 
            RowBox[{RowBox[{RowBox[{"$tensorcontainer", 
                  "\[LeftDoubleBracket]", RowBox[{"Sequence", "@@", 
                    RowBox[{"ilist", "\[LeftDoubleBracket]", "i", 
                      "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], 
                "=", RowBox[{"y", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ",", RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", RowBox[{"Length", "[", "ilist", 
                    "]"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", RowBox[{"tensorcontainer", "/:", 
          RowBox[{"Inject", "[", RowBox[{RowBox[{"x", ":", RowBox[
                 {"tensorcontainer", "[", "$tensorcontainer_", "]"}]}], ",", 
              RowBox[{"Rule", "[", RowBox[{RowBox[{"ilist_", "?", "ArrayQ"}], 
                  ",", RowBox[{"y_", "?", "ArrayQ"}]}], "]"}]}], "]"}], ":=", 
          "\[IndentingNewLine]", RowBox[{"Do", "[", 
            RowBox[{RowBox[{RowBox[{"$tensorcontainer", 
                  "\[LeftDoubleBracket]", RowBox[{"Sequence", "@@", 
                    RowBox[{"ilist", "\[LeftDoubleBracket]", "i", 
                      "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], 
                "=", RowBox[{"y", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ",", RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", RowBox[{"Length", "[", "ilist", 
                    "]"}]}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
      "]"}]], "Input", CellChangeTimes -> 
    {{3.7091944256957207*^9, 3.709194509285861*^9}, 
     {3.709194689373733*^9, 3.709194691284938*^9}, {3.709195380547015*^9, 
      3.709195423993998*^9}, {3.7092025723663607*^9, 3.709202575297715*^9}, 
     {3.709203244146003*^9, 3.709203278274001*^9}, {3.709203585565854*^9, 
      3.709203600397211*^9}, {3.709203652980998*^9, 3.709203656082869*^9}, 
     {3.7092281417317038*^9, 3.7092281652831984*^9}, 
     {3.709228383402123*^9, 3.709228389841058*^9}, {3.70923371654145*^9, 
      3.709233725589093*^9}, 3.721308459082017*^9, {3.721308506428502*^9, 
      3.7213085089950113*^9}, {3.721308541182482*^9, 3.7213086018181257*^9}, 
     {3.721308653316059*^9, 3.721308741285419*^9}, {3.7213087866774263*^9, 
      3.7213087870382223*^9}, {3.721308860362947*^9, 3.721308860832726*^9}, 
     {3.721308920360324*^9, 3.721308921246193*^9}, {3.721308958079659*^9, 
      3.721308998611576*^9}, {3.72130904259464*^9, 3.721309051802004*^9}, 
     {3.721309111575881*^9, 3.721309112126274*^9}, {3.721309268978236*^9, 
      3.721309278442143*^9}, 3.72130934005354*^9, {3.721309408620088*^9, 
      3.721309428161194*^9}, {3.721309625082108*^9, 3.721309641654065*^9}, 
     3.721309749503199*^9, 3.7213100708614893*^9, {3.721310105420343*^9, 
      3.721310120113758*^9}, {3.721373331375992*^9, 3.721373333371894*^9}, 
     3.721534638189919*^9, {3.721535088889703*^9, 3.721535100334738*^9}, 
     {3.7215353673096943*^9, 3.721535395699277*^9}, 
     {3.721535685710885*^9, 3.72153568823678*^9}, {3.7215358737886477*^9, 
      3.7215358779110947*^9}, {3.721535921341268*^9, 3.721535932517015*^9}, 
     {3.721536006313857*^9, 3.721536022180081*^9}, {3.7215369337839527*^9, 
      3.721536936175268*^9}, {3.721537375967267*^9, 3.721537376132859*^9}, 
     {3.721537412760118*^9, 3.7215374213354807*^9}, 3.7215376634638653*^9, 
     {3.7215385137399483*^9, 3.721538533457445*^9}, 3.721538732764127*^9, 
     {3.721540243445763*^9, 3.721540261801564*^9}, {3.721542116904736*^9, 
      3.7215421349296103*^9}, {3.726638493147496*^9, 3.726638496243678*^9}, 
     {3.726638785755974*^9, 3.7266388135217867*^9}, 
     {3.726638996506709*^9, 3.726639063252788*^9}, {3.726639132578416*^9, 
      3.726639134264409*^9}, {3.726639192369062*^9, 3.726639222550144*^9}}, 
   ExpressionUUID -> "e311a669-43d8-4c41-993a-797b041c80c0"], 
  Cell[BoxData[RowBox[{RowBox[{"Values", "=", RowBox[{"PackageFunction", "[", 
          RowBox[{RowBox[{"{", RowBox[{"T_", ",", "args___"}], "}"}], ",", 
            "\[IndentingNewLine]", RowBox[{"T", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "args"}], "\[RightDoubleBracket]"}], ",", 
            "\[IndentingNewLine]", RowBox[{"InputType", "\[Rule]", 
              "tensorcontainer"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Caching", "\[Rule]", "Access"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.721309318103592*^9, 3.7213093272617273*^9}, 
     3.721535405428413*^9}, ExpressionUUID -> 
    "6f2bbd76-5073-42b7-b761-16478320ff96"], 
  Cell[BoxData[RowBox[{RowBox[{"Dimensions", "=", 
        RowBox[{"PackageFunction", "[", RowBox[{"T_", ",", 
            "\[IndentingNewLine]", RowBox[{"Dimensions", "[", 
              RowBox[{"T", "\[LeftDoubleBracket]", "1", 
                "\[RightDoubleBracket]"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"InputType", "\[Rule]", "tensorcontainer"}], ",", 
            "\[IndentingNewLine]", RowBox[{"Caching", "\[Rule]", 
              "Access"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {3.7213092833912992*^9, 3.7215354126649523*^9}, 
   ExpressionUUID -> "c4af0fcf-f360-47c0-8170-08f372693dd0"], 
  Cell[BoxData[RowBox[{RowBox[{"TensorDimensions", "=", 
        RowBox[{"PackageFunction", "[", RowBox[{"T_", ",", 
            "\[IndentingNewLine]", RowBox[{"Dimensions", "[", 
              RowBox[{"T", "\[LeftDoubleBracket]", "1", 
                "\[RightDoubleBracket]"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"InputType", "\[Rule]", "tensorcontainer"}], ",", 
            "\[IndentingNewLine]", RowBox[{"Caching", "\[Rule]", 
              "Access"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.7213092332425423*^9, 3.7213092422339687*^9}, 
     3.721535415088901*^9}, ExpressionUUID -> 
    "994bc0a7-84e6-450e-9d65-d8c6a16b302b"], 
  Cell[BoxData[RowBox[{RowBox[{"Normal", "=", RowBox[{"PackageFunction", "[", 
          RowBox[{"T_", ",", "\[IndentingNewLine]", 
            RowBox[{"T", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"InputType", "\[Rule]", "tensorcontainer"}], ",", 
            "\[IndentingNewLine]", RowBox[{"Caching", "\[Rule]", 
              "Access"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.721309259401433*^9, 3.721309260230803*^9}, 
     3.7215368362033463*^9}, ExpressionUUID -> 
    "0cae0469-2be7-49dc-9835-ee096136108a"], 
  Cell[BoxData[RowBox[{RowBox[{"SetValues", "=", 
        RowBox[{"PackageFunction", "[", RowBox[
           {RowBox[{"{", RowBox[{"T_", ",", "vals_"}], "}"}], ",", 
            "\[IndentingNewLine]", RowBox[{"Init", "[", RowBox[{
                "tensorcontainer", ",", "vals"}], "]"}], ",", 
            "\[IndentingNewLine]", RowBox[{"InputType", "\[Rule]", 
              "tensorcontainer"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Caching", "\[Rule]", "Access"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.721309157212962*^9, 3.721309175443478*^9}, 
     {3.7213296707915897*^9, 3.721329686654997*^9}, 3.721329885506925*^9, 
     3.774903810843912*^9}, ExpressionUUID -> 
    "0108ad1e-e83f-4775-b861-8a64951b8509"], 
  Cell[BoxData[RowBox[{RowBox[{"DeepCopy", "=", 
        RowBox[{"PackageFunction", "[", RowBox[{"T_", ",", 
            "\[IndentingNewLine]", RowBox[{"Init", "[", RowBox[{
                "tensorcontainer", ",", RowBox[{"Normal", "[", "T", "]"}]}], 
              "]"}], ",", "\[IndentingNewLine]", RowBox[{"InputType", 
              "\[Rule]", "tensorcontainer"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Caching", "\[Rule]", "Access"}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}]], "Input", 
   CellChangeTimes -> {{3.7749037985717*^9, 3.774903817100175*^9}}, 
   ExpressionUUID -> "1da5a605-1403-4997-8c69-6f84d2d62e53"], 
  Cell[BoxData[RowBox[{"Clone", "=", RowBox[{"PackageFunction", "[", 
        RowBox[{"T_", ",", "\[IndentingNewLine]", 
          RowBox[{"Init", "[", RowBox[{"tensorcontainer", ",", 
              RowBox[{"Normal", "[", "T", "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", RowBox[{"InputType", "\[Rule]", 
            "tensorcontainer"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Caching", "\[Rule]", "Access"}]}], "\[IndentingNewLine]", 
        "]"}]}]], "Input", CellChangeTimes -> 
    {{3.721308742835415*^9, 3.721308779121595*^9}, 3.7213091856936893*^9, 
     3.72132987367542*^9, 3.774903819020796*^9}, 
   ExpressionUUID -> "2d9e714b-dc86-44b1-8576-ba3047f8f94c"], 
  Cell[BoxData[RowBox[{RowBox[{"Displace", "=", 
        RowBox[{"PackageFunction", "[", RowBox[
           {RowBox[{"{", RowBox[{"T_", ",", RowBox[{"S_", "?", "ArrayQ"}]}], 
              "}"}], ",", "\[IndentingNewLine]", RowBox[{"Init", "[", 
              RowBox[{"tensorcontainer", ",", RowBox[{RowBox[{"Normal", "[", 
                    "T", "]"}], "+", RowBox[{"ArrayReshape", "[", RowBox[
                     {"S", ",", RowBox[{"Dimensions", "[", "T", "]"}]}], 
                    "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"InputType", "\[Rule]", "tensorcontainer"}], ",", 
            "\[IndentingNewLine]", RowBox[{"Caching", "\[Rule]", 
              "Access"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.7213088196667757*^9, 3.721308851880198*^9}, 
     {3.721308886646789*^9, 3.721308888734004*^9}, 3.7213091897011967*^9, 
     3.721329863555881*^9, 3.721373334169835*^9, 3.774903820693913*^9}, 
   ExpressionUUID -> "9fe074b6-f0ce-4ace-bf0a-a288b8e346b9"], 
  Cell[BoxData[RowBox[{RowBox[{"TensorType", "=", 
        RowBox[{"PackageFunction", "[", RowBox[{"T_", ",", 
            "\[IndentingNewLine]", RowBox[{"If", "[", RowBox[{RowBox[
                 {"PackedQ", "[", RowBox[{RowBox[{"Normal", "[", "T", "]"}], 
                    ",", "Real"}], "]"}], ",", "\[IndentingNewLine]", "Real", 
                ",", "\[IndentingNewLine]", RowBox[{"If", "[", RowBox[
                   {RowBox[{"PackedQ", "[", RowBox[{RowBox[{"Normal", "[", 
                          "T", "]"}], ",", "Integer"}], "]"}], ",", 
                    "\[IndentingNewLine]", "Integer", ",", 
                    "\[IndentingNewLine]", RowBox[{"If", "[", RowBox[
                       {RowBox[{"PackedQ", "[", RowBox[{RowBox[{"Normal", 
                          "[", "T", "]"}], ",", "Complex"}], "]"}], ",", 
                        "\[IndentingNewLine]", "Complex", ",", 
                        "\[IndentingNewLine]", "None"}], 
                      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
                  "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
            "\[IndentingNewLine]", RowBox[{"InputType", "\[Rule]", 
              "tensorcontainer"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Caching", "\[Rule]", "Access"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.721308875230898*^9, 3.7213089136284323*^9}, 
     3.721309192045541*^9, {3.774903824029799*^9, 3.774903825789447*^9}}, 
   ExpressionUUID -> "a0153134-bf88-4082-a5ac-38e76529b578"], 
  Cell[BoxData[RowBox[{RowBox[{"PackedQ", "=", 
        RowBox[{"PackageFunction", "[", RowBox[{"T_", ",", 
            "\[IndentingNewLine]", RowBox[{"Developer`PackedArrayQ", "[", 
              RowBox[{"Normal", "[", "T", "]"}], "]"}], ",", 
            "\[IndentingNewLine]", RowBox[{"InputType", "\[Rule]", 
              "tensorcontainer"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Caching", "\[Rule]", "Access"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {3.721308894824044*^9, {3.721309058104357*^9, 
      3.721309086390955*^9}, {3.721309352475293*^9, 3.721309389681456*^9}, 
     3.7749038314928303*^9}, ExpressionUUID -> 
    "f033266e-186d-403e-83b8-4c8cc22c99fa"], 
  Cell[BoxData[RowBox[{RowBox[{"PackedQ", "=", 
        RowBox[{"PackageFunction", "[", RowBox[
           {RowBox[{"{", RowBox[{"T_", ",", "type"}], "}"}], ",", 
            "\[IndentingNewLine]", RowBox[{"Developer`PackedArrayQ", "[", 
              RowBox[{RowBox[{"Normal", "[", "T", "]"}], ",", "type"}], 
              "]"}], ",", "\[IndentingNewLine]", RowBox[{"InputType", 
              "\[Rule]", "tensorcontainer"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Caching", "\[Rule]", "Access"}]}], 
          "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.721309394463105*^9, 3.721309401967436*^9}, 
     3.774903835954126*^9}, ExpressionUUID -> 
    "b0166640-3e1d-4019-9c86-f87dbbbb6f3a"], 
  Cell[BoxData[RowBox[{"RandomTensor", "=", 
      RowBox[{"PackageFunction", "[", 
        RowBox[{RowBox[{"{", RowBox[{"spec_", ",", "dims_"}], "}"}], ",", 
          "\[IndentingNewLine]", RowBox[{"Init", "[", 
            RowBox[{"tensorcontainer", ",", RowBox[{"RandomReal", "[", 
                RowBox[{"spec", ",", "dims"}], "]"}]}], "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   ExpressionUUID -> "a1e9d336-8798-46c5-9d14-7dc8e7a882ff"], 
  Cell[BoxData[RowBox[{"FlatValues", "=", RowBox[{"PackageFunction", "[", 
        RowBox[{"T_", ",", "\[IndentingNewLine]", 
          RowBox[{"Flatten", "[", RowBox[{"Normal", "[", "T", "]"}], "]"}], 
          ",", "\[IndentingNewLine]", RowBox[{"InputType", "\[Rule]", 
            "tensorcontainer"}]}], "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.722162735941625*^9, 3.722162750348729*^9}, 
     {3.774903836664205*^9, 3.774903862511612*^9}}, 
   ExpressionUUID -> "439ea534-b58e-47f1-ac58-734444e4e64f"], 
  Cell[BoxData[RowBox[{"VerbatimRegion", "[", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{RowBox[{"tensorcontainer", "/:", RowBox[{"Times", "[", 
            RowBox[{RowBox[{"a_", "?", "NumericQ"}], ",", 
              "T_tensorcontainer"}], "]"}], ":=", 
          RowBox[{"Init", "[", RowBox[{"tensorcontainer", ",", 
              RowBox[{"a", " ", RowBox[{"Normal", "[", "T", "]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tensorcontainer", "/:", RowBox[{"Plus", "[", 
            RowBox[{"T_tensorcontainer", ",", "S_tensorcontainer"}], "]"}], 
          ":=", RowBox[{"Init", "[", RowBox[{"tensorcontainer", ",", 
              RowBox[{RowBox[{"Normal", "[", "T", "]"}], "+", RowBox[
                 {"Normal", "[", "S", "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"tensorcontainer", "/:", RowBox[{"Times", "[", 
            RowBox[{"T_tensorcontainer", ",", "S_tensorcontainer"}], "]"}], 
          ":=", RowBox[{"Init", "[", RowBox[{"tensorcontainer", ",", 
              RowBox[{RowBox[{"Normal", "[", "T", "]"}], " ", RowBox[
                 {"Normal", "[", "S", "]"}]}]}], "]"}]}], ";"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]], "Input", 
   CellChangeTimes -> {{3.7221748547059298*^9, 3.722174932086543*^9}}, 
   ExpressionUUID -> "13a5567f-343b-44b1-9691-98b987394da5"], 
  Cell[BoxData[RowBox[{"Support", "=", RowBox[{"PackageFunction", "[", 
        RowBox[{"u_", ",", "\[IndentingNewLine]", 
          RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"data", "=", 
                  RowBox[{"Normal", "[", "u", "]"}]}], "}"}], ",", 
              "\[IndentingNewLine]", RowBox[{RowBox[{"SparseArray", "[", 
                  RowBox[{"Threshold", "[", RowBox[{"data", ",", RowBox[
                       {"OptionValue", "[", "\"Threshold\"", "]"}]}], "]"}], 
                  "]"}], "[", "\"NonzeroPositions\"", "]"}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"InputType", "\[Rule]", "tensorcontainer"}], ",", 
          "\[IndentingNewLine]", RowBox[{"Options", "\[Rule]", 
            RowBox[{"{", "\[IndentingNewLine]", RowBox[{"\"Threshold\"", 
                "\[Rule]", "Automatic"}], "\[IndentingNewLine]", "}"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.722175363207491*^9, 3.722175366094273*^9}, 
     {3.722175401333132*^9, 3.722175412394578*^9}}, 
   ExpressionUUID -> "d6096b33-f245-4e41-8290-79fbe75c76d1"], 
  Cell[BoxData[RowBox[{"MatrixPlot", "=", RowBox[{"PackageFunction", "[", 
        RowBox[{"u_", ",", "\[IndentingNewLine]", 
          RowBox[{"MatrixPlot", "[", RowBox[{"Normal", "[", "u", "]"}], 
            "]"}], ",", "\[IndentingNewLine]", RowBox[{"InputType", 
            "\[Rule]", "tensorcontainer"}]}], "\[IndentingNewLine]", 
        "]"}]}]], "Input", CellChangeTimes -> {3.774903863871366*^9}, 
   ExpressionUUID -> "31086ce9-e5ba-4dae-ab5a-93d95810bfcf"], 
  Cell[BoxData[RowBox[{"Extract", "=", RowBox[{"PackageFunction", "[", 
        RowBox[{RowBox[{"{", RowBox[{"T_", ",", "args___"}], "}"}], ",", 
          "\[IndentingNewLine]", RowBox[{"Extract", "[", 
            RowBox[{RowBox[{"Normal", "[", "T", "]"}], ",", "args"}], "]"}], 
          ",", "\[IndentingNewLine]", RowBox[{"InputType", "\[Rule]", 
            "tensorcontainer"}]}], "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {3.774903865333798*^9}, 
   ExpressionUUID -> "5571c74d-3080-4216-b13d-c00424b6230d"], 
  Cell[BoxData[RowBox[{"MaxAbs", "=", RowBox[{"PackageFunction", "[", 
        RowBox[{"T_", ",", "\[IndentingNewLine]", 
          RowBox[{"Max", "[", RowBox[{"Abs", "[", RowBox[{"Normal", "[", "T", 
                "]"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"InputType", "\[Rule]", "tensorcontainer"}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.7266388156227617*^9, 3.726638843639015*^9}, 
     3.774903866157296*^9}, ExpressionUUID -> 
    "09ad45fc-a687-4d85-bf02-2dc8fce3b86a"]}, WindowSize -> {1440, 851}, 
 WindowMargins -> {{0, Automatic}, {Automatic, 0}}, 
 FrontEndVersion -> "12.0 for Mac OS X x86 (64-bit) (April 8, 2019)", 
 StyleDefinitions -> "Default.nb"]
