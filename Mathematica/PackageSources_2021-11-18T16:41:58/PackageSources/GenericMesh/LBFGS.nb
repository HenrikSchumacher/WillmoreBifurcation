(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    103364,       1859]
NotebookOptionsPosition[    102970,       1845]
NotebookOutlinePosition[    103308,       1860]
CellTagsIndexPosition[    103265,       1857]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"LBFGS", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M0_", ",", "F_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "FM", ",", "\[IndentingNewLine]", "me", ",", "M", ",", "res", ",", 
        "meshlistQ", ",", "maxwallclocktime", ",", "maxiter", ",", "tic", ",",
         "toc", ",", "\[Tau]tic", ",", "\[Tau]toc", ",", "DF", ",", "DFold", 
        ",", "dir", ",", "maxhistlen", ",", "ResFun", ",", "StopFun", ",", 
        "LineSearch", ",", "StepPred", ",", "StepTrunc", ",", "l", ",", "pt", 
        ",", "r", ",", "H", ",", "Hinv", ",", "s", ",", "y", ",", "\[Rho]", 
        ",", "slist", ",", "ylist", ",", "\[Rho]list", ",", "data", ",", 
        "\[Alpha]list", ",", "c", ",", "Hfun", ",", "\[Tau]min", ",", 
        "\[Tau]max", ",", "Profiler", ",", "infokeys", ",", "profile", ",", 
        "cputoc", ",", "cputic", ",", "StoppedQ"}], "\[IndentingNewLine]", 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"me", "=", "LBFGS"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Profiler", "=", 
        RowBox[{"OptionValue", "[", "\"\<Profiler\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"infokeys", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"$InfoKeys", ",", 
          RowBox[{"{", "\"\<HistoryLength\>\"", "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"M", "\[LeftArrow]", "M0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ClearCache", "[", "M", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"dir", "=", 
        RowBox[{"OptimizationDirection", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ResFun", "=", 
        RowBox[{"OptionValue", "[", "\"\<ResidualFunction\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"maxhistlen", "=", 
        RowBox[{"OptionValue", "[", "\"\<MaxHistoryLength\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"meshlistQ", "=", 
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<CreateMeshList\>\"", "]"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"$MeshList", "=", 
        RowBox[{"If", "[", 
         RowBox[{"meshlistQ", ",", 
          RowBox[{"Init", "[", 
           RowBox[{"meshlist", ",", "M"}], "]"}], ",", "None"}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"maxwallclocktime", "=", 
        RowBox[{"OptionValue", "[", "\"\<MaxWallClockTime\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"NumberQ", "[", "maxwallclocktime", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"maxiter", "=", "\[Infinity]"}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"maxwallclocktime", "=", "\[Infinity]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"maxiter", "=", 
           RowBox[{"OptionValue", "[", "\"\<MaxIterations\>\"", "]"}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"StopFun", "=", 
        RowBox[{"OptionValue", "[", "\"\<StopFunction\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"LineSearch", "=", 
        RowBox[{"OptionValue", "[", "\"\<StepSizeStrategy\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"StepPred", "=", 
        RowBox[{"OptionValue", "[", "\"\<StepSizePredictor\>\"", "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"StepTrunc", "=", 
        RowBox[{"OptionValue", "[", "\"\<StepSizeTruncator\>\"", "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"\[Tau]min", "=", 
        RowBox[{"OptionValue", "[", "\"\<MinStepSize\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"tic", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cputic", "=", 
        RowBox[{"TimeUsed", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"profile", "=", 
        RowBox[{"Profiler", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"FM", "=", 
           RowBox[{"F", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"DF", "=", 
           RowBox[{"DFold", "=", 
            RowBox[{
             RowBox[{"F", "'"}], "[", "M", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"res", "=", 
           RowBox[{"ResFun", "[", 
            RowBox[{"M", ",", "DF"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"StoppedQ", "=", 
           RowBox[{"StopFun", "[", "M", "]"}]}], ";"}], "\[IndentingNewLine]",
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cputoc", "=", 
        RowBox[{"TimeUsed", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"toc", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"PrintTemporary", "[", 
        RowBox[{"Button", "[", 
         RowBox[{"\"\<Stop\>\"", ",", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<Continue\>\"", "]"}], "=", "False"}]}], 
         "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"$S", "=", 
        RowBox[{"Association", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\"\<BigRedButton\>\"", "\[Rule]", 
           RowBox[{"Button", "[", 
            RowBox[{"\"\<Stop\>\"", ",", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<Continue\>\"", "]"}], "=", "False"}]}], 
            "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Iteration\>\"", "\[Rule]", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<MaxIteration\>\"", "\[Rule]", "maxiter"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<WallClockTime\>\"", "\[Rule]", 
           RowBox[{"toc", "-", "tic"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<MaxWallClockTime\>\"", "\[Rule]", "maxwallclocktime"}],
           ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Objective\>\"", "\[Rule]", "FM"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Residual\>\"", "\[Rule]", "res"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Time\>\"", "\[Rule]", 
           RowBox[{"toc", "-", "tic"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<LineSearchTime\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<TotalLineSearchTime\>\"", "\[Rule]", "0."}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<LineSearchExpansions\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<LineSearchContractions\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<InitialStepSize\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<StepSize\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<MaxStepSize\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<StepSizeSucceeded\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<HistoryLength\>\"", "\[Rule]", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<ObjectiveFunction\>\"", "\[Rule]", "F"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<TotalCPUTime\>\"", "\[Rule]", 
           RowBox[{"cputoc", "-", "cputic"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<CPUTime\>\"", "\[Rule]", 
           RowBox[{"cputoc", "-", "cputic"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Profile\>\"", "\[Rule]", "profile"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Method\>\"", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ToString", "[", "me", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"Association", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"\"\<MaxHistoryLength\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<MaxHistoryLength\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<ResidualFunction\>\"", "\[Rule]", "ResFun"}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"\"\<Tolerance\>\"", "\[Rule]", 
                RowBox[{"OptionValue", "[", "\"\<Tolerance\>\"", "]"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"\"\<StopFunction\>\"", "\[Rule]", 
                RowBox[{"OptionValue", "[", "\"\<StopFunction\>\"", "]"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<InitialStepSize\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<InitialStepSize\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<StepSizeStrategy\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<StepSizeStrategy\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<StepSizeOptions\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<StepSizeOptions\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<StepSizePredictor\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<StepSizePredictor\>\"", "]"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"\"\<ResetIfWolfeFails\>\"", "\[Rule]", 
                RowBox[{"Not", "[", 
                 RowBox[{"TrueQ", "[", 
                  RowBox[{"!", 
                   RowBox[{
                   "OptionValue", "[", "\"\<ResetIfWolfeFails\>\"", "]"}]}], 
                  "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<Metric\>\"", "\[Rule]", 
                RowBox[{"OptionValue", "[", "\"\<Metric\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<InverseMetric\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<InverseMetric\>\"", "]"}]}]}], 
              "\[IndentingNewLine]", "]"}]}], "}"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Continue\>\"", "\[Rule]", "True"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<StuckQ\>\"", "\[Rule]", "False"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<StoppedByStopFunction\>\"", "\[Rule]", "StoppedQ"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"$InfoList", "=", 
        RowBox[{"Association", "[", 
         RowBox[{"0", "\[Rule]", 
          RowBox[{
          "$S", "\[LeftDoubleBracket]", "infokeys", 
           "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$S", "[", "\"\<StepSize\>\"", "]"}], "=", 
        RowBox[{"$S", "[", "\"\<InitialStepSize\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Hinv", "=", 
        RowBox[{"OptionValue", "[", "\"\<InverseMetric\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Hinv", "===", "Automatic"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Hfun", "=", 
           RowBox[{"OptionValue", "[", "\"\<Metric\>\"", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"H", "=", 
           RowBox[{"Hfun", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Hinv", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MatrixQ", "[", "H", "]"}], "\[IndentingNewLine]", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"M", "\[Function]", 
              RowBox[{"LinearSolve", "[", 
               RowBox[{"Hfun", "[", "M", "]"}], "]"}]}], 
             "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"M", "\[Function]", 
               RowBox[{"Identity", "&"}]}], ";"}]}], "\[IndentingNewLine]", 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"slist", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"maxhistlen", ",", 
            RowBox[{"DofCount", "[", "M", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ylist", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"maxhistlen", ",", 
            RowBox[{"DofCount", "[", "M", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Rho]list", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", "maxhistlen", "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"pt", "=", "0"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"And", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"$S", "[", "\"\<StoppedByStopFunction\>\"", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"res", ">", 
            RowBox[{"$S", "\[LeftDoubleBracket]", 
             RowBox[{"\"\<Method\>\"", ",", "2", ",", "\"\<Tolerance\>\""}], 
             "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<Iteration\>\"", "]"}], "<", "maxiter"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<WallClockTime\>\"", "]"}], "<", 
            "maxwallclocktime"}], ",", "\[IndentingNewLine]", 
           RowBox[{"!", 
            RowBox[{"$S", "[", "\"\<StuckQ\>\"", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"TrueQ", "[", 
            RowBox[{"$S", "[", "\"\<Continue\>\"", "]"}], "]"}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tic", "=", 
           RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"cputic", "=", 
           RowBox[{"TimeUsed", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"profile", "=", 
           RowBox[{
           "Profiler", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"r", "=", "DF"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"l", ">", "0"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"data", "=", 
                 RowBox[{"ncLBFGSMultiply1", "[", 
                  RowBox[{
                  "r", ",", "slist", ",", "ylist", ",", "\[Rho]list", ",", 
                   "l", ",", "pt"}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"r", "=", 
                 RowBox[{"data", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ";;", 
                   RowBox[{"Length", "[", "r", "]"}]}], 
                  "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"\[Alpha]list", "=", 
                 RowBox[{"data", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "r", "]"}], "+", "1"}], ";;", 
                   RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}], ";"}]}],
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"r", "=", 
              RowBox[{
               RowBox[{"Hinv", "[", "M", "]"}], "[", "r", "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"l", ">", "0"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "=", 
                 RowBox[{"ncLBFGSMultiply2", "[", 
                  RowBox[{
                  "r", ",", "slist", ",", "ylist", ",", "\[Rho]list", ",", 
                   "\[Alpha]list", ",", "l", ",", "pt"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"s", "=", 
              RowBox[{"dir", " ", "r"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"dir", " ", 
                 RowBox[{"DF", ".", "s"}]}], "<", "0."}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"l", "=", "0"}], ";", "\[IndentingNewLine]", 
                RowBox[{"s", "=", 
                 RowBox[{"dir", " ", 
                  RowBox[{
                   RowBox[{"Hinv", "[", "M", "]"}], "[", "DF", "]"}]}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{
                "Print", "[", "\"\<Reverse direction. Resetting history.\>\"",
                  "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"\[Tau]tic", "=", 
              RowBox[{"AbsoluteTime", "[", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Tau]max", "=", 
              RowBox[{"StepTrunc", "[", 
               RowBox[{"M", ",", "s"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"M", "=", 
              RowBox[{"LineSearch", "[", 
               RowBox[{"M", ",", "F", ",", "s", ",", 
                RowBox[{"$S", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "\"\<Method\>\"", ",", "2", ",", "\"\<StepSizeOptions\>\""}],
                  "\[RightDoubleBracket]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"\"\<InitialStepSize\>\"", "\[Rule]", 
                 RowBox[{"StepPred", "[", 
                  RowBox[{"M", ",", "DF", ",", "s", ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"NumericQ", "[", 
                    RowBox[{"$S", "[", "\"\<StepSize\>\"", "]"}], "]"}], ",", 
                    
                    RowBox[{"$S", "[", "\"\<StepSize\>\"", "]"}], ",", 
                    "\[Tau]max"}], "]"}], ",", "\[Tau]max"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                "\"\<MaxStepSize\>\"", "\[Rule]", " ", "\[Tau]max"}]}], 
               "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"\[Tau]toc", "=", 
              RowBox[{"AbsoluteTime", "[", "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
              "$S", "\[LeftDoubleBracket]", "\"\<StepSizeSucceeded\>\"", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"Cache", "[", 
               RowBox[{
               "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<Succeeded\>\""}],
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<Iteration\>\"", "]"}], "++"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"s", "=", 
              RowBox[{"Cache", "[", 
               RowBox[{
               "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<Update\>\""}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"DFold", "=", "DF"}], ";", "\[IndentingNewLine]", 
             RowBox[{"DF", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"F", "'"}], "[", "M", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Cache", "[", 
                 RowBox[{
                 "M", ",", "\"\<LineSearchData\>\"", ",", 
                  "\"\<StepSize\>\""}], "]"}], "<", "\[Tau]min"}], 
               "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"maxhistlen", ">", "0"}], "&&", 
                  RowBox[{"l", ">", "0"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"l", "=", "0"}], ";", "\[IndentingNewLine]", 
                  RowBox[{
                  "Print", "[", "\"\<Tiny step size. History deleted.\>\"", 
                   "]"}], ";"}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"$S", "[", "\"\<StuckQ\>\"", "]"}], "=", "True"}]}],
                 "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"maxhistlen", ">", "0"}], "\[IndentingNewLine]", 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Or", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"$S", "\[LeftDoubleBracket]", 
                    RowBox[{
                    "\"\<Method\>\"", ",", "2", ",", 
                    "\"\<ResetIfWolfeFails\>\""}], 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{
                    "$S", "\[LeftDoubleBracket]", "\"\<StepSizeSucceeded\>\"",
                     "\[RightDoubleBracket]"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"l", "=", 
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{"l", "+", "1"}], ",", "maxhistlen"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"pt", "++"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"y", "=", 
                    RowBox[{"DF", "-", "DFold"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\[Rho]", "=", 
                    RowBox[{"1", "/", 
                    RowBox[{"y", ".", "s"}]}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"c", "=", 
                    RowBox[{"Mod", "[", 
                    RowBox[{"pt", ",", "maxhistlen", ",", "1"}], "]"}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "slist", "\[LeftDoubleBracket]", "c", 
                    "\[RightDoubleBracket]"}], "=", "s"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "ylist", "\[LeftDoubleBracket]", "c", 
                    "\[RightDoubleBracket]"}], "=", "y"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "\[Rho]list", "\[LeftDoubleBracket]", "c", 
                    "\[RightDoubleBracket]"}], "=", "\[Rho]"}], ";"}], 
                    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"l", "=", "0"}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<Linesearch failed. History deleted.\>\"", "]"}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
                 "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]",
               "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<Objective\>\"", "]"}], "=", 
              RowBox[{"F", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<Residual\>\"", "]"}], "=", 
              RowBox[{"res", "=", 
               RowBox[{"ResFun", "[", 
                RowBox[{"M", ",", "DF"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<StoppedByStopFunction\>\"", "]"}], "=", 
              
              RowBox[{"StopFun", "[", "M", "]"}]}], ";"}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"cputoc", "=", 
           RowBox[{"TimeUsed", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"toc", "=", 
           RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<Time\>\"", "]"}], "=", 
           RowBox[{"toc", "-", "tic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<CPUTime\>\"", "]"}], "=", 
           RowBox[{"cputoc", "-", "cputic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<WallClockTime\>\"", "]"}], "=", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<WallClockTime\>\"", "]"}], "+", "toc", 
            "-", "tic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<TotalCPUTime\>\"", "]"}], "=", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<TotalCPUTime\>\"", "]"}], "+", "cputoc", 
            "-", "cputic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<LineSearchTime\>\"", "]"}], "=", 
           RowBox[{"\[Tau]toc", "-", "\[Tau]tic"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<TotalLineSearchTime\>\"", "]"}], "=", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<TotalLineSearchTime\>\"", "]"}], "+", 
            "\[Tau]toc", "-", "\[Tau]tic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<Profile\>\"", "]"}], "=", "profile"}], ";",
           "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<StepSize\>\"", "]"}], "=", 
           RowBox[{"Cache", "[", 
            RowBox[{
            "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<StepSize\>\""}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<MaxStepSize\>\"", "]"}], "=", 
           "\[Tau]max"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<InitialStepSize\>\"", "]"}], "=", 
           RowBox[{"Cache", "[", 
            RowBox[{
            "M", ",", "\"\<LineSearchData\>\"", ",", 
             "\"\<InitialStepSize\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<LineSearchContractions\>\"", "]"}], "=", 
           RowBox[{"Cache", "[", 
            RowBox[{
            "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<Contractions\>\""}],
             "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<LineSearchExpansions\>\"", "]"}], "=", 
           RowBox[{"Cache", "[", 
            RowBox[{
            "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<Expansions\>\""}], 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"$InfoList", ",", 
            RowBox[{
             RowBox[{"$S", "[", "\"\<Iteration\>\"", "]"}], "\[Rule]", 
             RowBox[{
             "$S", "\[LeftDoubleBracket]", "infokeys", 
              "\[RightDoubleBracket]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"meshlistQ", ",", 
            RowBox[{
             RowBox[{"AppendToMeshList", "[", 
              RowBox[{"$MeshList", ",", "M"}], "]"}], ";"}]}], "]"}], ";"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"OptimizationReturnHandler", "[", 
        RowBox[{"me", ",", "M"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"\"\<Errors\>\"", "\[Rule]", "$OptimizationErrors"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"\"\<Warnings\>\"", "\[Rule]", "$OptimizationWarnings"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Options", "\[Rule]", 
     RowBox[{"Join", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\"\<StepSizePredictor\>\"", "\[Rule]", 
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "M", ",", "DF", ",", "searchdirection", ",", "\[Tau]old", ",", 
              "\[Tau]max"}], "}"}], ",", "1."}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<StepSizeStrategy\>\"", "\[Rule]", "WeakWolfePowell"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<StepSizeOptions\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<ExpansionFactor\>\"", "\[Rule]", "2."}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<ArmijoParameter\>\"", "\[Rule]", "0.33"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<WolfeParameter\>\"", "\[Rule]", "0.66"}]}], 
           "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<ResetIfWolfeFails\>\"", "\[Rule]", "False"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"\"\<MaxHistoryLength\>\"", "\[Rule]", "30"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<Metric\>\"", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<InverseMetric\>\"", "\[Rule]", "Automatic"}]}], 
        "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
       "$OptimizationOptions"}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.639460838626183*^9, 3.6394608736312*^9}, {
   3.639460907155924*^9, 3.639460965380426*^9}, {3.639461535760684*^9, 
   3.639461561417651*^9}, {3.639461646244321*^9, 3.639461667180352*^9}, {
   3.639461849322659*^9, 3.639461926160853*^9}, {3.639462228595779*^9, 
   3.639462303947507*^9}, {3.639462375336973*^9, 3.639462376949583*^9}, {
   3.6394627355686483`*^9, 3.639462826381105*^9}, {3.639462939933854*^9, 
   3.639463001699952*^9}, {3.639463084360001*^9, 3.639463094486239*^9}, {
   3.639463169176341*^9, 3.63946317523947*^9}, {3.639464672092042*^9, 
   3.639464672331571*^9}, {3.63946481903333*^9, 3.639464831764217*^9}, {
   3.639465081478547*^9, 3.639465121813917*^9}, {3.639465529774518*^9, 
   3.63946553257419*^9}, {3.639473169114295*^9, 3.63947325106853*^9}, {
   3.6394733422030697`*^9, 3.63947335126987*^9}, {3.639473384187064*^9, 
   3.639473385607481*^9}, {3.6394734466366568`*^9, 3.639473474249461*^9}, {
   3.6394736611046133`*^9, 3.639473665254208*^9}, {3.639475339241949*^9, 
   3.639475426745132*^9}, {3.6394754618189774`*^9, 3.639475722833591*^9}, {
   3.6394757909547043`*^9, 3.639475799931398*^9}, {3.6394758475963497`*^9, 
   3.639475911205947*^9}, {3.639475995034284*^9, 3.639475997927931*^9}, {
   3.6394760434128237`*^9, 3.63947604600243*^9}, {3.639476188078114*^9, 
   3.6394761970225267`*^9}, {3.6394762557440557`*^9, 3.639476334751068*^9}, {
   3.639476402961535*^9, 3.639476434026843*^9}, {3.639476467731566*^9, 
   3.639476486258012*^9}, {3.639476516517709*^9, 3.6394765190761642`*^9}, {
   3.639476661128187*^9, 3.6394766766242743`*^9}, {3.639476785274866*^9, 
   3.639476806219809*^9}, {3.639476892919238*^9, 3.639476936438469*^9}, {
   3.639477462643079*^9, 3.6394775189323397`*^9}, {3.6394776141513567`*^9, 
   3.639477630391424*^9}, {3.6394806702405357`*^9, 3.6394806724763193`*^9}, 
   3.639480719569315*^9, {3.639481127104061*^9, 3.639481129055697*^9}, {
   3.639481198285575*^9, 3.6394812038587503`*^9}, 3.6394815926624727`*^9, {
   3.639483111112419*^9, 3.639483186952812*^9}, 3.639483492759626*^9, {
   3.639483532059104*^9, 3.639483532472477*^9}, {3.639483747536379*^9, 
   3.639483747829479*^9}, {3.639483938813579*^9, 3.639483980908681*^9}, {
   3.639484011308712*^9, 3.639484014516231*^9}, {3.639484064734727*^9, 
   3.639484067036921*^9}, {3.6394842331059723`*^9, 3.639484235537631*^9}, {
   3.639484364178307*^9, 3.639484365706057*^9}, {3.639484527890926*^9, 
   3.639484530087846*^9}, {3.639484572713933*^9, 3.639484573105886*^9}, {
   3.639484817323873*^9, 3.639484819191551*^9}, {3.6394848801131907`*^9, 
   3.63948490408041*^9}, {3.639485034008451*^9, 3.639485066158008*^9}, {
   3.6394852675070267`*^9, 3.639485311852272*^9}, {3.639485419283743*^9, 
   3.6394856163994627`*^9}, {3.639485649332361*^9, 3.639485664026725*^9}, {
   3.63948585761569*^9, 3.639485873699469*^9}, {3.639486311755965*^9, 
   3.639486328098269*^9}, 3.639487121309123*^9, {3.6394897003023148`*^9, 
   3.63948970399395*^9}, {3.639491103016193*^9, 3.639491104228427*^9}, {
   3.639491137787311*^9, 3.6394911513738117`*^9}, {3.639491183974443*^9, 
   3.63949130051994*^9}, {3.6394913357616453`*^9, 3.639491345889929*^9}, {
   3.639491575557766*^9, 3.639491628190785*^9}, {3.639491670236063*^9, 
   3.639491686065816*^9}, {3.639491716212152*^9, 3.639491756411058*^9}, {
   3.63949181643563*^9, 3.639491817204344*^9}, {3.639491889472089*^9, 
   3.639491891284484*^9}, {3.639493864041625*^9, 3.639493888823759*^9}, {
   3.639493935425601*^9, 3.639493939728866*^9}, {3.6394939731294317`*^9, 
   3.639493991378584*^9}, {3.639494022834504*^9, 3.6394941426087523`*^9}, {
   3.6394941752157927`*^9, 3.6394942564306393`*^9}, 3.639494344028215*^9, {
   3.6395005371728*^9, 3.639500580355207*^9}, {3.639500718183243*^9, 
   3.639500726578917*^9}, {3.6395008948155003`*^9, 3.639500922844208*^9}, {
   3.6395010374882*^9, 3.6395010385203047`*^9}, 3.6395011236996107`*^9, {
   3.6395013553111353`*^9, 3.639501363992764*^9}, {3.639537714663927*^9, 
   3.639537733823123*^9}, {3.639538630096183*^9, 3.639538640783764*^9}, {
   3.639538757406901*^9, 3.639538757730032*^9}, {3.63953916763503*^9, 
   3.639539189591083*^9}, {3.639539453372991*^9, 3.639539456089188*^9}, {
   3.639539554063542*^9, 3.639539600792432*^9}, {3.639540097066194*^9, 
   3.639540097438613*^9}, {3.639540552302988*^9, 3.639540555732497*^9}, {
   3.6395409392398157`*^9, 3.639540946195422*^9}, {3.639541156875165*^9, 
   3.639541173780776*^9}, {3.639632401114334*^9, 3.6396325142526484`*^9}, {
   3.639632554748961*^9, 3.63963256018954*^9}, {3.639632606602233*^9, 
   3.639632667518742*^9}, {3.639632707211173*^9, 3.6396327106016293`*^9}, {
   3.6396328866083107`*^9, 3.63963289317339*^9}, {3.639632948513802*^9, 
   3.639632987592626*^9}, {3.6411345801006517`*^9, 3.6411346227231092`*^9}, {
   3.641134660612506*^9, 3.641134727448091*^9}, {3.6411347611863823`*^9, 
   3.641134794842704*^9}, 3.6411348422493553`*^9, {3.641134923532764*^9, 
   3.6411349237078876`*^9}, {3.641135354701386*^9, 3.641135375067137*^9}, {
   3.641135683974835*^9, 3.6411356958350477`*^9}, {3.641448194109501*^9, 
   3.6414481963863153`*^9}, {3.6414520394525633`*^9, 3.641452061717186*^9}, {
   3.6414521363845882`*^9, 3.6414521391253633`*^9}, {3.6414559197093153`*^9, 
   3.641455943485127*^9}, {3.641456373960422*^9, 3.641456381930924*^9}, {
   3.6414830539807463`*^9, 3.641483199394305*^9}, {3.641483271821649*^9, 
   3.641483324413054*^9}, {3.641483478729372*^9, 3.641483529375443*^9}, {
   3.641483667699512*^9, 3.641483695104206*^9}, {3.641484212161018*^9, 
   3.641484214869299*^9}, {3.641484439257092*^9, 3.641484479928273*^9}, {
   3.641484544665207*^9, 3.641484595319477*^9}, {3.645104332890296*^9, 
   3.6451043557943087`*^9}, {3.645104390972728*^9, 3.6451043936378736`*^9}, {
   3.645104456868718*^9, 3.645104463575967*^9}, {3.64510461223761*^9, 
   3.645104617023185*^9}, 3.645894120592732*^9, {3.645894156888104*^9, 
   3.645894259042923*^9}, {3.645897748606764*^9, 3.645897801873472*^9}, {
   3.646671048737813*^9, 3.6466710563790493`*^9}, {3.6466711081758537`*^9, 
   3.6466711105181227`*^9}, {3.646671388153948*^9, 3.6466714094179983`*^9}, {
   3.646671495525179*^9, 3.6466715201092587`*^9}, {3.6466715676829023`*^9, 
   3.646671577457068*^9}, {3.646679541607732*^9, 3.646679544711813*^9}, {
   3.646981666710863*^9, 3.646981681088763*^9}, {3.646981784973336*^9, 
   3.64698179312182*^9}, {3.646982123141691*^9, 3.6469821307205877`*^9}, {
   3.6469872803364887`*^9, 3.646987337385795*^9}, {3.646987389624179*^9, 
   3.64698741842846*^9}, {3.646987491749048*^9, 3.646987492179472*^9}, {
   3.646987806401108*^9, 3.646987806590694*^9}, {3.648097976682378*^9, 
   3.6480979889180593`*^9}, 3.64809814277599*^9, {3.649241579372106*^9, 
   3.6492415815940866`*^9}, {3.65207487480092*^9, 3.65207488312658*^9}, {
   3.652074922032058*^9, 3.652074958067649*^9}, {3.652075028644932*^9, 
   3.6520750448471622`*^9}, {3.652075075351132*^9, 3.652075331158884*^9}, {
   3.652075393356098*^9, 3.6520754177600117`*^9}, {3.652075472297984*^9, 
   3.652075581991962*^9}, {3.6520756290349283`*^9, 3.652075629545662*^9}, {
   3.652075674770533*^9, 3.652075710671866*^9}, {3.652076667214754*^9, 
   3.652076668817176*^9}, {3.652076775144637*^9, 3.652076777628295*^9}, {
   3.652086337610968*^9, 3.652086382481645*^9}, {3.665556171829764*^9, 
   3.665556192831489*^9}, {3.665556255471731*^9, 3.6655562578184566`*^9}, 
   3.6655568903869543`*^9, {3.6657730591868477`*^9, 3.665773063133769*^9}, {
   3.665773114013151*^9, 3.665773117270718*^9}, {3.689926620139492*^9, 
   3.689926675063148*^9}, {3.689926712548479*^9, 3.6899268005232153`*^9}, 
   3.6899268736248903`*^9, {3.689927073295137*^9, 3.689927243300363*^9}, {
   3.6899290587347517`*^9, 3.6899290742472687`*^9}, {3.68994240900799*^9, 
   3.689942409707511*^9}, {3.690380621387594*^9, 3.6903806371612597`*^9}, {
   3.690380703750863*^9, 3.690380703973703*^9}, {3.709215440646678*^9, 
   3.709215476247569*^9}, {3.709262266697977*^9, 3.709262277428904*^9}, {
   3.785149600612905*^9, 3.785149685385076*^9}, {3.785149768520733*^9, 
   3.7851497834065447`*^9}, {3.7853967140976353`*^9, 3.785396726614008*^9}, {
   3.785396889898143*^9, 3.7853970476614857`*^9}, {3.785397131043425*^9, 
   3.7853972083747272`*^9}, {3.785397250029893*^9, 3.785397357816403*^9}, {
   3.78539742468412*^9, 3.785397552088554*^9}, {3.785397626643927*^9, 
   3.785397901505143*^9}, {3.785397934246297*^9, 3.785398119201564*^9}, {
   3.7853982001818*^9, 3.785398225329742*^9}, {3.785398260620448*^9, 
   3.785398443587265*^9}, {3.78539856328292*^9, 3.78539863791796*^9}, {
   3.7854002028127203`*^9, 3.785400347383552*^9}, {3.785400399623*^9, 
   3.785400460354987*^9}, {3.785400594526841*^9, 3.7854006291657143`*^9}, {
   3.7854006727418833`*^9, 3.7854007312165403`*^9}, {3.7854008036957407`*^9, 
   3.785400879931655*^9}, 3.785401005829153*^9, {3.785401105363576*^9, 
   3.7854011305387373`*^9}, {3.785401161450629*^9, 3.785401163288557*^9}, {
   3.7854012491916018`*^9, 3.785401259821694*^9}, {3.785401531506789*^9, 
   3.785401603238617*^9}, {3.7854016412634783`*^9, 3.7854016629663773`*^9}, {
   3.785401693813253*^9, 3.7854016987228737`*^9}, {3.785401800532091*^9, 
   3.7854018160814123`*^9}, {3.785402585521961*^9, 3.785402601171266*^9}, {
   3.785402638993196*^9, 3.785402660782735*^9}, {3.78540280691525*^9, 
   3.785402969476186*^9}, {3.7854033165834627`*^9, 3.785403331475667*^9}, {
   3.7854036183395147`*^9, 3.785403723624939*^9}, {3.785403809222529*^9, 
   3.7854038516438713`*^9}, {3.78540389813898*^9, 3.785404149313815*^9}, 
   3.785404184544024*^9, {3.785404218237701*^9, 3.785404305434639*^9}, {
   3.785404377359939*^9, 3.785404385255204*^9}, {3.7854044356640453`*^9, 
   3.785404438629982*^9}, {3.7854052090457706`*^9, 3.785405229413001*^9}, {
   3.785406130982534*^9, 3.785406148829383*^9}, {3.785406474737967*^9, 
   3.78540650098986*^9}, {3.785406634998157*^9, 3.785406652602358*^9}, 
   3.7854067374406643`*^9, {3.785407042811829*^9, 3.785407043195108*^9}, {
   3.785407159678364*^9, 3.7854071598763866`*^9}, {3.78540750149618*^9, 
   3.785407503285762*^9}, {3.785407624116951*^9, 3.785407626903878*^9}, {
   3.785407766885305*^9, 3.78540776709256*^9}, {3.7854078060694323`*^9, 
   3.785407838377893*^9}, {3.7854082432178717`*^9, 3.785408245616851*^9}, {
   3.785408582549189*^9, 3.785408587797983*^9}, {3.785408674404807*^9, 
   3.785408681570753*^9}, {3.785408976730242*^9, 3.7854089772476473`*^9}, {
   3.785409544803318*^9, 3.78540955900434*^9}, {3.785409739099017*^9, 
   3.785409742531693*^9}, {3.7854098579187737`*^9, 3.785409859913332*^9}, {
   3.785410427865115*^9, 3.78541048251431*^9}, {3.785410573895604*^9, 
   3.785410737311296*^9}, {3.785410788917206*^9, 3.7854108510885277`*^9}, {
   3.785410899251417*^9, 3.785410924126788*^9}, {3.785411220651082*^9, 
   3.785411359905917*^9}, {3.785411427304536*^9, 3.785411623627164*^9}, {
   3.7854117325867157`*^9, 3.7854117350927143`*^9}, {3.785411851440518*^9, 
   3.7854118792464113`*^9}, {3.785415703254931*^9, 3.7854157039428596`*^9}, {
   3.78541583830387*^9, 3.785415841268818*^9}, {3.785415975688805*^9, 
   3.7854159798742657`*^9}, {3.785416011020165*^9, 3.785416047557496*^9}, {
   3.7854160826924257`*^9, 3.785416098984991*^9}, {3.7854161425711308`*^9, 
   3.785416158747335*^9}, {3.785416235200934*^9, 3.785416308334074*^9}, {
   3.785416346893916*^9, 3.785416428312808*^9}, {3.785416512439086*^9, 
   3.785416536607896*^9}, {3.7854165889709377`*^9, 3.7854165919529552`*^9}, {
   3.785416674334963*^9, 3.785416708264099*^9}, {3.7854167492475243`*^9, 
   3.785416774309349*^9}, 3.785416838069476*^9, {3.785416901166387*^9, 
   3.785416908145937*^9}, 3.7854169579931593`*^9, {3.785417007220003*^9, 
   3.785417043817416*^9}, {3.785417085659012*^9, 3.785417130656193*^9}, {
   3.785417161298172*^9, 3.785417208547166*^9}, {3.785417239939191*^9, 
   3.785417240131617*^9}, {3.785417319418935*^9, 3.7854173314468927`*^9}, {
   3.785417532444821*^9, 3.785417547592319*^9}, {3.785417622934198*^9, 
   3.785417623148488*^9}, {3.785417658548501*^9, 3.785417668251692*^9}, {
   3.785417789297619*^9, 3.785417794919187*^9}, {3.7854184017117243`*^9, 
   3.785418404366295*^9}, {3.785418443773943*^9, 3.785418443957595*^9}, {
   3.785418511796256*^9, 3.785418532723536*^9}, {3.785419158420994*^9, 
   3.785419168282895*^9}, {3.7854203244608803`*^9, 3.7854203609517736`*^9}, 
   3.785994845732717*^9, 3.785994916693564*^9, {3.78627532797295*^9, 
   3.78627534882442*^9}, {3.795248985102727*^9, 3.795248986799115*^9}, {
   3.795421322621805*^9, 3.795421324828373*^9}, 3.795421405288517*^9, {
   3.795422331790062*^9, 3.7954223801255207`*^9}, {3.795422682396916*^9, 
   3.795422699353573*^9}, {3.7954227342899303`*^9, 3.795422760650217*^9}, {
   3.7954228866374607`*^9, 3.795422891092695*^9}, {3.795422960681223*^9, 
   3.795423022896661*^9}, {3.795423413228499*^9, 3.7954234452172327`*^9}, {
   3.7954240815358353`*^9, 3.795424106810553*^9}, {3.795424425231637*^9, 
   3.79542445798778*^9}, {3.79542538398628*^9, 3.795425388739189*^9}, {
   3.795425975013568*^9, 3.7954259793880987`*^9}, {3.795435542920741*^9, 
   3.79543555100963*^9}, 3.795435596267558*^9, {3.7954356366156693`*^9, 
   3.79543565142135*^9}, {3.795435689111713*^9, 3.795435728427985*^9}, {
   3.795435830408578*^9, 3.795435831606485*^9}, {3.795435930139923*^9, 
   3.7954359348893337`*^9}, {3.795436205514056*^9, 3.795436226799365*^9}, {
   3.795492994903701*^9, 3.795493000519306*^9}, 3.795493107541306*^9, {
   3.7954939852301397`*^9, 3.795493993834094*^9}, {3.7954946207422647`*^9, 
   3.795494622427121*^9}, 3.7954948250674047`*^9, {3.795494982759119*^9, 
   3.7954950006372137`*^9}, {3.795495312643736*^9, 3.79549535913428*^9}, {
   3.795495409341927*^9, 3.795495463898362*^9}, {3.79549724430828*^9, 
   3.7954972661437817`*^9}, {3.7954973368897448`*^9, 3.795497338975234*^9}, {
   3.795497385505556*^9, 3.795497387350585*^9}, {3.795497635989105*^9, 
   3.795497636255536*^9}, {3.795497681777852*^9, 3.795497697625435*^9}, {
   3.795497855942487*^9, 3.795497874500555*^9}, {3.795498038034593*^9, 
   3.795498049469446*^9}, {3.79549810798238*^9, 3.79549813665948*^9}, {
   3.7954982928277483`*^9, 3.7954983619705276`*^9}, {3.7954985538354397`*^9, 
   3.795498601838396*^9}, {3.7954986461125307`*^9, 3.795498697238131*^9}, {
   3.79549893960531*^9, 3.7954989758199043`*^9}, 3.795499096870755*^9, {
   3.7954993281693363`*^9, 3.7954993680315733`*^9}, {3.7954993992105637`*^9, 
   3.795499422928361*^9}, {3.795499494162901*^9, 3.7954994973456907`*^9}, 
   3.795499529776017*^9, {3.795499886788723*^9, 3.795499889504119*^9}, {
   3.795499965136326*^9, 3.795500033787484*^9}, {3.795501032119858*^9, 
   3.79550103377628*^9}, 3.7955011161868753`*^9, {3.795509155821053*^9, 
   3.795509174083006*^9}, {3.795509264506928*^9, 3.795509306558928*^9}, {
   3.795510849383915*^9, 3.795510885924728*^9}, {3.795511201605257*^9, 
   3.795511206338481*^9}, {3.795511242662428*^9, 3.795511254199099*^9}, {
   3.795511401202579*^9, 3.7955114492396317`*^9}, {3.7955114800535917`*^9, 
   3.795511577825634*^9}, {3.795511622842503*^9, 3.7955116230829287`*^9}, {
   3.795511859433358*^9, 3.7955118599357367`*^9}, {3.79551197396668*^9, 
   3.795511975607759*^9}, {3.795512140680641*^9, 3.795512211611163*^9}, {
   3.795512825980838*^9, 3.7955128473338346`*^9}, {3.795512879117028*^9, 
   3.795512880492278*^9}, 3.795513161002789*^9, {3.795513218137643*^9, 
   3.795513233522143*^9}, {3.795513306750054*^9, 3.795513307324469*^9}, {
   3.795536067659287*^9, 3.795536083707095*^9}, {3.7955369279322977`*^9, 
   3.795536928223029*^9}, {3.795578235477359*^9, 3.795578337337715*^9}, {
   3.795579089309374*^9, 3.795579089740189*^9}, {3.79557916622683*^9, 
   3.7955792090857897`*^9}, {3.795579291770926*^9, 3.7955793021816063`*^9}, {
   3.795579348679388*^9, 3.795579403859326*^9}, {3.795579435881002*^9, 
   3.795579457615583*^9}, {3.7955794887233953`*^9, 3.795579495911871*^9}, {
   3.795579534992852*^9, 3.79557955219872*^9}, {3.795579603348063*^9, 
   3.7955796574021807`*^9}, {3.795586336552462*^9, 3.7955863442871637`*^9}, {
   3.795586698335443*^9, 3.795586704599969*^9}, {3.79558677245313*^9, 
   3.7955867787592573`*^9}, {3.795587296931958*^9, 3.795587298773712*^9}, {
   3.795587328893111*^9, 3.7955873478174467`*^9}, {3.795588522165743*^9, 
   3.795588530557889*^9}, {3.795592336329548*^9, 3.79559240508646*^9}, {
   3.795593617936123*^9, 3.7955936223292294`*^9}, 3.795601830377775*^9, {
   3.7956018716812067`*^9, 3.7956019170172367`*^9}, {3.795604794062977*^9, 
   3.795604842545795*^9}, {3.7956639994994926`*^9, 3.7956640331549063`*^9}, {
   3.79566407030873*^9, 3.795664122831092*^9}, 3.795664188958273*^9, {
   3.795664222622843*^9, 3.795664265650139*^9}, {3.795664416112852*^9, 
   3.795664450860243*^9}, {3.795666517946883*^9, 3.79566651902561*^9}, {
   3.795669254493608*^9, 3.795669257897511*^9}, {3.795678400213657*^9, 
   3.795678403694294*^9}, {3.7957625582581778`*^9, 3.7957625699848223`*^9}, 
   3.795763316193946*^9, {3.7957633633890057`*^9, 3.795763411163146*^9}, {
   3.795763689268675*^9, 3.795763735400329*^9}, {3.795764387704969*^9, 
   3.795764389851214*^9}, {3.7957644224313803`*^9, 3.795764425469556*^9}, {
   3.7957708377890253`*^9, 3.795770921343758*^9}, {3.7957717064736347`*^9, 
   3.7957717086099157`*^9}, {3.795789622946434*^9, 3.795789623209646*^9}, {
   3.7958542165510073`*^9, 3.795854229254216*^9}, 3.7958610310087442`*^9, {
   3.7960114102947073`*^9, 3.79601141129452*^9}, {3.796462518526812*^9, 
   3.796462520307829*^9}, {3.796486955592256*^9, 3.796487056045032*^9}, {
   3.796487111675411*^9, 3.796487113730345*^9}, {3.7966289291278563`*^9, 
   3.796628939341522*^9}, {3.796628971829479*^9, 3.796628975051968*^9}, {
   3.796629165258173*^9, 3.7966291970750217`*^9}, {3.7966292363798513`*^9, 
   3.796629291805192*^9}, {3.796629325405587*^9, 3.796629334347837*^9}, {
   3.796629646696965*^9, 3.796629654297112*^9}, {3.7966296845357523`*^9, 
   3.7966297108441343`*^9}, {3.796631172253912*^9, 3.796631179296584*^9}, {
   3.796631477691534*^9, 3.796631490658641*^9}, {3.796632094288994*^9, 
   3.796632098845182*^9}, 3.796632130255909*^9, 3.79664396162148*^9, {
   3.796806820086153*^9, 3.7968068211952457`*^9}, {3.79689686901569*^9, 
   3.7968969213991537`*^9}, 3.796900254594039*^9, {3.796900288955154*^9, 
   3.796900356920175*^9}, {3.796900634962775*^9, 3.7969006631107903`*^9}, {
   3.796901551838482*^9, 3.79690155210723*^9}, 3.796902431570539*^9, {
   3.796930400700293*^9, 3.7969305440395412`*^9}, {3.7969307233823013`*^9, 
   3.796930773797471*^9}, {3.796930888487414*^9, 3.796930948351922*^9}, {
   3.796930984159103*^9, 3.796930985523507*^9}, {3.796931669956356*^9, 
   3.7969316907443523`*^9}, {3.796935909395911*^9, 3.796935922739641*^9}, {
   3.796968445573859*^9, 3.796968446096154*^9}, {3.796968518819417*^9, 
   3.796968565089477*^9}, {3.7969686046674767`*^9, 3.796968620224299*^9}, {
   3.796968782980618*^9, 3.796968785047968*^9}, {3.797003808138853*^9, 
   3.797003873726993*^9}, {3.797004051936213*^9, 3.797004077722343*^9}, {
   3.797004305776863*^9, 3.797004309757513*^9}, {3.79700439913148*^9, 
   3.79700443844074*^9}, {3.797004598883669*^9, 3.7970046167859917`*^9}, {
   3.797006854917995*^9, 3.797006935548244*^9}, {3.797006974450308*^9, 
   3.797006992369129*^9}, {3.797007035953318*^9, 3.797007103332567*^9}, {
   3.797015437571292*^9, 3.797015459997143*^9}, {3.797015495827669*^9, 
   3.7970155199361362`*^9}, {3.797015600222069*^9, 3.7970156133488283`*^9}, {
   3.797015662973652*^9, 3.797015684995098*^9}, 3.7974112040341673`*^9, 
   3.797751588405517*^9, {3.797751668459787*^9, 3.797751668667994*^9}, {
   3.799137044247108*^9, 3.7991370457717657`*^9}, {3.799137124084114*^9, 
   3.799137149431477*^9}, {3.7991371869105797`*^9, 3.799137241203836*^9}, {
   3.799137398923644*^9, 3.799137439385953*^9}, {3.7991377641510468`*^9, 
   3.799137842147217*^9}, {3.799138087043146*^9, 3.799138090762278*^9}, 
   3.7991383207390842`*^9, {3.7991383690256844`*^9, 3.799138401063589*^9}, {
   3.799138643632249*^9, 3.799138648957941*^9}, {3.7991386823738317`*^9, 
   3.799138682538351*^9}, {3.799138941125319*^9, 3.799138943698143*^9}, {
   3.799145122612871*^9, 3.79914515620373*^9}, {3.7991454529386053`*^9, 
   3.799145458049436*^9}, {3.799209208386445*^9, 3.799209227679349*^9}, {
   3.799545524772111*^9, 3.799545555979569*^9}, {3.844079286851493*^9, 
   3.844079317610257*^9}, {3.8440793676878*^9, 3.84407944662149*^9}, {
   3.844079486899213*^9, 3.844079510243557*^9}, 3.844079625550983*^9, {
   3.844079833319271*^9, 
   3.8440798365030727`*^9}},ExpressionUUID->"65aad035-93d2-4487-a350-\
d04277911656"],

Cell[BoxData[
 RowBox[{"ConstrainedLBFGS", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", "M0_", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "FM", ",", "\[IndentingNewLine]", "me", ",", "M", ",", "res", ",", 
        "meshlistQ", ",", "maxwallclocktime", ",", "maxiter", ",", "tic", ",",
         "toc", ",", "\[Tau]tic", ",", "\[Tau]toc", ",", "DF", ",", "DFold", 
        ",", "dir", ",", "maxhistlen", ",", "ResFun", ",", "StopFun", ",", 
        "LineSearch", ",", "StepPred", ",", "StepTrunc", ",", "l", ",", "pt", 
        ",", "r", ",", "H", ",", "Hinv", ",", "s", ",", "y", ",", "\[Rho]", 
        ",", "slist", ",", "ylist", ",", "\[Rho]list", ",", "data", ",", 
        "\[Alpha]list", ",", "c", ",", "Hfun", ",", "\[Tau]min", ",", 
        "\[Tau]max", ",", "Profiler", ",", "infokeys", ",", "profile", ",", 
        "cputoc", ",", "cputic", ",", "StoppedQ"}], "\[IndentingNewLine]", 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"me", "=", "LBFGS"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Profiler", "=", 
        RowBox[{"OptionValue", "[", "\"\<Profiler\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"infokeys", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"$InfoKeys", ",", 
          RowBox[{"{", "\"\<HistoryLength\>\"", "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"M", "\[LeftArrow]", "M0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ClearCache", "[", "M", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"dir", "=", 
        RowBox[{"OptimizationDirection", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ResFun", "=", 
        RowBox[{"OptionValue", "[", "\"\<ResidualFunction\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"maxhistlen", "=", 
        RowBox[{"OptionValue", "[", "\"\<MaxHistoryLength\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"meshlistQ", "=", 
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "\"\<CreateMeshList\>\"", "]"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"$MeshList", "=", 
        RowBox[{"If", "[", 
         RowBox[{"meshlistQ", ",", 
          RowBox[{"Init", "[", 
           RowBox[{"meshlist", ",", "M"}], "]"}], ",", "None"}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"maxwallclocktime", "=", 
        RowBox[{"OptionValue", "[", "\"\<MaxWallClockTime\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"NumberQ", "[", "maxwallclocktime", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"maxiter", "=", "\[Infinity]"}], ";"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"maxwallclocktime", "=", "\[Infinity]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"maxiter", "=", 
           RowBox[{"OptionValue", "[", "\"\<MaxIterations\>\"", "]"}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"StopFun", "=", 
        RowBox[{"OptionValue", "[", "\"\<StopFunction\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"LineSearch", "=", 
        RowBox[{"OptionValue", "[", "\"\<StepSizeStrategy\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"StepPred", "=", 
        RowBox[{"OptionValue", "[", "\"\<StepSizePredictor\>\"", "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"StepTrunc", "=", 
        RowBox[{"OptionValue", "[", "\"\<StepSizeTruncator\>\"", "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"\[Tau]min", "=", 
        RowBox[{"OptionValue", "[", "\"\<MinStepSize\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"tic", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cputic", "=", 
        RowBox[{"TimeUsed", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"profile", "=", 
        RowBox[{"Profiler", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"FM", "=", 
           RowBox[{"Energy", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"DF", "=", 
           RowBox[{"DFold", "=", 
            RowBox[{
             RowBox[{"Energy", "'"}], "[", "M", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"res", "=", 
           RowBox[{"ResFun", "[", 
            RowBox[{"M", ",", "DF"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"StoppedQ", "=", 
           RowBox[{"StopFun", "[", "M", "]"}]}], ";"}], "\[IndentingNewLine]",
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cputoc", "=", 
        RowBox[{"TimeUsed", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"toc", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"PrintTemporary", "[", 
        RowBox[{"Button", "[", 
         RowBox[{"\"\<Stop\>\"", ",", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<Continue\>\"", "]"}], "=", "False"}]}], 
         "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"$S", "=", 
        RowBox[{"Association", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\"\<BigRedButton\>\"", "\[Rule]", 
           RowBox[{"Button", "[", 
            RowBox[{"\"\<Stop\>\"", ",", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<Continue\>\"", "]"}], "=", "False"}]}], 
            "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Iteration\>\"", "\[Rule]", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<MaxIteration\>\"", "\[Rule]", "maxiter"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<WallClockTime\>\"", "\[Rule]", 
           RowBox[{"toc", "-", "tic"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<MaxWallClockTime\>\"", "\[Rule]", "maxwallclocktime"}],
           ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Objective\>\"", "\[Rule]", "FM"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Residual\>\"", "\[Rule]", "res"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Time\>\"", "\[Rule]", 
           RowBox[{"toc", "-", "tic"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<LineSearchTime\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<TotalLineSearchTime\>\"", "\[Rule]", "0."}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<LineSearchExpansions\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<LineSearchContractions\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<InitialStepSize\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<StepSize\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<MaxStepSize\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<StepSizeSucceeded\>\"", "\[Rule]", 
           RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<HistoryLength\>\"", "\[Rule]", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<ObjectiveFunction\>\"", "\[Rule]", 
           RowBox[{"EnergyList", "[", "M", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<TotalCPUTime\>\"", "\[Rule]", 
           RowBox[{"cputoc", "-", "cputic"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<CPUTime\>\"", "\[Rule]", 
           RowBox[{"cputoc", "-", "cputic"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<Profile\>\"", "\[Rule]", "profile"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Method\>\"", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ToString", "[", "me", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"Association", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"\"\<MaxHistoryLength\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<MaxHistoryLength\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<ResidualFunction\>\"", "\[Rule]", "ResFun"}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"\"\<Tolerance\>\"", "\[Rule]", 
                RowBox[{"OptionValue", "[", "\"\<Tolerance\>\"", "]"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"\"\<StopFunction\>\"", "\[Rule]", 
                RowBox[{"OptionValue", "[", "\"\<StopFunction\>\"", "]"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<InitialStepSize\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<InitialStepSize\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<StepSizeStrategy\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<StepSizeStrategy\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<StepSizeOptions\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<StepSizeOptions\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<StepSizePredictor\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<StepSizePredictor\>\"", "]"}]}], ",",
                "\[IndentingNewLine]", 
               RowBox[{"\"\<ResetIfWolfeFails\>\"", "\[Rule]", 
                RowBox[{"Not", "[", 
                 RowBox[{"TrueQ", "[", 
                  RowBox[{"!", 
                   RowBox[{
                   "OptionValue", "[", "\"\<ResetIfWolfeFails\>\"", "]"}]}], 
                  "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<Metric\>\"", "\[Rule]", 
                RowBox[{"OptionValue", "[", "\"\<Metric\>\"", "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<InverseMetric\>\"", "\[Rule]", 
                RowBox[{
                "OptionValue", "[", "\"\<InverseMetric\>\"", "]"}]}]}], 
              "\[IndentingNewLine]", "]"}]}], "}"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<Continue\>\"", "\[Rule]", "True"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<StuckQ\>\"", "\[Rule]", "False"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<StoppedByStopFunction\>\"", "\[Rule]", "StoppedQ"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"$InfoList", "=", 
        RowBox[{"Association", "[", 
         RowBox[{"0", "\[Rule]", 
          RowBox[{
          "$S", "\[LeftDoubleBracket]", "infokeys", 
           "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"$S", "[", "\"\<StepSize\>\"", "]"}], "=", 
        RowBox[{"$S", "[", "\"\<InitialStepSize\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Hinv", "=", 
        RowBox[{"M", "\[Function]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"SystemSolve", "[", 
             RowBox[{
              RowBox[{"MetricSaddlePointSystem", "[", "M", "]"}], ",", "#"}], 
             "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"slist", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"maxhistlen", ",", 
            RowBox[{"DofCount", "[", "M", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ylist", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", 
           RowBox[{"maxhistlen", ",", 
            RowBox[{"DofCount", "[", "M", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Rho]list", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0.", ",", 
          RowBox[{"{", "maxhistlen", "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"l", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"pt", "=", "0"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"And", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"$S", "[", "\"\<StoppedByStopFunction\>\"", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"res", ">", 
            RowBox[{"$S", "\[LeftDoubleBracket]", 
             RowBox[{"\"\<Method\>\"", ",", "2", ",", "\"\<Tolerance\>\""}], 
             "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<Iteration\>\"", "]"}], "<", "maxiter"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<WallClockTime\>\"", "]"}], "<", 
            "maxwallclocktime"}], ",", "\[IndentingNewLine]", 
           RowBox[{"!", 
            RowBox[{"$S", "[", "\"\<StuckQ\>\"", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"TrueQ", "[", 
            RowBox[{"$S", "[", "\"\<Continue\>\"", "]"}], "]"}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tic", "=", 
           RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"cputic", "=", 
           RowBox[{"TimeUsed", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"profile", "=", 
           RowBox[{
           "Profiler", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"r", "=", "DF"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"l", ">", "0"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"data", "=", 
                 RowBox[{"ncLBFGSMultiply1", "[", 
                  RowBox[{
                  "r", ",", "slist", ",", "ylist", ",", "\[Rho]list", ",", 
                   "l", ",", "pt"}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"r", "=", 
                 RowBox[{"data", "\[LeftDoubleBracket]", 
                  RowBox[{"1", ";;", 
                   RowBox[{"Length", "[", "r", "]"}]}], 
                  "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"\[Alpha]list", "=", 
                 RowBox[{"data", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "r", "]"}], "+", "1"}], ";;", 
                   RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}], ";"}]}],
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"r", "=", 
              RowBox[{
               RowBox[{"Hinv", "[", "M", "]"}], "[", "r", "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"l", ">", "0"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "=", 
                 RowBox[{"ncLBFGSMultiply2", "[", 
                  RowBox[{
                  "r", ",", "slist", ",", "ylist", ",", "\[Rho]list", ",", 
                   "\[Alpha]list", ",", "l", ",", "pt"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"s", "=", 
              RowBox[{"dir", " ", "r"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"dir", " ", 
                 RowBox[{"DF", ".", "s"}]}], "<", "0."}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"l", "=", "0"}], ";", "\[IndentingNewLine]", 
                RowBox[{"s", "=", 
                 RowBox[{"dir", " ", 
                  RowBox[{
                   RowBox[{"Hinv", "[", "M", "]"}], "[", "DF", "]"}]}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{
                "Print", "[", "\"\<Reverse direction. Resetting history.\>\"",
                  "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"\[Tau]tic", "=", 
              RowBox[{"AbsoluteTime", "[", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[Tau]max", "=", 
              RowBox[{"StepTrunc", "[", 
               RowBox[{"M", ",", "s"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"M", "=", 
              RowBox[{"LineSearch", "[", 
               RowBox[{"M", ",", "Energy", ",", "s", ",", 
                RowBox[{"$S", "\[LeftDoubleBracket]", 
                 RowBox[{
                 "\"\<Method\>\"", ",", "2", ",", "\"\<StepSizeOptions\>\""}],
                  "\[RightDoubleBracket]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"\"\<InitialStepSize\>\"", "\[Rule]", 
                 RowBox[{"StepPred", "[", 
                  RowBox[{"M", ",", "DF", ",", "s", ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"NumericQ", "[", 
                    RowBox[{"$S", "[", "\"\<StepSize\>\"", "]"}], "]"}], ",", 
                    
                    RowBox[{"$S", "[", "\"\<StepSize\>\"", "]"}], ",", 
                    "\[Tau]max"}], "]"}], ",", "\[Tau]max"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                "\"\<MaxStepSize\>\"", "\[Rule]", " ", "\[Tau]max"}]}], 
               "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"\[Tau]toc", "=", 
              RowBox[{"AbsoluteTime", "[", "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
              "$S", "\[LeftDoubleBracket]", "\"\<StepSizeSucceeded\>\"", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"Cache", "[", 
               RowBox[{
               "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<Succeeded\>\""}],
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<Iteration\>\"", "]"}], "++"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"s", "=", 
              RowBox[{"Cache", "[", 
               RowBox[{
               "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<Update\>\""}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"DFold", "=", "DF"}], ";", "\[IndentingNewLine]", 
             RowBox[{"DF", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"Energy", "'"}], "[", "M", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Cache", "[", 
                 RowBox[{
                 "M", ",", "\"\<LineSearchData\>\"", ",", 
                  "\"\<StepSize\>\""}], "]"}], "<", "\[Tau]min"}], 
               "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"maxhistlen", ">", "0"}], "&&", 
                  RowBox[{"l", ">", "0"}]}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"l", "=", "0"}], ";", "\[IndentingNewLine]", 
                  RowBox[{
                  "Print", "[", "\"\<Tiny step size. History deleted.\>\"", 
                   "]"}], ";"}], "\[IndentingNewLine]", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"$S", "[", "\"\<StuckQ\>\"", "]"}], "=", "True"}]}],
                 "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"maxhistlen", ">", "0"}], "\[IndentingNewLine]", 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Or", "[", 
                    RowBox[{
                    RowBox[{"!", 
                    RowBox[{"$S", "\[LeftDoubleBracket]", 
                    RowBox[{
                    "\"\<Method\>\"", ",", "2", ",", 
                    "\"\<ResetIfWolfeFails\>\""}], 
                    "\[RightDoubleBracket]"}]}], ",", 
                    RowBox[{
                    "$S", "\[LeftDoubleBracket]", "\"\<StepSizeSucceeded\>\"",
                     "\[RightDoubleBracket]"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"l", "=", 
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{"l", "+", "1"}], ",", "maxhistlen"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"pt", "++"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"y", "=", 
                    RowBox[{"DF", "-", "DFold"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\[Rho]", "=", 
                    RowBox[{"1", "/", 
                    RowBox[{"y", ".", "s"}]}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"c", "=", 
                    RowBox[{"Mod", "[", 
                    RowBox[{"pt", ",", "maxhistlen", ",", "1"}], "]"}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "slist", "\[LeftDoubleBracket]", "c", 
                    "\[RightDoubleBracket]"}], "=", "s"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "ylist", "\[LeftDoubleBracket]", "c", 
                    "\[RightDoubleBracket]"}], "=", "y"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "\[Rho]list", "\[LeftDoubleBracket]", "c", 
                    "\[RightDoubleBracket]"}], "=", "\[Rho]"}], ";"}], 
                    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"l", "=", "0"}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<Linesearch failed. History deleted.\>\"", "]"}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
                 "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]",
               "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<Objective\>\"", "]"}], "=", 
              RowBox[{"Energy", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<Residual\>\"", "]"}], "=", 
              RowBox[{"res", "=", 
               RowBox[{"ResFun", "[", 
                RowBox[{"M", ",", "DF"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$S", "[", "\"\<StoppedByStopFunction\>\"", "]"}], "=", 
              
              RowBox[{"StopFun", "[", "M", "]"}]}], ";"}], 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"cputoc", "=", 
           RowBox[{"TimeUsed", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"toc", "=", 
           RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<Time\>\"", "]"}], "=", 
           RowBox[{"toc", "-", "tic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<CPUTime\>\"", "]"}], "=", 
           RowBox[{"cputoc", "-", "cputic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<WallClockTime\>\"", "]"}], "=", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<WallClockTime\>\"", "]"}], "+", "toc", 
            "-", "tic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<TotalCPUTime\>\"", "]"}], "=", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<TotalCPUTime\>\"", "]"}], "+", "cputoc", 
            "-", "cputic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<LineSearchTime\>\"", "]"}], "=", 
           RowBox[{"\[Tau]toc", "-", "\[Tau]tic"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<TotalLineSearchTime\>\"", "]"}], "=", 
           RowBox[{
            RowBox[{"$S", "[", "\"\<TotalLineSearchTime\>\"", "]"}], "+", 
            "\[Tau]toc", "-", "\[Tau]tic"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<Profile\>\"", "]"}], "=", "profile"}], ";",
           "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<StepSize\>\"", "]"}], "=", 
           RowBox[{"Cache", "[", 
            RowBox[{
            "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<StepSize\>\""}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<MaxStepSize\>\"", "]"}], "=", 
           "\[Tau]max"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<InitialStepSize\>\"", "]"}], "=", 
           RowBox[{"Cache", "[", 
            RowBox[{
            "M", ",", "\"\<LineSearchData\>\"", ",", 
             "\"\<InitialStepSize\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<LineSearchContractions\>\"", "]"}], "=", 
           RowBox[{"Cache", "[", 
            RowBox[{
            "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<Contractions\>\""}],
             "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"$S", "[", "\"\<LineSearchExpansions\>\"", "]"}], "=", 
           RowBox[{"Cache", "[", 
            RowBox[{
            "M", ",", "\"\<LineSearchData\>\"", ",", "\"\<Expansions\>\""}], 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"$InfoList", ",", 
            RowBox[{
             RowBox[{"$S", "[", "\"\<Iteration\>\"", "]"}], "\[Rule]", 
             RowBox[{
             "$S", "\[LeftDoubleBracket]", "infokeys", 
              "\[RightDoubleBracket]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"meshlistQ", ",", 
            RowBox[{
             RowBox[{"AppendToMeshList", "[", 
              RowBox[{"$MeshList", ",", "M"}], "]"}], ";"}]}], "]"}], ";"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"OptimizationReturnHandler", "[", 
        RowBox[{"me", ",", "M"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"\"\<Errors\>\"", "\[Rule]", "$OptimizationErrors"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"\"\<Warnings\>\"", "\[Rule]", "$OptimizationWarnings"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Options", "\[Rule]", 
     RowBox[{"Join", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\"\<StepSizePredictor\>\"", "\[Rule]", 
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "M", ",", "DF", ",", "searchdirection", ",", "\[Tau]old", ",", 
              "\[Tau]max"}], "}"}], ",", "1."}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<StepSizeStrategy\>\"", "\[Rule]", "WeakWolfePowell"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<StepSizeOptions\>\"", "\[Rule]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<ExpansionFactor\>\"", "\[Rule]", "2."}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<ArmijoParameter\>\"", "\[Rule]", "0.33"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<WolfeParameter\>\"", "\[Rule]", "0.66"}]}], 
           "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"\"\<ResetIfWolfeFails\>\"", "\[Rule]", "False"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"\"\<MaxHistoryLength\>\"", "\[Rule]", "30"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<Metric\>\"", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<InverseMetric\>\"", "\[Rule]", "Automatic"}]}], 
        "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
       "$OptimizationOptions"}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.639460838626183*^9, 3.6394608736312*^9}, {
   3.639460907155924*^9, 3.639460965380426*^9}, {3.639461535760684*^9, 
   3.639461561417651*^9}, {3.639461646244321*^9, 3.639461667180352*^9}, {
   3.639461849322659*^9, 3.639461926160853*^9}, {3.639462228595779*^9, 
   3.639462303947507*^9}, {3.639462375336973*^9, 3.639462376949583*^9}, {
   3.6394627355686483`*^9, 3.639462826381105*^9}, {3.639462939933854*^9, 
   3.639463001699952*^9}, {3.639463084360001*^9, 3.639463094486239*^9}, {
   3.639463169176341*^9, 3.63946317523947*^9}, {3.639464672092042*^9, 
   3.639464672331571*^9}, {3.63946481903333*^9, 3.639464831764217*^9}, {
   3.639465081478547*^9, 3.639465121813917*^9}, {3.639465529774518*^9, 
   3.63946553257419*^9}, {3.639473169114295*^9, 3.63947325106853*^9}, {
   3.6394733422030697`*^9, 3.63947335126987*^9}, {3.639473384187064*^9, 
   3.639473385607481*^9}, {3.6394734466366568`*^9, 3.639473474249461*^9}, {
   3.6394736611046133`*^9, 3.639473665254208*^9}, {3.639475339241949*^9, 
   3.639475426745132*^9}, {3.6394754618189774`*^9, 3.639475722833591*^9}, {
   3.6394757909547043`*^9, 3.639475799931398*^9}, {3.6394758475963497`*^9, 
   3.639475911205947*^9}, {3.639475995034284*^9, 3.639475997927931*^9}, {
   3.6394760434128237`*^9, 3.63947604600243*^9}, {3.639476188078114*^9, 
   3.6394761970225267`*^9}, {3.6394762557440557`*^9, 3.639476334751068*^9}, {
   3.639476402961535*^9, 3.639476434026843*^9}, {3.639476467731566*^9, 
   3.639476486258012*^9}, {3.639476516517709*^9, 3.6394765190761642`*^9}, {
   3.639476661128187*^9, 3.6394766766242743`*^9}, {3.639476785274866*^9, 
   3.639476806219809*^9}, {3.639476892919238*^9, 3.639476936438469*^9}, {
   3.639477462643079*^9, 3.6394775189323397`*^9}, {3.6394776141513567`*^9, 
   3.639477630391424*^9}, {3.6394806702405357`*^9, 3.6394806724763193`*^9}, 
   3.639480719569315*^9, {3.639481127104061*^9, 3.639481129055697*^9}, {
   3.639481198285575*^9, 3.6394812038587503`*^9}, 3.6394815926624727`*^9, {
   3.639483111112419*^9, 3.639483186952812*^9}, 3.639483492759626*^9, {
   3.639483532059104*^9, 3.639483532472477*^9}, {3.639483747536379*^9, 
   3.639483747829479*^9}, {3.639483938813579*^9, 3.639483980908681*^9}, {
   3.639484011308712*^9, 3.639484014516231*^9}, {3.639484064734727*^9, 
   3.639484067036921*^9}, {3.6394842331059723`*^9, 3.639484235537631*^9}, {
   3.639484364178307*^9, 3.639484365706057*^9}, {3.639484527890926*^9, 
   3.639484530087846*^9}, {3.639484572713933*^9, 3.639484573105886*^9}, {
   3.639484817323873*^9, 3.639484819191551*^9}, {3.6394848801131907`*^9, 
   3.63948490408041*^9}, {3.639485034008451*^9, 3.639485066158008*^9}, {
   3.6394852675070267`*^9, 3.639485311852272*^9}, {3.639485419283743*^9, 
   3.6394856163994627`*^9}, {3.639485649332361*^9, 3.639485664026725*^9}, {
   3.63948585761569*^9, 3.639485873699469*^9}, {3.639486311755965*^9, 
   3.639486328098269*^9}, 3.639487121309123*^9, {3.6394897003023148`*^9, 
   3.63948970399395*^9}, {3.639491103016193*^9, 3.639491104228427*^9}, {
   3.639491137787311*^9, 3.6394911513738117`*^9}, {3.639491183974443*^9, 
   3.63949130051994*^9}, {3.6394913357616453`*^9, 3.639491345889929*^9}, {
   3.639491575557766*^9, 3.639491628190785*^9}, {3.639491670236063*^9, 
   3.639491686065816*^9}, {3.639491716212152*^9, 3.639491756411058*^9}, {
   3.63949181643563*^9, 3.639491817204344*^9}, {3.639491889472089*^9, 
   3.639491891284484*^9}, {3.639493864041625*^9, 3.639493888823759*^9}, {
   3.639493935425601*^9, 3.639493939728866*^9}, {3.6394939731294317`*^9, 
   3.639493991378584*^9}, {3.639494022834504*^9, 3.6394941426087523`*^9}, {
   3.6394941752157927`*^9, 3.6394942564306393`*^9}, 3.639494344028215*^9, {
   3.6395005371728*^9, 3.639500580355207*^9}, {3.639500718183243*^9, 
   3.639500726578917*^9}, {3.6395008948155003`*^9, 3.639500922844208*^9}, {
   3.6395010374882*^9, 3.6395010385203047`*^9}, 3.6395011236996107`*^9, {
   3.6395013553111353`*^9, 3.639501363992764*^9}, {3.639537714663927*^9, 
   3.639537733823123*^9}, {3.639538630096183*^9, 3.639538640783764*^9}, {
   3.639538757406901*^9, 3.639538757730032*^9}, {3.63953916763503*^9, 
   3.639539189591083*^9}, {3.639539453372991*^9, 3.639539456089188*^9}, {
   3.639539554063542*^9, 3.639539600792432*^9}, {3.639540097066194*^9, 
   3.639540097438613*^9}, {3.639540552302988*^9, 3.639540555732497*^9}, {
   3.6395409392398157`*^9, 3.639540946195422*^9}, {3.639541156875165*^9, 
   3.639541173780776*^9}, {3.639632401114334*^9, 3.6396325142526484`*^9}, {
   3.639632554748961*^9, 3.63963256018954*^9}, {3.639632606602233*^9, 
   3.639632667518742*^9}, {3.639632707211173*^9, 3.6396327106016293`*^9}, {
   3.6396328866083107`*^9, 3.63963289317339*^9}, {3.639632948513802*^9, 
   3.639632987592626*^9}, {3.6411345801006517`*^9, 3.6411346227231092`*^9}, {
   3.641134660612506*^9, 3.641134727448091*^9}, {3.6411347611863823`*^9, 
   3.641134794842704*^9}, 3.6411348422493553`*^9, {3.641134923532764*^9, 
   3.6411349237078876`*^9}, {3.641135354701386*^9, 3.641135375067137*^9}, {
   3.641135683974835*^9, 3.6411356958350477`*^9}, {3.641448194109501*^9, 
   3.6414481963863153`*^9}, {3.6414520394525633`*^9, 3.641452061717186*^9}, {
   3.6414521363845882`*^9, 3.6414521391253633`*^9}, {3.6414559197093153`*^9, 
   3.641455943485127*^9}, {3.641456373960422*^9, 3.641456381930924*^9}, {
   3.6414830539807463`*^9, 3.641483199394305*^9}, {3.641483271821649*^9, 
   3.641483324413054*^9}, {3.641483478729372*^9, 3.641483529375443*^9}, {
   3.641483667699512*^9, 3.641483695104206*^9}, {3.641484212161018*^9, 
   3.641484214869299*^9}, {3.641484439257092*^9, 3.641484479928273*^9}, {
   3.641484544665207*^9, 3.641484595319477*^9}, {3.645104332890296*^9, 
   3.6451043557943087`*^9}, {3.645104390972728*^9, 3.6451043936378736`*^9}, {
   3.645104456868718*^9, 3.645104463575967*^9}, {3.64510461223761*^9, 
   3.645104617023185*^9}, 3.645894120592732*^9, {3.645894156888104*^9, 
   3.645894259042923*^9}, {3.645897748606764*^9, 3.645897801873472*^9}, {
   3.646671048737813*^9, 3.6466710563790493`*^9}, {3.6466711081758537`*^9, 
   3.6466711105181227`*^9}, {3.646671388153948*^9, 3.6466714094179983`*^9}, {
   3.646671495525179*^9, 3.6466715201092587`*^9}, {3.6466715676829023`*^9, 
   3.646671577457068*^9}, {3.646679541607732*^9, 3.646679544711813*^9}, {
   3.646981666710863*^9, 3.646981681088763*^9}, {3.646981784973336*^9, 
   3.64698179312182*^9}, {3.646982123141691*^9, 3.6469821307205877`*^9}, {
   3.6469872803364887`*^9, 3.646987337385795*^9}, {3.646987389624179*^9, 
   3.64698741842846*^9}, {3.646987491749048*^9, 3.646987492179472*^9}, {
   3.646987806401108*^9, 3.646987806590694*^9}, {3.648097976682378*^9, 
   3.6480979889180593`*^9}, 3.64809814277599*^9, {3.649241579372106*^9, 
   3.6492415815940866`*^9}, {3.65207487480092*^9, 3.65207488312658*^9}, {
   3.652074922032058*^9, 3.652074958067649*^9}, {3.652075028644932*^9, 
   3.6520750448471622`*^9}, {3.652075075351132*^9, 3.652075331158884*^9}, {
   3.652075393356098*^9, 3.6520754177600117`*^9}, {3.652075472297984*^9, 
   3.652075581991962*^9}, {3.6520756290349283`*^9, 3.652075629545662*^9}, {
   3.652075674770533*^9, 3.652075710671866*^9}, {3.652076667214754*^9, 
   3.652076668817176*^9}, {3.652076775144637*^9, 3.652076777628295*^9}, {
   3.652086337610968*^9, 3.652086382481645*^9}, {3.665556171829764*^9, 
   3.665556192831489*^9}, {3.665556255471731*^9, 3.6655562578184566`*^9}, 
   3.6655568903869543`*^9, {3.6657730591868477`*^9, 3.665773063133769*^9}, {
   3.665773114013151*^9, 3.665773117270718*^9}, {3.689926620139492*^9, 
   3.689926675063148*^9}, {3.689926712548479*^9, 3.6899268005232153`*^9}, 
   3.6899268736248903`*^9, {3.689927073295137*^9, 3.689927243300363*^9}, {
   3.6899290587347517`*^9, 3.6899290742472687`*^9}, {3.68994240900799*^9, 
   3.689942409707511*^9}, {3.690380621387594*^9, 3.6903806371612597`*^9}, {
   3.690380703750863*^9, 3.690380703973703*^9}, {3.709215440646678*^9, 
   3.709215476247569*^9}, {3.709262266697977*^9, 3.709262277428904*^9}, {
   3.785149600612905*^9, 3.785149685385076*^9}, {3.785149768520733*^9, 
   3.7851497834065447`*^9}, {3.7853967140976353`*^9, 3.785396726614008*^9}, {
   3.785396889898143*^9, 3.7853970476614857`*^9}, {3.785397131043425*^9, 
   3.7853972083747272`*^9}, {3.785397250029893*^9, 3.785397357816403*^9}, {
   3.78539742468412*^9, 3.785397552088554*^9}, {3.785397626643927*^9, 
   3.785397901505143*^9}, {3.785397934246297*^9, 3.785398119201564*^9}, {
   3.7853982001818*^9, 3.785398225329742*^9}, {3.785398260620448*^9, 
   3.785398443587265*^9}, {3.78539856328292*^9, 3.78539863791796*^9}, {
   3.7854002028127203`*^9, 3.785400347383552*^9}, {3.785400399623*^9, 
   3.785400460354987*^9}, {3.785400594526841*^9, 3.7854006291657143`*^9}, {
   3.7854006727418833`*^9, 3.7854007312165403`*^9}, {3.7854008036957407`*^9, 
   3.785400879931655*^9}, 3.785401005829153*^9, {3.785401105363576*^9, 
   3.7854011305387373`*^9}, {3.785401161450629*^9, 3.785401163288557*^9}, {
   3.7854012491916018`*^9, 3.785401259821694*^9}, {3.785401531506789*^9, 
   3.785401603238617*^9}, {3.7854016412634783`*^9, 3.7854016629663773`*^9}, {
   3.785401693813253*^9, 3.7854016987228737`*^9}, {3.785401800532091*^9, 
   3.7854018160814123`*^9}, {3.785402585521961*^9, 3.785402601171266*^9}, {
   3.785402638993196*^9, 3.785402660782735*^9}, {3.78540280691525*^9, 
   3.785402969476186*^9}, {3.7854033165834627`*^9, 3.785403331475667*^9}, {
   3.7854036183395147`*^9, 3.785403723624939*^9}, {3.785403809222529*^9, 
   3.7854038516438713`*^9}, {3.78540389813898*^9, 3.785404149313815*^9}, 
   3.785404184544024*^9, {3.785404218237701*^9, 3.785404305434639*^9}, {
   3.785404377359939*^9, 3.785404385255204*^9}, {3.7854044356640453`*^9, 
   3.785404438629982*^9}, {3.7854052090457706`*^9, 3.785405229413001*^9}, {
   3.785406130982534*^9, 3.785406148829383*^9}, {3.785406474737967*^9, 
   3.78540650098986*^9}, {3.785406634998157*^9, 3.785406652602358*^9}, 
   3.7854067374406643`*^9, {3.785407042811829*^9, 3.785407043195108*^9}, {
   3.785407159678364*^9, 3.7854071598763866`*^9}, {3.78540750149618*^9, 
   3.785407503285762*^9}, {3.785407624116951*^9, 3.785407626903878*^9}, {
   3.785407766885305*^9, 3.78540776709256*^9}, {3.7854078060694323`*^9, 
   3.785407838377893*^9}, {3.7854082432178717`*^9, 3.785408245616851*^9}, {
   3.785408582549189*^9, 3.785408587797983*^9}, {3.785408674404807*^9, 
   3.785408681570753*^9}, {3.785408976730242*^9, 3.7854089772476473`*^9}, {
   3.785409544803318*^9, 3.78540955900434*^9}, {3.785409739099017*^9, 
   3.785409742531693*^9}, {3.7854098579187737`*^9, 3.785409859913332*^9}, {
   3.785410427865115*^9, 3.78541048251431*^9}, {3.785410573895604*^9, 
   3.785410737311296*^9}, {3.785410788917206*^9, 3.7854108510885277`*^9}, {
   3.785410899251417*^9, 3.785410924126788*^9}, {3.785411220651082*^9, 
   3.785411359905917*^9}, {3.785411427304536*^9, 3.785411623627164*^9}, {
   3.7854117325867157`*^9, 3.7854117350927143`*^9}, {3.785411851440518*^9, 
   3.7854118792464113`*^9}, {3.785415703254931*^9, 3.7854157039428596`*^9}, {
   3.78541583830387*^9, 3.785415841268818*^9}, {3.785415975688805*^9, 
   3.7854159798742657`*^9}, {3.785416011020165*^9, 3.785416047557496*^9}, {
   3.7854160826924257`*^9, 3.785416098984991*^9}, {3.7854161425711308`*^9, 
   3.785416158747335*^9}, {3.785416235200934*^9, 3.785416308334074*^9}, {
   3.785416346893916*^9, 3.785416428312808*^9}, {3.785416512439086*^9, 
   3.785416536607896*^9}, {3.7854165889709377`*^9, 3.7854165919529552`*^9}, {
   3.785416674334963*^9, 3.785416708264099*^9}, {3.7854167492475243`*^9, 
   3.785416774309349*^9}, 3.785416838069476*^9, {3.785416901166387*^9, 
   3.785416908145937*^9}, 3.7854169579931593`*^9, {3.785417007220003*^9, 
   3.785417043817416*^9}, {3.785417085659012*^9, 3.785417130656193*^9}, {
   3.785417161298172*^9, 3.785417208547166*^9}, {3.785417239939191*^9, 
   3.785417240131617*^9}, {3.785417319418935*^9, 3.7854173314468927`*^9}, {
   3.785417532444821*^9, 3.785417547592319*^9}, {3.785417622934198*^9, 
   3.785417623148488*^9}, {3.785417658548501*^9, 3.785417668251692*^9}, {
   3.785417789297619*^9, 3.785417794919187*^9}, {3.7854184017117243`*^9, 
   3.785418404366295*^9}, {3.785418443773943*^9, 3.785418443957595*^9}, {
   3.785418511796256*^9, 3.785418532723536*^9}, {3.785419158420994*^9, 
   3.785419168282895*^9}, {3.7854203244608803`*^9, 3.7854203609517736`*^9}, 
   3.785994845732717*^9, 3.785994916693564*^9, {3.78627532797295*^9, 
   3.78627534882442*^9}, {3.795248985102727*^9, 3.795248986799115*^9}, {
   3.795421322621805*^9, 3.795421324828373*^9}, 3.795421405288517*^9, {
   3.795422331790062*^9, 3.7954223801255207`*^9}, {3.795422682396916*^9, 
   3.795422699353573*^9}, {3.7954227342899303`*^9, 3.795422760650217*^9}, {
   3.7954228866374607`*^9, 3.795422891092695*^9}, {3.795422960681223*^9, 
   3.795423022896661*^9}, {3.795423413228499*^9, 3.7954234452172327`*^9}, {
   3.7954240815358353`*^9, 3.795424106810553*^9}, {3.795424425231637*^9, 
   3.79542445798778*^9}, {3.79542538398628*^9, 3.795425388739189*^9}, {
   3.795425975013568*^9, 3.7954259793880987`*^9}, {3.795435542920741*^9, 
   3.79543555100963*^9}, 3.795435596267558*^9, {3.7954356366156693`*^9, 
   3.79543565142135*^9}, {3.795435689111713*^9, 3.795435728427985*^9}, {
   3.795435830408578*^9, 3.795435831606485*^9}, {3.795435930139923*^9, 
   3.7954359348893337`*^9}, {3.795436205514056*^9, 3.795436226799365*^9}, {
   3.795492994903701*^9, 3.795493000519306*^9}, 3.795493107541306*^9, {
   3.7954939852301397`*^9, 3.795493993834094*^9}, {3.7954946207422647`*^9, 
   3.795494622427121*^9}, 3.7954948250674047`*^9, {3.795494982759119*^9, 
   3.7954950006372137`*^9}, {3.795495312643736*^9, 3.79549535913428*^9}, {
   3.795495409341927*^9, 3.795495463898362*^9}, {3.79549724430828*^9, 
   3.7954972661437817`*^9}, {3.7954973368897448`*^9, 3.795497338975234*^9}, {
   3.795497385505556*^9, 3.795497387350585*^9}, {3.795497635989105*^9, 
   3.795497636255536*^9}, {3.795497681777852*^9, 3.795497697625435*^9}, {
   3.795497855942487*^9, 3.795497874500555*^9}, {3.795498038034593*^9, 
   3.795498049469446*^9}, {3.79549810798238*^9, 3.79549813665948*^9}, {
   3.7954982928277483`*^9, 3.7954983619705276`*^9}, {3.7954985538354397`*^9, 
   3.795498601838396*^9}, {3.7954986461125307`*^9, 3.795498697238131*^9}, {
   3.79549893960531*^9, 3.7954989758199043`*^9}, 3.795499096870755*^9, {
   3.7954993281693363`*^9, 3.7954993680315733`*^9}, {3.7954993992105637`*^9, 
   3.795499422928361*^9}, {3.795499494162901*^9, 3.7954994973456907`*^9}, 
   3.795499529776017*^9, {3.795499886788723*^9, 3.795499889504119*^9}, {
   3.795499965136326*^9, 3.795500033787484*^9}, {3.795501032119858*^9, 
   3.79550103377628*^9}, 3.7955011161868753`*^9, {3.795509155821053*^9, 
   3.795509174083006*^9}, {3.795509264506928*^9, 3.795509306558928*^9}, {
   3.795510849383915*^9, 3.795510885924728*^9}, {3.795511201605257*^9, 
   3.795511206338481*^9}, {3.795511242662428*^9, 3.795511254199099*^9}, {
   3.795511401202579*^9, 3.7955114492396317`*^9}, {3.7955114800535917`*^9, 
   3.795511577825634*^9}, {3.795511622842503*^9, 3.7955116230829287`*^9}, {
   3.795511859433358*^9, 3.7955118599357367`*^9}, {3.79551197396668*^9, 
   3.795511975607759*^9}, {3.795512140680641*^9, 3.795512211611163*^9}, {
   3.795512825980838*^9, 3.7955128473338346`*^9}, {3.795512879117028*^9, 
   3.795512880492278*^9}, 3.795513161002789*^9, {3.795513218137643*^9, 
   3.795513233522143*^9}, {3.795513306750054*^9, 3.795513307324469*^9}, {
   3.795536067659287*^9, 3.795536083707095*^9}, {3.7955369279322977`*^9, 
   3.795536928223029*^9}, {3.795578235477359*^9, 3.795578337337715*^9}, {
   3.795579089309374*^9, 3.795579089740189*^9}, {3.79557916622683*^9, 
   3.7955792090857897`*^9}, {3.795579291770926*^9, 3.7955793021816063`*^9}, {
   3.795579348679388*^9, 3.795579403859326*^9}, {3.795579435881002*^9, 
   3.795579457615583*^9}, {3.7955794887233953`*^9, 3.795579495911871*^9}, {
   3.795579534992852*^9, 3.79557955219872*^9}, {3.795579603348063*^9, 
   3.7955796574021807`*^9}, {3.795586336552462*^9, 3.7955863442871637`*^9}, {
   3.795586698335443*^9, 3.795586704599969*^9}, {3.79558677245313*^9, 
   3.7955867787592573`*^9}, {3.795587296931958*^9, 3.795587298773712*^9}, {
   3.795587328893111*^9, 3.7955873478174467`*^9}, {3.795588522165743*^9, 
   3.795588530557889*^9}, {3.795592336329548*^9, 3.79559240508646*^9}, {
   3.795593617936123*^9, 3.7955936223292294`*^9}, 3.795601830377775*^9, {
   3.7956018716812067`*^9, 3.7956019170172367`*^9}, {3.795604794062977*^9, 
   3.795604842545795*^9}, {3.7956639994994926`*^9, 3.7956640331549063`*^9}, {
   3.79566407030873*^9, 3.795664122831092*^9}, 3.795664188958273*^9, {
   3.795664222622843*^9, 3.795664265650139*^9}, {3.795664416112852*^9, 
   3.795664450860243*^9}, {3.795666517946883*^9, 3.79566651902561*^9}, {
   3.795669254493608*^9, 3.795669257897511*^9}, {3.795678400213657*^9, 
   3.795678403694294*^9}, {3.7957625582581778`*^9, 3.7957625699848223`*^9}, 
   3.795763316193946*^9, {3.7957633633890057`*^9, 3.795763411163146*^9}, {
   3.795763689268675*^9, 3.795763735400329*^9}, {3.795764387704969*^9, 
   3.795764389851214*^9}, {3.7957644224313803`*^9, 3.795764425469556*^9}, {
   3.7957708377890253`*^9, 3.795770921343758*^9}, {3.7957717064736347`*^9, 
   3.7957717086099157`*^9}, {3.795789622946434*^9, 3.795789623209646*^9}, {
   3.7958542165510073`*^9, 3.795854229254216*^9}, 3.7958610310087442`*^9, {
   3.7960114102947073`*^9, 3.79601141129452*^9}, {3.796462518526812*^9, 
   3.796462520307829*^9}, {3.796486955592256*^9, 3.796487056045032*^9}, {
   3.796487111675411*^9, 3.796487113730345*^9}, {3.7966289291278563`*^9, 
   3.796628939341522*^9}, {3.796628971829479*^9, 3.796628975051968*^9}, {
   3.796629165258173*^9, 3.7966291970750217`*^9}, {3.7966292363798513`*^9, 
   3.796629291805192*^9}, {3.796629325405587*^9, 3.796629334347837*^9}, {
   3.796629646696965*^9, 3.796629654297112*^9}, {3.7966296845357523`*^9, 
   3.7966297108441343`*^9}, {3.796631172253912*^9, 3.796631179296584*^9}, {
   3.796631477691534*^9, 3.796631490658641*^9}, {3.796632094288994*^9, 
   3.796632098845182*^9}, 3.796632130255909*^9, 3.79664396162148*^9, {
   3.796806820086153*^9, 3.7968068211952457`*^9}, {3.79689686901569*^9, 
   3.7968969213991537`*^9}, 3.796900254594039*^9, {3.796900288955154*^9, 
   3.796900356920175*^9}, {3.796900634962775*^9, 3.7969006631107903`*^9}, {
   3.796901551838482*^9, 3.79690155210723*^9}, 3.796902431570539*^9, {
   3.796930400700293*^9, 3.7969305440395412`*^9}, {3.7969307233823013`*^9, 
   3.796930773797471*^9}, {3.796930888487414*^9, 3.796930948351922*^9}, {
   3.796930984159103*^9, 3.796930985523507*^9}, {3.796931669956356*^9, 
   3.7969316907443523`*^9}, {3.796935909395911*^9, 3.796935922739641*^9}, {
   3.796968445573859*^9, 3.796968446096154*^9}, {3.796968518819417*^9, 
   3.796968565089477*^9}, {3.7969686046674767`*^9, 3.796968620224299*^9}, {
   3.796968782980618*^9, 3.796968785047968*^9}, {3.797003808138853*^9, 
   3.797003873726993*^9}, {3.797004051936213*^9, 3.797004077722343*^9}, {
   3.797004305776863*^9, 3.797004309757513*^9}, {3.79700439913148*^9, 
   3.79700443844074*^9}, {3.797004598883669*^9, 3.7970046167859917`*^9}, {
   3.797006854917995*^9, 3.797006935548244*^9}, {3.797006974450308*^9, 
   3.797006992369129*^9}, {3.797007035953318*^9, 3.797007103332567*^9}, {
   3.797015437571292*^9, 3.797015459997143*^9}, {3.797015495827669*^9, 
   3.7970155199361362`*^9}, {3.797015600222069*^9, 3.7970156133488283`*^9}, {
   3.797015662973652*^9, 3.797015684995098*^9}, 3.7974112040341673`*^9, 
   3.797751588405517*^9, {3.797751668459787*^9, 3.797751668667994*^9}, {
   3.799137044247108*^9, 3.7991370457717657`*^9}, {3.799137124084114*^9, 
   3.799137149431477*^9}, {3.7991371869105797`*^9, 3.799137241203836*^9}, {
   3.799137398923644*^9, 3.799137439385953*^9}, {3.7991377641510468`*^9, 
   3.799137842147217*^9}, {3.799138087043146*^9, 3.799138090762278*^9}, 
   3.7991383207390842`*^9, {3.7991383690256844`*^9, 3.799138401063589*^9}, {
   3.799138643632249*^9, 3.799138648957941*^9}, {3.7991386823738317`*^9, 
   3.799138682538351*^9}, {3.799138941125319*^9, 3.799138943698143*^9}, {
   3.799145122612871*^9, 3.79914515620373*^9}, {3.7991454529386053`*^9, 
   3.799145458049436*^9}, {3.799209208386445*^9, 3.799209227679349*^9}, {
   3.799545524772111*^9, 3.799545555979569*^9}, {3.844079286851493*^9, 
   3.844079317610257*^9}, {3.8440793676878*^9, 3.84407944662149*^9}, {
   3.844079486899213*^9, 3.844079510243557*^9}, 3.844079625550983*^9, {
   3.8440796691165857`*^9, 3.8440797096664963`*^9}, {3.8440797926167917`*^9, 
   3.844079844237747*^9}, {3.844079930030113*^9, 3.844079930404201*^9}, {
   3.844079974851838*^9, 3.8440799757219057`*^9}, {3.844080020481893*^9, 
   3.844080021071814*^9}, {3.844080130729856*^9, 3.844080158099081*^9}, {
   3.844080190419001*^9, 3.844080295029703*^9}, {3.844080330214076*^9, 
   3.844080351995543*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"2e62581d-71c7-43ed-8ab5-acf8d24b5f1b"]
},
WindowSize->{1440, 855},
WindowMargins->{{425, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.0 for Mac OS X x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 51390, 916, 5817, "Input",ExpressionUUID->"65aad035-93d2-4487-a350-d04277911656"],
Cell[51951, 938, 51015, 905, 5542, "Input",ExpressionUUID->"2e62581d-71c7-43ed-8ab5-acf8d24b5f1b"]
}
]
*)

