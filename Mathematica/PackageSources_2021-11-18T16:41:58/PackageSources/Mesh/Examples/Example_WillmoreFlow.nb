(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     34620,        723]
NotebookOptionsPosition[     33928,        698]
NotebookOutlinePosition[     34322,        715]
CellTagsIndexPosition[     34279,        712]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Better", " ", "start", " ", "here", " ", "with", " ", "a", " ", "clean", 
    " ", 
    RowBox[{"MathKernel", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "Exit"}]], "Input",
 CellChangeTimes->{{3.614254675916469*^9, 3.614254676567388*^9}, 
   3.6964319959315243`*^9, 3.696434937998234*^9, {3.719080093612076*^9, 
   3.719080110577108*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"This", " ", "loads", " ", "my", " ", "self"}], "-", 
    RowBox[{"written", " ", "package", " ", 
     RowBox[{"manager", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Needs", "[", "\"\<PM`\>\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"This", " ", "loads", " ", "the", " ", "required", " ", 
      RowBox[{"packages", ".", " ", "On"}], " ", "first", " ", "run", " ", 
      "on", " ", "a", " ", "system"}], ",", " ", 
     RowBox[{
     "this", " ", "will", " ", "take", " ", "some", " ", "time", " ", 
      RowBox[{"(", 
       RowBox[{"12", " ", "minutes", " ", "on", " ", "my", " ", "laptop"}], 
       ")"}], " ", "to", " ", "compile", " ", "various", " ", 
      RowBox[{"functions", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"LoadPackages", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<Mesh\>\"", ",", "\"\<POVray\>\""}], "}"}], "]"}], "//", 
    "AbsoluteTiming"}]}]}]], "Input",
 CellChangeTimes->{{3.6971934719855833`*^9, 3.69719347826403*^9}, {
  3.697193589198*^9, 3.697193589356888*^9}, {3.7190796244352007`*^9, 
  3.719079697800029*^9}, {3.719079775719122*^9, 3.719079775900175*^9}, {
  3.719119928683483*^9, 3.71911993456126*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "If", " ", "any", " ", "packages", " ", "have", " ", "been", " ", 
     "installed"}], ",", " ", 
    RowBox[{"better", " ", "clean", " ", "the", " ", "MathKernel", " ", 
     RowBox[{"again", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "Exit"}]], "Input",
 CellChangeTimes->{{3.614254675916469*^9, 3.614254676567388*^9}, 
   3.6964319959315243`*^9, 3.696434937998234*^9, {3.719080093612076*^9, 
   3.719080110577108*^9}, {3.719123008346548*^9, 3.7191230279219713`*^9}, {
   3.7191230698537617`*^9, 3.719123071245414*^9}, {3.719123178859208*^9, 
   3.71912317972326*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Should", " ", "load", " ", "now", " ", "within", " ", "a", " ", "few", 
    " ", 
    RowBox[{"seconds", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Needs", "[", "\"\<PM`\>\"", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"LoadPackages", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<Mesh\>\"", ",", "\"\<POVray\>\""}], "}"}], "]"}], "//", 
    "AbsoluteTiming"}]}]}]], "Input",
 CellChangeTimes->{{3.6971934719855833`*^9, 3.69719347826403*^9}, {
  3.697193589198*^9, 3.697193589356888*^9}, {3.7190796244352007`*^9, 
  3.719079697800029*^9}, {3.719079775719122*^9, 3.719079775900175*^9}, {
  3.719119928683483*^9, 3.71911993456126*^9}, {3.719123030441965*^9, 
  3.719123082993647*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "As", " ", "I", " ", "write", " ", "only", " ", "few", " ", 
     "documentation"}], "..."}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"?", "TriceratopsMesh"}]}]], "Input",
 CellChangeTimes->{{3.719076823895645*^9, 3.719076841196854*^9}, {
  3.7190791697087927`*^9, 3.719079227496366*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "...", " ", "but", " ", "I", " ", "consider", " ", "code", " ", "as", " ",
      "documentation", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"to", " ", "some", " ", "extent"}], ")"}], ".", " ", "For"}], 
     " ", "many", " ", "self"}], "-", 
    RowBox[{
    "written", " ", "functions", " ", "you", " ", "can", " ", "open", " ", 
     "the", " ", "source", " ", "to", " ", "learn", " ", "more", " ", "about",
      " ", "the", " ", 
     RowBox[{"function", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"OpenSource", "[", "TriceratopsMesh", "]"}]}]], "Input",
 CellChangeTimes->{{3.719079229624722*^9, 3.719079281142159*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "The", " ", "argument", " ", "of", " ", "TriceratopsMesh", " ", "is", " ",
      "the", " ", "subdivision", " ", "level"}], ";", " ", 
    RowBox[{"Loop", " ", "subdivision", " ", "is", " ", 
     RowBox[{"used", ".", " ", "Try"}], " ", "different", " ", "values", " ", 
     "from", " ", "1", " ", "to", " ", "4"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"M", "=", 
     RowBox[{"TriceratopsMesh", "[", "2", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"M", "=", 
     RowBox[{"Centralize", "[", "M", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Telling", " ", "M", " ", "that", " ", "it", " ", "should", " ", 
      "consider", " ", "the", " ", "Bi"}], "-", 
     RowBox[{"Laplacian", " ", "as", " ", "its", " ", "inner", " ", 
      RowBox[{"product", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetMetricFunction", "[", 
     RowBox[{"M", ",", "IsotropicH2SemiInnerProduct"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Setting", " ", "up", " ", 
     RowBox[{"constraints", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AddToConstraintList", "[", 
     RowBox[{"M", ",", "Area"}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"AddToConstraintList", "[", 
      RowBox[{"M", ",", "VolumePotential"}], "]"}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AddToConstraintList", "[", 
     RowBox[{"M", ",", "Barycenter", ",", 
      RowBox[{"\"\<DesiredConstraint\>\"", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"0.", ",", "0.", ",", "0."}], "}"}]}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Specifying", " ", "the", " ", "energy", " ", "to", " ", 
     RowBox[{"minimize", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetEnergy", "[", 
     RowBox[{"M", ",", 
      RowBox[{"{", "Willmore", "}"}], ",", 
      RowBox[{"\"\<Weights\>\"", "\[Rule]", 
       RowBox[{"{", "1.", "}"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Satisfy", " ", 
     RowBox[{"constraints", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"M", "=", 
     RowBox[{"ConstraintProjection", "[", 
      RowBox[{"M", ",", 
       RowBox[{"Method", "\[Rule]", "\"\<FrozenNewton\>\""}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Make", " ", "a", " ", "deep", " ", "copy", " ", "for", " ", 
      RowBox[{"later", "."}]}], " ", "\[LeftArrow]", " ", 
     RowBox[{
      RowBox[{"is", " ", "not", " ", "a", " ", "built"}], "-", 
      RowBox[{"in", " ", 
       RowBox[{"symbol", "!"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Generate", " ", "the", " ", "saddle", " ", "point", " ", "system", " ", 
     "and", " ", "factorize", " ", "it", " ", "for", " ", "obtaining", " ", 
     "the", " ", "symbolic", " ", "factorization", " ", "once", " ", "and", 
     " ", "for", " ", 
     RowBox[{"all", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SystemPardiso", "[", 
     RowBox[{"MetricSaddlePointSystem", "[", "M", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Make", " ", "a", " ", "deep", " ", "copy", " ", "of", " ", "the", " ", 
      "initial", " ", "mesh", " ", "for", " ", "later", " ", 
      RowBox[{"use", ".", " ", "The"}], " ", "class", " ", "\"\<mesh\>\"", 
      " ", "used", " ", "for", " ", "meshes", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"e", ".", "g", ".", " ", "for"}], " ", "M"}], ")"}], " ", 
      "is", " ", "sort", " ", "of", " ", "a", " ", "pointer", " ", "type"}], 
     ",", " ", 
     RowBox[{
     "so", " ", "\"\<=\>\"", " ", "is", " ", "only", " ", "shallow", " ", 
      RowBox[{"copy", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"M0", "\[LeftArrow]", "M"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.696523255609179*^9, 3.696523256712813*^9}, {
   3.696530664652966*^9, 3.696530667587165*^9}, 3.6965307909469757`*^9, 
   3.696530874231732*^9, {3.696530955813107*^9, 3.6965309602537813`*^9}, 
   3.69653121469389*^9, 3.696531373486196*^9, 3.696531998321393*^9, {
   3.6965320799391336`*^9, 3.6965320811545258`*^9}, {3.696532119762392*^9, 
   3.696532147849444*^9}, {3.69653303842772*^9, 3.696533044742888*^9}, {
   3.696533099698984*^9, 3.696533152025674*^9}, {3.696533401518796*^9, 
   3.696533402783296*^9}, 3.6965334432041607`*^9, {3.696533655817317*^9, 
   3.696533657624325*^9}, 3.696535334622183*^9, {3.6965356046899443`*^9, 
   3.696535607361753*^9}, 3.696535702096874*^9, 3.6965359580338078`*^9, {
   3.697119944483807*^9, 3.697119956047086*^9}, 3.697120408041753*^9, {
   3.697120525478528*^9, 3.697120549588923*^9}, 3.697120950097239*^9, {
   3.697121867388233*^9, 3.697121869559142*^9}, {3.697122273983979*^9, 
   3.697122291456952*^9}, 3.697122401807369*^9, 3.6971226943494997`*^9, {
   3.697125498703383*^9, 3.697125499558414*^9}, 3.697127981171604*^9, 
   3.697128044986974*^9, 3.6971281268830748`*^9, 3.697131693137439*^9, 
   3.6971318985161867`*^9, 3.697132001819672*^9, {3.697132880136627*^9, 
   3.697132883089168*^9}, {3.6971329235511103`*^9, 3.697132924016919*^9}, {
   3.697133678317728*^9, 3.697133679516428*^9}, {3.697134272841354*^9, 
   3.697134273080399*^9}, {3.697134310304843*^9, 3.697134310529849*^9}, {
   3.697134427378797*^9, 3.69713443378738*^9}, {3.697134748313862*^9, 
   3.6971347505783873`*^9}, {3.697134827639415*^9, 3.6971348315344477`*^9}, 
   3.6971385882846203`*^9, 3.697139022963379*^9, 3.69713925209592*^9, 
   3.697139774566986*^9, 3.69714129383106*^9, 3.697142867994886*^9, 
   3.697143541079234*^9, {3.6971436758343287`*^9, 3.697143676110693*^9}, 
   3.697176062167714*^9, 3.697176299396759*^9, 3.697176471723332*^9, 
   3.697182257810062*^9, 3.697182956316677*^9, 3.6971835547854233`*^9, 
   3.697185445050807*^9, 3.697186889973222*^9, 3.697187752880231*^9, {
   3.697190165096534*^9, 3.6971901659122753`*^9}, {3.697190718129554*^9, 
   3.697190718467038*^9}, {3.6971914011311893`*^9, 3.697191402641923*^9}, {
   3.697192922356735*^9, 3.697192922741643*^9}, 3.697192981611086*^9, {
   3.697268757784699*^9, 3.697268758015194*^9}, {3.697268813908668*^9, 
   3.697268814716165*^9}, {3.697268898575808*^9, 3.697268901555484*^9}, {
   3.6972694199753113`*^9, 3.697269421825788*^9}, {3.6972697821183023`*^9, 
   3.697269783207505*^9}, {3.697270123404307*^9, 3.697270171188929*^9}, 
   3.697272725005718*^9, 3.697433145904829*^9, {3.697433214885285*^9, 
   3.697433215019652*^9}, {3.697718303884359*^9, 3.697718348965497*^9}, {
   3.69771841381574*^9, 3.697718448036847*^9}, {3.697720306475112*^9, 
   3.697720326441473*^9}, 3.697726019272757*^9, {3.697726118166266*^9, 
   3.6977261183488693`*^9}, {3.697726290623282*^9, 3.697726298421529*^9}, {
   3.697728453019948*^9, 3.697728456600939*^9}, 3.6977300877690268`*^9, 
   3.6977304604581757`*^9, {3.697730993616763*^9, 3.697730996462895*^9}, {
   3.6977310689792233`*^9, 3.697731085195067*^9}, {3.6977371829552517`*^9, 
   3.697737186170994*^9}, {3.6977376174902363`*^9, 3.697737632740484*^9}, {
   3.697737747664288*^9, 3.697737748004615*^9}, {3.69773790290267*^9, 
   3.6977379056955767`*^9}, {3.6977384801813183`*^9, 3.697738480492404*^9}, {
   3.697738934648011*^9, 3.697738948455495*^9}, {3.697739106994713*^9, 
   3.697739107523142*^9}, {3.697739714940887*^9, 3.6977397374929247`*^9}, {
   3.6977398444111853`*^9, 3.69773985975413*^9}, {3.6977404922398863`*^9, 
   3.6977405038718653`*^9}, {3.697776776582896*^9, 3.697776787405307*^9}, {
   3.6977777377427263`*^9, 3.697777741261015*^9}, {3.6977778093273478`*^9, 
   3.6977778095096807`*^9}, {3.697779413807364*^9, 3.697779413910934*^9}, 
   3.697779512231236*^9, {3.697784156685588*^9, 3.697784157269368*^9}, {
   3.697784207481661*^9, 3.697784207568215*^9}, {3.697784482082315*^9, 
   3.697784482264763*^9}, {3.697784534902776*^9, 3.69778454119809*^9}, 
   3.6978134404810658`*^9, {3.6978144280133877`*^9, 3.69781443210802*^9}, 
   3.697814576221179*^9, {3.697814650834733*^9, 3.697814660323822*^9}, 
   3.697818190586996*^9, {3.6978879668549843`*^9, 3.697887973957646*^9}, 
   3.697888252437052*^9, {3.697947521616808*^9, 3.697947523695236*^9}, 
   3.697989211785521*^9, 3.698066972536768*^9, 3.698067044039536*^9, 
   3.698067353247395*^9, {3.698067752623176*^9, 3.698067779236237*^9}, {
   3.698067937548923*^9, 3.698067941124289*^9}, 3.698068072745166*^9, 
   3.698072031376152*^9, 3.698072177162653*^9, {3.698121917757285*^9, 
   3.698121917883651*^9}, {3.698127437795444*^9, 3.698127437930434*^9}, {
   3.69812875789109*^9, 3.698128758001412*^9}, {3.69812912343406*^9, 
   3.6981291235761557`*^9}, {3.699018189451269*^9, 3.699018190445959*^9}, 
   3.6990182730217867`*^9, {3.69907062717801*^9, 3.69907064393641*^9}, {
   3.699071106322118*^9, 3.699071106544688*^9}, {3.6990719279582243`*^9, 
   3.699071940166337*^9}, 3.699072039455522*^9, {3.699072190983485*^9, 
   3.699072192342721*^9}, {3.699072727608777*^9, 3.699072736536746*^9}, {
   3.699072872776299*^9, 3.6990728825362673`*^9}, 3.699072917286277*^9, {
   3.6990746015909033`*^9, 3.699074601782816*^9}, {3.699075080656266*^9, 
   3.699075123176907*^9}, 3.699075616543045*^9, {3.6990786644732723`*^9, 
   3.699078664792232*^9}, 3.699091574599642*^9, {3.699091718670672*^9, 
   3.699091796520337*^9}, {3.699091926041356*^9, 3.6990919751261663`*^9}, 
   3.699092215706375*^9, {3.699448365003705*^9, 3.6994484113909483`*^9}, {
   3.707970208104998*^9, 3.707970210200474*^9}, {3.7080100982362432`*^9, 
   3.708010162264029*^9}, 3.708010200048107*^9, 3.708010275147806*^9, 
   3.709713465295528*^9, {3.709713497452183*^9, 3.709713497802775*^9}, {
   3.709713671540145*^9, 3.709713671877697*^9}, {3.713970265714737*^9, 
   3.713970266733735*^9}, {3.7139705697889557`*^9, 3.713970587260309*^9}, 
   3.713970673249193*^9, 3.7139763653116217`*^9, 3.713976407811851*^9, {
   3.713977170808422*^9, 3.713977170941044*^9}, 3.713985699944874*^9, {
   3.7139868677799797`*^9, 3.7139868679558687`*^9}, 3.713987150856854*^9, {
   3.713987276194023*^9, 3.71398727635045*^9}, {3.713987526718177*^9, 
   3.713987527587556*^9}, 3.7144658331790237`*^9, {3.714465865801476*^9, 
   3.7144658885393353`*^9}, 3.714465927144812*^9, {3.714643729861966*^9, 
   3.714643730027526*^9}, {3.7160283144850397`*^9, 3.716028327051618*^9}, {
   3.716028467555485*^9, 3.716028467754034*^9}, {3.716031033175107*^9, 
   3.716031058864522*^9}, {3.716031318368231*^9, 3.7160313229185953`*^9}, {
   3.716031383138908*^9, 3.71603138394655*^9}, 3.7160314481980762`*^9, 
   3.716749925695212*^9, 3.716750031108758*^9, {3.716751619678372*^9, 
   3.716751642401565*^9}, {3.716753141613946*^9, 3.716753141771853*^9}, 
   3.716753213053694*^9, 3.716753370705608*^9, 3.716783063467229*^9, 
   3.716784528501603*^9, 3.716785009675177*^9, 3.7167860884529133`*^9, 
   3.7167873707062807`*^9, {3.717517665590014*^9, 3.717517672414468*^9}, {
   3.7175178498653107`*^9, 3.717517850015798*^9}, {3.718893809625608*^9, 
   3.718893810127944*^9}, {3.718894300919963*^9, 3.718894301083946*^9}, {
   3.71889438136058*^9, 3.718894381535074*^9}, 3.718894865769878*^9, {
   3.7188953779440823`*^9, 3.718895378102507*^9}, {3.7190743028583803`*^9, 
   3.719074303018158*^9}, {3.7190743513643847`*^9, 3.7190743537962437`*^9}, 
   3.719074528617648*^9, {3.719074568651779*^9, 3.719074574062772*^9}, 
   3.719075247500399*^9, {3.719075281813778*^9, 3.719075282228258*^9}, {
   3.719075319123761*^9, 3.719075527107448*^9}, {3.719119227927417*^9, 
   3.719119269418989*^9}, {3.71911933644801*^9, 3.7191194034320593`*^9}, {
   3.719119666793041*^9, 3.719119667983902*^9}, {3.7191326750305357`*^9, 
   3.7191327124809227`*^9}, {3.7191329745579863`*^9, 3.7191329903458138`*^9}, 
   3.719133020955454*^9, {3.7191332235871572`*^9, 3.719133223785573*^9}, {
   3.7191332567622013`*^9, 3.7191332787765303`*^9}, 3.719133965703826*^9, {
   3.719134045399061*^9, 3.719134045549163*^9}, {3.7191341102431498`*^9, 
   3.719134110417045*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Let", "'"}], "s", " ", "start", " ", "to", " ", 
    RowBox[{"minimize", "!"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"M", "\[LeftArrow]", "M0"}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
    "Make", " ", "a", " ", "deep", " ", "copy", " ", "of", " ", "the", " ", 
     "initial", " ", 
     RowBox[{"mesh", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MList", "=", 
     RowBox[{"{", 
      RowBox[{"getp", "[", "M", "]"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"iter", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Dynamic", "[", "\[IndentingNewLine]", 
    RowBox[{"Grid", "@", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\"\<Iteration\>\"", ",", "\"\<Energy\>\"", ",", "\"\<Speed\>\"", 
          ",", "\"\<StepWidth\>\"", ",", "\"\<Reason\>\"", ",", 
          "\"\<Violation\>\"", ",", "\"\<Time\>\""}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
         "iter", ",", "val", ",", "speed", ",", "old\[Tau]", ",", "reason", 
          ",", "vio", ",", "time"}], "}"}]}], "\[IndentingNewLine]", "}"}], 
      "]"}]}], "]"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "only", " ", "about", " ", "dynamic", " ", 
      "output"}], "..."}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"val", "=", 
     RowBox[{"Energy", "[", "M", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"speed", "=", "1000."}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"While", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"speed", ">", "0.002"}], "&&", 
       RowBox[{"iter", "<", "40"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"iter", "++"}], ";", "\[IndentingNewLine]", 
       RowBox[{"tic1", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "Compute", " ", "the", " ", "projected", " ", "gradient", " ", 
           "and", " ", "a", " ", "possibly", " ", "bent", " ", "curve", " ", 
           "for", " ", "line", " ", 
           RowBox[{"search", ".", " ", "With"}], " ", "option", " ", "value", 
           " ", "Method"}], "\[Rule]", "\"\<FirstOrder\>\""}], ",", " ", 
         RowBox[{
          RowBox[{"it", "'"}], "s", " ", "a", " ", "straight", " ", "line"}], 
         ",", " ", 
         RowBox[{
          RowBox[{"though", ".", " ", "Have"}], " ", "a", " ", "look", " ", 
          "at", " ", "the", " ", "source", " ", "of", " ", 
          "\"\<ConstrainedGradientData\>\"", " ", "with", " ", 
          RowBox[{"\"\<OpenSource[ConstrainedGradientData]\>\"", "."}]}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"osc", "=", 
        RowBox[{"ConstrainedGradientData", "[", 
         RowBox[{"M", ",", "Energy", ",", 
          RowBox[{"Method", "\[Rule]", "\"\<FirstOrder\>\""}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"speed", "=", 
        RowBox[{"osc", "\[LeftDoubleBracket]", 
         RowBox[{"1", ",", "\"\<InitialSpeed\>\""}], 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Artificial", " ", "choice", " ", "for", " ", "the", " ", "initial", 
         " ", "step", " ", "size", " ", "to", " ", "start", " ", "line", " ", 
         "search", " ", 
         RowBox[{"with", ".", " ", "If"}], " ", "you", " ", "use", " ", 
         "\"\<ConstrainedGradientData\>\"", " ", "with", " ", 
         "\"\<Method\[Rule]\>\"", "SecondOrder", 
         "\"\<, this is not required. \>"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"osc", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "\"\<StepSizeCondition\>\""}], 
           "\[RightDoubleBracket]"}], "\[Equal]", "\"\<Straight Line\>\""}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"iter", "<", "20"}], ",", 
           RowBox[{
            RowBox[{"osc", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "\"\<StepSize\>\""}], 
             "\[RightDoubleBracket]"}], "=", 
            RowBox[{"2.", "/", "speed"}]}]}], "]"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "This", " ", "performs", " ", "Armijo", " ", "line", " ", "search", 
         " ", "along", " ", "the", " ", "curve", " ", "specified", " ", "in", 
         " ", "\"\<osc: Type \>\"", 
         RowBox[{"OpenSource", "[", "ConstrainedArmijo", "]"}], 
         "\"\< to see the code.\>"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"M", "=", 
        RowBox[{"ConstrainedArmijo", "[", 
         RowBox[{"M", ",", "Energy", ",", "osc", ",", "\[IndentingNewLine]", 
          RowBox[{"\"\<ScaleFactor\>\"", "\[Rule]", "0.1"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<ProjectionMethod\>\"", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"ConstraintProjection", ",", "\[IndentingNewLine]", 
             RowBox[{"Method", "\[Rule]", "\"\<FrozenNewton\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"\"\<MinIterations\>\"", "\[Rule]", "1"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"\"\<Tolerance\>\"", "\[Rule]", 
              RowBox[{"10", "^", 
               RowBox[{"(", 
                RowBox[{"-", "2"}], ")"}]}]}]}], "\[IndentingNewLine]", 
            "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"toc1", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"toc1", "-", "tic1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"MList", "=", 
        RowBox[{"{", 
         RowBox[{"MList", ",", 
          RowBox[{"getp", "[", "M", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"old\[Tau]", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"StepData", "[", "M", "]"}], "\[LeftDoubleBracket]", 
          "\"\<\[Tau]\>\"", "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]",
          "1", "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"val", "=", 
        RowBox[{"Energy", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"reason", "=", 
        RowBox[{"osc", "\[LeftDoubleBracket]", 
         RowBox[{"1", ",", "\"\<StepSizeCondition\>\""}], 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vio", "=", 
        RowBox[{"Max", "[", 
         RowBox[{"Abs", "[", 
          RowBox[{"ConstraintViolation", "[", "M", "]"}], "]"}], "]"}]}], 
       ";"}]}], "\[IndentingNewLine]", "]"}], "//", 
    "AbsoluteTiming"}]}]}]], "Input",
 CellChangeTimes->{{3.679747471303314*^9, 3.679747475644142*^9}, {
   3.679747875734017*^9, 3.6797478760284357`*^9}, {3.6797480088090076`*^9, 
   3.679748172972845*^9}, {3.681037526066163*^9, 3.68103759221286*^9}, {
   3.681039236736404*^9, 3.681039236984421*^9}, {3.681039309748354*^9, 
   3.6810393532876987`*^9}, {3.681040042701005*^9, 3.681040044644697*^9}, 
   3.681040885403467*^9, 3.6810410190661917`*^9, 3.681041072918448*^9, 
   3.681041106225526*^9, {3.68104275766089*^9, 3.6810427579404383`*^9}, 
   3.681044226380621*^9, {3.681051033544588*^9, 3.6810510340965*^9}, {
   3.681051079932249*^9, 3.6810511337244263`*^9}, {3.6810511763330183`*^9, 
   3.681051222604575*^9}, {3.681051265383916*^9, 3.68105127966547*^9}, {
   3.6810516637144823`*^9, 3.681051664249724*^9}, 3.681056120877863*^9, {
   3.681056417060305*^9, 3.681056421031231*^9}, 3.681056636845314*^9, {
   3.681057005003788*^9, 3.681057041478469*^9}, {3.6810573168089027`*^9, 
   3.681057317795306*^9}, {3.681057531327244*^9, 3.6810575392867928`*^9}, 
   3.6810579737420177`*^9, {3.681058410337698*^9, 3.681058440997095*^9}, 
   3.681058488641467*^9, {3.68105912169032*^9, 3.681059164962899*^9}, {
   3.681059567150095*^9, 3.681059590429935*^9}, {3.6810597103840446`*^9, 
   3.681059714184678*^9}, {3.68111631888087*^9, 3.681116319057062*^9}, {
   3.681116613574778*^9, 3.681116613708848*^9}, {3.681116704005028*^9, 
   3.681116764487665*^9}, {3.681116922163289*^9, 3.681116922872807*^9}, 
   3.681116997928439*^9, {3.681117459659539*^9, 3.681117464148245*^9}, {
   3.681117715758319*^9, 3.681117717980577*^9}, {3.681118262801395*^9, 
   3.681118266568741*^9}, 3.681118317029463*^9, {3.681120347672573*^9, 
   3.681120352872061*^9}, {3.681198145069477*^9, 3.6811981750685387`*^9}, {
   3.681198210489622*^9, 3.681198235454221*^9}, 3.6811982881891327`*^9, {
   3.6811984190817842`*^9, 3.681198419241725*^9}, {3.681202069737053*^9, 
   3.681202107619252*^9}, {3.681203393124691*^9, 3.681203395368911*^9}, {
   3.681462906844371*^9, 3.681462918451124*^9}, {3.68146305266698*^9, 
   3.6814631029762897`*^9}, 3.681463151302005*^9, {3.681463566879834*^9, 
   3.681463613138381*^9}, {3.681464351708761*^9, 3.681464352200531*^9}, 
   3.68146446843193*^9, 3.681473357433207*^9, {3.6814739897814217`*^9, 
   3.6814739905309362`*^9}, {3.681625438004519*^9, 3.681625438370329*^9}, {
   3.681628464785491*^9, 3.6816284649605837`*^9}, 3.681629340360696*^9, {
   3.681629823065836*^9, 3.681629823401327*^9}, {3.681630358767994*^9, 
   3.681630366208633*^9}, {3.684389653742551*^9, 3.6843896649211187`*^9}, 
   3.6860462822931557`*^9, 3.6860479132668056`*^9, {3.686048106554599*^9, 
   3.686048110284501*^9}, {3.689398136039134*^9, 3.689398136171009*^9}, {
   3.689398182989621*^9, 3.6893981834173613`*^9}, {3.6893985944550753`*^9, 
   3.689398595097237*^9}, 3.689535068927327*^9, {3.692972018452527*^9, 
   3.69297201895555*^9}, {3.692972154726378*^9, 3.692972189254821*^9}, {
   3.693081392459689*^9, 3.6930814024654303`*^9}, 3.693081763396756*^9, {
   3.693081835626844*^9, 3.693081838395402*^9}, 3.695467028622696*^9, {
   3.6972104078379803`*^9, 3.6972104288956423`*^9}, {3.6972608082418737`*^9, 
   3.697260808617251*^9}, {3.69726107902851*^9, 3.6972611072021723`*^9}, {
   3.697261922968004*^9, 3.697261923496498*^9}, {3.697262062190769*^9, 
   3.697262062356863*^9}, 3.697268404197555*^9, {3.6977823544009867`*^9, 
   3.697782370534113*^9}, {3.697782433883483*^9, 3.697782434075099*^9}, {
   3.697887942253582*^9, 3.697887943979454*^9}, {3.697947744665003*^9, 
   3.6979477448145523`*^9}, {3.698069427075218*^9, 3.6980694271869373`*^9}, 
   3.6980698930685463`*^9, {3.6990186093715677`*^9, 3.699018612378963*^9}, {
   3.699074817954494*^9, 3.699074818472706*^9}, {3.699075621389036*^9, 
   3.699075621517914*^9}, {3.6990759259929457`*^9, 3.699075926398266*^9}, {
   3.699076255647335*^9, 3.699076257926455*^9}, {3.699078672777741*^9, 
   3.699078672905266*^9}, {3.6990804234940557`*^9, 3.699080426045291*^9}, {
   3.699080456508801*^9, 3.699080456852882*^9}, {3.7080101780001183`*^9, 
   3.7080101805351963`*^9}, 3.7097137330013943`*^9, {3.711137419691731*^9, 
   3.7111374545916767`*^9}, {3.71113750253586*^9, 3.711137506917487*^9}, 
   3.713970555699255*^9, 3.714643820038598*^9, {3.716028413700481*^9, 
   3.7160284139942827`*^9}, {3.716028464788783*^9, 3.716028493403307*^9}, 
   3.71603147148763*^9, 3.716750463422729*^9, 3.7167861036813307`*^9, {
   3.718894654572465*^9, 3.7188947121894817`*^9}, {3.718894754322022*^9, 
   3.718894819411525*^9}, {3.7188949442988157`*^9, 3.7188949444583187`*^9}, {
   3.718895036779406*^9, 3.718895039482204*^9}, {3.718895091960826*^9, 
   3.7188950949926567`*^9}, {3.718895141335616*^9, 3.718895156700479*^9}, {
   3.718895188686305*^9, 3.718895207923984*^9}, 3.718895264672699*^9, {
   3.718895302656045*^9, 3.718895325639298*^9}, {3.71889553617675*^9, 
   3.718895566978311*^9}, {3.718895650196991*^9, 3.718895651850889*^9}, {
   3.7190745891841173`*^9, 3.719074604974228*^9}, {3.719075537027237*^9, 
   3.719075555361931*^9}, {3.71911927949454*^9, 3.719119358974804*^9}, {
   3.719119416378523*^9, 3.719119556578149*^9}, {3.719119602443102*^9, 
   3.719119661535828*^9}, {3.719119764919978*^9, 3.719119847117271*^9}}],

Cell[BoxData[
 RowBox[{"GraphicsGrid", "[", 
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"MeshPlot", "[", "M0", "]"}], ",", 
     RowBox[{"MeshPlot", "[", "M", "]"}]}], "}"}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.719079303665388*^9, 3.7190793374684*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Here", " ", "is", " ", "an", " ", "animation", " ", "of", " ", "the", " ",
     "optimization", " ", 
    RowBox[{"process", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"data", "=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"data", "=", 
         RowBox[{"ToPack", "[", 
          RowBox[{"Flatten", "[", "MList", "]"}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"data", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "data", "]"}], "/", 
            RowBox[{"numdofs", "[", "M", "]"}]}], ",", 
           RowBox[{"numpts", "[", "M", "]"}], ",", 
           RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "}"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"R", "\[LeftArrow]", "M0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MeshPlot", "[", 
      RowBox[{"SetPoints", "[", 
       RowBox[{"R", ",", 
        RowBox[{
        "data", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
       "]"}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "data", "]"}], ",", "1"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"TrackedSymbols", ":>", 
      RowBox[{"{", "i", "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",\

 CellChangeTimes->{{3.7160285357227907`*^9, 3.716028557631996*^9}, 
   3.719074661046858*^9, {3.719079353411222*^9, 3.719079371210492*^9}, {
   3.7190794813527327`*^9, 3.719079528761338*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "And", " ", "this", " ", "is", " ", "how", " ", "I", " ", "produce", " ", 
    "my", " ", 
    RowBox[{"pictures", ".", " ", 
     RowBox[{"(", 
      RowBox[{
      "This", " ", "will", " ", "only", " ", "work", " ", "if", " ", "you", 
       " ", "have", " ", "installed", " ", 
       RowBox[{"povray", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"cam", "=", 
     RowBox[{"\"\<Cam\>\"", "\[Rule]", 
      RowBox[{"camera", "[", 
       RowBox[{"\[LeftAssociation]", 
        RowBox[{
         RowBox[{"\"\<Position\>\"", "\[Rule]", 
          RowBox[{"0.35", 
           RowBox[{"{", 
            RowBox[{"80.", ",", "57.59", ",", "16.69"}], "}"}]}]}], ",", 
         RowBox[{"\"\<LookAt\>\"", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", 
         RowBox[{"\"\<Format\>\"", "\[Rule]", 
          RowBox[{"2", 
           RowBox[{"{", 
            RowBox[{"540", ",", "540"}], "}"}]}]}], ",", 
         RowBox[{"\"\<ViewAngle\>\"", "\[Rule]", "8."}], ",", 
         RowBox[{"\"\<Stereo\>\"", "\[Rule]", "False"}], ",", 
         RowBox[{"\"\<EyeDistance\>\"", "\[Rule]", "0.6"}], ",", 
         RowBox[{"\"\<Quality\>\"", "\[Rule]", "11"}], ",", 
         RowBox[{"\"\<Sky\>\"", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "0.1"}], ",", 
            RowBox[{"-", "0.14"}], ",", "0.98"}], "}"}]}]}], 
        "\[RightAssociation]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"light", "=", 
     RowBox[{"getLightSource", "[", 
      RowBox[{"cam", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"10", 
          RowBox[{"{", 
           RowBox[{"4", ",", "4", ",", "10"}], "}"}]}], ",", 
         RowBox[{"10", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "4"}], ",", "4", ",", "10"}], "}"}]}]}], "}"}], ",", 
       
       RowBox[{"\"\<Intensities\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{".7", ",", ".2"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"POVray", "[", 
    RowBox[{"M0", ",", "cam", ",", "light"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"POVray", "[", 
    RowBox[{"M", ",", "cam", ",", "light"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.719119987750572*^9, 3.719120050256084*^9}, 
   3.719133243849703*^9}]
},
WindowSize->{1440, 851},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules->{"Salvaged" -> True},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 405, 10, 69, "Input"],
Cell[966, 32, 1311, 28, 144, "Input"],
Cell[2280, 62, 652, 14, 69, "Input"],
Cell[2935, 78, 780, 18, 94, "Input"],
Cell[3718, 98, 370, 9, 69, "Input"],
Cell[4091, 109, 727, 17, 94, "Input"],
Cell[4821, 128, 12268, 212, 644, "Input"],
Cell[17092, 342, 12301, 232, 1144, "Input"],
Cell[29396, 576, 278, 7, 43, "Input"],
Cell[29677, 585, 1798, 46, 269, "Input"],
Cell[31478, 633, 2446, 63, 219, "Input"]
}
]
*)

