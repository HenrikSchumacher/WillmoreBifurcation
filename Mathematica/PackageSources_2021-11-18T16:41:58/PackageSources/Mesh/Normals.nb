(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     82194,       1831]
NotebookOptionsPosition[     79327,       1791]
NotebookOutlinePosition[     79719,       1807]
CellTagsIndexPosition[     79676,       1804]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"Quiet", "[", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"PP", ",", "P", ",", "X", ",", "Y", ",", "areanormal"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"PP", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"P", "\[LeftDoubleBracket]", 
         RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"X", "=", 
      RowBox[{
       RowBox[{"PP", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "-", 
       RowBox[{
       "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Y", "=", 
      RowBox[{
       RowBox[{"PP", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
       "-", 
       RowBox[{
       "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"areanormal", "=", 
      RowBox[{
       RowBox[{"1", "/", "2"}], " ", 
       RowBox[{"Cross", "[", 
        RowBox[{"X", ",", "Y"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"CompileJet", "[", 
      RowBox[{"\"\<AreaNormals3D\>\"", ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
       "areanormal", ",", "PP"}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"CompileJet", "[", 
      RowBox[{"\"\<TriangleNormals3D\>\"", ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
       RowBox[{"areanormal", "/", 
        RowBox[{"Sqrt", "[", 
         RowBox[{"Abs", "[", 
          RowBox[{"areanormal", ".", "areanormal"}], "]"}], "]"}]}], ",", 
       "PP"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], "]"}]], "Input",
 CellChangeTimes->{
  3.654251067464266*^9, 3.6542546462020483`*^9, {3.689074632401824*^9, 
   3.689074632594039*^9}, {3.744278097850645*^9, 3.744278105002421*^9}, {
   3.7442782492240543`*^9, 3.744278251137547*^9}, {3.759214984241391*^9, 
   3.759214986318425*^9}},
 CellLabel->
  "In[248]:=",ExpressionUUID->"14b36a81-e882-4742-bdf5-09d838788788"],

Cell[BoxData[
 RowBox[{"CreategetFunction", "[", 
  RowBox[{
  "\"\<AreaNormals\>\"", ",", "mesh", ",", "Triangles", ",", "TriangleData", 
   ",", "\[IndentingNewLine]", 
   RowBox[{"\"\<Derivatives\>\"", "\[Rule]", "2"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<PrintCode\>\"", "\[Rule]", "False"}]}], "\[IndentingNewLine]",
   "]"}]], "Input",
 CellChangeTimes->{{3.700725112764586*^9, 3.700725117812978*^9}, {
   3.700726567895377*^9, 3.700726568525358*^9}, {3.70080334304018*^9, 
   3.700803343438442*^9}, {3.7008045872397203`*^9, 3.7008045879976883`*^9}, 
   3.706528580491506*^9, {3.7140372440445547`*^9, 3.714037244433567*^9}, {
   3.7140374922606688`*^9, 3.71403749288253*^9}, {3.7442781749537497`*^9, 
   3.74427817681415*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"bfbca2e0-2bc0-4f7d-8505-197e80b7fa5a"],

Cell[BoxData[
 RowBox[{"CreateJet", "[", 
  RowBox[{
  "\"\<AreaNormals\>\"", ",", "mesh", ",", "Triangles", ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<Global\>\"", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
   RowBox[{"\"\<Derivatives\>\"", "\[Rule]", "2"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<VectorDimension\>\"", "\[Rule]", "3"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<PrintCode\>\"", "\[Rule]", "False"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<Process\>\"", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.6697346475288363`*^9, 3.669734675464734*^9}, {
   3.680242083204756*^9, 3.680242085370412*^9}, {3.6890743870480003`*^9, 
   3.689074388014222*^9}, {3.697129407016775*^9, 3.6971294075511017`*^9}, {
   3.6971294786433563`*^9, 3.697129479274335*^9}, {3.697134202444203*^9, 
   3.697134203022616*^9}, {3.6971894985564537`*^9, 3.6971894994208*^9}, {
   3.6977963631364098`*^9, 3.697796363661112*^9}, {3.6977987613759108`*^9, 
   3.697798762182118*^9}, {3.700053857703845*^9, 3.700053882274506*^9}, {
   3.700054066864348*^9, 3.700054067470069*^9}, {3.7001092809749727`*^9, 
   3.700109281510124*^9}, {3.700113030679587*^9, 3.700113031271113*^9}, {
   3.700117118863186*^9, 3.700117119348069*^9}, {3.7001175642801647`*^9, 
   3.700117564934132*^9}, {3.7001272113462963`*^9, 3.7001272194381733`*^9}, {
   3.700129563670642*^9, 3.700129564258333*^9}, {3.7006595207453203`*^9, 
   3.7006595216062527`*^9}, {3.70066152208676*^9, 3.700661530411179*^9}, {
   3.7006627855915413`*^9, 3.700662798976269*^9}, {3.700668750003134*^9, 
   3.700668770416127*^9}, {3.7006733853145*^9, 3.700673387994957*^9}, 
   3.7007229893792887`*^9, {3.700723500507579*^9, 3.7007235009446583`*^9}, 
   3.7007251107347517`*^9, {3.7007265711644297`*^9, 3.700726571309417*^9}, {
   3.700727814725103*^9, 3.7007278150565453`*^9}, {3.7007311198199577`*^9, 
   3.700731120455139*^9}, {3.700732288517686*^9, 3.700732288997541*^9}, {
   3.700756638791334*^9, 3.70075664725957*^9}, {3.700757279704977*^9, 
   3.700757280269844*^9}, {3.700759060537842*^9, 3.700759061174117*^9}, {
   3.700759369330298*^9, 3.700759369901042*^9}, {3.7007600041691923`*^9, 
   3.700760004839636*^9}, {3.700800804069091*^9, 3.700800804503496*^9}, {
   3.700801124521039*^9, 3.700801125111871*^9}, {3.7008033095224752`*^9, 
   3.700803311420598*^9}, {3.7008045902890368`*^9, 3.7008045909339437`*^9}, {
   3.714027578151217*^9, 3.714027578779892*^9}, {3.714037240775221*^9, 
   3.714037241388915*^9}, {3.714472042517033*^9, 3.714472043068501*^9}, {
   3.7144733904753637`*^9, 3.714473391138225*^9}, {3.7144811390512857`*^9, 
   3.7144811395415297`*^9}, 3.714481715069249*^9, {3.714488008247664*^9, 
   3.71448800891018*^9}, {3.738257087074048*^9, 3.7382570876074657`*^9}, {
   3.738257332256569*^9, 3.738257332878434*^9}, {3.744278184705698*^9, 
   3.7442781951175547`*^9}, 3.7442783524502373`*^9},
 CellLabel->"In[35]:=",ExpressionUUID->"c8b0fc26-2d3d-47b5-bf68-8f995e8fde00"],

Cell[BoxData[
 RowBox[{"AreaNormals", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"getAreaNormals", "[", "M", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
    RowBox[{
    "Description", "\[Rule]", 
     "\"\<Computes the face normals with face area as length.\>\""}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.744278298256706*^9, 3.7442783204655457`*^9}, 
   3.744278770193926*^9, {3.744278821408649*^9, 3.744278824122238*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"76078b42-5729-4570-9e3e-0057645e525d"],

Cell[BoxData[
 RowBox[{"CreategetFunction", "[", 
  RowBox[{
  "\"\<TriangleNormals\>\"", ",", "mesh", ",", "Triangles", ",", 
   "TriangleData", ",", "\[IndentingNewLine]", 
   RowBox[{"\"\<Derivatives\>\"", "\[Rule]", "2"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<PrintCode\>\"", "\[Rule]", "False"}]}], "\[IndentingNewLine]",
   "]"}]], "Input",
 CellChangeTimes->{3.7442783674913273`*^9},
 CellLabel->"In[36]:=",ExpressionUUID->"6ba34583-b220-4b4c-b5cd-f4d9a1af8697"],

Cell[BoxData[
 RowBox[{"CreateJet", "[", 
  RowBox[{
  "\"\<TriangleNormals\>\"", ",", "mesh", ",", "Triangles", ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<Global\>\"", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
   RowBox[{"\"\<Derivatives\>\"", "\[Rule]", "2"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<VectorDimension\>\"", "\[Rule]", "3"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<PrintCode\>\"", "\[Rule]", "False"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"\"\<Process\>\"", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.744278357416321*^9, 3.7442783583846493`*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"716b267a-2615-4a4f-983e-ba53aaab2bdf"],

Cell[BoxData[
 RowBox[{"TriangleNormals", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"getTriangleNormals", "[", "M", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
    RowBox[{
    "Description", "\[Rule]", 
     "\"\<Computes the face normals with face area as length.\>\""}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.7442783430666533`*^9, 3.744278348684484*^9}, {
  3.744278778527308*^9, 3.7442788061016207`*^9}},
 CellLabel->
  "In[247]:=",ExpressionUUID->"9d38112b-b1b7-4fe8-aa51-9ce43e46294f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getperpframe", "=", 
    RowBox[{"CPackageFunction", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"U", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "u", ",", "v", ",", "w", ",", "V", ",", "W", ",", "\[Lambda]1", ",", 
          "\[Lambda]2", ",", "\[Lambda]3", ",", "i"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"u", "=", 
          RowBox[{"U", "/", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"U", ".", "U"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"\[Lambda]1", "=", 
          RowBox[{"Abs", "[", 
           RowBox[{
           "u", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"\[Lambda]2", "=", 
          RowBox[{"Abs", "[", 
           RowBox[{
           "u", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"\[Lambda]3", "=", 
          RowBox[{"Abs", "[", 
           RowBox[{
           "u", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"i", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"\[Lambda]1", "\[LessEqual]", "\[Lambda]2"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"\[Lambda]1", "\[LessEqual]", "\[Lambda]3"}], ",", "1", 
              ",", "3"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"\[Lambda]2", "\[LessEqual]", "\[Lambda]3"}], ",", "2", 
              ",", "3"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"V", "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1.`", ",", "0.`", ",", "0.`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0.`", ",", "1.`", ",", "0.`"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0.`", ",", "0.`", ",", "1.`"}], "}"}]}], "}"}], 
           "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"W", "=", 
          RowBox[{"V", "-", 
           RowBox[{
            RowBox[{"V", ".", "u"}], " ", "u"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"v", "=", 
          RowBox[{"W", "/", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"W", ".", "W"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"w", "=", 
          RowBox[{"Cross", "[", 
           RowBox[{"u", ",", "v"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"v", ",", "w"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getopenstrataframes", "=", 
    RowBox[{"CPackageFunction", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"list", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "list1", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"list1", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"list", "\[LeftDoubleBracket]", 
                RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
               RowBox[{
               "list", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}], ")"}], "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"list", "\[LeftDoubleBracket]", 
                  RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "list", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ")"}], ".", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"list", "\[LeftDoubleBracket]", 
                  RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "list", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{
               RowBox[{"Length", "[", "list", "]"}], "-", "1"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"getperpframe", "[", 
            RowBox[{
             RowBox[{"list1", "\[LeftDoubleBracket]", 
              RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "+", 
             RowBox[{
             "list1", "\[LeftDoubleBracket]", "i", 
              "\[RightDoubleBracket]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{
              RowBox[{"Length", "[", "list1", "]"}], "-", "1"}]}], "}"}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
      RowBox[{"CompilationOptions", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
        "\"\<InlineCompiledFunctions\>\"", " ", "\[Rule]", " ", "True"}], 
        "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getclosedstrataframes", "=", 
    RowBox[{"CPackageFunction", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"list", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "list1", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"list1", "=", 
          RowBox[{"Append", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"list", "\[LeftDoubleBracket]", 
                  RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
                 RowBox[{
                 "list", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"list", "\[LeftDoubleBracket]", 
                    RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "list", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}], ")"}], ".", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"list", "\[LeftDoubleBracket]", 
                    RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "-", 
                   RowBox[{
                   "list", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}], ")"}]}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{
                 RowBox[{"Length", "[", "list", "]"}], "-", "1"}]}], "}"}]}], 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
               "list", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                "-", 
               RowBox[{"list", "\[LeftDoubleBracket]", 
                RowBox[{"-", "2"}], "\[RightDoubleBracket]"}]}], ")"}], "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                 "list", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{"list", "\[LeftDoubleBracket]", 
                  RowBox[{"-", "2"}], "\[RightDoubleBracket]"}]}], ")"}], ".", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                 "list", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], "-", 
                 RowBox[{"list", "\[LeftDoubleBracket]", 
                  RowBox[{"-", "2"}], "\[RightDoubleBracket]"}]}], ")"}]}], 
              "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"getperpframe", "[", 
            RowBox[{
             RowBox[{"list1", "\[LeftDoubleBracket]", 
              RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "+", 
             RowBox[{
             "list1", "\[LeftDoubleBracket]", "i", 
              "\[RightDoubleBracket]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{
              RowBox[{"Length", "[", "list1", "]"}], "-", "1"}]}], "}"}]}], 
          "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"CompilationOptions", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
        "\"\<InlineCompiledFunctions\>\"", " ", "\[Rule]", " ", "True"}], 
        "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"getSignedVertexTriangleAdjacencyMatrix", "=", 
   RowBox[{"CPackageFunction", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fflist", ",", "_Integer", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"normals", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ff", ",", "n", ",", "a", ",", "b", ",", 
         RowBox[{"result", "=", 
          RowBox[{"Internal`Bag", "[", 
           RowBox[{"Most", "[", 
            RowBox[{"{", "0", "}"}], "]"}], "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ff", "=", 
            RowBox[{
            "fflist", "\[LeftDoubleBracket]", "i", 
             "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"a", "=", 
            RowBox[{"normals", "[", 
             RowBox[{"[", 
              RowBox[{
              "ff", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Internal`StuffBag", "[", 
            RowBox[{"result", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{
               "ff", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "1"}], "}"}], ",", "1"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"ff", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "!=", " ", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"Internal`StuffBag", "[", 
                RowBox[{"result", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", 
                   RowBox[{"ff", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", 
                   RowBox[{"Sign", "[", 
                    RowBox[{"Dot", "[", 
                    RowBox[{"a", ",", 
                    RowBox[{"normals", "[", 
                    RowBox[{"[", 
                    RowBox[{"ff", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}]}], "]"}], 
                    "]"}]}], "}"}], ",", "1"}], "]"}]}], 
              "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "2", ",", 
               RowBox[{"Length", "[", "ff", "]"}]}], "}"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "fflist", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Internal`BagPart", "[", 
           RowBox[{"result", ",", "All"}], "]"}], ",", "3"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6321357408553343`*^9, 3.6321357468929577`*^9}, {
   3.6327308659498453`*^9, 3.632730936837912*^9}, {3.632731008238728*^9, 
   3.6327310088790283`*^9}, {3.6327422087142477`*^9, 3.632742234290516*^9}, {
   3.637058886554345*^9, 3.637058887116035*^9}, {3.641457219194353*^9, 
   3.641457251519925*^9}, {3.641461468961896*^9, 3.641461472594554*^9}, {
   3.665941997005979*^9, 3.6659421555369873`*^9}, 3.665942286435041*^9, {
   3.665942566733944*^9, 3.665942581194755*^9}, {3.665943587401235*^9, 
   3.6659435993825903`*^9}, 3.7194872354467163`*^9, 3.7194873000831537`*^9, {
   3.728066280478015*^9, 3.728066316219804*^9}, {3.728066473912925*^9, 
   3.7280664787751513`*^9}, 3.728066639506137*^9, 3.7282279819591227`*^9, 
   3.728231458886463*^9},ExpressionUUID->"11241be4-d154-44e6-b6a0-\
de459fe47cff"],

Cell[BoxData[
 RowBox[{"SignedVertexTriangleAdjacencyMatrix2", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "LL", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{"x", "\[Function]", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"LL", "=", 
            RowBox[{
            "getSignedVertexTriangleAdjacencyMatrix", "[", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ToPack", "[", 
               RowBox[{"PadRight", "[", 
                RowBox[{
                 RowBox[{"SortBy", "[", 
                  RowBox[{
                   RowBox[{"Normal", "[", "\[IndentingNewLine]", 
                    RowBox[{"GroupBy", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"getVerticesNeighTriangles", "[", 
                    RowBox[{"x", "[", 
                    RowBox[{"[", "\"\<IntrinsicTriangles\>\"", "]"}], "]"}], 
                    "]"}], ",", "2"}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"First", "\[Rule]", "Last"}]}], "]"}], 
                    "\[IndentingNewLine]", "]"}], ",", "First"}], "]"}], "[", 
                 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"AreaNormals", "[", "M", "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"x", "[", 
                 RowBox[{"[", "\"\<TriangleRange\>\"", "]"}], "]"}], "]"}], 
               "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"LL", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], "->", 
              RowBox[{"LL", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{
                "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "]"}], ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                "x", "\[LeftDoubleBracket]", "\"\<IntrinsicTriangles\>\"", 
                 "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], 
          "\[IndentingNewLine]", ")"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"FacetData", "[", "M", "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{"Description", "\[Rule]", "\"\<\>\""}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.630957368518359*^9, 3.630957401401495*^9}, {
   3.632731019539916*^9, 3.632731038700791*^9}, 3.632731450516015*^9, 
   3.632732370430882*^9, {3.644391011168703*^9, 3.644391017109449*^9}, 
   3.665942075810272*^9, {3.711213364069138*^9, 3.711213388608243*^9}, {
   3.719487236394062*^9, 3.71948725860315*^9}, {3.719487300664708*^9, 
   3.719487305410858*^9}, {3.719487432810575*^9, 3.7194874480652103`*^9}, {
   3.728066323970189*^9, 3.728066364052536*^9}, 3.728227498338653*^9, 
   3.7282279856144867`*^9, {3.728231453175625*^9, 3.728231455482018*^9}, {
   3.728231492084399*^9, 3.72823150341829*^9}, 3.728231788896145*^9, {
   3.7442810729601593`*^9, 3.744281075267865*^9}, {3.791026185487636*^9, 
   3.791026185847207*^9}},ExpressionUUID->"060fb7e6-1f78-4d01-94ca-\
6c1a5f2defcd"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.836116435868926*^9, 
  3.836116446250684*^9}},ExpressionUUID->"59e894f9-526a-4146-93c9-\
ed23dc47bb2d"],

Cell[BoxData[
 RowBox[{"SignedAdjacencyMatrix", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_mesh", ",", "Vertices", ",", "Triangles"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "f", ",", "globalplist", ",", "Ave", ",", "Aset", ",", "plist", ",", 
        "patlist", ",", "vallist", ",", "b", ",", "outgoingedges", ",", "a", 
        ",", "a1", ",", "path", ",", "w", ",", "c", ",", "Avt", ",", 
        "\[IndentingNewLine]", "pat", ",", "pos", ",", "aa", ",", "Adj", ",", 
        "AbsAdj", ",", "fAset", ",", "globalvertices"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"globalplist", "=", 
        RowBox[{"Union", "@@", 
         RowBox[{"Edges", "[", 
          RowBox[{"M", ",", 
           RowBox[{"OrientationViolatingEdges", "[", "M", "]"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Ave", "=", 
        RowBox[{"AdjacencyMatrix", "[", 
         RowBox[{"M", ",", "Vertices", ",", "Edges"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Aset", "=", 
        RowBox[{"SignedAdjacencyMatrix", "[", 
         RowBox[{"M", ",", "Edges", ",", "Triangles"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"f", "=", 
        RowBox[{"facet", "\[Function]", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"fAset", "=", 
            RowBox[{"Aset", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", 
              RowBox[{
              "facet", "\[LeftDoubleBracket]", "\"\<TriangleRange\>\"", 
               "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"plist", "=", 
              RowBox[{"Intersection", "[", 
               RowBox[{"globalplist", ",", 
                RowBox[{"facet", "[", "\"\<Vertices\>\"", "]"}]}], "]"}]}], 
             ";"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"globalvertices", "=", 
            RowBox[{
            "facet", "\[LeftDoubleBracket]", "\"\<Vertices\>\"", 
             "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"plist", "=", 
            RowBox[{"Lookup", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AssociationThread", "[", 
               RowBox[{"globalvertices", "\[Rule]", 
                RowBox[{"Range", "[", 
                 RowBox[{"Length", "[", "globalvertices", "]"}], "]"}]}], 
               "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Intersection", "[", 
               RowBox[{"globalplist", ",", "globalvertices"}], "]"}]}], 
             "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"patlist", "=", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", "}"}], ",", 
              RowBox[{"Length", "[", "plist", "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"vallist", "=", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", "}"}], ",", 
              RowBox[{"Length", "[", "plist", "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"b", "=", 
               RowBox[{
               "plist", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"outgoingedges", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                 "Ave", "\[LeftDoubleBracket]", "b", 
                  "\[RightDoubleBracket]"}], "[", "\"\<AdjacencyLists\>\"", 
                 "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"a", "=", 
               RowBox[{
               "fAset", "\[LeftDoubleBracket]", "outgoingedges", 
                "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"pat", "=", 
               RowBox[{"a", "[", "\"\<NonzeroPositions\>\"", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "pat", "]"}], ">", "0"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"With", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"p2", "=", 
                    RowBox[{"pat", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"pos", "=", 
                    RowBox[{"DeleteDuplicates", "[", "p2", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"pat", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], "=", 
                    RowBox[{"Lookup", "[", 
                    RowBox[{
                    RowBox[{"AssociationThread", "[", 
                    RowBox[{"pos", "\[Rule]", 
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "pos", "]"}], "]"}]}], "]"}], ",", 
                    "p2"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"aa", "=", 
                  RowBox[{"Normal", "@", 
                   RowBox[{"SparseArray", "[", 
                    RowBox[{"pat", "\[Rule]", 
                    RowBox[{"a", "[", "\"\<NonzeroValues\>\"", "]"}]}], 
                    "]"}]}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"aa", "=", 
                    RowBox[{"a", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "pos"}], "\[RightDoubleBracket]"}]}], 
                   ";"}], "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"Adj", "=", 
                  RowBox[{
                   RowBox[{"aa", "\[Transpose]"}], ".", "aa"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Do", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Adj", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "i"}], "\[RightDoubleBracket]"}], "=", 
                    "0"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "Adj", "]"}]}], "}"}]}], "]"}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"AbsAdj", "=", 
                  RowBox[{"Abs", "@", "Adj"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"path", "=", 
                  RowBox[{"With", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"ends", "=", 
                    RowBox[{"Pick", "[", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "AbsAdj", "]"}], "]"}], ",", 
                    RowBox[{"Total", "[", "AbsAdj", "]"}], ",", "1"}], 
                    "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "ends", "]"}], "\[GreaterEqual]", 
                    "2"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"SparseArray`ShortestPath", "[", 
                    RowBox[{"AbsAdj", ",", 
                    RowBox[{
                    "ends", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    "ends", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    "SparseArray`FindHamiltonianCycle", "[", "AbsAdj", 
                    "]"}]}], "\[IndentingNewLine]", "]"}]}], 
                   "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "path", "]"}], ">", "0"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"w", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "1", "}"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"Extract", "[", 
                    RowBox[{"Adj", ",", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Most", "[", "path", "]"}], ",", 
                    RowBox[{"Rest", "[", "path", "]"}]}], "}"}], "]"}]}], 
                    "]"}]}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{"w", "=", 
                    RowBox[{"{", "1", "}"}]}]}], "\[IndentingNewLine]", "]"}],
                  ";", "\[IndentingNewLine]", 
                 RowBox[{"c", "=", "1"}], ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                  "patlist", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "=", 
                  RowBox[{"Thread", "[", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{
                    "pos", "\[LeftDoubleBracket]", "path", 
                    "\[RightDoubleBracket]"}]}], "}"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                  "vallist", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"c", "*=", "m"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"m", ",", "w"}], "}"}]}], "]"}]}], ";"}]}], 
               "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "plist", "]"}]}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Avt", "=", 
            RowBox[{"Transpose", "[", 
             RowBox[{"getVertexAdjacencyMatrix", "[", " ", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{
                "facet", "\[LeftDoubleBracket]", "\"\<Vertices\>\"", 
                 "\[RightDoubleBracket]"}], "]"}], ",", 
               RowBox[{
               "facet", "\[LeftDoubleBracket]", "\"\<IntrinsicTriangles\>\"", 
                "\[RightDoubleBracket]"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "plist", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
              "Avt", "\[LeftDoubleBracket]", "plist", 
               "\[RightDoubleBracket]"}], "=", 
              RowBox[{"SparseArray", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Rule", "[", 
                 RowBox[{
                  RowBox[{"Join", "@@", "patlist"}], ",", 
                  RowBox[{"Join", "@@", "vallist"}]}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Length", "[", "plist", "]"}], ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"facet", "[", "\"\<IntrinsicTriangles\>\"", "]"}], 
                   "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "Avt"}],
           "\[IndentingNewLine]", ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"f", "/@", 
        RowBox[{"FacetData", "[", "M", "]"}]}]}]}], "\[IndentingNewLine]", 
     "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7282120232558117`*^9, 3.728212034405674*^9}, {
   3.72821213913559*^9, 3.7282121686504793`*^9}, {3.728212218399663*^9, 
   3.728212229653532*^9}, {3.72821237148398*^9, 3.728212378676285*^9}, {
   3.7282124221143827`*^9, 3.7282124616683817`*^9}, {3.728212509407645*^9, 
   3.7282125262212257`*^9}, 3.728212557447262*^9, {3.7282125977924232`*^9, 
   3.728212597905492*^9}, {3.7282127346185913`*^9, 3.7282127352653513`*^9}, 
   3.728212845267757*^9, {3.72821329780376*^9, 3.728213346331263*^9}, {
   3.728215717116251*^9, 3.728215786967742*^9}, {3.72821584049395*^9, 
   3.7282158424936943`*^9}, {3.728215898907194*^9, 3.7282159535012074`*^9}, {
   3.728215997520186*^9, 3.728216037061487*^9}, {3.728216214754067*^9, 
   3.728216242709104*^9}, {3.728216283715361*^9, 3.728216321850972*^9}, {
   3.7282163901275806`*^9, 3.72821661192487*^9}, {3.728216809345901*^9, 
   3.728216811470703*^9}, {3.728216871503532*^9, 3.7282168718517227`*^9}, {
   3.728216940524775*^9, 3.728217083399808*^9}, {3.728217128673917*^9, 
   3.72821727769003*^9}, 3.728217348828182*^9, 3.728224924594067*^9, {
   3.728227135794973*^9, 3.728227141961768*^9}, {3.728227174635888*^9, 
   3.728227242664206*^9}, {3.728227279582858*^9, 3.728227279772573*^9}, {
   3.728227315969548*^9, 3.728227316366864*^9}, {3.728227383079124*^9, 
   3.7282273982014513`*^9}, 3.728227493970693*^9, 3.72822756541007*^9, {
   3.728228060617194*^9, 3.728228094950098*^9}, {3.728228300877536*^9, 
   3.7282283011635027`*^9}, {3.728228443932152*^9, 3.728228455135654*^9}, 
   3.728228597989379*^9, 3.72822863513093*^9, {3.728230010401116*^9, 
   3.728230016908741*^9}, {3.728230058678185*^9, 3.728230060842278*^9}, {
   3.728230093653722*^9, 3.7282301002105503`*^9}, {3.7282301413683643`*^9, 
   3.728230155653371*^9}, {3.728230194527717*^9, 3.72823019984734*^9}, {
   3.728230235235868*^9, 3.728230273463189*^9}, {3.728230316818493*^9, 
   3.728230366224305*^9}, {3.728230399152471*^9, 3.728230420174296*^9}, {
   3.728230461748345*^9, 3.7282304798228807`*^9}, {3.728230803281419*^9, 
   3.7282308360139313`*^9}, {3.728230940396734*^9, 3.728230941843508*^9}, {
   3.728231030858995*^9, 3.7282310861004267`*^9}, {3.7282311168178*^9, 
   3.7282311285681677`*^9}, {3.728231166249935*^9, 3.728231172455594*^9}, 
   3.7282314212151747`*^9, 3.72823146374682*^9, {3.728231741520399*^9, 
   3.728231814563951*^9}, 3.728232081618986*^9, {3.74386964344308*^9, 
   3.7438698164604607`*^9}, {3.7438708584138193`*^9, 3.743870866084311*^9}, {
   3.743945295815681*^9, 3.7439453024006243`*^9}, {3.7442778947318068`*^9, 
   3.744277942423051*^9}, {3.744280971731744*^9, 3.744281015526896*^9}, {
   3.7442812243369913`*^9, 3.7442812473735247`*^9}, {3.757508789524335*^9, 
   3.757508806800102*^9}, {3.791026212564394*^9, 3.79102621612062*^9}, {
   3.791026894583888*^9, 3.791026901430743*^9}, {3.791027110424644*^9, 
   3.791027128221726*^9}, {3.836116433856558*^9, 3.836116442807106*^9}, {
   3.83622288082969*^9, 
   3.836222903116818*^9}},ExpressionUUID->"fad59189-4851-47cf-a038-\
91dbfa11e7c3"],

Cell[BoxData[
 RowBox[{"FacetNormals", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Nu]", "=", 
        RowBox[{"AreaNormals", "[", "M", "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a", ",", "x"}], "}"}], "\[Function]", 
         RowBox[{"cNormalize3", "[", 
          RowBox[{"a", ".", 
           RowBox[{
           "\[Nu]", "\[LeftDoubleBracket]", "x", "\[RightDoubleBracket]"}]}], 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"SignedVertexTriangleAdjacencyMatrix2", "[", "M", "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"FacetData", "[", "M", "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "\"\<TriangleRange\>\""}], 
           "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", "}"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
    RowBox[{
    "Description", "\[Rule]", 
     "\"\<Computes smooth normals for each facet.\>\""}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.6309581251071787`*^9, 3.630958238807761*^9}, {
   3.632731045869981*^9, 3.632731059100976*^9}, 3.632731450752594*^9, {
   3.637059109934877*^9, 3.637059111611891*^9}, {3.637059182608734*^9, 
   3.6370592270859203`*^9}, {3.711213363993721*^9, 3.711213380208436*^9}, 
   3.7194872382440023`*^9, {3.719487311841106*^9, 3.719487319135169*^9}, {
   3.728066367822501*^9, 3.728066375524425*^9}, 3.728067447846938*^9, {
   3.7282275883348637`*^9, 3.728227665047154*^9}, 3.728227906016076*^9, {
   3.7282313024985723`*^9, 3.728231330674926*^9}, {3.728234797860387*^9, 
   3.7282347983708677`*^9}, {3.7442810625753517`*^9, 3.744281064274598*^9}, {
   3.791026280118423*^9, 3.791026283426826*^9}, {3.836116455685832*^9, 
   3.836116460490636*^9}, {3.8362230377645817`*^9, 3.836223045636024*^9}},
 CellLabel->
  "In[123]:=",ExpressionUUID->"1b1a6246-3e84-4327-b276-887104e21d43"],

Cell[BoxData[
 RowBox[{"LumpedAreaNormalsHelper", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"KroneckerProduct", "[", 
     RowBox[{
      RowBox[{"GlobalSignedVertexTriangleAdjacencyMatrix", "[", "M", "]"}], 
      ",", 
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"EmbeddingDimension", "[", "M", "]"}], "]"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.711236136846179*^9, 3.7194872387331877`*^9, 3.719487320174015*^9, {
   3.744281368261567*^9, 3.744281411346169*^9}},
 CellLabel->
  "In[171]:=",ExpressionUUID->"9b76ee39-c067-473c-9253-a2b9ac36d4bc"],

Cell[BoxData[
 RowBox[{"LumpedAreaNormals", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Partition", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"LumpedAreaNormalsHelper", "[", "M", "]"}], ".", 
       RowBox[{"Flatten", "[", 
        RowBox[{"AreaNormals", "[", "M", "]"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "\[IndentingNewLine]", 
     "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7112197436522093`*^9, 3.711219803796713*^9}, {
  3.711219876537449*^9, 3.711219909239896*^9}, {3.711220196861033*^9, 
  3.711220226800359*^9}, {3.711220413707164*^9, 3.7112204142078533`*^9}, {
  3.7112204569232283`*^9, 3.71122046205822*^9}, {3.711220502827478*^9, 
  3.71122050331956*^9}, {3.744281413601554*^9, 3.744281415842169*^9}},
 CellLabel->
  "In[172]:=",ExpressionUUID->"c3716069-3675-46aa-8496-078627af99be"],

Cell[BoxData[
 RowBox[{"DLumpedAreaNormals", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"LumpedAreaNormalsHelper", "[", "M", "]"}], ".", 
      RowBox[{
       RowBox[{"AreaNormals", "'"}], "[", "M", "]"}]}], ")"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7442814174912577`*^9, 
  3.744281425440949*^9}},ExpressionUUID->"da235679-5490-4832-9806-\
6a8baf89cfbd"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.711220537046966*^9, 
  3.711220537392853*^9}},ExpressionUUID->"80439eac-2391-4669-b140-\
097568f8664d"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Normals", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_", ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"cNormalize2", "[", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "GlobalSignedVertexTriangleAdjacencyMatrix", "[", "M", "]"}], ".", 
          RowBox[{"AreaNormals", "[", "M", "]"}]}], ")"}], "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"NonspecialVertices", "[", "M", "]"}], 
       "\[RightDoubleBracket]"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"cNormalize2", "[", "\[IndentingNewLine]", 
      RowBox[{"Part", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Dot", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "GlobalSignedVertexTriangleAdjacencyMatrix", "[", "M", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"AreaNormals", "[", "M", "]"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"RegularInteriorVertices", "[", "M", "]"}]}], 
       "\[IndentingNewLine]", "]"}], "]"}], "\[IndentingNewLine]", ",", 
     "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Description", "\[Rule]", "\"\<???\>\""}]}], 
    "\[IndentingNewLine]", "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{
  3.711220621343932*^9, {3.719487239393265*^9, 3.719487268057302*^9}, {
   3.7194873213081427`*^9, 
   3.719487322192382*^9}},ExpressionUUID->"00f70548-a379-4440-9819-\
62133a45bfc4"],

Cell[BoxData[
 RowBox[{"Quiet", "[", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"XX", ",", "X", ",", "\[Nu]"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"XX", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"X", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Nu]", "=", 
      RowBox[{"XX", "/", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"XX", ".", "XX"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"code", "=", "\[Nu]"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"getNormalized3D", "=", 
        RowBox[{"CPackageFunction", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"X", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
          "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
          RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"RuntimeAttributes", "\[Rule]", 
           RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
         "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"code", "=", 
         RowBox[{"N", "[", 
          RowBox[{"Simplify", "[", 
           RowBox[{"D", "[", 
            RowBox[{"\[Nu]", ",", 
             RowBox[{"{", 
              RowBox[{"XX", ",", "1"}], "}"}]}], "]"}], "]"}], "]"}]}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"getDNormalized3D", "=", 
        RowBox[{"CPackageFunction", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"X", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
          "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
          RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"RuntimeAttributes", "\[Rule]", 
           RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
         "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
     ";"}]}], "\[IndentingNewLine]", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.711218497873508*^9, 3.711218506155233*^9}, {
   3.711218572255063*^9, 3.7112185790927773`*^9}, {3.711218718050082*^9, 
   3.711218851733876*^9}, 3.711218991269313*^9, {3.711220564895624*^9, 
   3.711220569334363*^9}, {3.711220664994917*^9, 
   3.711220665371488*^9}},ExpressionUUID->"5cda60f2-ecde-4e56-82ea-\
75eba8336c4e"],

Cell[BoxData[
 RowBox[{"Normals", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"getNormalized3D", "[", 
     RowBox[{"LumpedAreaNormals", "[", "M", "]"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.630958311696178*^9, 3.6309583290731916`*^9}, {
   3.630958362496625*^9, 3.630958368519236*^9}, {3.63273109496763*^9, 
   3.632731105821116*^9}, 3.632731451358235*^9, {3.6370592851991777`*^9, 
   3.637059289362752*^9}, 3.665936568091304*^9, {3.7112091438320913`*^9, 
   3.7112091518715353`*^9}, {3.711209314874011*^9, 3.711209320456525*^9}, {
   3.711213347597261*^9, 3.711213380212946*^9}, {3.711220628621255*^9, 
   3.71122063871488*^9}, {3.71122067791308*^9, 3.711220682200885*^9}, {
   3.744281468600215*^9, 
   3.7442814737993097`*^9}},ExpressionUUID->"f6267fbc-8fca-441b-8c8b-\
0ffe7bf973ad"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Normals", "'"}], "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Dot", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SparseDiagonalBlockMatrix", "[", 
       RowBox[{"getDNormalized3D", "[", 
        RowBox[{"LumpedAreaNormals", "[", "M", "]"}], "]"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"DLumpedAreaNormals", "[", "M", "]"}]}], "\[IndentingNewLine]", 
     "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.711221972143497*^9, 3.71122198839839*^9}, {
  3.74428143357749*^9, 3.744281434208818*^9}, {3.74428147542269*^9, 
  3.744281477502841*^9}},ExpressionUUID->"71491d67-5638-4cb6-825f-\
4b4bb91f67fd"],

Cell[BoxData[
 RowBox[{"NormalBundleData", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_", ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "nbdl", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nbdl", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"EmbeddingDimension", "[", "M", "]"}], "]"}], "]"}], ",", 
          
          RowBox[{"VertexCount", "[", "M", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"nbdl", "\[LeftDoubleBracket]", 
         RowBox[{"NonspecialVertices", "[", "M", "]"}], 
         "\[RightDoubleBracket]"}], "=", 
        RowBox[{"Thread", "[", 
         RowBox[{"List", "[", 
          RowBox[{
           RowBox[{"Normals", "[", "M", "]"}], "\[LeftDoubleBracket]", 
           RowBox[{"NonspecialVertices", "[", "M", "]"}], 
           "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"b", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"SingularStrata", "[", "M", "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "All", ",", 
              RowBox[{"2", ";;", 
               RowBox[{"-", "2"}]}]}], "\[RightDoubleBracket]"}], "]"}]}], 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
           "nbdl", "\[LeftDoubleBracket]", "b", "\[RightDoubleBracket]"}], 
           "=", 
           RowBox[{"Join", "@@", 
            RowBox[{"getopenstrataframes", "/@", 
             RowBox[{
              RowBox[{"SingularVertexCoordinates", "[", "M", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"b", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Most", "/@", 
             RowBox[{
              RowBox[{"SingularStrata", "[", "M", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
           "nbdl", "\[LeftDoubleBracket]", "b", "\[RightDoubleBracket]"}], 
           "=", 
           RowBox[{"Join", "@@", 
            RowBox[{"getclosedstrataframes", "/@", 
             RowBox[{
              RowBox[{"SingularVertexCoordinates", "[", "M", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"b", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"BoundaryStrata", "[", "M", "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "All", ",", 
              RowBox[{"2", ";;", 
               RowBox[{"-", "2"}]}]}], "\[RightDoubleBracket]"}], "]"}]}], 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
           "nbdl", "\[LeftDoubleBracket]", "b", "\[RightDoubleBracket]"}], 
           "=", 
           RowBox[{"Join", "@@", 
            RowBox[{"getopenstrataframes", "/@", 
             RowBox[{
              RowBox[{"BoundaryVertexCoordinates", "[", "M", "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"b", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Most", "/@", 
             RowBox[{
              RowBox[{"BoundaryStrata", "[", "M", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
           "nbdl", "\[LeftDoubleBracket]", "b", "\[RightDoubleBracket]"}], 
           "=", 
           RowBox[{"Join", "@@", 
            RowBox[{"getclosedstrataframes", "/@", 
             RowBox[{
              RowBox[{"BoundaryVertexCoordinates", "[", "M", "]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"lengths", "=", 
           RowBox[{"ToPack", "[", 
            RowBox[{"Length", "/@", "nbdl"}], "]"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Association", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\"\<Vectors\>\"", "\[Rule]", 
            RowBox[{"ToPack", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"nbdl", ",", "1"}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Lengths\>\"", "\[Rule]", "lengths"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\"\<Ranges\>\"", "\[Rule]", 
            RowBox[{"With", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"a", "=", 
                RowBox[{"FoldList", "[", 
                 RowBox[{"Plus", ",", "1", ",", "lengths"}], "]"}]}], "}"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Most", "[", "a", "]"}], ",", 
                 RowBox[{
                  RowBox[{"Rest", "[", "a", "]"}], "-", "1"}]}], "}"}], 
               "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.665936082660234*^9, 3.66593613643559*^9}, {
   3.6659367956518917`*^9, 3.665936796967574*^9}, {3.665936958435061*^9, 
   3.66593696805648*^9}, 3.66593728034706*^9, {3.665937727609243*^9, 
   3.6659377870524073`*^9}, 3.713949421414797*^9, {3.719487269359109*^9, 
   3.7194872709409723`*^9}, {3.720106273768084*^9, 3.720106353458774*^9}, {
   3.728232330840748*^9, 
   3.728232333054976*^9}},ExpressionUUID->"cb25b89e-4b9d-4282-9bbe-\
162ee29af7e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NormalBundle", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NormalBundleData", "[", "M", "]"}], "\[LeftDoubleBracket]", 
      "\"\<Vectors\>\"", "\[RightDoubleBracket]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Description", "\[Rule]", "\"\<\>\""}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"NormalBundleRanges", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NormalBundleData", "[", "M", "]"}], "\[LeftDoubleBracket]", 
      "\"\<Ranges\>\"", "\[RightDoubleBracket]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Description", "\[Rule]", "\"\<\>\""}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"NormalBundleLengths", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"NormalBundleData", "[", "M", "]"}], "\[LeftDoubleBracket]", 
     "\"\<Lengths\>\"", "\[RightDoubleBracket]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Description", "\[Rule]", "\"\<\>\""}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.665935152130808*^9, 3.6659351865829782`*^9}, {
   3.665935227312413*^9, 3.665935245659645*^9}, {3.665935282914548*^9, 
   3.665935308682032*^9}, {3.6659354107518463`*^9, 3.665935411683539*^9}, {
   3.665935448382626*^9, 3.665935448645667*^9}, {3.665935576970886*^9, 
   3.665935753447504*^9}, {3.665936027880169*^9, 3.6659360774492807`*^9}, 
   3.665936108469078*^9, {3.665936138644038*^9, 3.665936155259392*^9}, {
   3.665936286958508*^9, 3.66593633280173*^9}, {3.665937201709375*^9, 
   3.6659372111499987`*^9}},ExpressionUUID->"20f7babd-b75c-4c51-a99c-\
92e22da96b62"],

Cell[BoxData[
 RowBox[{"NormalBundlePlot", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_", ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "k", ",", "j", ",", "P", ",", "LL", ",", "r", ",", "i", ",", "circle", 
        ",", "plotfun", ",", "x"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"k", "=", "16"}], ";", "\[IndentingNewLine]", 
       RowBox[{"j", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"P", "=", 
        RowBox[{"VertexCoordinates", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"LL", "=", 
        RowBox[{"NormalBundle", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"r", "=", 
        RowBox[{"0.05", " ", 
         RowBox[{"OptionValue", "[", "\"\<Scaling\>\"", "]"}], " ", 
         RowBox[{"Radius", "[", "M", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"circle", "=", 
        RowBox[{"N", "[", 
         RowBox[{
          RowBox[{"2", "/", "3"}], "r", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Cos", "[", "t", "]"}], ",", 
              RowBox[{"Sin", "[", "t", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"t", ",", "0", ",", 
              RowBox[{"2", "Pi"}], ",", 
              RowBox[{"2", 
               RowBox[{"Pi", "/", "k"}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plotfun", "=", 
        RowBox[{"z", "\[Function]", 
         RowBox[{"Switch", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{
            "z", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "]"}], ",", "\[IndentingNewLine]", "1", ",", 
           RowBox[{
            RowBox[{"x", "=", 
             RowBox[{"z", "\[LeftDoubleBracket]", 
              RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Darker", "[", "Red", "]"}], ",", "Thick", ",", " ", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "z", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                   "-", 
                  RowBox[{"r", " ", "x"}]}], ",", 
                 RowBox[{
                  RowBox[{
                  "z", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                   "+", 
                  RowBox[{"r", " ", "x"}]}]}], "}"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "2", ",", 
           RowBox[{
            RowBox[{"x", "=", 
             RowBox[{
             "z", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            ";", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Darker", "[", "Red", "]"}], ",", 
              RowBox[{"EdgeForm", "[", "]"}], ",", " ", 
              RowBox[{"Polygon", "[", 
               RowBox[{
                RowBox[{"ConstantArray", "[", 
                 RowBox[{
                  RowBox[{
                  "z", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                   ",", 
                  RowBox[{"{", 
                   RowBox[{"k", "+", "1"}], "}"}]}], "]"}], "+", 
                RowBox[{"circle", ".", "x"}]}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", "3", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Darker", "[", "Red", "]"}], ",", 
             RowBox[{"Sphere", "[", 
              RowBox[{
               RowBox[{
               "z", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{"r", " ", 
                RowBox[{"2", "/", "3"}]}]}], "]"}]}], "}"}]}], 
          "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Show", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Graphics3D", "[", "\[IndentingNewLine]", 
          RowBox[{"plotfun", "/@", 
           RowBox[{"Transpose", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"VertexCoordinates", "[", "M", "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Internal`PartitionRagged", "[", 
               RowBox[{
                RowBox[{"NormalBundle", "[", "M", "]"}], ",", 
                RowBox[{"NormalBundleLengths", "[", "M", "]"}]}], "]"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}]}], "\[IndentingNewLine]", 
          "]"}], ",", 
         RowBox[{"Lighting", "\[Rule]", "\"\<Neutral\>\""}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Description", "\[Rule]", "\"\<Plots the normal bundle.\>\""}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"\"\<Public\>\"", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
    RowBox[{"\"\<Options\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<Scaling\>\"", "\[Rule]", "1"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.630958583301136*^9, 3.630958686146208*^9}, {
   3.63273115409897*^9, 3.632731170811454*^9}, 3.632731261573223*^9, {
   3.636301261464167*^9, 3.6363012791699743`*^9}, {3.665936717827242*^9, 
   3.665936717992148*^9}, {3.6659380067804213`*^9, 3.665938074022428*^9}, {
   3.711213363999385*^9, 3.7112133802214117`*^9}, {3.7139494878737707`*^9, 
   3.713949497487811*^9}, {3.713949542157329*^9, 3.7139495426035233`*^9}, {
   3.720106371479827*^9, 
   3.7201063721879253`*^9}},ExpressionUUID->"22671517-caf9-4be5-9978-\
77110eedff01"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"getNormalBundleBasisCombinatorics", "=", 
   RowBox[{"CPackageFunction", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"ranges", ",", "_Integer", ",", "2"}], "}"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"i", "=", "0"}], ",", 
         RowBox[{"Bag", "=", 
          RowBox[{"Internal`Bag", "[", 
           RowBox[{"Most", "[", 
            RowBox[{"{", "0", "}"}], "]"}], "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"i", "++"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Internal`StuffBag", "[", 
              RowBox[{"Bag", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"3", "i"}], "-", "2"}], ",", "j", ",", 
                 RowBox[{
                  RowBox[{"3", "i"}], "-", "1"}], ",", "j", ",", 
                 RowBox[{"3", "i"}], ",", "j"}], "}"}], ",", "6"}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"j", ",", 
               RowBox[{
               "ran", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{
               "ran", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"ran", ",", "ranges"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Internal`BagPart", "[", 
           RowBox[{"Bag", ",", "All"}], "]"}], ",", "2"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NormalBundleBasisCombinatorics", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_", ",", "\[IndentingNewLine]", 
     RowBox[{"getNormalBundleBasisCombinatorics", "[", 
      RowBox[{"NormalBundleRanges", "[", "M", "]"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"NormalBundleBasis", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_", ",", "\[IndentingNewLine]", 
    RowBox[{"MySparseArray", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"NormalBundleBasisCombinatorics", "[", "M", "]"}], "\[Rule]", 
       RowBox[{"Flatten", "[", 
        RowBox[{"NormalBundle", "[", "M", "]"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"DofCount", "[", "M", "]"}], ",", 
        RowBox[{"Length", "[", 
         RowBox[{"NormalBundle", "[", "M", "]"}], "]"}]}], "}"}], ",", 
      "Total"}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.665941907343912*^9, 3.665941911722097*^9}, 
   3.665942075816901*^9, 3.6659421152230062`*^9, {3.665943837164526*^9, 
   3.6659438440274353`*^9}, {3.711213364004036*^9, 3.711213388617426*^9}, {
   3.720106383126174*^9, 
   3.720106384276291*^9}},ExpressionUUID->"4de04d20-7981-4bff-bc07-\
f5378b496726"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NormalDerivative", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"M_", ",", "F_"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"F", "'"}], "[", "M", "]"}], "]"}], ".", 
      RowBox[{"NormalBundleBasis", "[", "M", "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"NormalHessian", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_", ",", "F_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Nu]\[Nu]F", ",", "funname"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"funname", "=", 
        RowBox[{"ToString", "[", 
         RowBox[{"Unevaluated", "[", "F", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Nu]\[Nu]F", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<NormalHess\>\"", ",", "funname"}], "]"}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"\[Nu]\[Nu]F", "[", "M", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.641461482876926*^9, 3.641461483135765*^9}, {
   3.641461580084228*^9, 3.6414615870627003`*^9}, 3.641462075254792*^9, {
   3.641482755190073*^9, 3.6414827567898607`*^9}, {3.642479445878663*^9, 
   3.642479458968457*^9}, {3.6659444895769587`*^9, 3.665944490076223*^9}, {
   3.711213364013633*^9, 
   3.71121337049608*^9}},ExpressionUUID->"a17ab86c-970f-4072-833c-\
5baece9efbab"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"InnerNormalBundleDOFS", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_", ",", "\[IndentingNewLine]", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Range", "@@@", 
       RowBox[{
        RowBox[{"NormalBundleRanges", "[", "M", "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"InteriorVertices", "[", "M", "]"}], 
        "\[RightDoubleBracket]"}]}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InnerNormalBundleBasis", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NormalBundleBasis", "[", "M", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"All", ",", 
       RowBox[{"InnerNormalBundleDOFS", "[", "M", "]"}]}], 
      "\[RightDoubleBracket]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", "]"}]}],
   "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InnerNormalBundleEmbedding", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"M_", ",", "V_"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Partition", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"InnerNormalBundleBasis", "[", "M", "]"}], ".", "V"}], ",", 
       RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "]"}], ",", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"InnerNormalBundleProjection", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_", ",", "V_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Flatten", "[", "V", "]"}], ".", 
     RowBox[{"InnerNormalBundleBasis", "[", "M", "]"}]}], ",", " ", 
    "\[IndentingNewLine]", 
    RowBox[{"InputType", "\[Rule]", "mesh"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.6659440188779984`*^9, 3.6659440576411457`*^9}, {
   3.665944096364065*^9, 3.665944110705245*^9}, 3.665944520730791*^9, {
   3.6659447911003227`*^9, 3.665944801347806*^9}, 3.665944846439723*^9, {
   3.711213364021447*^9, 3.711213364025457*^9}, 
   3.719487272040118*^9},ExpressionUUID->"46513380-51f2-4b72-9322-\
406d71919b75"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"InnerNormalDerivative", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"M_", ",", "F_"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"F", "'"}], "[", "M", "]"}], "]"}], ".", 
      RowBox[{"InnerNormalBundleBasis", "[", "M", "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"InnerNormalHessian", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_", ",", "F_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Nu]\[Nu]F", ",", "funname"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"funname", "=", 
        RowBox[{"ToString", "[", 
         RowBox[{"Unevaluated", "[", "F", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Nu]\[Nu]F", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<NormalHess\>\"", ",", "funname"}], "]"}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Nu]\[Nu]F", "[", "M", "]"}], "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"InnerNormalBundleDOFS", "[", "M", "]"}], ",", 
         RowBox[{"InnerNormalBundleDOFS", "[", "M", "]"}]}], 
        "\[RightDoubleBracket]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.647742488003028*^9, 3.647742488824121*^9}, {
  3.6659344014866543`*^9, 3.6659344024708967`*^9}, {3.665940221557596*^9, 
  3.6659402280811577`*^9}, {3.665944463642647*^9, 3.665944498916656*^9}, {
  3.711213364032827*^9, 
  3.711213370510483*^9}},ExpressionUUID->"ac21d41a-78a0-4cd7-9e4b-\
decc2a5cb4d2"]
},
WindowSize->{1440, 851},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (June 19, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"9e472dc3-e115-4f2c-8db7-90f8fb9df798"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2403, 61, 267, "Input",ExpressionUUID->"14b36a81-e882-4742-bdf5-09d838788788"],
Cell[2964, 83, 824, 15, 117, "Input",ExpressionUUID->"bfbca2e0-2bc0-4f7d-8505-197e80b7fa5a"],
Cell[3791, 100, 3012, 46, 192, "Input",ExpressionUUID->"c8b0fc26-2d3d-47b5-bf68-8f995e8fde00"],
Cell[6806, 148, 658, 12, 142, "Input",ExpressionUUID->"76078b42-5729-4570-9e3e-0057645e525d"],
Cell[7467, 162, 481, 10, 117, "Input",ExpressionUUID->"6ba34583-b220-4b4c-b5cd-f4d9a1af8697"],
Cell[7951, 174, 729, 15, 192, "Input",ExpressionUUID->"716b267a-2615-4a4f-983e-ba53aaab2bdf"],
Cell[8683, 191, 649, 13, 142, "Input",ExpressionUUID->"9d38112b-b1b7-4fe8-aa51-9ce43e46294f"],
Cell[9335, 206, 13603, 325, 1342, "Input",ExpressionUUID->"11241be4-d154-44e6-b6a0-de459fe47cff"],
Cell[22941, 533, 3864, 82, 467, "Input",ExpressionUUID->"060fb7e6-1f78-4d01-94ca-6c1a5f2defcd"],
Cell[26808, 617, 152, 3, 41, "Input",ExpressionUUID->"59e894f9-526a-4146-93c9-ed23dc47bb2d"],
Cell[26963, 622, 15792, 317, 1592, "Input",ExpressionUUID->"fad59189-4851-47cf-a038-91dbfa11e7c3"],
Cell[42758, 941, 2316, 47, 342, "Input",ExpressionUUID->"1b1a6246-3e84-4327-b276-887104e21d43"],
Cell[45077, 990, 745, 17, 117, "Input",ExpressionUUID->"9b76ee39-c067-473c-9253-a2b9ac36d4bc"],
Cell[45825, 1009, 1060, 21, 192, "Input",ExpressionUUID->"c3716069-3675-46aa-8496-078627af99be"],
Cell[46888, 1032, 563, 14, 117, "Input",ExpressionUUID->"da235679-5490-4832-9806-6a8baf89cfbd"],
Cell[47454, 1048, 232, 5, 117, "Input",ExpressionUUID->"80439eac-2391-4669-b140-097568f8664d"],
Cell[47689, 1055, 1645, 37, 392, "Input",ExpressionUUID->"00f70548-a379-4440-9819-62133a45bfc4"],
Cell[49337, 1094, 2910, 68, 542, "Input",ExpressionUUID->"5cda60f2-ecde-4e56-82ea-75eba8336c4e"],
Cell[52250, 1164, 965, 18, 117, "Input",ExpressionUUID->"f6267fbc-8fca-441b-8c8b-0ffe7bf973ad"],
Cell[53218, 1184, 828, 18, 192, "Input",ExpressionUUID->"71491d67-5638-4cb6-825f-4b4bb91f67fd"],
Cell[54049, 1204, 6708, 159, 742, "Input",ExpressionUUID->"cb25b89e-4b9d-4282-9bbe-162ee29af7e1"],
Cell[60760, 1365, 2091, 39, 442, "Input",ExpressionUUID->"20f7babd-b75c-4c51-a99c-92e22da96b62"],
Cell[62854, 1406, 5940, 133, 742, "Input",ExpressionUUID->"22671517-caf9-4be5-9978-77110eedff01"],
Cell[68797, 1541, 3722, 88, 667, "Input",ExpressionUUID->"4de04d20-7981-4bff-bc07-f5378b496726"],
Cell[72522, 1631, 2016, 47, 392, "Input",ExpressionUUID->"a17ab86c-970f-4072-833c-5baece9efbab"],
Cell[74541, 1680, 2603, 56, 567, "Input",ExpressionUUID->"46513380-51f2-4b72-9322-406d71919b75"],
Cell[77147, 1738, 2176, 51, 392, "Input",ExpressionUUID->"ac21d41a-78a0-4cd7-9e4b-decc2a5cb4d2"]
}
]
*)

