(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     79608,       1861]
NotebookOptionsPosition[     76932,       1823]
NotebookOutlinePosition[     77324,       1839]
CellTagsIndexPosition[     77281,       1836]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"MeshTransformationParameters", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{
    "M_mesh", ",", "\[IndentingNewLine]", "None", ",", "\[IndentingNewLine]", 
     
     RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetMeshTransformationParameters", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_mesh", ",", "parameters_"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"ClearAllCacheDependingOn", "[", 
       RowBox[{"M", ",", "\"\<MeshTransformationParameters\>\""}], "]"}], 
      ";"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ClearCache", "[", 
      RowBox[{"M", ",", 
       RowBox[{"{", 
        RowBox[{
        "\"\<Metrics\>\"", ",", "\"\<DMetrics\>\"", ",", 
         "\"\<TransformedMesh\>\""}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SetPersistentCache", "[", 
      RowBox[{"M", ",", "\"\<MeshTransformationParameters\>\"", ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "parameters", "}"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.682830466197146*^9, 3.6828305157754793`*^9}, {
   3.6867533929506683`*^9, 3.686753393496447*^9}, {3.687236388869019*^9, 
   3.687236410375609*^9}, {3.687237694922785*^9, 3.6872376996889753`*^9}, {
   3.6872377554710703`*^9, 3.687237758582494*^9}, {3.687241200904261*^9, 
   3.687241204732149*^9}, {3.709196640390861*^9, 3.709196660657062*^9}, 
   3.709472922976066*^9, {3.709474807805922*^9, 3.70947481472274*^9}, {
   3.713761656557255*^9, 3.713761656728929*^9}, {3.8010419732405787`*^9, 
   3.801041978021846*^9}},ExpressionUUID->"87dcbe90-e548-4f3f-9a77-\
ad62da4de944"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MeshTransformationFunction", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{
    "M_mesh", ",", "\[IndentingNewLine]", "Identity", ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetMeshTransformationFunction", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_mesh", ",", "f_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ClearAllCacheDependingOn", "[", 
      RowBox[{"M", ",", "\"\<MeshTransformationFunction\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SetMeshTransformationParameters", "[", 
      RowBox[{"M", ",", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{
              "f", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}], "-", "1"}], "}"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}], ")"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SetPersistentCache", "[", 
      RowBox[{"M", ",", "\"\<MeshTransformationFunction\>\"", ",", "f"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.682830466197146*^9, 3.6828305157754793`*^9}, {
   3.6867533929506683`*^9, 3.686753393496447*^9}, {3.687237607519105*^9, 
   3.687237655269569*^9}, {3.6872377243196087`*^9, 3.687237770782764*^9}, {
   3.6872564225107613`*^9, 3.687256424634227*^9}, {3.698414627274665*^9, 
   3.6984146337586193`*^9}, {3.698414686832128*^9, 3.698414688149057*^9}, 
   3.7091966745295897`*^9, {3.709201029918685*^9, 3.709201032245799*^9}, {
   3.709474853540906*^9, 3.7094748675660133`*^9}, {3.709474969182004*^9, 
   3.709474971582018*^9}, {3.801041979863534*^9, 
   3.8010419862298527`*^9}},ExpressionUUID->"fb4a7c2a-9579-46ef-b3d7-\
c6c969ad4da1"],

Cell[BoxData[
 RowBox[{"cMeshTransformationFunction", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[CapitalPhi]", ",", "k", ",", "pp", ",", "p", ",", "X", ",", "XX"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"XX", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Compile`GetElement", "[", 
           RowBox[{"X", ",", "i"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "}"}]}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalPhi]", "=", 
        RowBox[{"MeshTransformationFunction", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"k", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Compile`GetElement", "[", 
           RowBox[{"\[CapitalPhi]", ",", "1"}], "]"}], "]"}], "-", "1"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"pp", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Compile`GetElement", "[", 
              RowBox[{"p", ",", "i"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "k"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"code", "=", 
              RowBox[{"N", "[", 
               RowBox[{"\[CapitalPhi]", "[", 
                RowBox[{"XX", ",", 
                 RowBox[{"Sequence", "@@", "pp"}]}], "]"}], "]"}]}], "}"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"Compile", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"X", ",", "_Real", ",", "1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"p", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
              "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
              RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"RuntimeAttributes", "\[Rule]", 
               RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"code", "=", 
             RowBox[{"\[CapitalPhi]", "[", "XX", "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"X", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
             "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
             RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"RuntimeAttributes", "\[Rule]", 
              RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.6872395964413223`*^9, 3.687239599775373*^9}, {
  3.687254604739945*^9, 3.68725461470463*^9}, {3.687519332123829*^9, 
  3.687519334249319*^9}, {3.687519802237587*^9, 3.6875198031969633`*^9}, {
  3.801041993063571*^9, 
  3.801042064516348*^9}},ExpressionUUID->"c4149c06-7abd-46f4-93d5-\
9987d7f960c3"],

Cell[BoxData[
 RowBox[{"TransformedMesh", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"R", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"M", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "data", "\[LeftDoubleBracket]", "\"\<Cache\>\"", 
         "\[RightDoubleBracket]"}], "=", 
        RowBox[{"\[LeftAssociation]", "\[RightAssociation]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "data", "\[LeftDoubleBracket]", "\"\<Points\>\"", 
         "\[RightDoubleBracket]"}], "=", 
        RowBox[{
         RowBox[{"cMeshTransformationFunction", "[", "M", "]"}], "[", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"VertexCoordinates", "[", "M", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"MeshTransformationParameters", "[", "M", "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"None", "\[Rule]", "Nothing"}], ",", 
             RowBox[{
              RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}], "}"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "data", "\[LeftDoubleBracket]", "\"\<Dimension\>\"", 
         "\[RightDoubleBracket]"}], "=", 
        RowBox[{"Length", "[", 
         RowBox[{"data", "\[LeftDoubleBracket]", 
          RowBox[{"\"\<Points\>\"", ",", "1"}], "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"R", "=", 
        RowBox[{"Initialize", "[", 
         RowBox[{"mesh", ",", "data"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ClearPersistentCacheDependingOn", "[", 
        RowBox[{"R", ",", 
         RowBox[{"{", 
          RowBox[{
          "\"\<EmbeddingDimension\>\"", ",", 
           "\"\<MeshTransformationFunction\>\"", ",", 
           "\"\<MeshTransformationParameters\>\""}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "R"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.687239763881012*^9, 3.687239812301589*^9}, {
   3.687239843610311*^9, 3.687239973275269*^9}, {3.68724013610281*^9, 
   3.687240174897607*^9}, {3.687240227488765*^9, 3.68724023013017*^9}, {
   3.687240275967696*^9, 3.687240283665797*^9}, {3.6872403202804317`*^9, 
   3.687240323776074*^9}, {3.6876082865967627`*^9, 3.687608328775914*^9}, {
   3.70799021997614*^9, 3.707990298821187*^9}, {3.713761585650098*^9, 
   3.71376160664884*^9}, 3.7201056241745253`*^9, {3.801042079403242*^9, 
   3.801042079866838*^9}},ExpressionUUID->"e570e874-4dbd-4779-8806-\
93ee5d1c5f19"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MeshTransformationEmbeddingDimension", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
     RowBox[{"EmbeddingDimension", "[", "M", "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetMeshTransformationEmbeddingDimension", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_mesh", ",", "d_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ClearAllCacheDependingOn", "[", 
      RowBox[{"M", ",", "\"\<MeshTransformationEmbeddingDimension\>\""}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"SetPersistentCache", "[", 
      RowBox[{
      "M", ",", "\"\<MeshTransformationEmbeddingDimension\>\"", ",", "d"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.682830466197146*^9, 3.6828305157754793`*^9}, {
  3.682830570177589*^9, 3.682830592097983*^9}, {3.686753393835442*^9, 
  3.686753394063469*^9}, {3.801042083140044*^9, 
  3.801042088336546*^9}},ExpressionUUID->"52b5d72f-dda6-4adc-b5a0-\
fa00c82bb728"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.709470791157777*^9, 
  3.709470791402245*^9}},ExpressionUUID->"b749b965-aef5-49d5-b9bf-\
28a08cf33304"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AmbientMetricFunction", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"code", "=", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"MeshTransformationEmbeddingDimension", "[", "M", "]"}], 
          "]"}]}], "}"}], ",", 
       RowBox[{"Function", "[", 
        RowBox[{"x", ",", "code"}], "]"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetAmbientMetricFunction", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_mesh", ",", "g_"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ClearAllCacheDependingOn", "[", 
      RowBox[{"M", ",", "\"\<AmbientMetricFunction\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SetAmbientMetricParameters", "[", 
      RowBox[{"M", ",", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{
              "g", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}], "-", "1"}], "}"}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"{", "}"}], "\[Rule]", "None"}]}], ")"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SetPersistentCache", "[", 
      RowBox[{"M", ",", "\"\<AmbientMetricFunction\>\"", ",", "g"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.682830526025206*^9, 3.6828305578888693`*^9}, {
  3.686753394285563*^9, 3.6867533945536337`*^9}, {3.687967255858862*^9, 
  3.687967257032647*^9}, {3.709474842998433*^9, 3.7094748432126102`*^9}, {
  3.70947489583517*^9, 3.709474959918748*^9}, {3.713761674470059*^9, 
  3.7137616749574842`*^9}, {3.801042090570869*^9, 
  3.8010420963459*^9}},ExpressionUUID->"896deeba-0abc-4556-bf67-4a5a082ce7ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AmbientMetricParameters", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{
    "M_mesh", ",", "\[IndentingNewLine]", "None", ",", "\[IndentingNewLine]", 
     
     RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetAmbientMetricParameters", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_mesh", ",", "parameters_"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ClearCache", "[", 
      RowBox[{"M", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Metrics\>\"", ",", "\"\<DMetrics\>\""}], "}"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"SetPersistentCache", "[", 
      RowBox[{"M", ",", "\"\<AmbientMetricParameters\>\"", ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "parameters", "}"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.709470797963737*^9, 3.709470819724366*^9}, {
  3.709472831906332*^9, 3.7094728450854816`*^9}, {3.709472914266144*^9, 
  3.709472915281155*^9}, {3.709473654549418*^9, 3.709473657032003*^9}, {
  3.709474584213633*^9, 3.709474614948986*^9}, {3.709474829452621*^9, 
  3.709474840798551*^9}, {3.7137616705660257`*^9, 3.713761671084599*^9}, {
  3.801042098298504*^9, 
  3.8010421033533373`*^9}},ExpressionUUID->"9283d89c-ab01-4ab2-951a-\
3920a0a3d150"],

Cell[BoxData[
 RowBox[{"cAmbientMetricFunction", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", ",", "k", ",", "pp", ",", "p", ",", "X", ",", "XX"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"XX", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Compile`GetElement", "[", 
           RowBox[{"X", ",", "i"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "}"}]}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"g", "=", 
        RowBox[{"AmbientMetricFunction", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"k", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Compile`GetElement", "[", 
           RowBox[{"g", ",", "1"}], "]"}], "]"}], "-", "1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"pp", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Compile`GetElement", "[", 
              RowBox[{"p", ",", "i"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "k"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"code", "=", 
              RowBox[{"N", "[", 
               RowBox[{"g", "[", 
                RowBox[{"XX", ",", 
                 RowBox[{"Sequence", "@@", "pp"}]}], "]"}], "]"}]}], "}"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"Compile", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"X", ",", "_Real", ",", "1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"p", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
              "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
              RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"RuntimeAttributes", "\[Rule]", 
               RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"code", "=", 
             RowBox[{"g", "[", "XX", "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"X", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
             "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
             RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"RuntimeAttributes", "\[Rule]", 
              RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.709470996484745*^9, 3.709471019488905*^9}, {
  3.8010421095483294`*^9, 3.8010421440317793`*^9}},
 CellLabel->
  "In[176]:=",ExpressionUUID->"1ff37f08-7366-4f4b-801f-9987ff3e9c31"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"cAmbientMetricFunction", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_", ",", "\[IndentingNewLine]", 
     RowBox[{"Quiet", "[", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"P", ",", "gAmb"}], "}"}], ",", 
        RowBox[{
         RowBox[{"gAmb", "=", 
          RowBox[{"AmbientMetricFunction", "[", "M", "]"}]}], ";", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"code", "=", 
             RowBox[{"N", "[", 
              RowBox[{"gAmb", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                 "P", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "}"}]}], 
                "]"}], "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"P", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
             "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
             RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"RuntimeAttributes", "\[Rule]", 
              RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
            "\[IndentingNewLine]", "]"}]}], "]"}]}]}], "]"}], 
      "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
    "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.682830658699957*^9, 3.682830709790207*^9}, 
   3.686753395441545*^9, 3.709470772434082*^9, 
   3.709470983074503*^9},ExpressionUUID->"4cef2547-00df-48fd-8e8e-\
b44303273e20"],

Cell[BoxData[
 RowBox[{"PullbackMetricsFunction", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", ",", "\[CapitalPhi]", ",", "XX", ",", "X", ",", "d"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"d", "=", 
        RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"g", "=", 
        RowBox[{"AmbientMetricFunction", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CapitalPhi]", "=", 
        RowBox[{"MeshTransformationFunction", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"XX", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Compile`GetElement", "[", 
           RowBox[{"X", ",", "i"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"And", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"g", "[", "XX", "]"}], "===", 
            RowBox[{"IdentityMatrix", "[", "d", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"\[CapitalPhi]", "===", "Identity"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"StandardPullBackMetricsFunction", "[", 
          RowBox[{"2", ",", "d"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"CreatePullbackMetricsFunction", "[", "M", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.698414819659472*^9, 3.698414858968396*^9}, 
   3.70920097242178*^9, {3.7092010532404137`*^9, 3.709201054903921*^9}, 
   3.7092011530681753`*^9, {3.709471101888*^9, 3.7094711086383257`*^9}, 
   3.709474015406641*^9, {3.80104214993801*^9, 3.801042182671007*^9}},
 CellLabel->
  "In[177]:=",ExpressionUUID->"ae79a9ac-5166-4a12-933c-fb67051d0f5b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"CreatePullbackMetricsFunction", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "PP", ",", "P", ",", "XX", ",", "X", ",", "a", ",", "w", ",", 
         "\[Lambda]", ",", "\[Omega]", ",", "F", ",", "g", ",", 
         "\[CapitalPhi]", ",", "k", ",", "m", ",", "argpat", ",", "pp", ",", 
         "p", ",", "qq", ",", "q", ",", "D\[CapitalPhi]", ",", 
         "\[CapitalPhi]pullg", ",", "pullbackmetric"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"PP", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"P", ",", "i", ",", "j"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"XX", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"X", ",", "i"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"a", "=", 
         RowBox[{"1", "/", "6"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"1", "/", "3"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]", "=", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1", "-", 
              RowBox[{"2", "a"}]}], ",", "a", ",", "a"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"a", ",", 
             RowBox[{"1", "-", 
              RowBox[{"2", "a"}]}], ",", "a"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"a", ",", "a", ",", 
             RowBox[{"1", "-", 
              RowBox[{"2", "a"}]}]}], "}"}]}], "\[IndentingNewLine]", "}"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"\[Omega]", "=", 
         RowBox[{"{", 
          RowBox[{"w", ",", "w", ",", "w"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"F", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
             "PP", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "-", 
             RowBox[{
             "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", 
            RowBox[{
             RowBox[{
             "PP", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
             "-", 
             RowBox[{
             "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}],
            "}"}], "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"g", "=", 
         RowBox[{"AmbientMetricFunction", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[CapitalPhi]", "=", 
         RowBox[{"MeshTransformationFunction", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"\[CapitalPhi]", "===", "Identity"}], ",", " ", 
          RowBox[{"\[CapitalPhi]", "=", 
           RowBox[{"X", "\[Function]", 
            RowBox[{"Evaluate", "[", "XX", "]"}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"k", "=", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"\[CapitalPhi]", ",", "1"}], "]"}], "]"}], "-", "1"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"m", "=", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"g", ",", "1"}], "]"}], "]"}], "-", "1"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"argpat", "=", 
         RowBox[{"{", 
          RowBox[{"Hold", "[", 
           RowBox[{"{", 
            RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], "]"}], "}"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", 
          RowBox[{"(*", "Then", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pp", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"p", ",", "i"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "k"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"D\[CapitalPhi]", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"\[CapitalPhi]", "[", 
                 RowBox[{"XX", ",", 
                  RowBox[{"Sequence", "@@", "pp"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"XX", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"argpat", ",", 
             RowBox[{"Hold", "[", 
              RowBox[{"{", 
               RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "]"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"D\[CapitalPhi]", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"\[CapitalPhi]", "[", "XX", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"XX", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], ";"}]}],
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", ">", "0"}], ",", 
          RowBox[{"(*", "Then", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"qq", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"q", ",", "i"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "m"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"g", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"g", "[", 
               RowBox[{"XX", ",", 
                RowBox[{"Sequence", "@@", "qq"}]}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"argpat", ",", 
             RowBox[{"Hold", "[", 
              RowBox[{"{", 
               RowBox[{"q", ",", "_Real", ",", "1"}], "}"}], "]"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"g", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"g", "[", "XX", "]"}], "]"}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"\[CapitalPhi]pullg", "=", 
         RowBox[{"X", "\[Function]", 
          RowBox[{"Evaluate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"D\[CapitalPhi]", "[", "XX", "]"}], ".", "F"}], ")"}], 
             "\[Transpose]"}], ".", 
            RowBox[{"g", "[", "XX", "]"}], ".", 
            RowBox[{"D\[CapitalPhi]", "[", "XX", "]"}], ".", "F"}], "]"}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"pullbackmetric", "=", 
         RowBox[{"Dot", "[", 
          RowBox[{"\[Omega]", ",", 
           RowBox[{"\[CapitalPhi]pullg", "/@", 
            RowBox[{"(", 
             RowBox[{"\[Lambda]", ".", "PP"}], ")"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ReleaseHold", "@", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"code", "=", 
             RowBox[{"N", "[", "pullbackmetric", "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"HoldComplete", "[", 
              RowBox[{"Compile", "[", 
               RowBox[{
               "\"\<argpat\>\"", ",", "\[IndentingNewLine]", "code", ",", 
                "\[IndentingNewLine]", 
                RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"RuntimeAttributes", "\[Rule]", 
                 RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
               "\[IndentingNewLine]", "]"}], "]"}], "/.", 
             RowBox[{"\"\<argpat\>\"", "\[Rule]", "argpat"}]}], "/.", 
            RowBox[{
             RowBox[{"Hold", "[", "a_", "]"}], "\[RuleDelayed]", "a"}]}]}], 
          "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"PullbackMetrics", "=", 
    RowBox[{"PackageFunction", "[", 
     RowBox[{"M_", ",", "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"g", "=", 
           RowBox[{"PullbackMetricsFunction", "[", "M", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"parameters", "=", 
           RowBox[{"MeshTransformationParameters", "[", "M", "]"}]}]}], 
         "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "parameters", "]"}], "\[Equal]", "0"}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"g", "[", 
           RowBox[{"TriangleData", "[", "M", "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"g", "[", 
           RowBox[{
            RowBox[{"TriangleData", "[", "M", "]"}], ",", "parameters"}], 
           "]"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"InputType", "\[Rule]", "mesh"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
     "]"}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.682829711571697*^9, 3.682829712004683*^9}, {
   3.682830962340678*^9, 3.682830987587123*^9}, {3.682831018643219*^9, 
   3.6828310298942957`*^9}, {3.682831134688999*^9, 3.682831162487858*^9}, {
   3.68283119585191*^9, 3.68283119599356*^9}, {3.682831288559464*^9, 
   3.682831289141382*^9}, 3.682831628579131*^9, {3.682831834070867*^9, 
   3.68283185333965*^9}, {3.68283212054987*^9, 3.682832130091679*^9}, {
   3.686753396077917*^9, 3.686753396658893*^9}, {3.6867534665929003`*^9, 
   3.6867534937134247`*^9}, {3.686753632698495*^9, 3.686753658188362*^9}, {
   3.686753714740068*^9, 3.686753761799057*^9}, {3.686753827049858*^9, 
   3.686753829688341*^9}, {3.686753879072599*^9, 3.6867538810913973`*^9}, 
   3.6867539679965057`*^9, {3.687253888613574*^9, 3.687253939573509*^9}, {
   3.687253994990075*^9, 3.687254154186741*^9}, 3.687254569962339*^9, {
   3.687254761420045*^9, 3.687254786625153*^9}, 3.687254829757371*^9, {
   3.687254916202567*^9, 3.687254990828459*^9}, {3.6872550631261044`*^9, 
   3.687255136270805*^9}, 3.687255275758319*^9, {3.687967406951775*^9, 
   3.687967422819943*^9}, {3.689409825922633*^9, 3.689409828079146*^9}, 
   3.6949621347520027`*^9, 3.6949629561018543`*^9, {3.698414787591158*^9, 
   3.698414802204637*^9}, {3.698414848323565*^9, 3.69841485477109*^9}, {
   3.709471130551387*^9, 3.70947131272733*^9}, {3.709471351507709*^9, 
   3.709471548088999*^9}, {3.709473206529871*^9, 3.709473229212946*^9}, {
   3.709473486958878*^9, 3.709473503041366*^9}, {3.709473780056232*^9, 
   3.709473785152103*^9}, {3.801042189721685*^9, 3.8010422438955803`*^9}},
 CellLabel->
  "In[178]:=",ExpressionUUID->"405d0ae1-dbc2-4e69-abce-b904a4b5652a"],

Cell[BoxData[
 RowBox[{"PullbackMetrics", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", "=", 
        RowBox[{"PullbackMetricsFunction", "[", "M", "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"g", "@@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"TriangleData", "[", "M", "]"}], ",", "\[IndentingNewLine]", 
         
         RowBox[{
          RowBox[{"MeshTransformationParameters", "[", "M", "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "\[Rule]", "Nothing"}], ",", 
            RowBox[{
             RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}], "}"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"AmbientMetricParameters", "[", "M", "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "\[Rule]", "Nothing"}], ",", 
            RowBox[{
             RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}], "}"}]}]}], 
        "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.709473521712612*^9, 3.709473544870182*^9}, {
  3.709473920560728*^9, 3.709473921246428*^9}, {3.7137616258569927`*^9, 
  3.713761635629833*^9}, {3.801042292948546*^9, 
  3.801042294530349*^9}},ExpressionUUID->"ab223d25-0d05-4e14-9638-\
7477751cc07d"],

Cell[BoxData[
 RowBox[{"DPullbackMetricsFunction", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", ",", "\[CapitalPhi]", ",", "XX", ",", "X", ",", "d"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"d", "=", 
        RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"g", "=", 
        RowBox[{"AmbientMetricFunction", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[CapitalPhi]", "=", 
        RowBox[{"MeshTransformationFunction", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"XX", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Compile`GetElement", "[", 
           RowBox[{"X", ",", "i"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"And", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"g", "[", "XX", "]"}], "===", 
            RowBox[{"IdentityMatrix", "[", "d", "]"}]}], ",", 
           RowBox[{"\[CapitalPhi]", "===", "Identity"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"SetPersistentCache", "[", 
            RowBox[{"M", ",", "\"\<DPullbackMetricsFunction3\>\"", ",", 
             RowBox[{"DStandardPullBackMetricsFunction3", "[", 
              RowBox[{"2", ",", "d"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"DStandardPullBackMetricsFunction", "[", 
            RowBox[{"2", ",", "d"}], "]"}]}], "\[IndentingNewLine]", ")"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"CreateDPullbackMetricsFunction", "[", "M", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.698414895893695*^9, 3.698414899693758*^9}, {
  3.709201135244075*^9, 3.709201142232477*^9}, {3.709473959614682*^9, 
  3.709473960429335*^9}, {3.713961358529462*^9, 3.71396140738235*^9}, {
  3.8010422980167713`*^9, 3.8010423481213417`*^9}, {3.8010425279232693`*^9, 
  3.801042551128976*^9}},
 CellLabel->
  "In[195]:=",ExpressionUUID->"94932cd5-bfb3-41aa-a53e-a12ab181e8ff"],

Cell[BoxData[
 RowBox[{"CreateDPullbackMetricsFunction", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"Quiet", "[", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "PP", ",", "P", ",", "XX", ",", "X", ",", "a", ",", "w", ",", 
         "\[Lambda]", ",", "\[Omega]", ",", "F", ",", "g", ",", 
         "\[CapitalPhi]", ",", "k", ",", "m", ",", "argpat", ",", "pp", ",", 
         "p", ",", "qq", ",", "q", ",", "D\[CapitalPhi]", ",", 
         "\[CapitalPhi]pullg", ",", "pullbackmetric", ",", "cf", ",", "U", 
         ",", "UU", ",", "cDf3", ",", "d"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"d", "=", 
         RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"PP", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"P", ",", "i", ",", "j"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"XX", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"X", ",", "i"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"UU", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"U", ",", "i"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"a", "=", 
         RowBox[{"1", "/", "6"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"1", "/", "3"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]", "=", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1", "-", 
              RowBox[{"2", "a"}]}], ",", "a", ",", "a"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"a", ",", 
             RowBox[{"1", "-", 
              RowBox[{"2", "a"}]}], ",", "a"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"a", ",", "a", ",", 
             RowBox[{"1", "-", 
              RowBox[{"2", "a"}]}]}], "}"}]}], "\[IndentingNewLine]", "}"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"\[Omega]", "=", 
         RowBox[{"{", 
          RowBox[{"w", ",", "w", ",", "w"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"F", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
             "PP", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
             "-", 
             RowBox[{
             "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", 
            RowBox[{
             RowBox[{
             "PP", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
             "-", 
             RowBox[{
             "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}],
            "}"}], "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"g", "=", 
         RowBox[{"AmbientMetricFunction", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[CapitalPhi]", "=", 
         RowBox[{"MeshTransformationFunction", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"\[CapitalPhi]", "===", "Identity"}], ",", " ", 
          RowBox[{"\[CapitalPhi]", "=", 
           RowBox[{"X", "\[Function]", 
            RowBox[{"Evaluate", "[", "XX", "]"}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"k", "=", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"\[CapitalPhi]", ",", "1"}], "]"}], "]"}], "-", "1"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"m", "=", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"g", ",", "1"}], "]"}], "]"}], "-", "1"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"argpat", "=", 
         RowBox[{"{", 
          RowBox[{"Hold", "[", 
           RowBox[{"{", 
            RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], "]"}], "}"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", 
          RowBox[{"(*", "Then", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pp", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
              "p", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "k"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"D\[CapitalPhi]", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"\[CapitalPhi]", "[", 
                 RowBox[{"XX", ",", 
                  RowBox[{"Sequence", "@@", "pp"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"XX", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"argpat", ",", 
             RowBox[{"Hold", "[", 
              RowBox[{"{", 
               RowBox[{"p", ",", "_Real", ",", "1"}], "}"}], "]"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"D\[CapitalPhi]", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"\[CapitalPhi]", "[", "XX", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"XX", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], ";"}]}],
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", ">", "0"}], ",", 
          RowBox[{"(*", "Then", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"qq", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
              "q", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "m"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"g", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"g", "[", 
               RowBox[{"XX", ",", 
                RowBox[{"Sequence", "@@", "qq"}]}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"argpat", ",", 
             RowBox[{"Hold", "[", 
              RowBox[{"{", 
               RowBox[{"q", ",", "_Real", ",", "1"}], "}"}], "]"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"g", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"g", "[", "XX", "]"}], "]"}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"\[CapitalPhi]pullg", "=", 
         RowBox[{"X", "\[Function]", 
          RowBox[{"Evaluate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"D\[CapitalPhi]", "[", "XX", "]"}], ".", "F"}], ")"}], 
             "\[Transpose]"}], ".", 
            RowBox[{"g", "[", "XX", "]"}], ".", 
            RowBox[{"D\[CapitalPhi]", "[", "XX", "]"}], ".", "F"}], "]"}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"pullbackmetric", "=", 
         RowBox[{"Dot", "[", 
          RowBox[{"\[Omega]", ",", 
           RowBox[{"\[CapitalPhi]pullg", "/@", 
            RowBox[{"(", 
             RowBox[{"\[Lambda]", ".", "PP"}], ")"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"cf", "=", 
         RowBox[{"ReleaseHold", "@", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"code", "=", 
              RowBox[{"D", "[", 
               RowBox[{"pullbackmetric", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Flatten", "[", "PP", "]"}], ",", "1"}], "}"}]}], 
               "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"HoldComplete", "[", 
               RowBox[{"Compile", "[", 
                RowBox[{
                "\"\<argpat\>\"", ",", "\[IndentingNewLine]", "code", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"RuntimeAttributes", "\[Rule]", 
                  RowBox[{"{", "Listable", "}"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
                "\[IndentingNewLine]", "]"}], "]"}], "/.", 
              RowBox[{"\"\<argpat\>\"", "\[Rule]", "argpat"}]}], "/.", 
             RowBox[{
              RowBox[{"Hold", "[", "a_", "]"}], "\[RuleDelayed]", "a"}]}]}], 
           "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"argpat", ",", 
          RowBox[{"Hold", "[", 
           RowBox[{"{", 
            RowBox[{"U", ",", "_Real", ",", "2"}], "}"}], "]"}]}], "]"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"cDf3", "=", 
         RowBox[{"ReleaseHold", "@", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"code", "=", 
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{"pullbackmetric", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Flatten", "[", "PP", "]"}], ",", "1"}], "}"}]}], 
                "]"}], ".", 
               RowBox[{"Flatten", "[", "U", "]"}]}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"HoldComplete", "[", 
               RowBox[{"Compile", "[", 
                RowBox[{
                "\"\<argpat\>\"", ",", "\[IndentingNewLine]", "code", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"RuntimeAttributes", "\[Rule]", 
                  RowBox[{"{", "Listable", "}"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
                "\[IndentingNewLine]", "]"}], "]"}], "/.", 
              RowBox[{"\"\<argpat\>\"", "\[Rule]", "argpat"}]}], "/.", 
             RowBox[{
              RowBox[{"Hold", "[", "a_", "]"}], "\[RuleDelayed]", "a"}]}]}], 
           "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"SetPersistentCache", "[", 
         RowBox[{"M", ",", "\"\<DPullbackMetricsFunction3\>\"", ",", "cDf3"}],
          "]"}], ";", "\[IndentingNewLine]", "cf"}]}], "\[IndentingNewLine]", 
      "]"}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.682831139166939*^9, 3.682831141907435*^9}, 
   3.682831200920745*^9, {3.68283184765149*^9, 3.682831868709807*^9}, {
   3.682831903362289*^9, 3.6828319037371817`*^9}, {3.6828321442762413`*^9, 
   3.682832156041445*^9}, {3.686378695407365*^9, 3.686378702948565*^9}, {
   3.686753397229906*^9, 3.686753397826892*^9}, {3.686753430063058*^9, 
   3.686753445081449*^9}, {3.6867535025197573`*^9, 3.686753507554922*^9}, 
   3.68675397283593*^9, {3.686754061142919*^9, 3.686754064903389*^9}, {
   3.687255185850223*^9, 3.687255251610579*^9}, {3.687255282977799*^9, 
   3.687255381705755*^9}, {3.687255489003293*^9, 3.687255493532156*^9}, {
   3.688725180474527*^9, 3.688725180719898*^9}, {3.698414891840605*^9, 
   3.698414911927313*^9}, 3.709473461654718*^9, {3.709473746798962*^9, 
   3.709473752404799*^9}, {3.709473831909189*^9, 3.709473854366303*^9}, {
   3.713960760164487*^9, 3.713960851175111*^9}, {3.7139609405214777`*^9, 
   3.71396094244239*^9}, {3.713961097631196*^9, 3.713961122727758*^9}, {
   3.7139614191546*^9, 3.71396143305779*^9}, {3.801042309502157*^9, 
   3.8010423250776443`*^9}, {3.80104236123559*^9, 3.8010423884267673`*^9}},
 CellLabel->
  "In[179]:=",ExpressionUUID->"00840bcc-362a-498a-bdaa-96dac86630f4"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Quiet", "[", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "PP", ",", "P", ",", "XX", ",", "X", ",", "a", ",", "w", ",", 
       "\[Omega]", ",", "\[Lambda]", ",", "F", ",", "g", ",", "\[CapitalPhi]",
        ",", "D\[CapitalPhi]", ",", "\[CapitalPhi]pullg", ",", 
       "pullbackmetric", ",", "k"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PP", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"P", "\[LeftDoubleBracket]", 
          RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"XX", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"X", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"EmbeddingDimension", "[", "M", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{"N", "[", 
        RowBox[{"1", "/", "6"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"N", "[", 
        RowBox[{"1", "/", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Lambda]", "=", 
       RowBox[{"N", "[", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1.", "-", 
             RowBox[{"2.", "a"}]}], ",", "a", ",", "a"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"a", ",", 
            RowBox[{"1.", "-", 
             RowBox[{"2.", "a"}]}], ",", "a"}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"a", ",", "a", ",", 
            RowBox[{"1.", "-", 
             RowBox[{"2.", "a"}]}]}], "}"}]}], "\[IndentingNewLine]", "}"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]", "=", 
       RowBox[{"{", 
        RowBox[{"w", ",", "w", ",", "w"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"F", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
           "PP", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "-", 
           
           RowBox[{
           "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
          ",", 
          RowBox[{
           RowBox[{
           "PP", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], "-", 
           
           RowBox[{
           "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
         "}"}], "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"g", "=", 
       RowBox[{"AmbientMetricFunction", "[", "M", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalPhi]", "=", 
       RowBox[{"MeshTransformationFunction", "[", "M", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"k", "=", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{
         "\[CapitalPhi]", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}], "]"}], "-", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"pp", ",", "p"}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pp", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
              "p", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "k"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"D\[CapitalPhi]", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"X", ",", "p"}], "}"}], "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"D", "[", 
               RowBox[{
                RowBox[{"\[CapitalPhi]", "[", 
                 RowBox[{"XX", ",", 
                  RowBox[{"Sequence", "@@", "pp"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"XX", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"\[CapitalPhi]pullg", "=", 
            RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"D\[CapitalPhi]", "[", 
                   RowBox[{"XX", ",", "pp"}], "]"}], ".", "F"}], ")"}], 
                "\[Transpose]"}], ".", 
               RowBox[{"g", "[", "XX", "]"}], ".", 
               RowBox[{"D\[CapitalPhi]", "[", 
                RowBox[{"XX", ",", "pp"}], "]"}], ".", "F"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"pullbackmetric", "=", 
            RowBox[{"Dot", "[", 
             RowBox[{"\[Omega]", ",", 
              RowBox[{"\[CapitalPhi]pullg", "/@", 
               RowBox[{"(", 
                RowBox[{"\[Lambda]", ".", "PP"}], ")"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"code", "=", 
               RowBox[{"D", "[", 
                RowBox[{"pullbackmetric", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Flatten", "[", "PP", "]"}], ",", "1"}], "}"}]}], 
                "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{"Compile", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"p", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
               "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
               RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"RuntimeAttributes", "\[Rule]", 
                RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
               
               RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
              "\[IndentingNewLine]", "]"}]}], "]"}]}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"D\[CapitalPhi]", "=", 
          RowBox[{"X", "\[Function]", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{"\[CapitalPhi]", "[", "XX", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"XX", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[CapitalPhi]pullg", "=", 
          RowBox[{"X", "\[Function]", 
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"D\[CapitalPhi]", "[", "XX", "]"}], ".", "F"}], ")"}],
               "\[Transpose]"}], ".", 
             RowBox[{"g", "[", "XX", "]"}], ".", 
             RowBox[{"D\[CapitalPhi]", "[", "XX", "]"}], ".", "F"}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"pullbackmetric", "=", 
          RowBox[{"Dot", "[", 
           RowBox[{"\[Omega]", ",", 
            RowBox[{"\[CapitalPhi]pullg", "/@", 
             RowBox[{"(", 
              RowBox[{"\[Lambda]", ".", "PP"}], ")"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"code", "=", 
             RowBox[{"D", "[", 
              RowBox[{"pullbackmetric", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Flatten", "[", "PP", "]"}], ",", "1"}], "}"}]}], 
              "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], "}"}], ",", 
             "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
             RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"RuntimeAttributes", "\[Rule]", 
              RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
            "\[IndentingNewLine]", "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
       "]"}]}]}], "\[IndentingNewLine]", "]"}], "]"}], "*)"}]], "Input",
 CellChangeTimes->{
  3.709473841519986*^9},ExpressionUUID->"c66fe3d4-a021-43bd-aeaa-\
900c69816230"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"DPullbackMetricsData", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_", ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Dg", ",", "parameters", ",", "data"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Dg", "=", 
         RowBox[{"DPullbackMetricsFunction", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"parameters", "=", 
         RowBox[{"MeshTransformationParameters", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "parameters", "]"}], "\[Equal]", "0"}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"Dg", "[", 
           RowBox[{"TriangleData", "[", "M", "]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Dg", "[", 
           RowBox[{
            RowBox[{"TriangleData", "[", "M", "]"}], ",", "parameters"}], 
           "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"InputType", "\[Rule]", "mesh"}]}], "\[IndentingNewLine]", 
    "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.68871372707551*^9, 3.6887137486269903`*^9}, 
   3.688713792752007*^9, 3.6887138923723793`*^9, {3.688725160907298*^9, 
   3.688725174067459*^9}, 
   3.709473908300387*^9},ExpressionUUID->"30d51a48-a34c-40c0-abfe-\
d3a60b67667f"],

Cell[BoxData[
 RowBox[{"DPullbackMetricsFunction3", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"getb", "=", 
         RowBox[{"DPullbackMetricsFunction", "[", "M", "]"}]}], ",", 
        RowBox[{"d", "=", 
         RowBox[{"EmbeddingDimension", "[", "M", "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Compile", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"U", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"B", ",", "u"}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"B", "=", 
            RowBox[{"getb", "[", "P", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"u", "=", 
            RowBox[{"Flatten", "[", "U", "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"B", ",", "i", ",", "j", ",", "k"}], "]"}], 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"u", ",", "k"}], "]"}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"k", ",", "1", ",", 
                   RowBox[{"3", " ", "d"}]}], "}"}]}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"RuntimeAttributes", "\[Rule]", 
         RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Parallelization", "\[Rule]", "True"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.713959965010746*^9, 3.713959980716886*^9}, {
  3.713960046287775*^9, 3.713960186408265*^9}, {3.713960289911355*^9, 
  3.713960348390789*^9}, {3.71396043928365*^9, 3.713960451188527*^9}, {
  3.801042403754957*^9, 3.801042418838478*^9}},
 CellLabel->
  "In[180]:=",ExpressionUUID->"7a100e9e-6256-43b1-aa08-f91ee6fa926b"],

Cell[BoxData[
 RowBox[{"DPullbackMetricsFunction3", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DPullbackMetricsFunction", "[", "M", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"DPullbackMetricsFunction3", "[", "M", "]"}]}], 
     "\[IndentingNewLine]", ")"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "Persistent"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.713960522012957*^9, 3.713960533587853*^9}, {
  3.713960623592551*^9, 3.7139607124506493`*^9}, {3.713960881585133*^9, 
  3.713960894726761*^9}, {3.713960972667976*^9, 3.7139609765397377`*^9}, {
  3.801042569163064*^9, 3.801042570431447*^9}},
 CellLabel->
  "In[196]:=",ExpressionUUID->"dbcd6035-81fa-42d7-8204-1f1a0aa2cf16"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DPullbackMetricsData", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Dg", "=", 
         RowBox[{"DPullbackMetricsFunction", "[", "M", "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Dg", "@@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"TriangleData", "[", "M", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"MeshTransformationParameters", "[", "M", "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"None", "\[Rule]", "Nothing"}], ",", 
             RowBox[{
              RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}], "}"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AmbientMetricParameters", "[", "M", "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"None", "\[Rule]", "Nothing"}], ",", 
             RowBox[{
              RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}], "}"}]}]}], 
         "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"DPullbackMetricsData", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_mesh", ",", 
      RowBox[{"{", "u_", "}"}], ",", 
      RowBox[{"{", "3", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cDg3", "=", 
        RowBox[{"DPullbackMetricsFunction3", "[", "M", "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"cDg3", "@@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"TriangleData", "[", "M", "]"}], ",", "\[IndentingNewLine]", 
         
         RowBox[{
          RowBox[{"MeshTransformationParameters", "[", "M", "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "\[Rule]", "Nothing"}], ",", 
            RowBox[{
             RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}], "}"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"AmbientMetricParameters", "[", "M", "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"None", "\[Rule]", "Nothing"}], ",", 
            RowBox[{
             RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}], "}"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"DistributeVector", "[", 
          RowBox[{"M", ",", "Triangles", ",", 
           RowBox[{"GetBuffer", "[", 
            RowBox[{"M", ",", "u"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
        "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.7094739296874313`*^9, 3.709473943470717*^9}, 
   3.709474084353297*^9, {3.713761642389462*^9, 3.713761650909073*^9}, {
   3.71396210289104*^9, 3.713962103228715*^9}, {3.8010424318955393`*^9, 
   3.801042455852597*^9}},
 CellLabel->
  "In[197]:=",ExpressionUUID->"42b9faef-585b-48d8-b705-702e789ebfcd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DPullbackMetrics", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "a", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"a", "=", 
         RowBox[{"AssemblyCombinatorics", "[", 
          RowBox[{
          "M", ",", "Triangles", ",", "1", ",", "\"\<Local\>\"", ",", "4"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"a", "[", 
         RowBox[{"DPullbackMetricsData", "[", "M", "]"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"DPullbackMetrics", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"M_mesh", ",", 
      RowBox[{"{", "u_", "}"}], ",", 
      RowBox[{"{", "3", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "a", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"a", "=", 
        RowBox[{"AssemblyCombinatorics", "[", 
         RowBox[{
         "M", ",", "Triangles", ",", "0", ",", "\"\<Local\>\"", ",", "4"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"a", "[", 
        RowBox[{"DPullbackMetricsData", "[", 
         RowBox[{"M", ",", 
          RowBox[{"{", "u", "}"}], ",", 
          RowBox[{"{", "3", "}"}]}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.713962118448288*^9, 3.7139622459214897`*^9}, {
   3.713962332102584*^9, 3.713962332406563*^9}, {3.7201056327139683`*^9, 
   3.720105640645533*^9}, {3.8010424596944923`*^9, 3.8010424720275307`*^9}, {
   3.835597751611869*^9, 3.8355977599633636`*^9}, 3.8355977956667213`*^9, {
   3.835597833880371*^9, 3.835597848127151*^9}},
 CellLabel->
  "In[649]:=",ExpressionUUID->"ddd21ac8-d527-4487-aedb-95b0ec4b3e6c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getEmbeddingDifferentials", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"p_", ",", "\[IndentingNewLine]", 
     RowBox[{"Transpose", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "i"}], "\[RightDoubleBracket]"}], "-", 
          RowBox[{"p", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "2", ",", 
           RowBox[{
            RowBox[{"Dimensions", "[", "p", "]"}], "\[LeftDoubleBracket]", 
            "2", "\[RightDoubleBracket]"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",ExpressionUUID->"2ffb409e-\
9367-48c1-8370-7b2a455b9dfa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EmbeddingDifferentials", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
     RowBox[{"getEmbeddingDifferentials", "[", 
      RowBox[{"TriangleData", "[", "M", "]"}], "]"}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.7101331164262047`*^9, {3.7101337558785686`*^9, 3.710133781444013*^9}, {
   3.710133976368482*^9, 3.71013398717157*^9}, {3.71013402608352*^9, 
   3.7101340377990303`*^9}, {3.801042484948938*^9, 3.8010424865304413`*^9}},
 CellLabel->
  "In[192]:=",ExpressionUUID->"56220cff-ac25-49c1-b564-e143a573b4d7"],

Cell[BoxData[
 RowBox[{"DualMetrics", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
    RowBox[{"cInvert2by2", "[", 
     RowBox[{"Metrics", "[", "M", "]"}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Caching", "\[Rule]", "False"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.801042489075946*^9, 3.801042491009828*^9}},
 CellLabel->
  "In[193]:=",ExpressionUUID->"c94cf89a-82bb-4a88-8931-f54da7f37651"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EmbeddingDifferentialPseudoinverses", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_mesh", ",", "\[IndentingNewLine]", 
     RowBox[{"ThreadDot", "[", 
      RowBox[{
       RowBox[{"EmbeddingDifferentials", "[", "M", "]"}], ",", 
       RowBox[{"DualMetrics", "[", "M", "]"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7101338234564533`*^9, 3.710133870940731*^9}, {
  3.801042493371669*^9, 3.801042495050181*^9}},
 CellLabel->
  "In[194]:=",ExpressionUUID->"01568b4b-ec8a-4f4f-9007-23c9cfd2ecf5"]
},
WindowSize->{1439, 852},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (June 19, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"d562be2e-d300-45b0-b9e3-7a07ad2199a6"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1851, 41, 267, "Input",ExpressionUUID->"87dcbe90-e548-4f3f-9a77-ad62da4de944"],
Cell[2412, 63, 2077, 45, 267, "Input",ExpressionUUID->"fb4a7c2a-9579-46ef-b3d7-c6c969ad4da1"],
Cell[4492, 110, 4077, 93, 692, "Input",ExpressionUUID->"c4149c06-7abd-46f4-93d5-9987d7f960c3"],
Cell[8572, 205, 2904, 64, 417, "Input",ExpressionUUID->"e570e874-4dbd-4779-8806-93ee5d1c5f19"],
Cell[11479, 271, 1230, 26, 242, "Input",ExpressionUUID->"52b5d72f-dda6-4adc-b5a0-fa00c82bb728"],
Cell[12712, 299, 206, 4, 92, "Input",ExpressionUUID->"b749b965-aef5-49d5-b9bf-28a08cf33304"],
Cell[12921, 305, 2124, 49, 267, "Input",ExpressionUUID->"896deeba-0abc-4556-bf67-4a5a082ce7ae"],
Cell[15048, 356, 1457, 33, 242, "Input",ExpressionUUID->"9283d89c-ab01-4ab2-951a-3920a0a3d150"],
Cell[16508, 391, 3879, 90, 692, "Input",ExpressionUUID->"1ff37f08-7366-4f4b-801f-9987ff3e9c31"],
Cell[20390, 483, 2089, 47, 342, "Input",ExpressionUUID->"4cef2547-00df-48fd-8e8e-b44303273e20"],
Cell[22482, 532, 2220, 49, 442, "Input",ExpressionUUID->"ae79a9ac-5166-4a12-933c-fb67051d0f5b"],
Cell[24705, 583, 12438, 283, 1517, "Input",ExpressionUUID->"405d0ae1-dbc2-4e69-abce-b904a4b5652a"],
Cell[37146, 868, 1573, 38, 267, "Input",ExpressionUUID->"ab223d25-0d05-4e14-9638-7477751cc07d"],
Cell[38722, 908, 2562, 57, 442, "Input",ExpressionUUID->"94932cd5-bfb3-41aa-a53e-a12ab181e8ff"],
Cell[41287, 967, 13260, 306, 1542, "Input",ExpressionUUID->"00840bcc-362a-498a-bdaa-96dac86630f4"],
Cell[54550, 1275, 9092, 224, 1017, "Input",ExpressionUUID->"c66fe3d4-a021-43bd-aeaa-900c69816230"],
Cell[63645, 1501, 1512, 36, 292, "Input",ExpressionUUID->"30d51a48-a34c-40c0-abfe-d3a60b67667f"],
Cell[65160, 1539, 2939, 67, 492, "Input",ExpressionUUID->"7a100e9e-6256-43b1-aa08-f91ee6fa926b"],
Cell[68102, 1608, 863, 17, 192, "Input",ExpressionUUID->"dbcd6035-81fa-42d7-8204-1f1a0aa2cf16"],
Cell[68968, 1627, 3338, 80, 567, "Input",ExpressionUUID->"42b9faef-585b-48d8-b705-702e789ebfcd"],
Cell[72309, 1709, 1981, 46, 342, "Input",ExpressionUUID->"ddd21ac8-d527-4487-aedb-95b0ec4b3e6c"],
Cell[74293, 1757, 922, 22, 92, "Input",ExpressionUUID->"2ffb409e-9367-48c1-8370-7b2a455b9dfa"],
Cell[75218, 1781, 636, 13, 92, "Input",ExpressionUUID->"56220cff-ac25-49c1-b564-e143a573b4d7"],
Cell[75857, 1796, 480, 10, 117, "Input",ExpressionUUID->"c94cf89a-82bb-4a88-8931-f54da7f37651"],
Cell[76340, 1808, 588, 13, 92, "Input",ExpressionUUID->"01568b4b-ec8a-4f4f-9007-23c9cfd2ecf5"]
}
]
*)

