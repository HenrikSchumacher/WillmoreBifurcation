Notebook[{Cell[BoxData["Exit"], "Input", CellChangeTimes -> 
    {{3.614254675916469*^9, 3.614254676567388*^9}, {3.654607025059938*^9, 
      3.6546070258719997*^9}, {3.654934036034268*^9, 3.654934037484831*^9}}], 
  Cell[BoxData[{RowBox[{"Needs", "[", "\"PackageManager`\"", "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"LoadPackage", "[", "\"Mesh`\"", "]"}], "//", 
         "AbsoluteTiming"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"LoadPackage", "[", "\"MeshDziuk`\"", "]"}], "//", 
       "AbsoluteTiming"}]}], "Input", CellChangeTimes -> 
    {{3.654067974470182*^9, 3.6540679783832617*^9}, 
     {3.6545050053286467*^9, 3.654505009215163*^9}, 
     {3.6545086966436167*^9, 3.6545087133042173*^9}, 
     {3.654513523711206*^9, 3.6545135266551943*^9}, 
     {3.654934033325122*^9, 3.654934034669137*^9}, {3.655489255252161*^9, 
      3.655489255544732*^9}, {3.656684304687447*^9, 3.6566843050069103*^9}}], 
  Cell[BoxData[RowBox[{"Quiet", "[", RowBox[{"Module", "[", 
        RowBox[{RowBox[{"{", RowBox[{"PP", ",", "P", ",", "XX", ",", "X", 
              ",", "h", ",", "heightvectors", ",", "t", ",", "l"}], "}"}], 
          ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{RowBox[{"PP", "=", RowBox[{"Table", "[", RowBox[
                 {RowBox[{"P", "\[LeftDoubleBracket]", RowBox[{"i", ",", 
                      "j"}], "\[RightDoubleBracket]"}], ",", RowBox[
                   {"{", RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
                  RowBox[{"{", RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"XX", "=", RowBox[{"Table", "[", RowBox[
                 {RowBox[{"X", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], ",", RowBox[{"{", RowBox[
                     {"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", RowBox[{"h", "=", RowBox[{"{", 
                "\[IndentingNewLine]", RowBox[{RowBox[{"(", RowBox[
                     {RowBox[{"PP", "\[LeftDoubleBracket]", "1", 
                        "\[RightDoubleBracket]"}], "-", " ", RowBox[
                       {RowBox[{"(", RowBox[{"1", "-", "t"}], ")"}], 
                        RowBox[{"PP", "\[LeftDoubleBracket]", "2", 
                          "\[RightDoubleBracket]"}]}], "-", RowBox[{"t", " ", 
                        RowBox[{"PP", "\[LeftDoubleBracket]", "3", 
                          "\[RightDoubleBracket]"}]}]}], ")"}], ",", 
                  "\[IndentingNewLine]", RowBox[{"(", RowBox[{RowBox[
                       {"PP", "\[LeftDoubleBracket]", "2", 
                        "\[RightDoubleBracket]"}], "-", " ", RowBox[
                       {RowBox[{"(", RowBox[{"1", "-", "t"}], ")"}], 
                        RowBox[{"PP", "\[LeftDoubleBracket]", "3", 
                          "\[RightDoubleBracket]"}]}], "-", RowBox[{"t", " ", 
                        RowBox[{"PP", "\[LeftDoubleBracket]", "1", 
                          "\[RightDoubleBracket]"}]}]}], ")"}], ",", 
                  "\[IndentingNewLine]", RowBox[{"(", RowBox[{RowBox[
                       {"PP", "\[LeftDoubleBracket]", "3", 
                        "\[RightDoubleBracket]"}], "-", " ", RowBox[
                       {RowBox[{"(", RowBox[{"1", "-", "t"}], ")"}], 
                        RowBox[{"PP", "\[LeftDoubleBracket]", "1", 
                          "\[RightDoubleBracket]"}]}], "-", RowBox[{"t", " ", 
                        RowBox[{"PP", "\[LeftDoubleBracket]", "2", 
                          "\[RightDoubleBracket]"}]}]}], ")"}]}], "}"}]}], 
            ";", "\[IndentingNewLine]", RowBox[{"l", "=", RowBox[{"{", 
                RowBox[{RowBox[{"(", RowBox[{RowBox[{"PP", 
                        "\[LeftDoubleBracket]", "3", 
                        "\[RightDoubleBracket]"}], "-", RowBox[{"PP", 
                        "\[LeftDoubleBracket]", "2", 
                        "\[RightDoubleBracket]"}]}], ")"}], ",", 
                  RowBox[{"(", RowBox[{RowBox[{"PP", "\[LeftDoubleBracket]", 
                        "1", "\[RightDoubleBracket]"}], "-", RowBox[{"PP", 
                        "\[LeftDoubleBracket]", "3", 
                        "\[RightDoubleBracket]"}]}], ")"}], ",", 
                  RowBox[{"(", RowBox[{RowBox[{"PP", "\[LeftDoubleBracket]", 
                        "2", "\[RightDoubleBracket]"}], "-", RowBox[{"PP", 
                        "\[LeftDoubleBracket]", "1", 
                        "\[RightDoubleBracket]"}]}], ")"}]}], "}"}]}], ";", 
            "\[IndentingNewLine]", RowBox[{"heightvectors", "=", 
              RowBox[{"Table", "[", RowBox[{RowBox[{"Together", "[", 
                    RowBox[{RowBox[{"h", "\[LeftDoubleBracket]", "i", 
                        "\[RightDoubleBracket]"}], "/.", RowBox[
                       {RowBox[{"Solve", "[", RowBox[{RowBox[{RowBox[
                          {RowBox[{"h", "\[LeftDoubleBracket]", "i", 
                          "\[RightDoubleBracket]"}], ".", RowBox[{"l", 
                          "\[LeftDoubleBracket]", "i", 
                          "\[RightDoubleBracket]"}]}], "\[Equal]", "0"}], 
                          ",", "t"}], "]"}], "\[LeftDoubleBracket]", "1", 
                        "\[RightDoubleBracket]"}]}], "]"}], ",", 
                  RowBox[{"{", RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"CompileJet", "[", RowBox[{"\"FaceHeightVectors\"", ",", 
                RowBox[{"{", RowBox[{"{", RowBox[{"P", ",", "_Real", ",", 
                      "2"}], "}"}], "}"}], ",", "heightvectors", ",", 
                RowBox[{"Flatten", "[", "PP", "]"}], ",", RowBox[
                 {"\"Derivatives\"", "\[Rule]", "0"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], "]"}]], "Input", 
   CellChangeTimes -> {{3.654505642149269*^9, 3.654505659412469*^9}, 
     {3.654505732082981*^9, 3.654505744310671*^9}, {3.6545064535258207*^9, 
      3.654506464781159*^9}, {3.654506516668386*^9, 3.654506588349763*^9}, 
     {3.6545066348960133*^9, 3.65450668962365*^9}, {3.654507053317572*^9, 
      3.6545070536962852*^9}, {3.6545071599158707*^9, 3.654507173946122*^9}, 
     {3.6545083943626947*^9, 3.6545083945445013*^9}, 
     {3.654515284604208*^9, 3.654515284794982*^9}}], 
  Cell[BoxData[RowBox[{"FaceHeightVectors", "=", 
      RowBox[{"PackageFunction", "[", RowBox[{"M_", ",", 
          "\[IndentingNewLine]", RowBox[{"getFaceHeightVectors", "[", 
            RowBox[{"TriangleData", "[", "M", "]"}], "]"}], ",", 
          "\[IndentingNewLine]", RowBox[{"\"InputType\"", "\[Rule]", 
            "mesh"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"Caching\"", "\[Rule]", "True"}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.654507185341145*^9, 3.65450720160667*^9}}], 
  Cell[BoxData[RowBox[{"FaceHeights", "=", RowBox[{"PackageFunction", "[", 
        RowBox[{"M_", ",", "\[IndentingNewLine]", 
          RowBox[{"cNorm3", "[", "FaceHeightVectors", "]"}], ",", 
          "\[IndentingNewLine]", RowBox[{"\"InputType\"", "\[Rule]", 
            "mesh"}]}], "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.656684915135008*^9, 3.656684925845027*^9}}], 
  Cell[BoxData[RowBox[{"FaceInvHeightVectors", "=", 
      RowBox[{"PackageFunction", "[", RowBox[{"M_", ",", 
          "\[IndentingNewLine]", RowBox[{RowBox[{"FaceHeightVectors", "[", 
              "M", "]"}], "/", RowBox[{"Total", "[", RowBox[{RowBox[
                 {RowBox[{"FaceHeightVectors", "[", "M", "]"}], "^", "2"}], 
                ",", RowBox[{"{", "3", "}"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", RowBox[{"\"InputType\"", "\[Rule]", 
            "mesh"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"Caching\"", "\[Rule]", "True"}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.6566849661699457*^9, 3.656684993369405*^9}}], 
  Cell[BoxData[RowBox[{"M", "\[LeftArrow]", 
      RowBox[{"DiskMesh", "[", "4", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.656681861470544*^9, 3.656681866461224*^9}, 
     3.656682007972987*^9}], 
  Cell[BoxData[RowBox[{RowBox[{"v", "=", RowBox[{"RandomReal", "[", 
          RowBox[{RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "}"}], 
            ",", RowBox[{"numpts", "[", "M", "]"}]}], "]"}]}], ";"}]], 
   "Input", CellChangeTimes -> {{3.65668189180184*^9, 3.6566819052229643*^9}, 
     3.6566820124438677*^9}], 
  Cell[BoxData[RowBox[{"HeightFunctionPlot", "=", 
      RowBox[{"PackageFunction", "[", 
        RowBox[{RowBox[{"{", RowBox[{"M_", ",", "v_"}], "}"}], ",", 
          "\[IndentingNewLine]", RowBox[{"Module", "[", 
            RowBox[{RowBox[{"{", "P", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{RowBox[{"P", "\[LeftArrow]", RowBox[{"Displace", "[", 
                    RowBox[{"M", ",", RowBox[{"Times", "[", RowBox[{"v", ",", 
                          RowBox[{"Partition", "[", RowBox[{RowBox[
                          {"VertexNormals", "[", "M", "]"}], ",", RowBox[
                          {"EmbeddingDimension", "[", "M", "]"}]}], "]"}]}], 
                        "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"MeshPlot3D", "[", "P", "]"}]}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"InputType\"", "\[Rule]", "mesh"}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.6566819100021057*^9, 3.656681972811882*^9}, 
     {3.656682028382284*^9, 3.656682051410891*^9}, 3.656685168099606*^9}], 
  Cell[BoxData[RowBox[{"FaceDifferentials", "=", 
      RowBox[{"PackageFunction", "[", RowBox[{"M_", ",", 
          "\[IndentingNewLine]", RowBox[{"LetL", "[", 
            RowBox[{RowBox[{"{", "\[IndentingNewLine]", RowBox[
                 {RowBox[{"faces", "=", RowBox[{"getf", "[", "M", "]"}]}], 
                  ",", "\[IndentingNewLine]", RowBox[{"p", "=", RowBox[
                     {"getp", "[", RowBox[{"M", ",", RowBox[{"faces", 
                          "\[LeftDoubleBracket]", RowBox[{"All", ",", "1"}], 
                          "\[RightDoubleBracket]"}]}], "]"}]}]}], 
                "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Transpose", "[", RowBox[{RowBox[{"{", 
                    "\[IndentingNewLine]", RowBox[{RowBox[{RowBox[{"getp", 
                          "[", RowBox[{"M", ",", RowBox[{"faces", 
                          "\[LeftDoubleBracket]", RowBox[{"All", ",", "2"}], 
                          "\[RightDoubleBracket]"}]}], "]"}], "-", "p"}], 
                      ",", RowBox[{RowBox[{"getp", "[", RowBox[{"M", ",", 
                          RowBox[{"faces", "\[LeftDoubleBracket]", RowBox[
                          {"All", ",", "3"}], "\[RightDoubleBracket]"}]}], 
                          "]"}], "-", "p"}]}], "\[IndentingNewLine]", "}"}], 
                  ",", RowBox[{"{", RowBox[{"3", ",", "1", ",", "2"}], 
                    "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", RowBox[{"\"InputType\"", "\[Rule]", 
            "mesh"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"Caching\"", "\[Rule]", "True"}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.656682249603939*^9, 3.656682250454*^9}, 
     {3.6566823033208647*^9, 3.656682369150309*^9}, 
     {3.65668244834516*^9, 3.6566824631762857*^9}}], 
  Cell[BoxData[RowBox[{"FunctionFaceDifferentials", "=", 
      RowBox[{"PackageFunction", "[", 
        RowBox[{RowBox[{"{", RowBox[{"M_", ",", "v_"}], "}"}], ",", 
          "\[IndentingNewLine]", RowBox[{"LetL", "[", 
            RowBox[{RowBox[{"{", "\[IndentingNewLine]", RowBox[
                 {RowBox[{"faces", "=", RowBox[{"getf", "[", "M", "]"}]}], 
                  ",", "\[IndentingNewLine]", RowBox[{"v1", "=", RowBox[
                     {"Part", "[", RowBox[{"v", ",", RowBox[{"faces", 
                          "\[LeftDoubleBracket]", RowBox[{"All", ",", "1"}], 
                          "\[RightDoubleBracket]"}]}], "]"}]}]}], 
                "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"ThreadDotMatVec", "[", "\[IndentingNewLine]", 
                RowBox[{RowBox[{"FaceDifferentials", "[", "M", "]"}], ",", 
                  "\[IndentingNewLine]", RowBox[{"Transpose", "[", 
                    RowBox[{"{", RowBox[{RowBox[{RowBox[{"Part", "[", RowBox[
                          {"v", ",", RowBox[{"faces", "\[LeftDoubleBracket]", 
                          RowBox[{"All", ",", "2"}], 
                          "\[RightDoubleBracket]"}]}], "]"}], "-", "v1"}], 
                        ",", RowBox[{RowBox[{"Part", "[", RowBox[{"v", ",", 
                          RowBox[{"faces", "\[LeftDoubleBracket]", RowBox[
                          {"All", ",", "3"}], "\[RightDoubleBracket]"}]}], 
                          "]"}], "-", "v1"}]}], "}"}], "]"}]}], 
                "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], 
          ",", "\[IndentingNewLine]", RowBox[{"\"InputType\"", "\[Rule]", 
            "mesh"}]}], "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.6566825905549107*^9, 3.656682628674954*^9}, 
     {3.656682669829384*^9, 3.656682672640562*^9}, {3.656685066563675*^9, 
      3.656685067722859*^9}}], 
  Cell[BoxData[RowBox[{"FunctionFaceGradients", "=", 
      RowBox[{"PackageFunction", "[", 
        RowBox[{RowBox[{"{", RowBox[{"M_", ",", "v_"}], "}"}], ",", 
          "\[IndentingNewLine]", RowBox[{"ThreadDotMatVec", "[", 
            "\[IndentingNewLine]", RowBox[{RowBox[{"Transpose", "[", 
                RowBox[{RowBox[{"FaceInvHeightVectors", "[", "M", "]"}], ",", 
                  RowBox[{"{", RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], 
                "]"}], ",", "\[IndentingNewLine]", RowBox[{"Partition", "[", 
                RowBox[{RowBox[{"Part", "[", RowBox[{"v", ",", RowBox[
                       {"Flatten", "[", RowBox[{"getf", "[", "M", "]"}], 
                        "]"}]}], "]"}], ",", "3"}], "]"}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"\"InputType\"", "\[Rule]", "mesh"}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.6566850899531393*^9, 3.656685095779566*^9}}], 
  Cell[BoxData[RowBox[{"TotalVariation", "=", 
      RowBox[{"PackageFunction", "[", 
        RowBox[{RowBox[{"{", RowBox[{"M_", ",", "v_"}], "}"}], ",", 
          "\[IndentingNewLine]", RowBox[{"Dot", "[", "\[IndentingNewLine]", 
            RowBox[{RowBox[{"Areas", "[", "M", "]"}], ",", 
              "\[IndentingNewLine]", RowBox[{"cNorm3", "[", RowBox[
                 {"FunctionFaceGradients", "[", RowBox[{"M", ",", "v"}], 
                  "]"}], "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", RowBox[{"\"InputType\"", "\[Rule]", 
            "mesh"}]}], "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.65668210421012*^9, 3.656682129593492*^9}, 
     {3.656682703778768*^9, 3.65668271060856*^9}, 3.656685178534897*^9}], 
  Cell[BoxData[
    {RowBox[{RowBox[{"Quiet", "[", RowBox[{"Module", "[", 
           RowBox[{RowBox[{"{", RowBox[{"VV", ",", "V", ",", "\[Epsilon]", 
                 ",", "code"}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{RowBox[{"VV", "=", RowBox[{"Table", "[", RowBox[
                    {RowBox[{"V", "[", RowBox[{"[", "i", "]"}], "]"}], ",", 
                     RowBox[{"{", RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], 
                   "]"}]}], ";", "\[IndentingNewLine]", RowBox[{"code", "=", 
                 RowBox[{"Sqrt", "[", RowBox[{"\[Epsilon]", "+", RowBox[
                      {"VV", ".", "VV"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", RowBox[
                {"CompileJet", "[", "\[IndentingNewLine]", RowBox[
                  {"\"RegularizedTotalVariation\"", ",", 
                   "\[IndentingNewLine]", RowBox[{"{", RowBox[{RowBox[
                        {"{", RowBox[{"V", ",", "_Real", ",", "1"}], "}"}], 
                       ",", RowBox[{"{", RowBox[{"\[Epsilon]", ",", 
                          "_Real"}], "}"}]}], "}"}], ",", 
                   "\[IndentingNewLine]", "code", ",", "\[IndentingNewLine]", 
                   "VV", ",", "\[IndentingNewLine]", RowBox[
                    {"\"Derivatives\"", "\[Rule]", "2"}]}], 
                 "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "]"}], "]"}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{"RegularizedTotalVariation", "=", 
       RowBox[{"PackageFunction", "[", RowBox[
          {RowBox[{"{", RowBox[{"M_", ",", "v_", ",", "\[Epsilon]_"}], "}"}], 
           ",", "\[IndentingNewLine]", RowBox[{"Dot", "[", 
             "\[IndentingNewLine]", RowBox[{RowBox[{"Areas", "[", "M", "]"}], 
               ",", "\[IndentingNewLine]", RowBox[{"Sqrt", "[", 
                 RowBox[{"\[Epsilon]", "+", RowBox[{"Total", "[", RowBox[
                      {RowBox[{RowBox[{"FunctionFaceGradients", "[", RowBox[
                          {"M", ",", "v"}], "]"}], "^", "2"}], ",", RowBox[
                        {"{", "2", "}"}]}], "]"}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"\"InputType\"", "\[Rule]", "mesh"}]}], 
         "\[IndentingNewLine]", "]"}]}]}], "Input", 
   CellChangeTimes -> {{3.656682818885397*^9, 3.65668283005309*^9}, 
     {3.656685182275964*^9, 3.656685202256302*^9}}], 
  Cell[BoxData[RowBox[{"MySparseArray", "[", "\[IndentingNewLine]", 
      RowBox[{RowBox[{RowBox[{"Transpose", "[", RowBox[
             {"{", RowBox[{"ran", ",", RowBox[{"faces", 
                  "\[LeftDoubleBracket]", RowBox[{"All", ",", "1"}], 
                  "\[RightDoubleBracket]"}]}], "}"}], "]"}], "\[Rule]", 
          RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", RowBox[{RowBox[{"numfaces", "[", "M", "]"}], ",", 
            RowBox[{"numpts", "[", "M", "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", "Total"}], "\[IndentingNewLine]", "]"}]], 
   "Input", CellChangeTimes -> {{3.656683650550899*^9, 
      3.6566836586332407*^9}, {3.656683704069433*^9, 3.656683750328636*^9}, 
     {3.656683922520501*^9, 3.656684011869898*^9}}], 
  Cell[BoxData[""], "Input", CellChangeTimes -> 
    {{3.656684679943186*^9, 3.656684686805813*^9}}], 
  Cell[BoxData[RowBox[
     {RowBox[{"v", "=", RowBox[{RowBox[{"getp", "[", "M", "]"}], ".", 
          RowBox[{"{", RowBox[{"1", ",", "0", ",", "0"}], "}"}]}]}], ";"}]], 
   "Input", CellChangeTimes -> {{3.656684673935193*^9, 
      3.656684688957416*^9}}], Cell[BoxData["Face"], "Input", 
   CellChangeTimes -> {{3.656684775482226*^9, 3.656684783879395*^9}}], 
  Cell[BoxData[RowBox[
     {RowBox[{RowBox[{"V", "=", RowBox[{"ThreadDotMatVec", "[", 
            "\[IndentingNewLine]", RowBox[{RowBox[{"Transpose", "[", 
                RowBox[{RowBox[{"FaceInvHeightVectors", "[", "M", "]"}], ",", 
                  RowBox[{"{", RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], 
                "]"}], ",", "\[IndentingNewLine]", RowBox[{"Partition", "[", 
                RowBox[{RowBox[{"Part", "[", RowBox[{"v", ",", RowBox[
                       {"Flatten", "[", RowBox[{"getf", "[", "M", "]"}], 
                        "]"}]}], "]"}], ",", "3"}], "]"}]}], 
            "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], 
   "Input", CellChangeTimes -> {{3.656684228989607*^9, 3.656684235210003*^9}, 
     {3.6566843164114237*^9, 3.656684329650536*^9}, 
     {3.656684373965703*^9, 3.656684405425034*^9}, {3.656684717965015*^9, 
      3.656684724437223*^9}, {3.656684772176252*^9, 3.656684773897573*^9}, 
     3.656685012258675*^9}], 
  Cell[BoxData[RowBox[{"M", "\[LeftArrow]", 
      RowBox[{"DiskMesh", "[", "6", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.656685354787043*^9, 3.656685368238007*^9}, 
     3.656685416064554*^9, 3.656685709187223*^9}], 
  Cell[BoxData[RowBox[
     {RowBox[{"v", "=", RowBox[{"Map", "[", RowBox[
           {RowBox[{"x", "\[Function]", RowBox[{RowBox[{"Cos", "[", 
                  RowBox[{"1", " ", RowBox[{"x", "[", RowBox[{"[", "1", 
                        "]"}], "]"}]}], "]"}], "+", RowBox[{"Sin", "[", 
                  RowBox[{"2", RowBox[{"x", "[", RowBox[{"[", "2", "]"}], 
                      "]"}]}], "]"}]}]}], ",", RowBox[{"getp", "[", "M", 
              "]"}]}], "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.656685222539082*^9, 3.656685249089929*^9}, 
     {3.6566853970877447*^9, 3.6566854038579082*^9}}], 
  Cell[BoxData[RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{RowBox[{"MeshPlot3D", "[", "M", "]"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"HeightFunctionPlot", "[", RowBox[{"M", ",", "v"}], "]"}], 
        ",", "\[IndentingNewLine]", RowBox[{"FaceFieldPlot3D", "[", 
          RowBox[{"M", ",", "\[IndentingNewLine]", 
            RowBox[{"FunctionFaceGradients", "[", RowBox[{"M", ",", "v"}], 
              "]"}], ",", "\[IndentingNewLine]", RowBox[{"PlotStyle", 
              "\[Rule]", RowBox[{"{", RowBox[{"Yellow", ",", RowBox[
                   {"Arrowheads", "[", "0", "]"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], 
   "Input", CellChangeTimes -> {{3.656684409009405*^9, 3.656684436386359*^9}, 
     {3.656684564366377*^9, 3.656684593395274*^9}, {3.6566846402744617*^9, 
      3.656684646714205*^9}, {3.656684703592445*^9, 3.65668471226903*^9}, 
     {3.656685018899108*^9, 3.656685019258946*^9}, {3.6566851076361027*^9, 
      3.656685157319491*^9}, {3.656685257090396*^9, 3.656685268165024*^9}, 
     {3.6566852992380667*^9, 3.65668532861395*^9}, 3.656685430659238*^9}], 
  Cell[BoxData[RowBox[{RowBox[{"Partition", "[", 
        RowBox[{RowBox[{"Part", "[", RowBox[{"v", ",", RowBox[{"Flatten", 
                "[", RowBox[{"getf", "[", "M", "]"}], "]"}]}], "]"}], ",", 
          "3"}], "]"}], "//", "Dimensions"}]], "Input", 
   CellChangeTimes -> {{3.656684336593135*^9, 3.656684351041498*^9}}], 
  Cell[BoxData[RowBox[{"ClearCache", "[", "M", "]"}]], "Input", 
   CellChangeTimes -> {{3.656685674137241*^9, 3.6566856761936693*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{RowBox[{"TriangleData", "[", "M", "]"}], 
        ";"}], "//", "AbsoluteTiming"}]], "Input", 
   CellChangeTimes -> {{3.656685649765951*^9, 3.656685671307633*^9}, 
     {3.656685732930492*^9, 3.656685735321871*^9}}], 
  Cell[BoxData[RowBox[
     {RowBox[{RowBox[{RowBox[{RowBox[{"PointFaceCornerAdjacencyMatrix", "[", 
              "M", "]"}], "\[Transpose]"}], ".", RowBox[{"getp", "[", "M", 
            "]"}]}], ";"}], "//", "AbsoluteTiming"}]], "Input", 
   CellChangeTimes -> {{3.656685632642645*^9, 3.656685688952832*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"PointFaceCornerAdjacencyMatrix", "[", "M", 
        "]"}], "\[Transpose]"}]], "Input", CellChangeTimes -> 
    {{3.656682624539123*^9, 3.656682702189344*^9}, {3.656685503931178*^9, 
      3.6566855391553907*^9}, {3.656685573102561*^9, 3.656685573538278*^9}}], 
  Cell[BoxData[RowBox[{"ThreadDotMatVec", "[", "\[IndentingNewLine]", 
      RowBox[{RowBox[{"Transpose", "[", RowBox[
           {RowBox[{"FaceInvHeightVectors", "[", "M", "]"}], ",", 
            RowBox[{"{", RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "]"}], 
        ",", "\[IndentingNewLine]", RowBox[{"Partition", "[", 
          RowBox[{RowBox[{"Part", "[", RowBox[{"v", ",", RowBox[{"Flatten", 
                  "[", RowBox[{"getf", "[", "M", "]"}], "]"}]}], "]"}], ",", 
            "3"}], "]"}]}], "\[IndentingNewLine]", "]"}]], "Input"], 
  Cell[BoxData[RowBox[{RowBox[{"Flatten", "[", 
        RowBox[{"FaceInvHeightVectors", "[", "M", "]"}], "]"}], "//", 
      "Dimensions"}]], "Input", CellChangeTimes -> 
    {{3.6566855809496593*^9, 3.656685592755632*^9}}], 
  Cell[BoxData["M"], "Input", CellChangeTimes -> {3.656685568297261*^9}], 
  Cell[BoxData[RowBox[{"ClearAllCache", "[", "M", "]"}]], "Input", 
   CellChangeTimes -> {{3.656682465408745*^9, 3.656682467834669*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"FaceDifferentials", "[", "M", "]"}], ";"}]], 
   "Input", CellChangeTimes -> {{3.6566823750554447*^9, 
      3.65668239777547*^9}}], 
  Cell[BoxData[
    {RowBox[{RowBox[{"faces", "=", RowBox[{"getf", "[", "M", "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"v1", "=", RowBox[{"Part", "[", 
           RowBox[{"v", ",", RowBox[{"faces", "\[LeftDoubleBracket]", RowBox[
                {"All", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
       ";"}]}], "Input", CellChangeTimes -> 
    {{3.6566824725902147*^9, 3.656682481039647*^9}}], 
  Cell[BoxData["\[IndentingNewLine]"], "Input", 
   CellChangeTimes -> {{3.65668252333552*^9, 3.656682536420086*^9}, 
     3.656682604352998*^9}], 
  Cell[BoxData[RowBox[{"PlotHeightFunction", "[", 
      RowBox[{"M", ",", RowBox[{"0.1", "v"}]}], "]"}]], "Input", 
   CellChangeTimes -> {{3.656682053227025*^9, 3.6566820657406683*^9}}]}, 
 WindowSize -> {1118, 852}, WindowMargins -> 
  {{Automatic, 0}, {Automatic, 0}}, ShowSelection -> True, 
 FrontEndVersion -> 
  "10.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (December 4, 2014)", 
 StyleDefinitions -> "Default.nb"]
