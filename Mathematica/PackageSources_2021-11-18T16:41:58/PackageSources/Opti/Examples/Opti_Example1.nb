Notebook[{Cell[BoxData["Exit"], "Input", CellChangeTimes -> 
    {{3.633928791825832*^9, 3.63392879606758*^9}}], 
  Cell[BoxData[{RowBox[{"Needs", "[", "\"PackageManager`\"", "]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"BuildPackage", "[", "\"Mesh`\"", 
         "]"}], "//", "AbsoluteTiming"}], "\[IndentingNewLine]"}], "Input", 
   CellChangeTimes -> {{3.6405051711411953*^9, 3.640505171801705*^9}}], 
  Cell[BoxData[RowBox[{"Head", "[", "\"If M is a point object then \
Displace[M,V] returns point object with coefficients set to \
Part[M,1,\\\"Coefficients\\\"]+=V.\"", "]"}]], "Input", 
   CellChangeTimes -> {{3.640505835628707*^9, 3.640505836729329*^9}, 
     {3.640505991632901*^9, 3.640506004602437*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"LoadPackage", "[", "\"Mesh`\"", "]"}], "//", 
      "AbsoluteTiming"}]], "Input"], 
  Cell[BoxData[{RowBox[{RowBox[{"Needs", "[", "\"PackageManager`\"", "]"}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"LoadPackage", "[", "\"Opti`\"", "]"}], "//", 
       "AbsoluteTiming"}], "\[IndentingNewLine]"}], "Input", 
   CellChangeTimes -> {{3.635011961712401*^9, 3.635011962012278*^9}, 
     {3.639459039858037*^9, 3.639459040445225*^9}, {3.63946137100364*^9, 
      3.639461375637906*^9}, {3.639472078089858*^9, 3.639472089742807*^9}, 
     {3.639472156433215*^9, 3.6394721598690166*^9}, 
     {3.639662493573641*^9, 3.639662494298545*^9}, 3.639662803035043*^9, 
     {3.639662882022051*^9, 3.6396628827451897*^9}, 
     {3.639663863119713*^9, 3.639663863258367*^9}, 3.6398259304236803*^9, 
     3.639826308196535*^9, 3.640505951735895*^9}], 
  Cell[BoxData[RowBox[{RowBox[{"P", "\[LeftArrow]", 
        RowBox[{"Init", "[", RowBox[{"point", ",", " ", 
            RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";"}]], 
   "Input", CellChangeTimes -> {{3.640505557807745*^9, 3.640505570781804*^9}, 
     {3.6405056160325823*^9, 3.640505641793063*^9}, 3.640505726521521*^9}], 
  Cell[BoxData["P"], "Input", CellChangeTimes -> {3.640505680045971*^9}], 
  Cell[BoxData[RowBox[{"Head", "[", RowBox[{"\"L\"", "\[Rule]", "3."}], 
      "]"}]], "Input", CellChangeTimes -> 
    {{3.6405056693890343*^9, 3.640505670367676*^9}}], 
  Cell[BoxData["P"], "Input", CellChangeTimes -> {3.640505620322136*^9}], 
  Cell[BoxData[RowBox[{"M", "\[LeftArrow]", 
      RowBox[{"FigureEightMesh", "[", "3", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.63966297097057*^9, 3.639662976338161*^9}}], 
  Cell[BoxData[RowBox[{"Willmore", "[", "M", "]"}]], "Input", 
   CellChangeTimes -> {{3.639662967500278*^9, 3.6396629794779873*^9}}], 
  Cell[BoxData[{RowBox[{RowBox[{"DInnerWillmore", "=", 
         RowBox[{"PackageFunction", "[", RowBox[{"M_", ",", 
             "\[IndentingNewLine]", RowBox[{RowBox[{"DWillmoreNew", "[", "M", 
                 "]"}], "\[LeftDoubleBracket]", RowBox[{"1", ";;", 
                 RowBox[{"3", " ", RowBox[{"numintpts", "[", "M", "]"}]}]}], 
               "\[RightDoubleBracket]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"InputType\"", "\[Rule]", " ", "mesh"}]}], "]"}]}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Willmore", "/:", RowBox[
          {RowBox[{"Derivative", "[", "1", "]"}], "[", "Willmore", "]"}], 
         ":=", "DInnerWillmore"}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"InnerDisplace", "=", RowBox[{"PackageFunction", "[", 
           RowBox[{RowBox[{"{", RowBox[{"M_", ",", "V_"}], "}"}], ",", 
             "\[IndentingNewLine]", RowBox[{"Displace", "[", RowBox[
                {"M", ",", RowBox[{"Join", "[", RowBox[{RowBox[{"Partition", 
                       "[", RowBox[{"V", ",", "3"}], "]"}], ",", RowBox[
                      {"ConstantArray", "[", RowBox[{"0.", ",", RowBox[
                          {"{", RowBox[{RowBox[{RowBox[{"numpts", "[", "M", 
                          "]"}], "-", RowBox[{"numintpts", "[", "M", "]"}]}], 
                          ",", "3"}], "}"}]}], "]"}]}], "]"}], ",", "All"}], 
               "]"}], ",", "\[IndentingNewLine]", RowBox[{"\"InputType\"", 
               "\[Rule]", " ", "mesh"}]}], "]"}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{"CheapHessian", "=", 
       RowBox[{"PackageFunction", "[", RowBox[
          {RowBox[{"{", RowBox[{"M_", ",", "F_"}], "}"}], ",", 
           "\[IndentingNewLine]", RowBox[{"LetL", "[", 
             RowBox[{RowBox[{"{", "\[IndentingNewLine]", RowBox[
                  {RowBox[{"A", "=", RowBox[{RowBox[{"WeakBiLaplace", "[", 
                         "M", "]"}], "\[LeftDoubleBracket]", RowBox[
                        {RowBox[{"1", ";;", RowBox[{"numintpts", "[", "M", 
                          "]"}]}], ",", RowBox[{"1", ";;", RowBox[
                          {"numintpts", "[", "M", "]"}]}]}], 
                       "\[RightDoubleBracket]"}]}], ",", 
                   "\[IndentingNewLine]", RowBox[{"rules", "=", RowBox[
                      {"Most", "@", RowBox[{"ArrayRules", "[", "A", 
                         "]"}]}]}], ",", "\[IndentingNewLine]", RowBox[
                    {"vals", "=", RowBox[{"rules", "\[LeftDoubleBracket]", 
                       RowBox[{"All", ",", "2"}], 
                       "\[RightDoubleBracket]"}]}], ",", 
                   "\[IndentingNewLine]", RowBox[{"rules1", "=", RowBox[
                      {RowBox[{"3", RowBox[{"rules", "\[LeftDoubleBracket]", 
                          RowBox[{"All", ",", "1"}], 
                          "\[RightDoubleBracket]"}]}], "-", "2"}]}], ",", 
                   "\[IndentingNewLine]", RowBox[{"rules2", "=", RowBox[
                      {RowBox[{"3", RowBox[{"rules", "\[LeftDoubleBracket]", 
                          RowBox[{"All", ",", "1"}], 
                          "\[RightDoubleBracket]"}]}], "-", "1"}]}], ",", 
                   "\[IndentingNewLine]", RowBox[{"rules3", "=", RowBox[
                      {"3", RowBox[{"rules", "\[LeftDoubleBracket]", RowBox[
                          {"All", ",", "1"}], 
                         "\[RightDoubleBracket]"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{"SparseArray", "[", RowBox[{RowBox[{"Join", "[", 
                     RowBox[{"rules1", ",", "rules2", ",", "rules3"}], "]"}], 
                   "\[Rule]", RowBox[{"Join", "[", RowBox[{"vals", ",", 
                       "vals", ",", "vals"}], "]"}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"\"InputType\"", "\[Rule]", "mesh"}], ",", 
           "\[IndentingNewLine]", RowBox[{"\"Caching\"", "\[Rule]", 
             "False"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]"}], "Input", CellChangeTimes -> 
    {{3.639663012563178*^9, 3.639663173245783*^9}, {3.639663288759707*^9, 
      3.639663301975307*^9}, {3.639663585342239*^9, 3.639663597982638*^9}, 
     {3.639663786773561*^9, 3.639663788115144*^9}, {3.639663997072464*^9, 
      3.639664011271679*^9}, {3.639664061182995*^9, 3.6396640651300907*^9}, 
     3.639664139549855*^9}], 
  Cell[BoxData[{RowBox[{RowBox[{"DInnerArea", "=", 
         RowBox[{"PackageFunction", "[", RowBox[{"M_", ",", 
             "\[IndentingNewLine]", RowBox[{RowBox[{"DArea", "[", "M", "]"}], 
               "\[LeftDoubleBracket]", RowBox[{"1", ";;", RowBox[{"3", " ", 
                   RowBox[{"numintpts", "[", "M", "]"}]}]}], 
               "\[RightDoubleBracket]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"InputType\"", "\[Rule]", " ", "mesh"}]}], "]"}]}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Unprotect", "[", "Area", "]"}], ";"}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Area", "/:", RowBox[{RowBox[{"Derivative", "[", "1", 
             "]"}], "[", "Area", "]"}], ":=", "DInnerArea"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{"CheapHessian", "=", RowBox[{"PackageFunction", "[", 
         RowBox[{RowBox[{"{", RowBox[{"M_", ",", "F_"}], "}"}], ",", 
           "\[IndentingNewLine]", RowBox[{"LetL", "[", 
             RowBox[{RowBox[{"{", "\[IndentingNewLine]", RowBox[
                  {RowBox[{"A", "=", RowBox[{"-", RowBox[{RowBox[
                          {"WeakLaplace", "[", "M", "]"}], 
                         "\[LeftDoubleBracket]", RowBox[{RowBox[{"1", ";;", 
                          RowBox[{"numintpts", "[", "M", "]"}]}], ",", 
                          RowBox[{"1", ";;", RowBox[{"numintpts", "[", "M", 
                          "]"}]}]}], "\[RightDoubleBracket]"}]}]}], ",", 
                   "\[IndentingNewLine]", RowBox[{"rules", "=", RowBox[
                      {"Most", "@", RowBox[{"ArrayRules", "[", "A", 
                         "]"}]}]}], ",", "\[IndentingNewLine]", RowBox[
                    {"vals", "=", RowBox[{"rules", "\[LeftDoubleBracket]", 
                       RowBox[{"All", ",", "2"}], 
                       "\[RightDoubleBracket]"}]}], ",", 
                   "\[IndentingNewLine]", RowBox[{"rules1", "=", RowBox[
                      {RowBox[{"3", RowBox[{"rules", "\[LeftDoubleBracket]", 
                          RowBox[{"All", ",", "1"}], 
                          "\[RightDoubleBracket]"}]}], "-", "2"}]}], ",", 
                   "\[IndentingNewLine]", RowBox[{"rules2", "=", RowBox[
                      {RowBox[{"3", RowBox[{"rules", "\[LeftDoubleBracket]", 
                          RowBox[{"All", ",", "1"}], 
                          "\[RightDoubleBracket]"}]}], "-", "1"}]}], ",", 
                   "\[IndentingNewLine]", RowBox[{"rules3", "=", RowBox[
                      {"3", RowBox[{"rules", "\[LeftDoubleBracket]", RowBox[
                          {"All", ",", "1"}], 
                         "\[RightDoubleBracket]"}]}]}]}], 
                 "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{"SparseArray", "[", RowBox[{RowBox[{"Join", "[", 
                     RowBox[{"rules1", ",", "rules2", ",", "rules3"}], "]"}], 
                   "\[Rule]", RowBox[{"Join", "[", RowBox[{"vals", ",", 
                       "vals", ",", "vals"}], "]"}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"\"InputType\"", "\[Rule]", "mesh"}], ",", 
           "\[IndentingNewLine]", RowBox[{"\"Caching\"", "\[Rule]", 
             "False"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]"}], "Input", CellChangeTimes -> 
    {{3.639663012563178*^9, 3.639663173245783*^9}, {3.639663288759707*^9, 
      3.639663301975307*^9}, {3.639663585342239*^9, 3.639663597982638*^9}, 
     {3.639663786773561*^9, 3.639663788115144*^9}, {3.639663997072464*^9, 
      3.639664011271679*^9}, {3.639664061182995*^9, 3.6396640651300907*^9}, 
     3.639664139549855*^9, {3.639664287647382*^9, 3.639664321791544*^9}, 
     3.639664460881666*^9}], 
  Cell[BoxData[RowBox[{RowBox[{"Area", "'"}], "[", "M", "]"}]], "Input", 
   CellChangeTimes -> {{3.639664277486679*^9, 3.639664281252689*^9}}], 
  Cell[BoxData[RowBox[{"WeakBiLaplaceDi", "[", "M", "]"}]], "Input", 
   CellChangeTimes -> {{3.6396639364493093*^9, 3.639663955038089*^9}}], 
  Cell[BoxData[RowBox[{"numintpts", "[", "M", "]"}]], "Input", 
   CellChangeTimes -> {{3.6396639768376217*^9, 3.6396639802291317*^9}}], 
  Cell[BoxData[RowBox[{"WeakLaplace", "[", "M", "]"}]], "Input", 
   CellChangeTimes -> {{3.6396639652354517*^9, 3.63966398970405*^9}}], 
  Cell[BoxData["M"], "Input", CellChangeTimes -> {3.639663958956237*^9}], 
  Cell[BoxData[RowBox[{RowBox[{RowBox[{"Willmore", "'"}], "[", "M", "]"}], 
      "//", "Length"}]], "Input", CellChangeTimes -> 
    {{3.639663636337736*^9, 3.63966363746227*^9}}], 
  Cell[BoxData[""], "Input", CellChangeTimes -> 
    {{3.639663639814562*^9, 3.639663673942767*^9}, 3.639663804884067*^9, 
     {3.639663889664267*^9, 3.639663893198427*^9}, {3.639664003358659*^9, 
      3.6396640202344847*^9}, {3.639664411008697*^9, 3.639664416810508*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"LinearSolve", "[", 
        RowBox[{RowBox[{"CheapHessian", "[", RowBox[{"M", ",", "Area"}], 
            "]"}], ",", RowBox[{RowBox[{"Area", "'"}], "[", "M", "]"}]}], 
        "]"}], ";"}]], "Input", CellChangeTimes -> {3.63966443711681*^9}], 
  Cell[BoxData[RowBox[{"Q", "\[LeftArrow]", 
      RowBox[{"InnerDisplace", "[", RowBox[{"M", ",", 
          RowBox[{"LinearSolve", "[", RowBox[{RowBox[{"CheapHessian", "[", 
                RowBox[{"M", ",", "Area"}], "]"}], ",", RowBox[{
                RowBox[{"Area", "'"}], "[", "M", "]"}]}], "]"}]}], "]"}]}]], 
   "Input", CellChangeTimes -> {{3.639663176752733*^9, 3.639663184699478*^9}, 
     {3.639663901133409*^9, 3.6396639174030437*^9}, 
     {3.639664024083908*^9, 3.639664042864216*^9}, {3.6396641352162867*^9, 
      3.639664136922141*^9}, {3.639664419261858*^9, 3.639664454329206*^9}}], 
  Cell[BoxData[{RowBox[{"Area", "[", "Q", "]"}], "\[IndentingNewLine]", 
     RowBox[{"Area", "[", "M", "]"}]}], "Input", 
   CellChangeTimes -> {{3.639664035081143*^9, 3.639664040375904*^9}, 
     {3.6396644441933603*^9, 3.639664446588269*^9}}], 
  Cell[BoxData[RowBox[{"MeshPlot3D", "[", "Q", "]"}]], "Input", 
   CellChangeTimes -> {{3.639663928503563*^9, 3.6396639314200983*^9}, 
     3.639664029015421*^9}], 
  Cell[BoxData[RowBox[{"Willmore", "[", "Q", "]"}]], "Input", 
   CellChangeTimes -> {{3.639663908746339*^9, 3.639663911299117*^9}}], 
  Cell[BoxData[RowBox[{"Abs", "[", RowBox[{"Max", "[", 
        RowBox[{RowBox[{"Willmore", "'"}], "[", "M", "]"}], "]"}], "]"}]], 
   "Input", CellChangeTimes -> {{3.639663912501244*^9, 3.639663914443454*^9}, 
     {3.639664091593108*^9, 3.639664104111847*^9}}], 
  Cell[BoxData[{RowBox[{RowBox[{"Q", "\[LeftArrow]", 
         RowBox[{"ModelAlgorithm", "[", RowBox[{"M", ",", "Area", ",", 
             "\[IndentingNewLine]", RowBox[{"\"UpdateMethod\"", "\[Rule]", 
               "InnerDisplace"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"MaxIterations\"", "\[Rule]", "100"}], ",", 
             "\[IndentingNewLine]", RowBox[{"\"PrecisionGoal\"", "\[Rule]", 
               RowBox[{"10", "^", RowBox[{"(", RowBox[{"-", "12"}], 
                   ")"}]}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"StepWidth\"", "\[Rule]", RowBox[{"{", RowBox[
                  {"WolfePowell", ",", RowBox[{"\"Interpolation\"", 
                     "\[Rule]", "\"Cubic\""}]}], "}"}]}], ",", 
             "\[IndentingNewLine]", RowBox[{"\"SearchDirection\"", "\[Rule]", 
               RowBox[{"{", "\[IndentingNewLine]", RowBox[{"\"L\bBFGS\"", 
                   ",", "\[IndentingNewLine]", RowBox[{"\"H\"", "\[Rule]", 
                     "CheapHessian"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"\"HTransform\"", "\[Rule]", "LinearSolve"}], ",", 
                   "\[IndentingNewLine]", RowBox[{"\"MaxHistoryLength\"", 
                     "\[Rule]", "100"}]}], "\[IndentingNewLine]", "}"}]}]}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"Q", "\[LeftArrow]", "Q"}], 
       ";"}], "\[IndentingNewLine]", 
     RowBox[{"Q", "[", RowBox[{"\"Cache\"", ",", "\"ModelAlgorithmData\""}], 
       "]"}]}], "Input", CellChangeTimes -> 
    {{3.639663220580781*^9, 3.639663258118251*^9}, {3.639663623362376*^9, 
      3.6396636235487213*^9}, {3.6396638279245453*^9, 3.639663844611734*^9}, 
     {3.639664049889606*^9, 3.639664050896937*^9}, {3.6396641082427893*^9, 
      3.639664115770796*^9}, {3.6396641556276207*^9, 3.639664168099366*^9}, 
     {3.6396641984208183*^9, 3.639664248862172*^9}, 
     {3.639664327223666*^9, 3.639664359673991*^9}, {3.639664478652268*^9, 
      3.6396644881714478*^9}, {3.639664531902255*^9, 
      3.6396645321724033*^9}}], 
  Cell[BoxData[RowBox[{"MeshPlot3D", "[", "M", "]"}]], "Input", 
   CellChangeTimes -> {{3.6396645055552387*^9, 3.63966450961255*^9}, 
     3.6396645435154552*^9}], 
  Cell[BoxData[RowBox[{"Max", "[", RowBox[{"Abs", "[", 
        RowBox[{RowBox[{"Area", "'"}], "[", "Q", "]"}], "]"}], "]"}]], 
   "Input", CellChangeTimes -> {{3.639664375693679*^9, 
      3.639664392777377*^9}}], 
  Cell[BoxData[{RowBox[{"Area", "[", "M", "]"}], "\[IndentingNewLine]", 
     RowBox[{"Area", "[", "Q", "]"}]}], "Input", 
   CellChangeTimes -> {{3.639664398169774*^9, 3.639664403342942*^9}}], 
  Cell[BoxData[{RowBox[{RowBox[{"n", "=", "128"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"p0", "=", RowBox[{"N", "@", 
           RowBox[{"{", RowBox[{"0", ",", "0", ",", "0"}], "}"}]}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"p1", "=", RowBox[{"N", "@", 
           RowBox[{"{", RowBox[{"1", ",", "0", ",", "2"}], "}"}]}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"\[Lambda]", "=", RowBox[{"N", "[", 
           RowBox[{"3", "/", RowBox[{"(", "n", ")"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"mass", "=", "0.2"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"m", "=", RowBox[{"N", "[", 
             RowBox[{"mass", "/", "n"}], "]"}]}], ";"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"pts", "=", RowBox[{"N", "@", 
           RowBox[{"Most", "@", RowBox[{"Rest", "@", RowBox[{"Table", "[", 
                 RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", "-", 
                          "t"}], ")"}], "p0"}], "+", RowBox[{"t", " ", 
                       "p1"}]}], ",", RowBox[{"{", RowBox[{"t", ",", "0", 
                       ",", "1", ",", RowBox[{"1", "/", RowBox[{"(", RowBox[
                          {"n", "+", "1"}], ")"}]}]}], "}"}]}], 
                 "]"}]}]}]}]}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"P0", "\[LeftArrow]", RowBox[{"polygon", "[", 
           RowBox[{"Association", "[", "\[IndentingNewLine]", 
             RowBox[{RowBox[{"\"Points\"", "\[Rule]", "pts"}], ",", 
               "\[IndentingNewLine]", RowBox[{"\"ClosedQ\"", "\[Rule]", 
                 "False"}], ",", "\[IndentingNewLine]", RowBox[{"\"Cache\"", 
                 "\[Rule]", RowBox[{"Association", "[", "]"}]}], ",", 
               "\[IndentingNewLine]", RowBox[{"\"PersistentCache\"", 
                 "\[Rule]", RowBox[{"Association", "[", RowBox[
                    {RowBox[{"\"\[Lambda]\"", "\[Rule]", "\[Lambda]"}], ",", 
                     RowBox[{"\"m\"", "\[Rule]", "m"}]}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"P", "\[LeftArrow]", "P0"}], ";"}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"V", "=", RowBox[{"0.1", RowBox[{"RandomReal", "[", 
             RowBox[{RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], 
                 "}"}], ",", RowBox[{"{", RowBox[{"3", " ", RowBox[
                    {"(", RowBox[{"n", "-", "2"}], ")"}]}], "}"}]}], 
             "]"}]}]}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"t", "=", "0.1"}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"InnerDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Energy", "[", "Q", "]"}], "-", 
         RowBox[{"Energy", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"Energy", "'"}], "[", "P", 
               "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.01"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"InnerDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Energy", "[", "Q", "]"}], "-", 
         RowBox[{"Energy", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"Energy", "'"}], "[", "P", 
               "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.001"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"InnerDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Energy", "[", "Q", "]"}], "-", 
         RowBox[{"Energy", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"Energy", "'"}], "[", "P", 
               "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.0001"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"InnerDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Energy", "[", "Q", "]"}], "-", 
         RowBox[{"Energy", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"Energy", "'"}], "[", "P", 
               "]"}], ".", "V"}]}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"V", "=", RowBox[{"0.1", RowBox[{"RandomReal", "[", 
             RowBox[{RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], 
                 "}"}], ",", RowBox[{"{", RowBox[{"3", " ", RowBox[
                    {"(", RowBox[{"n", "-", "2"}], ")"}]}], "}"}]}], 
             "]"}]}]}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"t", "=", "0.1"}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"InnerDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"StretchEnergy", "[", "Q", "]"}], "-", 
         RowBox[{"StretchEnergy", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"StretchEnergy", "'"}], 
               "[", "P", "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.01"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"InnerDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"StretchEnergy", "[", "Q", "]"}], "-", 
         RowBox[{"StretchEnergy", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"StretchEnergy", "'"}], 
               "[", "P", "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.001"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"InnerDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"StretchEnergy", "[", "Q", "]"}], "-", 
         RowBox[{"StretchEnergy", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"StretchEnergy", "'"}], 
               "[", "P", "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.0001"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"InnerDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"StretchEnergy", "[", "Q", "]"}], 
       "-", RowBox[{"StretchEnergy", "[", "P", "]"}], "-", 
       RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"StretchEnergy", "'"}], "[", 
             "P", "]"}], ".", "V"}]}]}]}], "Input", 
   CellChangeTimes -> {{3.639471755221079*^9, 3.639471755367641*^9}, 
     {3.6394722407173653*^9, 3.6394722521391563*^9}, 
     {3.639472411377203*^9, 3.639472454097068*^9}, {3.639472541371934*^9, 
      3.639472560289009*^9}, {3.639477577582432*^9, 3.6394775883644123*^9}, 
     {3.639481398051943*^9, 3.639481398501019*^9}, 3.639481753381535*^9, 
     {3.639481785094646*^9, 3.639481825694244*^9}, {3.639481859072259*^9, 
      3.63948187599231*^9}, 3.639481916793655*^9, {3.639481969075375*^9, 
      3.639481971129581*^9}, 3.6394821213180017*^9, 3.639482198663672*^9, 
     {3.639484477020678*^9, 3.639484487375739*^9}, 3.639485178070052*^9, 
     {3.6394853943315763*^9, 3.6394853953065643*^9}, 3.639485677068199*^9, 
     3.639485734722989*^9, 3.6394859590802183*^9, 3.639486159813344*^9, 
     {3.639486271663513*^9, 3.63948627359868*^9}, {3.6394865785182743*^9, 
      3.6394866047773027*^9}, {3.639486758147932*^9, 3.63948684749265*^9}, 
     {3.639486958216667*^9, 3.639486996905492*^9}, {3.639487067115347*^9, 
      3.639487082642008*^9}, {3.639487205438216*^9, 3.639487249254985*^9}, 
     {3.639487346417029*^9, 3.6394873640103083*^9}, 3.639488186711657*^9, 
     3.6394908236024733*^9, {3.639491945052841*^9, 3.6394919457958937*^9}, 
     {3.6394920419506903*^9, 3.63949205950401*^9}, {3.639494418716413*^9, 
      3.639494418874226*^9}, {3.639495695790402*^9, 3.639495723553089*^9}, 
     {3.639500813384041*^9, 3.6395008152540283*^9}, 3.6395016889506617*^9, 
     {3.639538490187841*^9, 3.639538517819058*^9}, 3.639540620644903*^9, 
     {3.63954073826488*^9, 3.6395407384390507*^9}, {3.639541073885562*^9, 
      3.639541074486573*^9}, 3.639541312590452*^9, 3.639541344662446*^9, 
     3.639553816512177*^9, 3.639628087179847*^9, {3.63962818607008*^9, 
      3.639628215269186*^9}, {3.639628288505087*^9, 3.6396282887582493*^9}, 
     {3.639631818021967*^9, 3.639631818145536*^9}, 3.639633535029786*^9, 
     {3.639637494257084*^9, 3.639637494680373*^9}, {3.639830034008793*^9, 
      3.6398300350199547*^9}, {3.639830092255616*^9, 3.6398301081551123*^9}, 
     3.6398303831669607*^9}], 
  Cell[BoxData[{RowBox[{RowBox[{"P", "\[LeftArrow]", "P0"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"ModelAlgorithm", "[", 
           RowBox[{"P", ",", "Energy", ",", "\[IndentingNewLine]", 
             RowBox[{"\"UpdateMethod\"", "\[Rule]", "InnerDisplace"}], ",", 
             "\[IndentingNewLine]", RowBox[{"\"MaxIterations\"", "\[Rule]", 
               "100"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"PrecisionGoal\"", "\[Rule]", RowBox[{"10", "^", 
                 RowBox[{"(", RowBox[{"-", "8"}], ")"}]}]}], ",", 
             "\[IndentingNewLine]", RowBox[{"\"StepWidth\"", "\[Rule]", 
               RowBox[{"{", RowBox[{"StrongWolfePowell", ",", RowBox[
                    {"\"Interpolation\"", "\[Rule]", "\"Cubic\""}]}], 
                 "}"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"SearchDirection\"", "\[Rule]", RowBox[
                {"{", "\[IndentingNewLine]", RowBox[{"\"L\bBFGS\"", ",", 
                   "\[IndentingNewLine]", RowBox[{"\"H\"", "\[Rule]", 
                     "CheapLaplace"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"\"HTransform\"", "\[Rule]", "LinearSolve"}], ",", 
                   "\[IndentingNewLine]", RowBox[{"\"MaxHistoryLength\"", 
                     "\[Rule]", "20"}]}], "\[IndentingNewLine]", "}"}]}]}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"Q", "\[LeftArrow]", "Q"}], 
       ";"}], "\[IndentingNewLine]", RowBox[{"Energy", "[", "P", "]"}], 
     "\[IndentingNewLine]", RowBox[{"Q", "[", 
       RowBox[{"\"Cache\"", ",", "\"ModelAlgorithmData\""}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "[", RowBox[{"\"PersistentCache\"", ",", 
           "\"LBFGS\""}], "]"}], ";"}]}], "Input", 
   CellChangeTimes -> {{3.63953997280508*^9, 3.639539989768096*^9}, 
     3.6395400691249437*^9, {3.6395404591773357*^9, 3.639540512378359*^9}, 
     {3.639540647227387*^9, 3.6395406807321577*^9}, 3.639540718869699*^9, 
     3.63954091428251*^9, 3.639540972923979*^9, {3.639541200299201*^9, 
      3.6395412118896923*^9}, {3.639541254426446*^9, 3.639541262474285*^9}, 
     {3.639627237254706*^9, 3.639627259751814*^9}, {3.6396273298951063*^9, 
      3.6396273416312647*^9}, {3.6396276738730392*^9, 3.6396276869590178*^9}, 
     {3.639627897351905*^9, 3.63962790146692*^9}, {3.6396279790541286*^9, 
      3.639628017901729*^9}, {3.639628360255529*^9, 3.6396283826462803*^9}, 
     {3.639630660813037*^9, 3.639630691381089*^9}, 3.6396308298917227*^9, 
     3.639631639943984*^9, 3.6396316879597187*^9, {3.639631726969561*^9, 
      3.639631733359705*^9}, {3.639632322374242*^9, 3.6396323280157423*^9}, 
     {3.6396325228513823*^9, 3.639632533128813*^9}, 
     {3.6396326825307302*^9, 3.639632685045411*^9}, 
     {3.639632727493519*^9, 3.639632740690939*^9}, {3.6396327923055887*^9, 
      3.639632857322733*^9}, {3.6396329228211193*^9, 3.6396329359048986*^9}, 
     {3.639633044943961*^9, 3.639633074616715*^9}, {3.639633122377746*^9, 
      3.639633131063149*^9}, {3.63963316407452*^9, 3.639633314931807*^9}, 
     {3.6396335393627043*^9, 3.639633550850801*^9}, 3.639633995838367*^9, 
     {3.639634550306571*^9, 3.6396345887058153*^9}, 3.6396346232996283*^9, 
     {3.639634658651885*^9, 3.639634679860927*^9}, 3.6396347315975943*^9, 
     {3.639634860285331*^9, 3.639634922924117*^9}, {3.639634966997175*^9, 
      3.63963498141962*^9}, {3.639635596538275*^9, 3.639635601650769*^9}, 
     {3.63963563230189*^9, 3.639635632490512*^9}, {3.639636063245646*^9, 
      3.639636085078116*^9}, 3.639636420039461*^9, {3.6396365866038094*^9, 
      3.639636586950218*^9}, {3.639636831499755*^9, 3.639636831702908*^9}, 
     {3.6396368632101173*^9, 3.639636879928393*^9}, 3.6396371502598457*^9, 
     {3.639637188562684*^9, 3.639637188774561*^9}, 3.6396373650189342*^9, 
     {3.639637402430925*^9, 3.639637410780058*^9}, {3.639637461431467*^9, 
      3.639637473166279*^9}, {3.6396375033135242*^9, 3.639637507910849*^9}, 
     {3.639637558425253*^9, 3.6396375934147797*^9}, 
     {3.6396376626047792*^9, 3.639637689147893*^9}, 
     {3.639639776830809*^9, 3.639639811319648*^9}, {3.639825964011724*^9, 
      3.639825964960034*^9}, {3.639827654440736*^9, 3.6398276751986837*^9}, 
     {3.6398277071292143*^9, 3.639827766758471*^9}, 
     {3.639828689895214*^9, 3.6398287028643913*^9}, 
     {3.639828927098711*^9, 3.63982893045888*^9}, 3.639829552626247*^9, 
     {3.639829966620151*^9, 3.639829974067458*^9}}], 
  Cell[BoxData[RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{RowBox[{"Graphics", "[", RowBox[{"Line", "[", 
            RowBox[{"getp", "[", RowBox[{"P", ",", "All", ",", 
                RowBox[{"{", RowBox[{"1", ",", "3"}], "}"}]}], "]"}], "]"}], 
          "]"}], ",", "\[IndentingNewLine]", RowBox[{"Graphics", "[", 
          RowBox[{"Point", "[", RowBox[{"getp", "[", RowBox[{"P", ",", "All", 
                ",", RowBox[{"{", RowBox[{"1", ",", "3"}], "}"}]}], "]"}], 
            "]"}], "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Graphics", "[", RowBox[{"{", RowBox[{"Red", ",", 
              RowBox[{"Line", "[", RowBox[{"getp", "[", RowBox[{"Q", ",", 
                    "All", ",", RowBox[{"{", RowBox[{"1", ",", "3"}], 
                      "}"}]}], "]"}], "]"}]}], "}"}], "]"}], ",", 
        "\[IndentingNewLine]", RowBox[{"Graphics", "[", 
          RowBox[{"Point", "[", RowBox[{"getp", "[", RowBox[{"Q", ",", "All", 
                ",", RowBox[{"{", RowBox[{"1", ",", "3"}], "}"}]}], "]"}], 
            "]"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "\[IndentingNewLine]", 
      "]"}]], "Input", CellChangeTimes -> 
    {{3.639463116181635*^9, 3.639463123186755*^9}, {3.639464652457206*^9, 
      3.639464659022409*^9}, {3.639473101198134*^9, 3.639473101936006*^9}, 
     {3.639482002554289*^9, 3.639482009808943*^9}, {3.63948700769703*^9, 
      3.639487011493723*^9}, {3.639487269670684*^9, 3.639487328144212*^9}, 
     {3.63950172011513*^9, 3.639501720857657*^9}, {3.639628120571013*^9, 
      3.639628124456491*^9}}], 
  Cell[BoxData[RowBox[{"w", "=", RowBox[{"t", "\[Function]", 
        RowBox[{FractionBox["1", "4"], " ", RowBox[
           {"(", RowBox[{RowBox[{"-", "1"}], "+", FractionBox[RowBox[
                {"1", "+", SuperscriptBox["t", "4"]}], RowBox[{"2", " ", 
                 SuperscriptBox["t", "2"]}]]}], ")"}]}]}]}]], "Input", 
   CellChangeTimes -> {{3.639554348521742*^9, 3.639554373419106*^9}, 
     3.639554419956348*^9}], Cell[BoxData[RowBox[{"t", "=."}]], "Input", 
   CellChangeTimes -> {{3.6395543936957207*^9, 3.639554394258481*^9}}], 
  Cell[BoxData[RowBox[{"\[Lambda]", "=."}]], "Input", 
   CellChangeTimes -> {{3.639554435408258*^9, 3.639554436387837*^9}}], 
  Cell[BoxData[{RowBox[{"w", "[", RowBox[{"t", "/", "\[Lambda]"}], "]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"w", "'"}], "[", 
       RowBox[{"t", "/", "\[Lambda]"}], "]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"w", "''"}], "[", RowBox[{"t", "/", "\[Lambda]"}], 
       "]"}]}], "Input", CellChangeTimes -> 
    {{3.639554351684166*^9, 3.639554359809783*^9}, {3.639554425779657*^9, 
      3.639554444219688*^9}}], Cell[BoxData[RowBox[{"t", "=."}]], "Input", 
   CellChangeTimes -> {{3.6394924150067043*^9, 3.6394924172360153*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"f", "=", RowBox[{"t", "\[Function]", 
          RowBox[{RowBox[{RowBox[{"1", "/", "2"}], RowBox[{"Exp", "[", 
                RowBox[{RowBox[{"Log", "[", "t", "]"}], "^", "2"}], "]"}]}], 
            "-", RowBox[{"1", "/", "2"}]}]}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.639492554741344*^9, 3.63949261780897*^9}, 
     {3.639492666367277*^9, 3.639492666754159*^9}, {3.6394927103906107*^9, 
      3.639492746732648*^9}}], 
  Cell[BoxData[{RowBox[{"f", "[", "1", "]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"f", "'"}], "[", "1", "]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"f", "''"}], "[", "1", "]"}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{"g", "[", "1", "]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"g", "'"}], "[", "1", "]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"g", "''"}], "[", "1", "]"}]}], "Input", 
   CellChangeTimes -> {{3.639492410701366*^9, 3.639492412340207*^9}, 
     {3.639492559796607*^9, 3.639492623465222*^9}, {3.639492750855157*^9, 
      3.639492752444427*^9}, {3.639492837716487*^9, 3.639492840979032*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"f", "[", "t", "]"}], "//", "Simplify"}]], 
   "Input", CellChangeTimes -> {{3.6394926767727127*^9, 
      3.6394926811482973*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"g", "=", RowBox[{"t", "\[Function]", 
          RowBox[{RowBox[{"1", "/", "2"}], RowBox[{RowBox[{"(", 
                RowBox[{"t", "-", "1"}], ")"}], "^", "2"}]}]}]}], ";"}]], 
   "Input", CellChangeTimes -> {{3.639492820379377*^9, 
      3.6394928469169693*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"Plot", "[", "\[IndentingNewLine]", 
        RowBox[{RowBox[{"{", RowBox[{RowBox[{"f", "[", "t", "]"}], ",", 
              RowBox[{RowBox[{"f", "'"}], "[", "t", "]"}], ",", 
              RowBox[{"g", "[", "t", "]"}], ",", RowBox[{RowBox[{"g", "'"}], 
                RowBox[{"t", "[", "t", "]"}]}]}], "}"}], ",", 
          RowBox[{"{", RowBox[{"t", ",", "0", ",", "2"}], "}"}]}], "]"}], 
      "\[IndentingNewLine]"}]], "Input", CellChangeTimes -> 
    {{3.639492345926214*^9, 3.639492363420411*^9}, {3.639492404928973*^9, 
      3.639492425137474*^9}, {3.639492629039147*^9, 3.639492636292522*^9}, 
     {3.639492723532714*^9, 3.63949273827372*^9}, {3.6394927751979437*^9, 
      3.639492830007753*^9}}], 
  Cell[BoxData[RowBox[{"M", "\[LeftArrow]", 
      RowBox[{"FigureEightMesh", "[", "3", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.639499742674651*^9, 3.639499756586969*^9}}], 
  Cell[BoxData[
    {RowBox[{RowBox[{"DAreaInt", "=", RowBox[{"PackageFunction", "[", 
           RowBox[{"M_", ",", "\[IndentingNewLine]", 
             RowBox[{RowBox[{"DArea", "[", "M", "]"}], "[", RowBox[
                {"[", RowBox[{"1", ";;", RowBox[{"3", " ", RowBox[
                      {"numintpts", "[", "M", "]"}]}]}], "]"}], "]"}], ",", 
             "\[IndentingNewLine]", RowBox[{"\"InputType\"", "\[Rule]", 
               "mesh"}], ",", "\[IndentingNewLine]", RowBox[{"\"Caching\"", 
               "\[Rule]", "False"}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"InnerDisplace", "=", RowBox[{"PackageFunction", "[", 
           RowBox[{RowBox[{"{", RowBox[{"M_", ",", "V_"}], "}"}], ",", 
             "\[IndentingNewLine]", RowBox[{"Module", "[", RowBox[
                {RowBox[{"{", "Q", "}"}], ",", "\[IndentingNewLine]", 
                 RowBox[{RowBox[{"Q", "\[LeftArrow]", "M"}], ";", 
                   "\[IndentingNewLine]", RowBox[{"ClearCache", "[", "Q", 
                     "]"}], ";", "\[IndentingNewLine]", RowBox[
                    {RowBox[{"Part", "[", RowBox[{"Q", ",", "1", ",", 
                         "\"Points\"", ",", RowBox[{"1", ";;", RowBox[
                          {"numintpts", "[", "M", "]"}]}]}], "]"}], "=", 
                     RowBox[{RowBox[{"Part", "[", RowBox[{"Q", ",", "1", ",", 
                          "\"Points\"", ",", RowBox[{"1", ";;", RowBox[
                          {"numintpts", "[", "M", "]"}]}]}], "]"}], "+", 
                       RowBox[{"Partition", "[", RowBox[{"V", ",", "3"}], 
                         "]"}]}]}], ";", "\[IndentingNewLine]", "Q"}]}], 
               "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"InputType\"", "\[Rule]", "mesh"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"InnerWeakLaplace", "=", 
         RowBox[{"PackageFunction", "[", RowBox[{"M_", ",", 
             "\[IndentingNewLine]", RowBox[{"Module", "[", RowBox[
                {RowBox[{"{", "Q", "}"}], ",", "\[IndentingNewLine]", 
                 RowBox[{RowBox[{"Q", "\[LeftArrow]", "M"}], ";", 
                   "\[IndentingNewLine]", RowBox[{"ClearCache", "[", "Q", 
                     "]"}], ";", "\[IndentingNewLine]", RowBox[
                    {RowBox[{"Part", "[", RowBox[{"Q", ",", "1", ",", 
                         "\"Points\"", ",", RowBox[{"1", ";;", RowBox[
                          {"numintpts", "[", "M", "]"}]}]}], "]"}], "=", 
                     RowBox[{RowBox[{"Part", "[", RowBox[{"Q", ",", "1", ",", 
                          "\"Points\"", ",", RowBox[{"1", ";;", RowBox[
                          {"numintpts", "[", "M", "]"}]}]}], "]"}], "+", 
                       RowBox[{"Partition", "[", RowBox[{"V", ",", "3"}], 
                         "]"}]}]}], ";", "\[IndentingNewLine]", "Q"}]}], 
               "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"InputType\"", "\[Rule]", "mesh"}]}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"Unprotect", "[", "Area", "]"}], 
       ";"}], "\[IndentingNewLine]", RowBox[{"Area", "/:", 
       RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "Area", "]"}], 
       ":=", "DAreaInt"}], "\[IndentingNewLine]"}], "Input", 
   CellChangeTimes -> {{3.639499851536762*^9, 3.6394999494174337*^9}, 
     {3.639500013140875*^9, 3.639500040256216*^9}, 3.6395006285720043*^9, 
     {3.639501571577985*^9, 3.639501586296236*^9}}], 
  Cell[BoxData[RowBox[
     {RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", " ", "-", " ", 
              RowBox[{"p", RowBox[{"(", "1", ")"}]}]}], ")"}], "^", "2"}], 
        " ", "+", " ", RowBox[{"a", "*", RowBox[
           {RowBox[{"(", RowBox[{RowBox[{RowBox[{"-", "p"}], RowBox[
                   {RowBox[{"(", "1", ")"}], "^", "2"}]}], " ", "+", " ", 
                RowBox[{"p", RowBox[{"(", "2", ")"}]}]}], ")"}], "^", 
            "2"}]}]}], ";"}]], "Input"], 
  Cell[BoxData[RowBox[{RowBox[{"DDRosenbrock", "=."}], ";"}]], "Input", 
   CellChangeTimes -> {{3.639974146168399*^9, 3.639974154039133*^9}}], 
  Cell[BoxData[RowBox[{"f", "[", RowBox[{"getp", "[", 
        RowBox[{"P", ",", "1"}], "]"}], "]"}]], "Input", 
   CellChangeTimes -> {{3.639974615569664*^9, 3.639974626023443*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"Rosenbrock", "'"}], "[", "P", "]"}]], 
   "Input", CellChangeTimes -> {3.6399746673394737*^9}], 
  Cell[BoxData[
    {RowBox[{RowBox[{"Quiet", "[", RowBox[{"XX", "=", 
           RowBox[{"{", RowBox[{RowBox[{"X", "[", RowBox[{"[", "1", "]"}], 
                 "]"}], ",", RowBox[{"X", "[", RowBox[{"[", "2", "]"}], 
                 "]"}], ",", RowBox[{"X", "[", RowBox[{"[", "3", "]"}], 
                 "]"}]}], "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"f", "=", RowBox[{"X", "\[Function]", 
           RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"X", "[", 
                     RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "^", "2"}], 
             "+", " ", RowBox[{"100", "*", RowBox[{RowBox[{"(", RowBox[
                    {RowBox[{"X", "[", RowBox[{"[", "2", "]"}], "]"}], "-", 
                     RowBox[{RowBox[{"X", "[", RowBox[{"[", "1", "]"}], 
                         "]"}], "^", "2"}]}], ")"}], "^", "2"}]}]}]}]}], 
       ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Df", "=", RowBox[{"X", "\[Function]", 
           RowBox[{"Evaluate", "[", RowBox[{"D", "[", RowBox[
                {RowBox[{"f", "[", "XX", "]"}], ",", RowBox[{"{", 
                   RowBox[{"XX", ",", "1"}], "}"}]}], "]"}], "]"}]}]}], 
       ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"DDf", "=", RowBox[{"X", "\[Function]", 
             RowBox[{"Evaluate", "[", RowBox[{"D", "[", RowBox[
                  {RowBox[{"f", "[", "XX", "]"}], ",", RowBox[{"{", 
                     RowBox[{"XX", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
         ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"With", "[", RowBox[
            {RowBox[{"{", RowBox[{"code", "=", RowBox[{"f", "[", "XX", 
                   "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{RowBox[{"cf", "=", RowBox[{"CPackageFunction", "[", 
                   RowBox[{RowBox[{"{", RowBox[{"{", RowBox[{"X", ",", 
                          "_Real", ",", "1"}], "}"}], "}"}], ",", 
                     "\[IndentingNewLine]", "code"}], "\[IndentingNewLine]", 
                   "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"With", "[", RowBox[
            {RowBox[{"{", RowBox[{"code", "=", RowBox[{"Df", "[", "XX", 
                   "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{RowBox[{"cDf", "=", RowBox[{"CPackageFunction", "[", 
                   RowBox[{RowBox[{"{", RowBox[{"{", RowBox[{"X", ",", 
                          "_Real", ",", "1"}], "}"}], "}"}], ",", 
                     "\[IndentingNewLine]", "code"}], "\[IndentingNewLine]", 
                   "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"With", "[", RowBox[
            {RowBox[{"{", RowBox[{"code", "=", RowBox[{"DDf", "[", "XX", 
                   "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{RowBox[{"cDDf", "=", RowBox[{"CPackageFunction", "[", 
                   RowBox[{RowBox[{"{", RowBox[{"{", RowBox[{"X", ",", 
                          "_Real", ",", "1"}], "}"}], "}"}], ",", 
                     "\[IndentingNewLine]", "code"}], "\[IndentingNewLine]", 
                   "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Rosenbrock", "=", RowBox[{"PackageFunction", "[", 
           RowBox[{"M_", ",", "\[IndentingNewLine]", 
             RowBox[{"cf", "[", RowBox[{"getp", "[", RowBox[{"M", ",", "1"}], 
                 "]"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"InputType\"", "\[Rule]", " ", "polygon"}], ",", 
             "\[IndentingNewLine]", RowBox[{"\"Caching\"", "\[Rule]", 
               "\"Access\""}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"DRosenbrock", "=", RowBox[{"PackageFunction", "[", 
           RowBox[{"M_", ",", "\[IndentingNewLine]", 
             RowBox[{"cDf", "[", RowBox[{"getp", "[", RowBox[{"M", ",", 
                   "1"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"InputType\"", "\[Rule]", " ", "polygon"}], ",", 
             "\[IndentingNewLine]", RowBox[{"\"Caching\"", "\[Rule]", 
               "\"Access\""}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"DDRosenbrock", "=", RowBox[{"PackageFunction", "[", 
           RowBox[{"M_", ",", "\[IndentingNewLine]", 
             RowBox[{"cDDf", "[", RowBox[{"getp", "[", RowBox[{"M", ",", 
                   "1"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"InputType\"", "\[Rule]", " ", "polygon"}], ",", 
             "\[IndentingNewLine]", RowBox[{"\"Caching\"", "\[Rule]", 
               "\"Access\""}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Rosenbrock", "/:", 
         RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "Rosenbrock", 
           "]"}], ":=", "DRosenbrock"}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Rosenbrock", "/:", 
           RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "Rosenbrock", 
             "]"}], ":=", "DDRosenbrock"}], ";"}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"bDisplace", "=", RowBox[{"PackageFunction", "[", 
           RowBox[{RowBox[{"{", RowBox[{"M_", ",", "V_"}], "}"}], ",", 
             "\[IndentingNewLine]", RowBox[{"Module", "[", RowBox[
                {RowBox[{"{", "Q", "}"}], ",", "\[IndentingNewLine]", 
                 RowBox[{RowBox[{"Q", "\[LeftArrow]", "M"}], ";", 
                   "\[IndentingNewLine]", RowBox[{"ClearCache", "[", "Q", 
                     "]"}], ";", "\[IndentingNewLine]", RowBox[
                    {RowBox[{"Part", "[", RowBox[{"Q", ",", "1", ",", 
                         "\"Points\""}], "]"}], "=", " ", RowBox[
                      {RowBox[{"getp", "[", "M", "]"}], "+", RowBox[{"{", 
                         "V", "}"}]}]}], ";", "\[IndentingNewLine]", "Q"}]}], 
               "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"\"InputType\"", "\[Rule]", " ", "polygon"}]}], "]"}]}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]"}], "Input", CellChangeTimes -> 
    {{3.639974842335384*^9, 3.639974853447398*^9}, 3.639975225400243*^9, 
     {3.639975296337489*^9, 3.639975303203051*^9}, {3.639975585659836*^9, 
      3.639975640044401*^9}, {3.639976532258494*^9, 3.6399765470499277*^9}, 
     {3.63997758565099*^9, 3.639977592859748*^9}}], 
  Cell[BoxData[{RowBox[{RowBox[{RowBox[{"n", "=", "1"}], ";"}], 
       "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"pts", "=", RowBox[{"N", "@", 
           RowBox[{"{", RowBox[{"{", RowBox[{RowBox[{"-", "0.1"}], ",", 
                 "0.5", ",", "0"}], "}"}], "}"}]}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"P0", "\[LeftArrow]", RowBox[{"polygon", "[", 
           RowBox[{"Association", "[", "\[IndentingNewLine]", 
             RowBox[{RowBox[{"\"Points\"", "\[Rule]", "pts"}], ",", 
               "\[IndentingNewLine]", RowBox[{"\"ClosedQ\"", "\[Rule]", 
                 "False"}], ",", "\[IndentingNewLine]", RowBox[{"\"Cache\"", 
                 "\[Rule]", RowBox[{"Association", "[", "]"}]}], ",", 
               "\[IndentingNewLine]", RowBox[{"\"PersistentCache\"", 
                 "\[Rule]", RowBox[{"Association", "[", "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"P", "\[LeftArrow]", RowBox[{"LBFGSInitialize", 
             "[", "P0", "]"}]}], ";"}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"V", "=", RowBox[{"0.1", RowBox[{"RandomReal", "[", 
             RowBox[{RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], 
                 "}"}], ",", RowBox[{"{", "3", " ", "}"}]}], "]"}]}]}], 
       ";"}], "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.1"}], 
       ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"bDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Rosenbrock", "[", "Q", "]"}], "-", 
         RowBox[{"Rosenbrock", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"Rosenbrock", "'"}], "[", 
               "P", "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.01"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"bDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Rosenbrock", "[", "Q", "]"}], "-", 
         RowBox[{"Rosenbrock", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"Rosenbrock", "'"}], "[", 
               "P", "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.001"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"bDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"Rosenbrock", "[", "Q", "]"}], "-", 
         RowBox[{"Rosenbrock", "[", "P", "]"}], "-", 
         RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"Rosenbrock", "'"}], "[", 
               "P", "]"}], ".", "V"}]}]}], "\[IndentingNewLine]"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"t", "=", "0.0001"}], ";"}], 
     "\[IndentingNewLine]", 
     RowBox[{RowBox[{"Q", "\[LeftArrow]", RowBox[{"bDisplace", "[", 
           RowBox[{"P", ",", RowBox[{"t", " ", "V"}]}], "]"}]}], ";"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"Rosenbrock", "[", "Q", "]"}], 
       "-", RowBox[{"Rosenbrock", "[", "P", "]"}], "-", 
       RowBox[{"t", " ", RowBox[{RowBox[{RowBox[{"Rosenbrock", "'"}], "[", 
             "P", "]"}], ".", "V"}]}]}]}], "Input"], 
  Cell[BoxData[RowBox[{RowBox[{"Q", "\[LeftArrow]", 
        RowBox[{"ModelAlgorithm", "[", RowBox[{"P", ",", "Rosenbrock", ",", 
            "\[IndentingNewLine]", RowBox[{"\"UpdateMethod\"", "\[Rule]", 
              "bDisplace"}], ",", "\[IndentingNewLine]", 
            RowBox[{"\"MaxIterations\"", "\[Rule]", "100"}], ",", 
            "\[IndentingNewLine]", RowBox[{"\"PrecisionGoal\"", "\[Rule]", 
              RowBox[{"10", "^", RowBox[{"(", RowBox[{"-", "5"}], ")"}]}]}], 
            ",", "\[IndentingNewLine]", RowBox[{"\"StepWidth\"", "\[Rule]", 
              RowBox[{"{", RowBox[{"StrongWolfePowell", ",", RowBox[
                   {"\"Interpolation\"", "\[Rule]", "\"Cubic\""}]}], "}"}]}], 
            ",", "\[IndentingNewLine]", RowBox[{"\"SearchDirection\"", 
              "\[Rule]", RowBox[{"{", "\[IndentingNewLine]", RowBox[
                 {"\"L\bBFGS\"", ",", "\[IndentingNewLine]", RowBox[
                   {"\"MaxHistoryLength\"", "\[Rule]", "100"}]}], 
                "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.639975498983026*^9, 3.639975501855733*^9}, 
     3.639976257845117*^9, {3.6399763477857018*^9, 3.639976356915699*^9}, 
     3.6399764406301727*^9}], 
  Cell[BoxData[RowBox[{RowBox[{"R", "\[LeftArrow]", 
        RowBox[{"ModelAlgorithm", "[", RowBox[{"P", ",", "Rosenbrock", ",", 
            "\[IndentingNewLine]", RowBox[{"\"UpdateMethod\"", "\[Rule]", 
              "bDisplace"}], ",", "\[IndentingNewLine]", 
            RowBox[{"\"MaxIterations\"", "\[Rule]", "2000"}], ",", 
            "\[IndentingNewLine]", RowBox[{"\"PrecisionGoal\"", "\[Rule]", 
              RowBox[{"10", "^", RowBox[{"(", RowBox[{"-", "6"}], ")"}]}]}], 
            ",", "\[IndentingNewLine]", RowBox[{"\"StepWidth\"", "\[Rule]", 
              RowBox[{"{", RowBox[{"StrongWolfePowell", ",", RowBox[
                   {"\"Interpolation\"", "\[Rule]", "\"Cubic\""}]}], "}"}]}], 
            ",", "\[IndentingNewLine]", RowBox[{"\"SearchDirection\"", 
              "\[Rule]", "\"SteepestDescent\""}]}], "\[IndentingNewLine]", 
          "]"}]}], ";"}]], "Input", CellChangeTimes -> 
    {{3.639974872826098*^9, 3.6399749850586853*^9}, 
     {3.6399753479196787*^9, 3.639975386196639*^9}, 
     {3.639975421247374*^9, 3.639975458733015*^9}, {3.6399754957400637*^9, 
      3.639975554840663*^9}, {3.639976083869299*^9, 3.639976123893272*^9}, 
     {3.639976471396181*^9, 3.639976489542647*^9}, {3.639976563078062*^9, 
      3.6399766172179527*^9}, {3.639977108198227*^9, 3.6399771302771*^9}, 
     {3.6399773982319727*^9, 3.639977399107473*^9}, 3.6399774307409678*^9, 
     {3.639977491272382*^9, 3.639977492846006*^9}, {3.6399776185214233*^9, 
      3.639977701045087*^9}, {3.6399780842546587*^9, 3.639978132685347*^9}, 
     {3.640005227347807*^9, 3.6400052277074423*^9}}], 
  Cell[BoxData[RowBox[{"R", "[", RowBox[{"[", "1", "]"}], "]"}]], "Input", 
   CellChangeTimes -> {{3.639976069666093*^9, 3.639976070731863*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"Print", "[", 
        RowBox[{RowBox[{"toc", "-", "tic"}], ",", "\"   \"", ",", 
          "ContractionIteration"}], "]"}], ";"}]], "Input"], 
  Cell[BoxData[RowBox[{"A", "=", 
      RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], ",", 
          RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "}"}]}], 
        "}"}]}]], "Input", CellChangeTimes -> 
    {{3.640002581156633*^9, 3.640002586860779*^9}}], 
  Cell[BoxData[RowBox[{"Plot3D", "[", 
      RowBox[{RowBox[{RowBox[{"{", RowBox[{"x", ",", "y"}], "}"}], ".", "A", 
          ".", RowBox[{"{", RowBox[{"x", ",", "y"}], "}"}]}], ",", 
        RowBox[{"{", RowBox[{"x", ",", RowBox[{"-", "1"}], ",", "1"}], "}"}], 
        ",", RowBox[{"{", RowBox[{"y", ",", RowBox[{"-", "1"}], ",", "1"}], 
          "}"}]}], "]"}]], "Input", CellChangeTimes -> 
    {{3.6400026465784616*^9, 3.640002666316454*^9}}], 
  Cell[BoxData[RowBox[{"Det", "[", "A", "]"}]], "Input", 
   CellChangeTimes -> {{3.640002588177804*^9, 3.64000259879331*^9}}], 
  Cell[BoxData[RowBox[{"\[Phi]", "=", RowBox[{"t", "\[Function]", 
        RowBox[{"c0", " ", "+", " ", RowBox[{"c1", " ", "t"}], "+", " ", 
          RowBox[{"c2", " ", RowBox[{"t", "^", "2"}]}], "+", 
          RowBox[{"c3", " ", RowBox[{"t", "^", "3"}]}]}]}]}]], "Input", 
   CellChangeTimes -> {{3.6400037738853827*^9, 3.640003810186469*^9}, 
     {3.640003842916203*^9, 3.640003849530816*^9}, {3.640004042301772*^9, 
      3.640004042655554*^9}}], 
  Cell[BoxData[RowBox[{"f", "=", RowBox[{"t", "\[Function]", 
        RowBox[{"Evaluate", "[", RowBox[{RowBox[{RowBox[{"\[Phi]", "[", "t", 
                "]"}], "/.", RowBox[{RowBox[{"Solve", "[", RowBox[
                   {RowBox[{"{", "\[IndentingNewLine]", RowBox[{RowBox[
                         {RowBox[{"\[Phi]", "[", "a", "]"}], "\[Equal]", 
                          "\[Phi]a"}], ",", "\[IndentingNewLine]", RowBox[
                         {RowBox[{"\[Phi]", "[", "b", "]"}], "\[Equal]", 
                          "\[Phi]b"}], ",", "\[IndentingNewLine]", RowBox[
                         {RowBox[{RowBox[{"\[Phi]", "'"}], "[", "a", "]"}], 
                          "\[Equal]", "D\[Phi]a"}], ",", 
                        "\[IndentingNewLine]", RowBox[{RowBox[{RowBox[
                          {"\[Phi]", "'"}], "[", "b", "]"}], "\[Equal]", 
                          "D\[Phi]b"}]}], "\[IndentingNewLine]", "}"}], ",", 
                    RowBox[{"{", RowBox[{"c0", ",", "c1", ",", "c2", ",", 
                        "c3"}], "}"}]}], "]"}], "[", RowBox[{"[", "1", "]"}], 
                "]"}]}], "//", "FullSimplify"}], "]"}]}]}]], "Input", 
   CellChangeTimes -> {{3.640004043799725*^9, 3.6400041176050997*^9}, 
     {3.640004167272194*^9, 3.640004194360355*^9}}], 
  Cell[BoxData[
    {RowBox[{RowBox[{"d1", "=", RowBox[{"D\[Phi]a", "+", "D\[Phi]b", "-", 
           RowBox[{"3", RowBox[{RowBox[{"(", RowBox[{"\[Phi]a", "-", 
                   "\[Phi]b"}], ")"}], "/", RowBox[{"(", RowBox[{"a", "-", 
                   "b"}], ")"}]}]}]}]}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"d2", "=", RowBox[{RowBox[{"Sign", "[", 
             RowBox[{"b", "-", "a"}], "]"}], RowBox[{"Sqrt", "[", 
             RowBox[{RowBox[{"d1", "^", "2"}], "-", RowBox[{"D\[Phi]a", " ", 
                 "D\[Phi]b"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
     RowBox[{"s", "=", RowBox[{"b", "-", 
         RowBox[{RowBox[{"(", RowBox[{"b", "-", "a"}], ")"}], 
           RowBox[{RowBox[{"(", RowBox[{"D\[Phi]b", "+", "d2", "-", "d1"}], 
               ")"}], "/", RowBox[{"(", RowBox[{"D\[Phi]b", "-", "D\[Phi]a", 
                 "+", RowBox[{"2", "d2"}]}], ")"}]}]}]}]}], 
     "\[IndentingNewLine]"}], "Input", CellChangeTimes -> 
    {{3.640004797156398*^9, 3.640004803539349*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{RowBox[{"f", "'"}], "[", "s", "]"}], "/.", 
      RowBox[{"Thread", "[", RowBox[
         {RowBox[{"{", RowBox[{"a", ",", "\[Phi]a", ",", "D\[Phi]a", ",", 
              "b", ",", "\[Phi]b", ",", "D\[Phi]b"}], "}"}], "\[Rule]", 
          "data"}], "]"}]}]], "Input", CellChangeTimes -> 
    {3.640004804438748*^9, {3.640004891539385*^9, 3.640004925060348*^9}}], 
  Cell[BoxData[RowBox[
     {RowBox[{"ex", "=", RowBox[{RowBox[{"f", "[", "t", "]"}], "/.", 
          RowBox[{"Thread", "[", RowBox[{RowBox[{"{", RowBox[{"a", ",", 
                  "\[Phi]a", ",", "D\[Phi]a", ",", "b", ",", "\[Phi]b", ",", 
                  "D\[Phi]b"}], "}"}], "\[Rule]", "data"}], "]"}]}]}], 
      ";"}]], "Input", CellChangeTimes -> 
    {{3.640004933067708*^9, 3.640004949941081*^9}}], 
  Cell[BoxData[RowBox[{"Plot", "[", RowBox[{"ex", ",", 
        RowBox[{"{", RowBox[{"t", ",", RowBox[{"data", "[", RowBox[{"[", "1", 
                "]"}], "]"}], ",", RowBox[{"data", "[", RowBox[{"[", "4", 
                "]"}], "]"}]}], "}"}]}], "]"}]], "Input", 
   CellChangeTimes -> {{3.64000493025727*^9, 3.6400049620581093*^9}}], 
  Cell[BoxData[RowBox[{"getWP", "=."}]], "Input", 
   CellChangeTimes -> {{3.640004616655027*^9, 3.640004616964713*^9}}], 
  Cell[BoxData[RowBox[{"getWP", "=", RowBox[{"CPackageFunction", "[", 
        RowBox[{RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{RowBox[{"{", RowBox[{"a", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", RowBox[{"\[Phi]a", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", RowBox[{"D\[Phi]a", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", RowBox[{"b", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", RowBox[{"\[Phi]b", ",", "_Real"}], "}"}], ",", 
              RowBox[{"{", RowBox[{"D\[Phi]b", ",", "_Real"}], "}"}]}], 
            "}"}], ",", "\[IndentingNewLine]", RowBox[{"Block", "[", 
            RowBox[{RowBox[{"{", RowBox[{"d1", ",", "d2", ",", "s", ",", 
                  "discriminant"}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{RowBox[{"d1", "=", RowBox[{"D\[Phi]a", "+", "D\[Phi]b", 
                    "-", RowBox[{"3", RowBox[{RowBox[{"(", RowBox[{"\[Phi]a", 
                          "-", "\[Phi]b"}], ")"}], "/", RowBox[{"(", RowBox[
                          {"a", "-", "b"}], ")"}]}]}]}]}], ";", 
                "\[IndentingNewLine]", RowBox[{"discriminant", "=", 
                  RowBox[{RowBox[{"d1", "^", "2"}], "-", RowBox[{"D\[Phi]a", 
                      " ", "D\[Phi]b"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", RowBox[{RowBox[{"discriminant", 
                      "\[GreaterEqual]", " ", "0"}], ",", 
                    "\[IndentingNewLine]", RowBox[{RowBox[{"d2", "=", 
                        RowBox[{RowBox[{"Sign", "[", RowBox[{"b", "-", "a"}], 
                          "]"}], RowBox[{"Sqrt", "[", RowBox[{RowBox[{"d1", 
                          "^", "2"}], "-", RowBox[{"D\[Phi]a", " ", 
                          "D\[Phi]b"}]}], "]"}]}]}], ";", 
                      "\[IndentingNewLine]", RowBox[{"s", "=", RowBox[
                         {"b", "-", RowBox[{RowBox[{"(", RowBox[{"b", "-", 
                          "a"}], ")"}], RowBox[{RowBox[{"(", RowBox[
                          {"D\[Phi]b", "+", "d2", "-", "d1"}], ")"}], "/", 
                          RowBox[{"(", RowBox[{"D\[Phi]b", "-", "D\[Phi]a", 
                          "+", RowBox[{"2", "d2"}]}], ")"}]}]}]}]}], ";", 
                      "\[IndentingNewLine]", RowBox[{"If", "[", RowBox[
                         {RowBox[{RowBox[{"s", "<", "a"}], " ", "||", " ", 
                          RowBox[{"s", ">", "b"}]}], ",", RowBox[{RowBox[
                          {"(", RowBox[{"a", "+", "b"}], ")"}], "/", "2"}], 
                          ",", "s"}], "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{RowBox[{"(", RowBox[{"a", "+", "b"}], ")"}], "/", 
                      "2"}]}], "\[IndentingNewLine]", "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], 
   "Input", CellChangeTimes -> {{3.6400045008624487*^9, 
      3.640004506795409*^9}, {3.640004548244232*^9, 3.640004621284293*^9}, 
     {3.640004660456091*^9, 3.640004669708448*^9}, {3.6400047753228493*^9, 
      3.640004776093886*^9}, {3.6400049979852858*^9, 3.640005075924127*^9}, 
     {3.640005111825994*^9, 3.640005143604506*^9}}], 
  Cell[BoxData[
    {RowBox[{RowBox[{"data", "=", RowBox[{"RandomReal", "[", 
           RowBox[{RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], 
               "}"}], ",", "6"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{RowBox[{"data", "[", RowBox[
            {"[", RowBox[{"{", RowBox[{"1", ",", "4"}], "}"}], "]"}], "]"}], 
         "=", RowBox[{"Sort", "[", RowBox[{"data", "[", 
             RowBox[{"[", RowBox[{"{", RowBox[{"1", ",", "4"}], "}"}], "]"}], 
             "]"}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
     RowBox[{"data", "[", RowBox[{"[", RowBox[{"{", RowBox[{"1", ",", "4"}], 
           "}"}], "]"}], "]"}], "\[IndentingNewLine]", 
     RowBox[{RowBox[{"getWP", "@@", "data"}], "//", "AbsoluteTiming"}], 
     "\[IndentingNewLine]", RowBox[{RowBox[{"getWolfePowellPoint", "@@", 
         "data"}], "//", "AbsoluteTiming"}]}], "Input", 
   CellChangeTimes -> {{3.6400045852408133*^9, 3.6400045934040337*^9}, 
     {3.6400046958638144*^9, 3.640004709545409*^9}, 
     {3.640004967118031*^9, 3.640004984860023*^9}, {3.640005155410563*^9, 
      3.640005158215424*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"getWP", "@@", "data"}], 
      "\[IndentingNewLine]"}]], "Input"], 
  Cell[BoxData[RowBox[{"getWolfePowellPoint", "@@", "data"}]], "Input"], 
  Cell[BoxData[""], "Input", CellChangeTimes -> 
    {{3.640004594936881*^9, 3.640004597468194*^9}, {3.640004634374053*^9, 
      3.640004637580374*^9}, {3.640004730131548*^9, 3.640004730283885*^9}, 
     {3.640004978419793*^9, 3.6400049833547583*^9}}], 
  Cell[BoxData["\[IndentingNewLine]"], "Input", 
   CellChangeTimes -> {{3.640004317768251*^9, 3.64000446064318*^9}, 
     {3.640004491397743*^9, 3.640004492930295*^9}, 3.640004561991287*^9}], 
  Cell[BoxData[RowBox[{"Solve", "[", 
      RowBox[{RowBox[{RowBox[{RowBox[{"f", "'"}], "[", "t", "]"}], 
          "\[Equal]", "0"}], ",", "t"}], "]"}]], "Input", 
   CellChangeTimes -> {{3.640004197638164*^9, 3.640004210257061*^9}}], 
  Cell[BoxData[RowBox[{"t", "=."}]], "Input", CellChangeTimes -> 
    {{3.64000379966114*^9, 3.640003800153274*^9}}], 
  Cell[BoxData[RowBox[{"D", "[", RowBox[{RowBox[{"f", "[", "t", "]"}], ",", 
        "t"}], "]"}]], "Input", CellChangeTimes -> 
    {{3.6400037927016582*^9, 3.640003797425168*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"sol", "=", 
        RowBox[{"t", "/.", RowBox[{"Solve", "[", RowBox[
             {RowBox[{RowBox[{"b", "+", RowBox[{"2", " ", "c", " ", "t"}], 
                  "+", RowBox[{"3", " ", "d", " ", SuperscriptBox["t", 
                     "2"]}]}], "\[Equal]", "0"}], ",", "t"}], "]"}]}]}], 
      ";"}]], "Input", CellChangeTimes -> 
    {{3.640003816527258*^9, 3.640003820190913*^9}, {3.640003856474906*^9, 
      3.640003865509964*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"{", RowBox[{"s1", ",", "s2"}], "}"}], "=", 
      RowBox[{RowBox[{"f", "/@", "sol"}], "//", "Simplify"}]}]], "Input", 
   CellChangeTimes -> {{3.640003835195776*^9, 3.6400039006869802*^9}}], 
  Cell[BoxData[RowBox[{"FullSimplify", "[", 
      RowBox[{"s1", ",", RowBox[{"{", RowBox[{RowBox[{"c0", "\[Element]", 
              "Reals"}], ",", RowBox[{"c1", "\[Element]", "Reals"}], ",", 
            RowBox[{"c2", "\[Element]", "Reals"}], ",", 
            RowBox[{"c3", "\[Element]", "Reals"}]}], "}"}]}], "]"}]], 
   "Input", CellChangeTimes -> {{3.640003902560371*^9, 
      3.6400039330288467*^9}}], Cell[BoxData[RowBox[{"s1", "//", "Expand"}]], 
   "Input", CellChangeTimes -> {{3.6400039402748537*^9, 
      3.6400039423657618*^9}}], 
  Cell[BoxData[RowBox[{"repo", "=", 
      RowBox[{"{", RowBox[{RowBox[{"\[Phi]a", "\[Rule]", "phia"}], ",", 
          RowBox[{"D\[Phi]a", "\[Rule]", "Dphia"}], ",", 
          RowBox[{"\[Phi]b", "\[Rule]", "phib"}], ",", 
          RowBox[{"D\[Phi]b", "->", "Dphib"}]}], "}"}]}]], "Input", 
   CellChangeTimes -> {{3.639992834520606*^9, 3.6399928710714827*^9}}], 
  Cell[BoxData[""], "Input", CellChangeTimes -> 
    {{3.639992944365548*^9, 3.639992946957189*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"str", "=", RowBox[{"ToMATLAB", "[", 
          RowBox[{"FullSimplify", "[", RowBox[{RowBox[{SuperscriptBox[
                 RowBox[{"(", RowBox[{RowBox[{RowBox[{"-", "2"}], " ", 
                       SuperscriptBox["a", "2"], " ", "D\[Phi]a"}], "-", 
                     RowBox[{"2", " ", "a", " ", "b", " ", "D\[Phi]a"}], "+", 
                     RowBox[{"4", " ", SuperscriptBox["b", "2"], " ", 
                       "D\[Phi]a"}], "-", RowBox[{"4", " ", SuperscriptBox[
                        "a", "2"], " ", "D\[Phi]b"}], "+", RowBox[{"2", " ", 
                       "a", " ", "b", " ", "D\[Phi]b"}], "+", RowBox[
                      {"2", " ", SuperscriptBox["b", "2"], " ", "D\[Phi]b"}], 
                     "+", RowBox[{"6", " ", "a", " ", "\[Phi]a"}], "+", 
                     RowBox[{"6", " ", "b", " ", "\[Phi]a"}], "-", RowBox[
                      {"6", " ", "a", " ", "\[Phi]b"}], "-", RowBox[
                      {"6", " ", "b", " ", "\[Phi]b"}]}], ")"}], "2"], "-", 
                RowBox[{"4", " ", RowBox[{"(", RowBox[{RowBox[{"3", " ", "a", 
                        " ", "D\[Phi]a"}], "-", RowBox[{"3", " ", "b", " ", 
                        "D\[Phi]a"}], "+", RowBox[{"3", " ", "a", " ", 
                        "D\[Phi]b"}], "-", RowBox[{"3", " ", "b", " ", 
                        "D\[Phi]b"}], "-", RowBox[{"6", " ", "\[Phi]a"}], 
                      "+", RowBox[{"6", " ", "\[Phi]b"}]}], ")"}], " ", 
                  RowBox[{"(", RowBox[{RowBox[{"2", " ", SuperscriptBox["a", 
                         "2"], " ", "b", " ", "D\[Phi]a"}], "-", RowBox[
                       {"a", " ", SuperscriptBox["b", "2"], " ", 
                        "D\[Phi]a"}], "-", RowBox[{SuperscriptBox["b", "3"], 
                        " ", "D\[Phi]a"}], "+", RowBox[{SuperscriptBox["a", 
                         "3"], " ", "D\[Phi]b"}], "+", RowBox[{SuperscriptBox[
                         "a", "2"], " ", "b", " ", "D\[Phi]b"}], "-", 
                      RowBox[{"2", " ", "a", " ", SuperscriptBox["b", "2"], 
                        " ", "D\[Phi]b"}], "-", RowBox[{"6", " ", "a", " ", 
                        "b", " ", "\[Phi]a"}], "+", RowBox[{"6", " ", "a", 
                        " ", "b", " ", "\[Phi]b"}]}], ")"}]}]}], "/.", 
              "repo"}], "]"}], "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {{3.6399929104839163*^9, 3.639992947493307*^9}, 
     {3.639992979422965*^9, 3.639992980059064*^9}, {3.639993059639964*^9, 
      3.639993065591413*^9}, {3.6399952749489737*^9, 3.639995279541753*^9}, 
     {3.639995410743582*^9, 3.6399954319462957*^9}, 3.639996347489964*^9}], 
  Cell[BoxData[RowBox[{RowBox[{"str", "=", RowBox[{"ToMATLAB", "[", 
          "\[IndentingNewLine]", RowBox[{"FullSimplify", "[", 
            RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"-", RowBox[
                       {"Sqrt", "[", "discriminant", "]"}]}], "+", 
                    RowBox[{"2", " ", SuperscriptBox["a", "2"], " ", 
                      "D\[Phi]a"}], "+", RowBox[{"2", " ", "a", " ", "b", 
                      " ", "D\[Phi]a"}], "-", RowBox[{"4", " ", 
                      SuperscriptBox["b", "2"], " ", "D\[Phi]a"}], "+", 
                    RowBox[{"4", " ", SuperscriptBox["a", "2"], " ", 
                      "D\[Phi]b"}], "-", RowBox[{"2", " ", "a", " ", "b", 
                      " ", "D\[Phi]b"}], "-", RowBox[{"2", " ", 
                      SuperscriptBox["b", "2"], " ", "D\[Phi]b"}], "-", 
                    RowBox[{"6", " ", "a", " ", "\[Phi]a"}], "-", RowBox[
                     {"6", " ", "b", " ", "\[Phi]a"}], "+", RowBox[{"6", " ", 
                      "a", " ", "\[Phi]b"}], "+", RowBox[{"6", " ", "b", " ", 
                      "\[Phi]b"}]}], ")"}], "/", RowBox[{"(", RowBox[
                   {"2", " ", RowBox[{"(", RowBox[{RowBox[{"3", " ", "a", 
                          " ", "D\[Phi]a"}], "-", RowBox[{"3", " ", "b", " ", 
                          "D\[Phi]a"}], "+", RowBox[{"3", " ", "a", " ", 
                          "D\[Phi]b"}], "-", RowBox[{"3", " ", "b", " ", 
                          "D\[Phi]b"}], "-", RowBox[{"6", " ", "\[Phi]a"}], 
                        "+", RowBox[{"6", " ", "\[Phi]b"}]}], ")"}]}], 
                  ")"}]}], "/.", "repo"}], "]"}], "\[IndentingNewLine]", 
          "]"}]}], ";"}]], "Input", CellChangeTimes -> 
    {{3.6399931117744093*^9, 3.6399931379440203*^9}, 
     {3.6399952275534277*^9, 3.639995233452035*^9}, 
     {3.6399954430320807*^9, 3.6399954453713303*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"str", "=", RowBox[{"ToMATLAB", "[", 
          "\[IndentingNewLine]", RowBox[{"FullSimplify", "[", 
            RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"Sqrt", "[", 
                      "discriminant", "]"}], "+", RowBox[{"2", " ", 
                      SuperscriptBox["a", "2"], " ", "D\[Phi]a"}], "+", 
                    RowBox[{"2", " ", "a", " ", "b", " ", "D\[Phi]a"}], "-", 
                    RowBox[{"4", " ", SuperscriptBox["b", "2"], " ", 
                      "D\[Phi]a"}], "+", RowBox[{"4", " ", SuperscriptBox[
                       "a", "2"], " ", "D\[Phi]b"}], "-", RowBox[{"2", " ", 
                      "a", " ", "b", " ", "D\[Phi]b"}], "-", RowBox[
                     {"2", " ", SuperscriptBox["b", "2"], " ", "D\[Phi]b"}], 
                    "-", RowBox[{"6", " ", "a", " ", "\[Phi]a"}], "-", 
                    RowBox[{"6", " ", "b", " ", "\[Phi]a"}], "+", RowBox[
                     {"6", " ", "a", " ", "\[Phi]b"}], "+", RowBox[{"6", " ", 
                      "b", " ", "\[Phi]b"}]}], ")"}], "/", RowBox[
                 {"(", RowBox[{"2", " ", RowBox[{"(", RowBox[{RowBox[
                         {"3", " ", "a", " ", "D\[Phi]a"}], "-", RowBox[
                         {"3", " ", "b", " ", "D\[Phi]a"}], "+", RowBox[
                         {"3", " ", "a", " ", "D\[Phi]b"}], "-", RowBox[
                         {"3", " ", "b", " ", "D\[Phi]b"}], "-", RowBox[
                         {"6", " ", "\[Phi]a"}], "+", RowBox[{"6", " ", 
                          "\[Phi]b"}]}], ")"}]}], ")"}]}], "/.", "repo"}], 
            "]"}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input", 
   CellChangeTimes -> {3.639993184642469*^9, {3.639995253413741*^9, 
      3.639995256180477*^9}, {3.63999545410635*^9, 3.6399954587159863*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"str", "=", RowBox[{"ToMATLAB", "[", 
          "\[IndentingNewLine]", RowBox[{"FullSimplify", "[", 
            RowBox[{RowBox[{FractionBox["1", SuperscriptBox[RowBox[
                   {"(", RowBox[{"a", "-", "b"}], ")"}], "3"]], 
                RowBox[{"(", RowBox[{RowBox[{RowBox[{"-", SuperscriptBox["a", 
                         "2"]}], " ", SuperscriptBox["b", "2"], " ", 
                      "D\[Phi]a"}], "+", RowBox[{"a", " ", SuperscriptBox[
                       "b", "3"], " ", "D\[Phi]a"}], "-", RowBox[
                     {SuperscriptBox["a", "3"], " ", "b", " ", "D\[Phi]b"}], 
                    "+", RowBox[{SuperscriptBox["a", "2"], " ", 
                      SuperscriptBox["b", "2"], " ", "D\[Phi]b"}], "+", 
                    RowBox[{"2", " ", SuperscriptBox["a", "2"], " ", "b", 
                      " ", "D\[Phi]a", " ", "s1"}], "-", RowBox[{"a", " ", 
                      SuperscriptBox["b", "2"], " ", "D\[Phi]a", " ", "s1"}], 
                    "-", RowBox[{SuperscriptBox["b", "3"], " ", "D\[Phi]a", 
                      " ", "s1"}], "+", RowBox[{SuperscriptBox["a", "3"], 
                      " ", "D\[Phi]b", " ", "s1"}], "+", RowBox[
                     {SuperscriptBox["a", "2"], " ", "b", " ", "D\[Phi]b", 
                      " ", "s1"}], "-", RowBox[{"2", " ", "a", " ", 
                      SuperscriptBox["b", "2"], " ", "D\[Phi]b", " ", "s1"}], 
                    "-", RowBox[{SuperscriptBox["a", "2"], " ", "D\[Phi]a", 
                      " ", SuperscriptBox["s1", "2"]}], "-", RowBox[
                     {"a", " ", "b", " ", "D\[Phi]a", " ", SuperscriptBox[
                       "s1", "2"]}], "+", RowBox[{"2", " ", SuperscriptBox[
                       "b", "2"], " ", "D\[Phi]a", " ", SuperscriptBox["s1", 
                       "2"]}], "-", RowBox[{"2", " ", SuperscriptBox["a", 
                       "2"], " ", "D\[Phi]b", " ", SuperscriptBox["s1", 
                       "2"]}], "+", RowBox[{"a", " ", "b", " ", "D\[Phi]b", 
                      " ", SuperscriptBox["s1", "2"]}], "+", RowBox[
                     {SuperscriptBox["b", "2"], " ", "D\[Phi]b", " ", 
                      SuperscriptBox["s1", "2"]}], "+", RowBox[{"a", " ", 
                      "D\[Phi]a", " ", SuperscriptBox["s1", "3"]}], "-", 
                    RowBox[{"b", " ", "D\[Phi]a", " ", SuperscriptBox["s1", 
                       "3"]}], "+", RowBox[{"a", " ", "D\[Phi]b", " ", 
                      SuperscriptBox["s1", "3"]}], "-", RowBox[{"b", " ", 
                      "D\[Phi]b", " ", SuperscriptBox["s1", "3"]}], "+", 
                    RowBox[{"3", " ", "a", " ", SuperscriptBox["b", "2"], 
                      " ", "\[Phi]a"}], "-", RowBox[{SuperscriptBox["b", 
                       "3"], " ", "\[Phi]a"}], "-", RowBox[{"6", " ", "a", 
                      " ", "b", " ", "s1", " ", "\[Phi]a"}], "+", RowBox[
                     {"3", " ", "a", " ", SuperscriptBox["s1", "2"], " ", 
                      "\[Phi]a"}], "+", RowBox[{"3", " ", "b", " ", 
                      SuperscriptBox["s1", "2"], " ", "\[Phi]a"}], "-", 
                    RowBox[{"2", " ", SuperscriptBox["s1", "3"], " ", 
                      "\[Phi]a"}], "+", RowBox[{SuperscriptBox["a", "3"], 
                      " ", "\[Phi]b"}], "-", RowBox[{"3", " ", SuperscriptBox[
                       "a", "2"], " ", "b", " ", "\[Phi]b"}], "+", 
                    RowBox[{"6", " ", "a", " ", "b", " ", "s1", " ", 
                      "\[Phi]b"}], "-", RowBox[{"3", " ", "a", " ", 
                      SuperscriptBox["s1", "2"], " ", "\[Phi]b"}], "-", 
                    RowBox[{"3", " ", "b", " ", SuperscriptBox["s1", "2"], 
                      " ", "\[Phi]b"}], "+", RowBox[{"2", " ", SuperscriptBox[
                       "s1", "3"], " ", "\[Phi]b"}]}], ")"}]}], "/.", 
              "repo"}], "]"}], "\[IndentingNewLine]", "]"}]}], ";"}]], 
   "Input", CellChangeTimes -> {3.639994473316472*^9, 
     {3.639994530032246*^9, 3.639994595874074*^9}, {3.6399946449636517*^9, 
      3.6399946560090227*^9}, {3.639995319223455*^9, 3.639995325152233*^9}, 
     {3.639995487347701*^9, 3.639995490389679*^9}}], 
  Cell[BoxData[RowBox[{RowBox[{"str", "=", RowBox[{"ToMATLAB", "[", 
          "\[IndentingNewLine]", RowBox[{"FullSimplify", "[", 
            RowBox[{RowBox[{FractionBox["1", SuperscriptBox[RowBox[
                   {"(", RowBox[{"a", "-", "b"}], ")"}], "3"]], 
                RowBox[{"(", RowBox[{RowBox[{RowBox[{"-", SuperscriptBox["a", 
                         "2"]}], " ", SuperscriptBox["b", "2"], " ", 
                      "D\[Phi]a"}], "+", RowBox[{"a", " ", SuperscriptBox[
                       "b", "3"], " ", "D\[Phi]a"}], "-", RowBox[
                     {SuperscriptBox["a", "3"], " ", "b", " ", "D\[Phi]b"}], 
                    "+", RowBox[{SuperscriptBox["a", "2"], " ", 
                      SuperscriptBox["b", "2"], " ", "D\[Phi]b"}], "+", 
                    RowBox[{"2", " ", SuperscriptBox["a", "2"], " ", "b", 
                      " ", "D\[Phi]a", " ", "s2"}], "-", RowBox[{"a", " ", 
                      SuperscriptBox["b", "2"], " ", "D\[Phi]a", " ", "s2"}], 
                    "-", RowBox[{SuperscriptBox["b", "3"], " ", "D\[Phi]a", 
                      " ", "s2"}], "+", RowBox[{SuperscriptBox["a", "3"], 
                      " ", "D\[Phi]b", " ", "s2"}], "+", RowBox[
                     {SuperscriptBox["a", "2"], " ", "b", " ", "D\[Phi]b", 
                      " ", "s2"}], "-", RowBox[{"2", " ", "a", " ", 
                      SuperscriptBox["b", "2"], " ", "D\[Phi]b", " ", "s2"}], 
                    "-", RowBox[{SuperscriptBox["a", "2"], " ", "D\[Phi]a", 
                      " ", SuperscriptBox["s2", "2"]}], "-", RowBox[
                     {"a", " ", "b", " ", "D\[Phi]a", " ", SuperscriptBox[
                       "s2", "2"]}], "+", RowBox[{"2", " ", SuperscriptBox[
                       "b", "2"], " ", "D\[Phi]a", " ", SuperscriptBox["s2", 
                       "2"]}], "-", RowBox[{"2", " ", SuperscriptBox["a", 
                       "2"], " ", "D\[Phi]b", " ", SuperscriptBox["s2", 
                       "2"]}], "+", RowBox[{"a", " ", "b", " ", "D\[Phi]b", 
                      " ", SuperscriptBox["s2", "2"]}], "+", RowBox[
                     {SuperscriptBox["b", "2"], " ", "D\[Phi]b", " ", 
                      SuperscriptBox["s2", "2"]}], "+", RowBox[{"a", " ", 
                      "D\[Phi]a", " ", SuperscriptBox["s2", "3"]}], "-", 
                    RowBox[{"b", " ", "D\[Phi]a", " ", SuperscriptBox["s2", 
                       "3"]}], "+", RowBox[{"a", " ", "D\[Phi]b", " ", 
                      SuperscriptBox["s2", "3"]}], "-", RowBox[{"b", " ", 
                      "D\[Phi]b", " ", SuperscriptBox["s2", "3"]}], "+", 
                    RowBox[{"3", " ", "a", " ", SuperscriptBox["b", "2"], 
                      " ", "\[Phi]a"}], "-", RowBox[{SuperscriptBox["b", 
                       "3"], " ", "\[Phi]a"}], "-", RowBox[{"6", " ", "a", 
                      " ", "b", " ", "s2", " ", "\[Phi]a"}], "+", RowBox[
                     {"3", " ", "a", " ", SuperscriptBox["s2", "2"], " ", 
                      "\[Phi]a"}], "+", RowBox[{"3", " ", "b", " ", 
                      SuperscriptBox["s2", "2"], " ", "\[Phi]a"}], "-", 
                    RowBox[{"2", " ", SuperscriptBox["s2", "3"], " ", 
                      "\[Phi]a"}], "+", RowBox[{SuperscriptBox["a", "3"], 
                      " ", "\[Phi]b"}], "-", RowBox[{"3", " ", SuperscriptBox[
                       "a", "2"], " ", "b", " ", "\[Phi]b"}], "+", 
                    RowBox[{"6", " ", "a", " ", "b", " ", "s2", " ", 
                      "\[Phi]b"}], "-", RowBox[{"3", " ", "a", " ", 
                      SuperscriptBox["s2", "2"], " ", "\[Phi]b"}], "-", 
                    RowBox[{"3", " ", "b", " ", SuperscriptBox["s2", "2"], 
                      " ", "\[Phi]b"}], "+", RowBox[{"2", " ", SuperscriptBox[
                       "s2", "3"], " ", "\[Phi]b"}]}], ")"}]}], "/.", 
              "repo"}], "]"}], "\[IndentingNewLine]", "]"}]}], ";"}]], 
   "Input", CellChangeTimes -> {3.6399932838869534*^9, 3.639993332193922*^9, 
     {3.63999441948785*^9, 3.639994429845429*^9}, {3.639995348637772*^9, 
      3.639995352974125*^9}, {3.6399955065559273*^9, 3.6399955099402*^9}, 
     3.639996358281642*^9}], 
  Cell[BoxData[RowBox[{RowBox[{FractionBox["1", SuperscriptBox[
          RowBox[{"(", RowBox[{"a", "-", "b"}], ")"}], "3"]], 
        RowBox[{"(", RowBox[{RowBox[{RowBox[{"-", SuperscriptBox["a", "2"]}], 
              " ", SuperscriptBox["b", "2"], " ", "D\[Phi]a"}], "+", 
            RowBox[{"a", " ", SuperscriptBox["b", "3"], " ", "D\[Phi]a"}], 
            "-", RowBox[{SuperscriptBox["a", "3"], " ", "b", " ", 
              "D\[Phi]b"}], "+", RowBox[{SuperscriptBox["a", "2"], " ", 
              SuperscriptBox["b", "2"], " ", "D\[Phi]b"}], "+", 
            RowBox[{"2", " ", SuperscriptBox["a", "2"], " ", "b", " ", 
              "D\[Phi]a", " ", "s2"}], "-", RowBox[{"a", " ", 
              SuperscriptBox["b", "2"], " ", "D\[Phi]a", " ", "s2"}], "-", 
            RowBox[{SuperscriptBox["b", "3"], " ", "D\[Phi]a", " ", "s2"}], 
            "+", RowBox[{SuperscriptBox["a", "3"], " ", "D\[Phi]b", " ", 
              "s2"}], "+", RowBox[{SuperscriptBox["a", "2"], " ", "b", " ", 
              "D\[Phi]b", " ", "s2"}], "-", RowBox[{"2", " ", "a", " ", 
              SuperscriptBox["b", "2"], " ", "D\[Phi]b", " ", "s2"}], "-", 
            RowBox[{SuperscriptBox["a", "2"], " ", "D\[Phi]a", " ", 
              SuperscriptBox["s2", "2"]}], "-", RowBox[{"a", " ", "b", " ", 
              "D\[Phi]a", " ", SuperscriptBox["s2", "2"]}], "+", 
            RowBox[{"2", " ", SuperscriptBox["b", "2"], " ", "D\[Phi]a", " ", 
              SuperscriptBox["s2", "2"]}], "-", RowBox[{"2", " ", 
              SuperscriptBox["a", "2"], " ", "D\[Phi]b", " ", 
              SuperscriptBox["s2", "2"]}], "+", RowBox[{"a", " ", "b", " ", 
              "D\[Phi]b", " ", SuperscriptBox["s2", "2"]}], "+", 
            RowBox[{SuperscriptBox["b", "2"], " ", "D\[Phi]b", " ", 
              SuperscriptBox["s2", "2"]}], "+", RowBox[{"a", " ", "D\[Phi]a", 
              " ", SuperscriptBox["s2", "3"]}], "-", 
            RowBox[{"b", " ", "D\[Phi]a", " ", SuperscriptBox["s2", "3"]}], 
            "+", RowBox[{"a", " ", "D\[Phi]b", " ", SuperscriptBox["s2", 
               "3"]}], "-", RowBox[{"b", " ", "D\[Phi]b", " ", 
              SuperscriptBox["s2", "3"]}], "+", RowBox[{"3", " ", "a", " ", 
              SuperscriptBox["b", "2"], " ", "\[Phi]a"}], "-", 
            RowBox[{SuperscriptBox["b", "3"], " ", "\[Phi]a"}], "-", 
            RowBox[{"6", " ", "a", " ", "b", " ", "s2", " ", "\[Phi]a"}], 
            "+", RowBox[{"3", " ", "a", " ", SuperscriptBox["s2", "2"], " ", 
              "\[Phi]a"}], "+", RowBox[{"3", " ", "b", " ", SuperscriptBox[
               "s2", "2"], " ", "\[Phi]a"}], "-", RowBox[{"2", " ", 
              SuperscriptBox["s2", "3"], " ", "\[Phi]a"}], "+", 
            RowBox[{SuperscriptBox["a", "3"], " ", "\[Phi]b"}], "-", 
            RowBox[{"3", " ", SuperscriptBox["a", "2"], " ", "b", " ", 
              "\[Phi]b"}], "+", RowBox[{"6", " ", "a", " ", "b", " ", "s2", 
              " ", "\[Phi]b"}], "-", RowBox[{"3", " ", "a", " ", 
              SuperscriptBox["s2", "2"], " ", "\[Phi]b"}], "-", 
            RowBox[{"3", " ", "b", " ", SuperscriptBox["s2", "2"], " ", 
              "\[Phi]b"}], "+", RowBox[{"2", " ", SuperscriptBox["s2", "3"], 
              " ", "\[Phi]b"}]}], ")"}]}], "//", "FullSimplify"}]], "Input", 
   CellChangeTimes -> {{3.639995373013389*^9, 3.6399953853159523*^9}}]}, 
 WindowSize -> {1115, 852}, WindowMargins -> 
  {{Automatic, 0}, {Automatic, 0}}, FrontEndVersion -> 
  "10.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (December 4, 2014)", 
 StyleDefinitions -> "Default.nb"]
