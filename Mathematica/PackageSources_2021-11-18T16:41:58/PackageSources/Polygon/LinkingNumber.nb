(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     46555,       1072]
NotebookOptionsPosition[     45584,       1052]
NotebookOutlinePosition[     45920,       1067]
CellTagsIndexPosition[     45877,       1064]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"factor", "=", 
     RowBox[{"1.", "/", 
      RowBox[{"(", 
       RowBox[{"2.", " ", "Pi"}], ")"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"getLinkingNumber", "=", 
    RowBox[{"CPackageFunction", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Q", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\[Lambda]", ",", "\[Lambda]i", ",", "S", ",", "XS", ",", "YS", ",", 
          "X1", ",", "Y1", ",", "X2", ",", "Y2", ",", "D1", ",", "D2", ",", 
          "p", ",", "sX1Y1", ",", "sX2Y2", ",", "sD1p", ",", "sD2p", ",", 
          "\[IndentingNewLine]", "x11", ",", "x12", ",", "x13", ",", "x21", 
          ",", "x22", ",", "x23", ",", "y11", ",", "y12", ",", "y13", ",", 
          "y21", ",", "y22", ",", "y23", ",", "v11", ",", "v12", ",", "v13", 
          ",", "v21", ",", "v22", ",", "v23", ",", "\[IndentingNewLine]", 
          "\[Alpha]1", ",", "\[Alpha]2", ",", "\[Alpha]3", ",", "l\[Alpha]", 
          ",", "\[Beta]1", ",", "\[Beta]2", ",", "\[Beta]3", ",", "l\[Beta]", 
          ",", "\[Gamma]1", ",", "\[Gamma]2", ",", "\[Gamma]3", ",", 
          "l\[Gamma]", ",", "\[Delta]1", ",", "\[Delta]2", ",", "\[Delta]3", 
          ",", "l\[Delta]", ",", "\[Alpha]\[Gamma]", ",", 
          "l\[Alpha]l\[Gamma]", ",", "mul"}], "\[IndentingNewLine]", "}"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Lambda]", "=", "0."}], ";", "\[IndentingNewLine]", 
         RowBox[{"\[Lambda]i", "=", "0."}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"x11", "=", 
             RowBox[{"Compile`GetElement", "[", 
              RowBox[{"P", ",", "i", ",", "1"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"x12", "=", 
             RowBox[{"Compile`GetElement", "[", 
              RowBox[{"P", ",", "i", ",", "2"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"x13", "=", 
             RowBox[{"Compile`GetElement", "[", 
              RowBox[{"P", ",", "i", ",", "3"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"x21", "=", 
             RowBox[{"Compile`GetElement", "[", 
              RowBox[{"P", ",", 
               RowBox[{"i", "+", "1"}], ",", "1"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"x22", "=", 
             RowBox[{"Compile`GetElement", "[", 
              RowBox[{"P", ",", 
               RowBox[{"i", "+", "1"}], ",", "2"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"x23", "=", 
             RowBox[{"Compile`GetElement", "[", 
              RowBox[{"P", ",", 
               RowBox[{"i", "+", "1"}], ",", "3"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"S", "=", 
             RowBox[{"-", "1."}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"XS", "=", "1."}], ";", "\[IndentingNewLine]", 
            RowBox[{"YS", "=", "0."}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Lambda]i", "=", "0."}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"y11", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"Q", ",", "j", ",", "1"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"y12", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"Q", ",", "j", ",", "2"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"y13", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"Q", ",", "j", ",", "3"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"y21", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"Q", ",", 
                  RowBox[{"j", "+", "1"}], ",", "1"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"y22", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"Q", ",", 
                  RowBox[{"j", "+", "1"}], ",", "2"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"y23", "=", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"Q", ",", 
                  RowBox[{"j", "+", "1"}], ",", "3"}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"\[Alpha]1", "=", 
                RowBox[{"y11", "-", "x11"}]}], ";", 
               RowBox[{"\[Alpha]2", "=", 
                RowBox[{"y12", "-", "x12"}]}], ";", 
               RowBox[{"\[Alpha]3", "=", 
                RowBox[{"y13", "-", "x13"}]}], ";", 
               RowBox[{"l\[Alpha]", "=", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{
                  RowBox[{"\[Alpha]1", " ", "\[Alpha]1"}], "+", 
                  RowBox[{"\[Alpha]2", " ", "\[Alpha]2"}], "+", 
                  RowBox[{"\[Alpha]3", " ", "\[Alpha]3"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"\[Beta]1", "=", 
                RowBox[{"y11", "-", "x21"}]}], ";", 
               RowBox[{"\[Beta]2", "=", 
                RowBox[{"y12", "-", "x22"}]}], ";", 
               RowBox[{"\[Beta]3", "=", 
                RowBox[{"y13", "-", "x23"}]}], ";", 
               RowBox[{"l\[Beta]", "=", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{
                  RowBox[{"\[Beta]1", " ", "\[Beta]1"}], "+", 
                  RowBox[{"\[Beta]2", " ", "\[Beta]2"}], "+", 
                  RowBox[{"\[Beta]3", " ", "\[Beta]3"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"\[Gamma]1", "=", 
                RowBox[{"y21", "-", "x21"}]}], ";", 
               RowBox[{"\[Gamma]2", "=", 
                RowBox[{"y22", "-", "x22"}]}], ";", 
               RowBox[{"\[Gamma]3", "=", 
                RowBox[{"y23", "-", "x23"}]}], ";", 
               RowBox[{"l\[Gamma]", "=", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{
                  RowBox[{"\[Gamma]1", " ", "\[Gamma]1"}], "+", 
                  RowBox[{"\[Gamma]2", " ", "\[Gamma]2"}], "+", 
                  RowBox[{"\[Gamma]3", " ", "\[Gamma]3"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"\[Delta]1", "=", 
                RowBox[{"y21", "-", "x11"}]}], ";", 
               RowBox[{"\[Delta]2", "=", 
                RowBox[{"y22", "-", "x12"}]}], ";", 
               RowBox[{"\[Delta]3", "=", 
                RowBox[{"y23", "-", "x13"}]}], ";", 
               RowBox[{"l\[Delta]", "=", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{
                  RowBox[{"\[Delta]1", " ", "\[Delta]1"}], "+", 
                  RowBox[{"\[Delta]2", " ", "\[Delta]2"}], "+", 
                  RowBox[{"\[Delta]3", " ", "\[Delta]3"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"p", "=", 
                RowBox[{
                 RowBox[{"\[Alpha]3", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Beta]1", " ", "\[Gamma]2"}], "-", 
                    RowBox[{"\[Beta]2", " ", "\[Gamma]1"}]}], ")"}]}], "+", 
                 RowBox[{"\[Alpha]2", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Beta]3", " ", "\[Gamma]1"}], "-", 
                    RowBox[{"\[Beta]1", " ", "\[Gamma]3"}]}], ")"}]}], "+", 
                 RowBox[{"\[Alpha]1", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Beta]2", " ", "\[Gamma]3"}], "-", 
                    RowBox[{"\[Beta]3", " ", "\[Gamma]2"}]}], ")"}]}]}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"\[Alpha]\[Gamma]", "=", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\[Alpha]1", " ", "\[Gamma]1"}], "+", 
                  RowBox[{"\[Alpha]2", " ", "\[Gamma]2"}], " ", "+", 
                  RowBox[{"\[Alpha]3", " ", "\[Gamma]3"}]}], ")"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"l\[Alpha]l\[Gamma]", "=", 
                RowBox[{"l\[Alpha]", " ", "l\[Gamma]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"D1", "=", 
                RowBox[{
                 RowBox[{"l\[Alpha]l\[Gamma]", " ", "l\[Beta]"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Alpha]1", " ", "\[Beta]1"}], "+", 
                    RowBox[{"\[Alpha]2", " ", "\[Beta]2"}], "+", 
                    RowBox[{"\[Alpha]3", " ", "\[Beta]3"}]}], ")"}], 
                  "l\[Gamma]"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Beta]1", " ", "\[Gamma]1"}], "+", 
                    RowBox[{"\[Beta]2", " ", "\[Gamma]2"}], "+", 
                    RowBox[{"\[Beta]3", " ", "\[Gamma]3"}]}], ")"}], " ", 
                  "l\[Alpha]"}], "+", 
                 RowBox[{"\[Alpha]\[Gamma]", " ", "l\[Beta]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"D2", "=", 
                RowBox[{
                 RowBox[{"l\[Alpha]l\[Gamma]", " ", "l\[Delta]"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Alpha]1", " ", "\[Delta]1"}], "+", 
                    RowBox[{"\[Alpha]2", " ", "\[Delta]2"}], "+", 
                    RowBox[{"\[Alpha]3", " ", "\[Delta]3"}]}], ")"}], " ", 
                  "l\[Gamma]"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Delta]1", " ", "\[Gamma]1"}], "+", 
                    RowBox[{"\[Delta]2", " ", "\[Gamma]2"}], "+", 
                    RowBox[{"\[Delta]3", " ", "\[Gamma]3"}]}], ")"}], " ", 
                  "l\[Alpha]"}], "+", 
                 RowBox[{"\[Alpha]\[Gamma]", " ", "l\[Delta]"}]}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"X1", "=", 
                RowBox[{
                 RowBox[{"D1", " ", "D2"}], " ", "-", " ", 
                 RowBox[{"p", " ", "p"}]}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"Y1", "=", 
                RowBox[{"p", 
                 RowBox[{"(", 
                  RowBox[{"D1", "+", "D2"}], " ", ")"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"sX1Y1", "=", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"Y1", ">", "0."}], ")"}], "||", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Y1", "\[Equal]", "0."}], "&&", 
                    RowBox[{"X1", "<", "0."}]}], ")"}]}], ",", "1.", ",", 
                  RowBox[{"-", "1."}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               
               RowBox[{"sD1p", "=", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"p", ">", "0."}], ")"}], "||", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"p", "\[Equal]", "0."}], "&&", 
                    RowBox[{"D1", "<", "0."}]}], ")"}]}], ",", "1.", ",", 
                  RowBox[{"-", "1."}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               
               RowBox[{"sD2p", "=", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"p", ">", "0."}], ")"}], "||", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"p", "\[Equal]", "0."}], "&&", 
                    RowBox[{"D2", "<", "0."}]}], ")"}]}], ",", "1.", ",", 
                  RowBox[{"-", "1."}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"sD1p", " ", "sD2p"}], ">", "0."}], ")"}], "&&", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"sD1p", " ", "sX1Y1"}], "<", "0."}], ")"}]}], ",", 
                 RowBox[{
                  RowBox[{"\[Lambda]i", "+=", "sD1p"}], ";"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"X2", "=", 
                RowBox[{
                 RowBox[{"XS", " ", "X1"}], "-", 
                 RowBox[{"YS", " ", "Y1"}]}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"Y2", "=", 
                RowBox[{
                 RowBox[{"XS", " ", "Y1"}], "+", 
                 RowBox[{"YS", " ", "X1"}]}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"sX2Y2", "=", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"Y2", ">", "0."}], ")"}], "||", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Y2", "\[Equal]", "0."}], "&&", 
                    RowBox[{"X2", "<", "0."}]}], ")"}]}], ",", "1.", ",", 
                  RowBox[{"-", "1."}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"sX1Y1", " ", "S"}], ">", "0."}], " ", ")"}], "&&", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"sX2Y2", " ", "S"}], "<", "0."}], ")"}]}], ",", 
                 RowBox[{
                  RowBox[{"\[Lambda]i", "+=", "S"}], ";"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"S", "=", "sX2Y2"}], ";", "\[IndentingNewLine]", 
               RowBox[{"mul", "=", 
                RowBox[{"1.", "/", 
                 RowBox[{"Max", "[", 
                  RowBox[{
                   RowBox[{"Abs", "[", "X2", "]"}], ",", 
                   RowBox[{"Abs", "[", "Y2", "]"}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"XS", "=", 
                RowBox[{"X2", " ", "mul"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"YS", "=", 
                RowBox[{"Y2", " ", "mul"}]}], ";"}], "\[IndentingNewLine]", 
              ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{
                 RowBox[{"Length", "[", "Q", "]"}], "-", "1"}]}], "}"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Lambda]i", "+=", 
             RowBox[{"ArcTan", "[", 
              RowBox[{"XS", ",", "YS"}], "]"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"\[Lambda]", "+=", "\[Lambda]i"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{
              RowBox[{"Length", "[", "P", "]"}], "-", "1"}]}], "}"}]}], "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"\[Lambda]", " ", "factor"}]}]}], "\[IndentingNewLine]", 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], 
     "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]], "Input",\

 CellChangeTimes->{{3.823092535463007*^9, 3.823092684832855*^9}, {
  3.823092809744309*^9, 3.8230928310526037`*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"16ca1542-3495-4c3b-acc9-dd8ed08d085b"],

Cell[BoxData[
 RowBox[{"LinkingNumbers", "=", 
  RowBox[{"PackageFunction", "[", 
   RowBox[{"M_polygon", ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "jobcount", ",", "loops", ",", "dividedloops", ",", "m", ",", 
        "boxes"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"loops", "=", 
        RowBox[{
         RowBox[{"StrataVertexCoordinates", "[", "M", "]"}], 
         "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"boxes", "=", 
        RowBox[{"BoundingBox", "/@", "loops"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"jobcount", "=", 
        RowBox[{"\"\<ParallelThreadNumber\>\"", "/.", 
         RowBox[{"(", 
          RowBox[{"\"\<ParallelOptions\>\"", "/.", 
           RowBox[{"SystemOptions", "[", "\"\<ParallelOptions\>\"", "]"}]}], 
          ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dividedloops", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{"c", "\[Function]", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Take", "[", 
               RowBox[{"c", ",", "#"}], "]"}], "&"}], ",", 
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"Ceiling", "[", 
                RowBox[{"Subdivide", "[", 
                 RowBox[{"1", ",", 
                  RowBox[{"Length", "[", "c", "]"}], ",", "jobcount"}], "]"}],
                 "]"}], ",", "2", ",", "1"}], "]"}]}], "]"}]}], ",", 
          "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m", "=", 
        RowBox[{"Length", "[", "loops", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#", "+", 
           RowBox[{"Transpose", "[", "#", "]"}]}], ")"}], "&"}], "[", 
        "\[IndentingNewLine]", 
        RowBox[{"SparseArray", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"IntersectingQ", "[", 
                  RowBox[{
                   RowBox[{
                   "boxes", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{
                   "boxes", "\[LeftDoubleBracket]", "i2", 
                    "\[RightDoubleBracket]"}]}], "]"}], "\[IndentingNewLine]",
                  ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i1", ",", "i2"}], "}"}], "\[Rule]", 
                  RowBox[{"Round", "@", 
                   RowBox[{"Total", "[", 
                    RowBox[{"getLinkingNumber", "[", 
                    RowBox[{
                    RowBox[{
                    "dividedloops", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    "loops", "\[LeftDoubleBracket]", "i2", 
                    "\[RightDoubleBracket]"}]}], "]"}], "]"}]}]}], 
                 "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "0"}], 
                "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i2", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "m"}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", "1", ",", "m"}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"m", ",", "m"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.8230923557907333`*^9, 3.823092386443674*^9}, {
  3.823092457596478*^9, 
  3.8230924591959467`*^9}},ExpressionUUID->"c88ec247-2e13-474d-aef5-\
80d1dcb04d7d"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.823059455600469*^9, 
  3.8230594557932053`*^9}},ExpressionUUID->"f37ee9e0-bc1f-4eea-828f-\
31d8d8e0d125"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "d", ",", "x", ",", "\[Omega]", ",", "\[Omega]2", ",", "x2", ",", "PP", 
      ",", "P", ",", "QQ", ",", "Q", ",", "\[Gamma]1", ",", "t", ",", 
      "\[Gamma]2", ",", "s", ",", "k", ",", "f"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"d", "=", "3"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "\[Omega]"}], "}"}], "=", 
      RowBox[{"Most", "[", 
       RowBox[{"NIntegrate`GaussRuleData", "[", 
        RowBox[{"7", ",", "$MachinePrecision"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Omega]2", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Outer", "[", 
         RowBox[{"Times", ",", "\[Omega]", ",", "\[Omega]"}], "]"}], ",", 
        "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"x2", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Outer", "[", 
         RowBox[{"List", ",", "x", ",", "x"}], "]"}], ",", "1"}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"PP", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Compile`GetElement", "[", 
         RowBox[{"P", ",", "i", ",", "j"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"QQ", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Compile`GetElement", "[", 
         RowBox[{"Q", ",", "k", ",", "i", ",", "j"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\[Gamma]1", "=", 
      RowBox[{"t", "\[Function]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "t"}], ")"}], 
         RowBox[{
         "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "+", 
        
        RowBox[{"t", " ", 
         RowBox[{
         "PP", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}]}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"\[Gamma]2", "=", 
      RowBox[{"s", "\[Function]", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", "s"}], ")"}], 
         RowBox[{
         "QQ", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "+", 
        
        RowBox[{"s", " ", 
         RowBox[{
         "QQ", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}]}]}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"s", ",", "t"}], "}"}], "\[Function]", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Simplify", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Det", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Gamma]1", "'"}], "[", "s", "]"}], ",", 
             RowBox[{
              RowBox[{"\[Gamma]2", "'"}], "[", "t", "]"}], ",", 
             RowBox[{
              RowBox[{"\[Gamma]1", "[", "s", "]"}], "-", 
              RowBox[{"\[Gamma]2", "[", "t", "]"}]}]}], "}"}], "]"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Sqrt", "[", 
             RowBox[{"Dot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"\[Gamma]1", "[", "s", "]"}], "-", 
                RowBox[{"\[Gamma]2", "[", "t", "]"}]}], ",", 
               RowBox[{
                RowBox[{"\[Gamma]1", "[", "s", "]"}], "-", 
                RowBox[{"\[Gamma]2", "[", "t", "]"}]}]}], "]"}], "]"}], "^", 
            "3"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
        "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"code", "=", 
         RowBox[{"N", "[", 
          RowBox[{"\[Omega]2", ".", 
           RowBox[{"f", "@@@", "x2"}]}], "]"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"getLinkingNumbers", "=", 
        RowBox[{"CPackageFunction", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Q", ",", "_Real", ",", "3"}], "}"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Sum", "[", 
           RowBox[{"code", ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "1", ",", 
              RowBox[{"Length", "[", "Q", "]"}]}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"RuntimeAttributes", "\[Rule]", 
           RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<ExportPseudoCode\>\"", "\[Rule]", "True"}]}], 
         "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
     ";"}]}], "\[IndentingNewLine]", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.7443523150458508`*^9, 3.744352421489736*^9}, {
   3.744352573912073*^9, 3.744352579149131*^9}, {3.744352672672263*^9, 
   3.744352694764442*^9}, {3.744352764944344*^9, 3.744352775312228*^9}, 
   3.74435287102851*^9, {3.744352959140367*^9, 3.7443529721709146`*^9}, {
   3.744353063904903*^9, 3.744353064239491*^9}, {3.744353105182375*^9, 
   3.744353125545292*^9}, {3.744353175324353*^9, 3.7443531897385674`*^9}, {
   3.744353943887314*^9, 3.744354030731535*^9}, 3.744354198120986*^9, {
   3.7443549058062267`*^9, 3.744354912581126*^9}, 3.744355040828487*^9, {
   3.7443551815574007`*^9, 3.74435518580437*^9}, {3.744355613377647*^9, 
   3.744355614047112*^9}, {3.74435567059569*^9, 3.744355672234571*^9}, {
   3.74435574530898*^9, 3.7443557798823347`*^9}, {3.74435592506429*^9, 
   3.7443559810872993`*^9}, {3.744356011546361*^9, 3.744356014080515*^9}, 
   3.744359599791709*^9, 3.744360048609723*^9, {3.81218065316547*^9, 
   3.812180653348836*^9}},ExpressionUUID->"5ab701b3-2b1b-4779-9662-\
1dcc9473b1e8"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"LinkingNumbersUnrounded", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_polygon", ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"strataedges", ",", "m", ",", "edata", ",", "A", ",", "x"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"strataedges", "=", 
         RowBox[{
          RowBox[{"StrataEdges", "[", "M", "]"}], "\[LeftDoubleBracket]", "2",
           "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"m", "=", 
         RowBox[{"Length", "[", "strataedges", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"edata", "=", 
         RowBox[{"EdgeData", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"A", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0.", ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", "m"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"a", "=", 
              RowBox[{"edata", "\[LeftDoubleBracket]", 
               RowBox[{
               "strataedges", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}]}], "}"}],
             ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"A", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "i"}], "\[RightDoubleBracket]"}], "=", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{"getLinkingNumbers", "[", 
                 RowBox[{
                  RowBox[{
                  "a", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}],
                   ",", 
                  RowBox[{"Delete", "[", 
                   RowBox[{"a", ",", "k"}], "]"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "1", ",", 
                  RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}]}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "m"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"x", "=", 
            RowBox[{"Total", "[", 
             RowBox[{"getLinkingNumbers", "[", 
              RowBox[{
               RowBox[{"edata", "\[LeftDoubleBracket]", 
                RowBox[{
                "strataedges", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"edata", "\[LeftDoubleBracket]", 
                RowBox[{
                "strataedges", "\[LeftDoubleBracket]", "j", 
                 "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}]}], 
              "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"A", "\[LeftDoubleBracket]", 
             RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "=", "x"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"A", "\[LeftDoubleBracket]", 
             RowBox[{"j", ",", "i"}], "\[RightDoubleBracket]"}], "=", "x"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "strataedges", "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"i", "+", "1"}], ",", 
            RowBox[{"Length", "[", "strataedges", "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"A", "/", 
         RowBox[{"(", 
          RowBox[{"4.", "Pi"}], ")"}]}]}]}], "\[IndentingNewLine]", "]"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", "]"}]}],
   "*)"}]], "Input",
 CellChangeTimes->{{3.744353088567404*^9, 3.744353090476822*^9}, {
  3.744353390540482*^9, 3.744353402750667*^9}, {3.744353598110519*^9, 
  3.7443536641052427`*^9}, {3.7443537201942863`*^9, 3.744353905904957*^9}, {
  3.744354086522373*^9, 3.744354107569428*^9}, {3.744354538491453*^9, 
  3.744354569840464*^9}, {3.744354812418687*^9, 3.7443548143224792`*^9}, {
  3.744355231493496*^9, 3.744355232203298*^9}, {3.7443596257054787`*^9, 
  3.744359672634748*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"ea221284-e30e-4e59-8756-a486bfe574d2"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"LinkingNumbers", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_polygon", ",", "\[IndentingNewLine]", 
     RowBox[{"Association", "[", 
      RowBox[{"Most", "[", 
       RowBox[{"ArrayRules", "[", 
        RowBox[{"UpperTriangularize", "[", 
         RowBox[{
          RowBox[{"Round", "[", 
           RowBox[{
            RowBox[{"LinkingNumbersUnrounded", "[", "M", "]"}], ",", "1"}], 
           "]"}], ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", "]"}]}],
   "*)"}]], "Input",
 CellChangeTimes->{{3.744359657148655*^9, 3.7443596682480717`*^9}, {
  3.744360183305114*^9, 3.744360185830256*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"08c3d432-a00c-4e6d-85cc-706732652e90"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"LinkingNumber", "=", 
   RowBox[{"PackageFunction", "[", 
    RowBox[{"M_polygon", ",", "\[IndentingNewLine]", 
     RowBox[{"Total", "[", 
      RowBox[{"LinkingNumbers", "[", "M", "]"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Caching", "\[Rule]", "True"}]}], "\[IndentingNewLine]", "]"}]}],
   "\[IndentingNewLine]", "*)"}]], "Input",
 CellChangeTimes->{
  3.744355020787816*^9, {3.7443601908661003`*^9, 3.744360204037648*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"b14ee550-a1b5-4dc5-bbea-50b511607297"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "P", ",", "PP", ",", "Q", ",", "QQ", ",", "i1", ",", "i2", ",", "j1", 
       ",", "j2", ",", "a", ",", "b", ",", "c", ",", "d", ",", "la", ",", 
       "lb", ",", "lc", ",", "ld", ",", "code"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PP", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Compile`GetElement", "[", 
          RowBox[{"P", ",", "i", ",", "k"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", "i2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"QQ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Compile`GetElement", "[", 
          RowBox[{"Q", ",", "i", ",", "k"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", "j2"}], "}"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
        RowBox[{"QQ", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "-", 
        RowBox[{
        "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"la", " ", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"a", ".", "a"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{
        RowBox[{"QQ", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "-", 
        RowBox[{
        "PP", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"lb", " ", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"b", ".", "b"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", "=", 
       RowBox[{
        RowBox[{"QQ", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "-", 
        RowBox[{
        "PP", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"lc", " ", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"c", ".", "c"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"d", "=", 
       RowBox[{
        RowBox[{"QQ", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        "-", 
        RowBox[{
        "PP", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"ld", " ", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"d", ".", "d"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"code", "=", 
       RowBox[{"Plus", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"la", " ", "lb", " ", "lc"}], " ", "+", 
            RowBox[{
             RowBox[{"a", ".", "b"}], " ", "lc"}], "+", 
            RowBox[{
             RowBox[{"c", ".", "a"}], " ", "lb"}], "+", 
            RowBox[{
             RowBox[{"b", ".", "c"}], " ", "la"}]}], ",", 
           RowBox[{"a", ".", 
            RowBox[{"Cross", "[", 
             RowBox[{"b", ",", "c"}], "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ArcTan", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"lc", " ", "ld", " ", "la"}], " ", "+", 
            RowBox[{
             RowBox[{"c", ".", "d"}], " ", "la"}], "+", 
            RowBox[{
             RowBox[{"a", ".", "c"}], " ", "ld"}], "+", 
            RowBox[{
             RowBox[{"d", ".", "a"}], " ", "lc"}]}], ",", 
           RowBox[{"c", ".", 
            RowBox[{"Cross", "[", 
             RowBox[{"d", ",", "a"}], "]"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"code", "=", " ", "code"}], ",", 
          RowBox[{"pi", "=", 
           RowBox[{"N", "[", "Pi", "]"}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"getLinkingNumber", "=", 
         RowBox[{"CPackageFunction", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"P", ",", "_Real", ",", "2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Pedge", ",", "_Integer", ",", "1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Q", ",", "_Real", ",", "2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Qedges", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2", ",", "j1", ",", "j2", ",", "sum"}], 
              "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"sum", "=", "0."}], ";", "\[IndentingNewLine]", 
              RowBox[{"i1", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"Pedge", ",", "1"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"i2", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"Pedge", ",", "2"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"j1", "=", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Qedges", ",", "j", ",", "1"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"j2", "=", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Qedges", ",", "j", ",", "2"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"sum", "+=", "code"}], ";"}], "\[IndentingNewLine]", 
                ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", 
                  RowBox[{"Length", "[", "Qedges", "]"}]}], "}"}]}], "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"sum", 
               RowBox[{"(", 
                RowBox[{"1.", "/", 
                 RowBox[{"(", "pi", ")"}]}], ")"}]}]}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"RuntimeAttributes", "\[Rule]", 
            RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], 
          "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"LinkingNumbers", "=", 
    RowBox[{"PackageFunction", "[", 
     RowBox[{"M_polygon", ",", "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "edges", ",", "elists", ",", "m", ",", "pts", ",", "edges1", ",", 
          "boxes"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"pts", "=", 
          RowBox[{"VertexCoordinates", "[", "M", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"edges", "=", 
          RowBox[{"Edges", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"boxes", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"BoundingBox", "[", 
             RowBox[{
             "pts", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
             "]"}], "&"}], "/@", 
           RowBox[{
            RowBox[{"Strata", "[", "M", "]"}], "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"elists", "=", 
          RowBox[{
           RowBox[{"StrataEdges", "[", "M", "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"m", "=", 
          RowBox[{"Length", "[", "elists", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"#", "+", 
             RowBox[{"Transpose", "[", "#", "]"}]}], ")"}], "&"}], "[", 
          "\[IndentingNewLine]", 
          RowBox[{"SparseArray", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"edges1", "=", 
                 RowBox[{"edges", "\[LeftDoubleBracket]", 
                  RowBox[{
                  "elists", "\[LeftDoubleBracket]", "i1", 
                   "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"Table", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"IntersectingQ", "[", 
                    RowBox[{
                    RowBox[{
                    "boxes", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    "boxes", "\[LeftDoubleBracket]", "i2", 
                    "\[RightDoubleBracket]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i1", ",", "i2"}], "}"}], "\[Rule]", 
                    RowBox[{"Round", "@", 
                    RowBox[{"Total", "[", 
                    RowBox[{"getLinkingNumber", "[", 
                    RowBox[{"pts", ",", "edges1", ",", "pts", ",", 
                    RowBox[{"edges", "\[LeftDoubleBracket]", 
                    RowBox[{
                    "elists", "\[LeftDoubleBracket]", "i2", 
                    "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], "]"}]}]}], "\[IndentingNewLine]", ",", 
                    "\[IndentingNewLine]", "0"}], "\[IndentingNewLine]", 
                   "]"}], "\[IndentingNewLine]", ",", 
                  RowBox[{"{", 
                   RowBox[{"i2", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "m"}], "}"}]}], "]"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", "1", ",", "m"}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"m", ",", "m"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
          "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.8230586357006187`*^9, 3.823058683754717*^9}, {
   3.823091650991824*^9, 3.82309165320945*^9}, 3.823092224348736*^9, {
   3.823092301523407*^9, 
   3.823092301924782*^9}},ExpressionUUID->"247d148c-18b1-425b-9ff3-\
a1e4d4420690"]
},
WindowSize->{1440, 851},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.0 for Mac OS X x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 16570, 355, 1692, "Input",ExpressionUUID->"16ca1542-3495-4c3b-acc9-dd8ed08d085b"],
Cell[17131, 377, 4244, 97, 717, "Input",ExpressionUUID->"c88ec247-2e13-474d-aef5-80d1dcb04d7d"],
Cell[21378, 476, 208, 4, 92, "Input",ExpressionUUID->"f37ee9e0-bc1f-4eea-828f-31d8d8e0d125"],
Cell[21589, 482, 6568, 157, 717, "Input",ExpressionUUID->"5ab701b3-2b1b-4779-9662-1dcc9473b1e8"],
Cell[28160, 641, 4576, 102, 492, "Input",ExpressionUUID->"ea221284-e30e-4e59-8756-a486bfe574d2"],
Cell[32739, 745, 831, 19, 117, "Input",ExpressionUUID->"08c3d432-a00c-4e6d-85cc-706732652e90"],
Cell[33573, 766, 566, 12, 142, "Input",ExpressionUUID->"b14ee550-a1b5-4dc5-bbea-50b511607297"],
Cell[34142, 780, 11438, 270, 1592, "Input",ExpressionUUID->"247d148c-18b1-425b-9ff3-a1e4d4420690"]
}
]
*)

