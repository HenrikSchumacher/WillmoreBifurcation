Notebook[{Cell[BoxData[RowBox[{"SamplingOperator", "=", 
      RowBox[{"PackageFunction", "[", 
        RowBox[{RowBox[{"{", RowBox[{"\[Gamma]_", ",", "grid_"}], "}"}], ",", 
          "\[IndentingNewLine]", RowBox[{"Module", "[", 
            RowBox[{RowBox[{"{", RowBox[{"pts", ",", "P", ",", "Q", ",", "v", 
                  ",", "w", ",", "y", ",", "l", ",", "x", ",", "L", ",", 
                  "M0"}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{RowBox[{"pts", "=", RowBox[{"N", "[", RowBox[{"Map", 
                      "[", RowBox[{"\[Gamma]", ",", "grid"}], "]"}], "]"}]}], 
                ";", "\[IndentingNewLine]", RowBox[{"P", "=", RowBox[
                   {"N", "[", RowBox[{"\[Gamma]", "[", RowBox[{"grid", 
                        "\[LeftDoubleBracket]", "1", 
                        "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", RowBox[{"Q", "=", RowBox[{"N", "[", 
                    RowBox[{"\[Gamma]", "[", RowBox[{"grid", 
                        "\[LeftDoubleBracket]", RowBox[{"-", "1"}], 
                        "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", RowBox[{"v", "=", RowBox[{"N", "[", 
                    RowBox[{"Normalize", "[", RowBox[{RowBox[{"\[Gamma]", 
                          "'"}], "[", RowBox[{"grid", "\[LeftDoubleBracket]", 
                          "1", "\[RightDoubleBracket]"}], "]"}], "]"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", RowBox[{"w", "=", 
                  RowBox[{"N", "[", RowBox[{"Normalize", "[", RowBox[
                       {RowBox[{"\[Gamma]", "'"}], "[", RowBox[{"grid", 
                          "\[LeftDoubleBracket]", RowBox[{"-", "1"}], 
                          "\[RightDoubleBracket]"}], "]"}], "]"}], "]"}]}], 
                ";", "\[IndentingNewLine]", RowBox[{"y", "=", RowBox[
                   {"Differences", "[", "pts", "]"}]}], ";", 
                "\[IndentingNewLine]", RowBox[{"l", "=", RowBox[{"cNorm3", 
                    "[", "y", "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"x", "=", RowBox[{"y", "/", "l"}]}], ";", 
                "\[IndentingNewLine]", RowBox[{RowBox[{"x", 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                  "=", "v"}], ";", "\[IndentingNewLine]", RowBox[
                 {RowBox[{"x", "\[LeftDoubleBracket]", RowBox[{"-", "1"}], 
                    "\[RightDoubleBracket]"}], "=", "w"}], ";", 
                "\[IndentingNewLine]", RowBox[{"L", "=", RowBox[
                   {"NIntegrate", "[", RowBox[{RowBox[{"Sqrt", "[", RowBox[
                         {RowBox[{RowBox[{"\[Gamma]", "'"}], "[", "t", "]"}], 
                          ".", RowBox[{RowBox[{"\[Gamma]", "'"}], "[", "t", 
                          "]"}]}], "]"}], ",", RowBox[{"{", RowBox[{"t", ",", 
                          RowBox[{"grid", "\[LeftDoubleBracket]", "1", 
                          "\[RightDoubleBracket]"}], ",", RowBox[{"grid", 
                          "\[LeftDoubleBracket]", RowBox[{"-", "1"}], 
                          "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", RowBox[{"l", "=", RowBox[{"l", " ", 
                    RowBox[{"L", "/", RowBox[{"Total", "[", "l", "]"}]}]}]}], 
                ";", "\[IndentingNewLine]", RowBox[{"y", "=", RowBox[
                   {"l", " ", "x"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"pts", "=", RowBox[{"Accumulate", "[", RowBox[
                     {"Join", "[", RowBox[{RowBox[{"{", "P", "}"}], ",", 
                        "y"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"M0", "\[LeftArrow]", RowBox[{"Init", "[", 
                    RowBox[{"polygon", ",", "pts", ",", RowBox[{"Table", "[", 
                        RowBox[{RowBox[{"{", RowBox[{"i", ",", RowBox[{"i", 
                          "+", "1"}]}], "}"}], ",", RowBox[{"{", RowBox[
                          {"i", ",", "1", ",", RowBox[{RowBox[{"Length", "[", 
                          "pts", "]"}], "-", "1"}]}], "}"}]}], "]"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", RowBox[{"FixPoints", 
                  "[", RowBox[{"M0", ",", RowBox[{"BoundaryPoints", "[", 
                      "M0", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"FixTangents", "[", RowBox[{"M0", ",", RowBox[
                     {"BoundaryEdges", "[", "M0", "]"}]}], "]"}], ";", 
                "\[IndentingNewLine]", RowBox[{"FixEdgeLengths", "[", "M0", 
                  "]"}], ";", "\[IndentingNewLine]", RowBox[{"M0", 
                  "\[LeftArrow]", RowBox[{"ChangePoints", "[", RowBox[
                     {"M0", ",", RowBox[{"BoundaryPoints", "[", "M0", "]"}], 
                      ",", RowBox[{"{", RowBox[{"P", ",", "Q"}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", "M0"}]}], 
            "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]], "Input", 
   CellChangeTimes -> {{3.6640213862751303*^9, 3.664021480730137*^9}, 
     {3.66402160522698*^9, 3.664021636555373*^9}, {3.664021669917551*^9, 
      3.6640217321397047*^9}, {3.664021796676997*^9, 3.6640219236893463*^9}, 
     {3.664021961483902*^9, 3.664022025146408*^9}, {3.6640220851526823*^9, 
      3.664022274201168*^9}, {3.664022384414609*^9, 3.664022391141539*^9}, 
     {3.664022456170608*^9, 3.664022456833766*^9}, {3.6640225068977337*^9, 
      3.664022544581277*^9}, {3.6640225921370697*^9, 3.664022596631279*^9}, 
     {3.664022634984529*^9, 3.6640226812941923*^9}, 
     {3.664022711610648*^9, 3.664022725439252*^9}, {3.664022987537876*^9, 
      3.664022998126514*^9}, {3.664534690403179*^9, 3.6645346912580957*^9}, 
     {3.6645541874022417*^9, 3.664554191409642*^9}, 
     {3.66455536024669*^9, 3.664555365757955*^9}, {3.6656540599659023*^9, 
      3.665654061115753*^9}}], 
  Cell[BoxData[RowBox[{"SamplingOperator0", "=", 
      RowBox[{"PackageFunction", "[", 
        RowBox[{RowBox[{"{", RowBox[{"\[Gamma]_", ",", "grid_"}], "}"}], ",", 
          "\[IndentingNewLine]", RowBox[{"Module", "[", 
            RowBox[{RowBox[{"{", RowBox[{"pts", ",", "P", ",", "Q", ",", "v", 
                  ",", "w", ",", "y", ",", "l", ",", "x", ",", "L", ",", 
                  "M0"}], "}"}], ",", "\[IndentingNewLine]", RowBox[{"(*", 
                "\[IndentingNewLine]", RowBox[{RowBox[{"pts", "=", 
                    RowBox[{"N", "[", RowBox[{"Map", "[", RowBox[{"\[Gamma]", 
                          ",", "grid"}], "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", RowBox[{"P", "=", RowBox[{"N", "[", 
                      RowBox[{"\[Gamma]", "[", RowBox[{"grid", 
                          "\[LeftDoubleBracket]", "1", 
                          "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", RowBox[{"Q", "=", RowBox[{"N", "[", 
                      RowBox[{"\[Gamma]", "[", RowBox[{"grid", 
                          "\[LeftDoubleBracket]", RowBox[{"-", "1"}], 
                          "\[RightDoubleBracket]"}], "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", RowBox[{"v", "=", RowBox[{"N", "[", 
                      RowBox[{"Normalize", "[", RowBox[{RowBox[{"\[Gamma]", 
                          "'"}], "[", RowBox[{"grid", "\[LeftDoubleBracket]", 
                          "1", "\[RightDoubleBracket]"}], "]"}], "]"}], 
                      "]"}]}], ";", "\[IndentingNewLine]", RowBox[{"w", "=", 
                    RowBox[{"N", "[", RowBox[{"Normalize", "[", RowBox[
                         {RowBox[{"\[Gamma]", "'"}], "[", RowBox[{"grid", 
                          "\[LeftDoubleBracket]", RowBox[{"-", "1"}], 
                          "\[RightDoubleBracket]"}], "]"}], "]"}], "]"}]}], 
                  ";", "\[IndentingNewLine]", RowBox[{"y", "=", RowBox[
                     {"Differences", "[", "pts", "]"}]}], ";", 
                  "\[IndentingNewLine]", RowBox[{"l", "=", RowBox[{"cNorm3", 
                      "[", "y", "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"x", "=", RowBox[{"y", "/", "l"}]}], ";", 
                  "\[IndentingNewLine]", RowBox[{"L", "=", RowBox[
                     {"NIntegrate", "[", RowBox[{RowBox[{"Sqrt", "[", 
                          RowBox[{RowBox[{RowBox[{"\[Gamma]", "'"}], "[", 
                          "t", "]"}], ".", RowBox[{RowBox[{"\[Gamma]", "'"}], 
                          "[", "t", "]"}]}], "]"}], ",", RowBox[{"{", 
                          RowBox[{"t", ",", RowBox[{"grid", 
                          "\[LeftDoubleBracket]", "1", 
                          "\[RightDoubleBracket]"}], ",", RowBox[{"grid", 
                          "\[LeftDoubleBracket]", RowBox[{"-", "1"}], 
                          "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], ";", 
                  "\[IndentingNewLine]", RowBox[{"l", "=", RowBox[{"l", " ", 
                      RowBox[{"L", "/", RowBox[{"Total", "[", "l", 
                          "]"}]}]}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"y", "=", RowBox[{"l", " ", "x"}]}], ";", 
                  "\[IndentingNewLine]", RowBox[{"pts", "=", RowBox[
                     {"Accumulate", "[", RowBox[{"Join", "[", RowBox[
                         {RowBox[{"{", "P", "}"}], ",", "y"}], "]"}], 
                      "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{RowBox[{"If", "[", "\[IndentingNewLine]", RowBox[
                   {RowBox[{"OptionValue", "[", "\"Closed\"", "]"}], ",", 
                    "\[IndentingNewLine]", RowBox[{RowBox[{"pts", "=", 
                        RowBox[{"Most", "@", RowBox[{"N", "[", RowBox[{"Map", 
                          "[", RowBox[{"\[Gamma]", ",", "grid"}], "]"}], 
                          "]"}]}]}], ";", "\[IndentingNewLine]", RowBox[
                       {"M0", "\[LeftArrow]", RowBox[{"Init", "[", RowBox[
                          {"polygon", ",", "pts", ",", "\[IndentingNewLine]", 
                          RowBox[{"Append", "[", RowBox[{RowBox[{"Table", 
                          "[", RowBox[{RowBox[{"{", RowBox[{"i", ",", RowBox[
                          {"i", "+", "1"}]}], "}"}], ",", RowBox[{"{", RowBox[
                          {"i", ",", "1", ",", RowBox[{RowBox[{"Length", "[", 
                          "pts", "]"}], "-", "1"}]}], "}"}]}], "]"}], ",", 
                          RowBox[{"{", RowBox[{RowBox[{"Length", "[", "pts", 
                          "]"}], ",", "1"}], "}"}]}], "]"}]}], "]"}]}], 
                      ";"}], "\[IndentingNewLine]", ",", 
                    "\[IndentingNewLine]", RowBox[{RowBox[{"pts", "=", 
                        RowBox[{"N", "[", RowBox[{"Map", "[", RowBox[
                          {"\[Gamma]", ",", "grid"}], "]"}], "]"}]}], ";", 
                      "\[IndentingNewLine]", RowBox[{"M0", "\[LeftArrow]", 
                        RowBox[{"Init", "[", RowBox[{"polygon", ",", "pts", 
                          ",", RowBox[{"Table", "[", RowBox[{RowBox[{"{", 
                          RowBox[{"i", ",", RowBox[{"i", "+", "1"}]}], "}"}], 
                          ",", RowBox[{"{", RowBox[{"i", ",", "1", ",", 
                          RowBox[{RowBox[{"Length", "[", "pts", "]"}], "-", 
                          "1"}]}], "}"}]}], "]"}]}], "]"}]}], ";", 
                      "\[IndentingNewLine]", RowBox[{"FixPoints", "[", 
                        RowBox[{"M0", ",", RowBox[{"BoundaryPoints", "[", 
                          "M0", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                      RowBox[{"FixTangents", "[", RowBox[{"M0", ",", RowBox[
                          {"BoundaryEdges", "[", "M0", "]"}]}], "]"}], 
                      ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
                "\[IndentingNewLine]", RowBox[{"(*", RowBox[
                   {RowBox[{"M0", "\[LeftArrow]", RowBox[{"ChangePoints", 
                        "[", RowBox[{"M0", ",", RowBox[{"BoundaryPoints", 
                          "[", "M0", "]"}], ",", RowBox[{"{", RowBox[{"P", 
                          ",", "Q"}], "}"}]}], "]"}]}], ";"}], "*)"}], 
                "\[IndentingNewLine]", "M0"}]}], "\[IndentingNewLine]", 
            "]"}], ",", "\[IndentingNewLine]", RowBox[{"\"Options\"", 
            "\[Rule]", RowBox[{"{", RowBox[{"\"Closed\"", "\[Rule]", 
                "False"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}]], 
   "Input", CellChangeTimes -> {{3.664024969764062*^9, 
      3.6640249825721817*^9}, {3.6642668415826817*^9, 3.664266882333078*^9}, 
     {3.6707343820156384*^9, 3.67073444664334*^9}, 3.6707345038023643*^9, 
     {3.670734565594666*^9, 3.670734581599942*^9}}]}, 
 WindowSize -> {1120, 852}, WindowMargins -> 
  {{Automatic, 0}, {Automatic, 0}}, FrontEndVersion -> 
  "10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (April 11, 2016)", 
 StyleDefinitions -> "Default.nb"]
