(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     49575,       1041]
NotebookOptionsPosition[     48838,       1023]
NotebookOutlinePosition[     49230,       1039]
CellTagsIndexPosition[     49187,       1036]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"MakeRegion", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"CreateCPackageFunction", "::", "usage"}], "=", "\"\<\>\""}], ";",
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CPackageFunction", "::", "usage"}], "=", "\"\<\>\""}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"SetAttributes", "[", 
    RowBox[{"CPackageFunction", ",", "HoldAll"}], "]"}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"CPackageFunction", "/:", 
    RowBox[{"Set", "[", 
     RowBox[{"S_", ",", 
      RowBox[{"CPackageFunction", "[", 
       RowBox[{"arglist_", ",", "body_", ",", "opts___"}], "]"}]}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ClearAll", "[", "S", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"data", "=", 
          RowBox[{"CreateCPackageFunction", "[", 
           RowBox[{
           "S", ",", "arglist", ",", "body", ",", "\[IndentingNewLine]", 
            "opts", ",", 
            RowBox[{
            "\"\<Description\>\"", "\[Rule]", 
             "\"\<Created by CPackageFunction.\>\""}]}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{"PM`Private`$Compiletime", ",", 
           RowBox[{"Sow", "[", 
            RowBox[{"data", ",", "\"\<CPackageFunctions\>\""}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "\"\<PublicDescription\>\"", "]"}], "]"}], "]"}], "=!=",
             "Missing"}], ",", "\[IndentingNewLine]", 
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"s", "=", 
               RowBox[{"UsageString", "[", 
                RowBox[{
                "data", "\[LeftDoubleBracket]", "\"\<PublicDescription\>\"", 
                 "\[RightDoubleBracket]"}], "]"}]}], "}"}], ",", 
             RowBox[{"ToExpression", "[", "s", "]"}]}], "]"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"PM`Private`$Runtime", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ReleaseHold", "[", 
             RowBox[{
             "data", "\[LeftDoubleBracket]", "\"\<Private\>\"", 
              "\[RightDoubleBracket]"}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ")"}]}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetCPackageFunction", "::", "usage"}], "=", "\"\<\>\""}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"SetAttributes", "[", 
    RowBox[{"SetCPackageFunction", ",", "HoldRest"}], "]"}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetCPackageFunction", "[", 
     RowBox[{"S_", ",", "arglist_", ",", "body_", ",", "opts___"}], "]"}], ":=",
     "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"data", "=", 
        RowBox[{"CreateCPackageFunction", "[", 
         RowBox[{
         "S", ",", "arglist", ",", "body", ",", "\[IndentingNewLine]", "opts",
           ",", 
          RowBox[{
          "\"\<Description\>\"", "\[Rule]", 
           "\"\<Created by CreateCPackageFunction.\>\""}]}], 
         "\[IndentingNewLine]", "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{"PM`Private`$Compiletime", ",", 
         RowBox[{"Sow", "[", 
          RowBox[{"data", ",", "\"\<CPackageFunctions\>\""}], "]"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"True", "\[IndentingNewLine]", 
         RowBox[{"(*", "PM`Private`$Runtime", "*)"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", 
              RowBox[{
              "data", "\[LeftDoubleBracket]", "\"\<PublicDescription\>\"", 
               "\[RightDoubleBracket]"}], "]"}], "=!=", "Missing"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"With", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"s", "=", 
                RowBox[{"UsageString", "[", 
                 RowBox[{
                 "data", "\[LeftDoubleBracket]", "\"\<PublicDescription\>\"", 
                  "\[RightDoubleBracket]"}], "]"}]}], "}"}], ",", 
              RowBox[{"ToExpression", "[", "s", "]"}]}], "]"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"ReleaseHold", "[", 
           RowBox[{
           "data", "\[LeftDoubleBracket]", "\"\<Private\>\"", 
            "\[RightDoubleBracket]"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{
  3.632599869843215*^9, {3.632683398645553*^9, 3.632683412836526*^9}, {
   3.632686668499166*^9, 3.632686668770525*^9}, {3.632686706300377*^9, 
   3.6326867196357594`*^9}, {3.6326867540525627`*^9, 3.632686756028966*^9}, {
   3.632686934412582*^9, 3.632686944771483*^9}, {3.632688395107379*^9, 
   3.632688417498024*^9}, {3.6326890074749603`*^9, 3.6326890214795513`*^9}, {
   3.632689091414773*^9, 3.6326890917867107`*^9}, {3.632689177991446*^9, 
   3.63268918154281*^9}, {3.6326892972241983`*^9, 3.6326893187506523`*^9}, {
   3.6326895141568727`*^9, 3.6326895226731863`*^9}, {3.6326945591449966`*^9, 
   3.632694566499053*^9}, {3.632694732896491*^9, 3.6326947475513144`*^9}, {
   3.632694938793993*^9, 3.632694944087882*^9}, {3.632695454525713*^9, 
   3.632695455516015*^9}, 3.6331780466779737`*^9, 3.633178219361144*^9, {
   3.6331785562573023`*^9, 3.633178557524645*^9}, {3.633178945926052*^9, 
   3.6331789479731092`*^9}, {3.6340763431280527`*^9, 3.63407636724571*^9}, {
   3.6340764111056547`*^9, 3.634076452303712*^9}, {3.634077884187592*^9, 
   3.634077890418336*^9}, {3.6340793239565496`*^9, 3.6340793325955*^9}, {
   3.634079451867812*^9, 3.6340795759084167`*^9}, {3.6340796267609787`*^9, 
   3.634079639163365*^9}, {3.6340798816597977`*^9, 3.634079882034768*^9}, {
   3.634080621598753*^9, 3.6340806381827917`*^9}, {3.634080742933427*^9, 
   3.63408074806841*^9}, {3.634123558455982*^9, 3.63412356049293*^9}, {
   3.6341239118427887`*^9, 3.634123913809587*^9}, {3.634124104693849*^9, 
   3.634124177626004*^9}, {3.6341243105040903`*^9, 3.634124343800891*^9}, {
   3.634124395492202*^9, 3.634124395740505*^9}, {3.634221536783085*^9, 
   3.634221537233294*^9}, {3.634221667219349*^9, 3.634221669206429*^9}, {
   3.6342224690071707`*^9, 3.634222528294973*^9}, {3.6342225601681004`*^9, 
   3.6342225714791813`*^9}, {3.63422262685977*^9, 3.634222627768648*^9}, {
   3.6342249337025013`*^9, 3.634224934101881*^9}, 3.652587142299817*^9, {
   3.6642902202634153`*^9, 3.664290232214973*^9}, {3.6642902741286507`*^9, 
   3.664290274404998*^9}, {3.6642940415991364`*^9, 3.664294085534771*^9}, {
   3.664294468026597*^9, 3.664294468696969*^9}, {3.664297788785705*^9, 
   3.6642978161441936`*^9}, {3.664298696596571*^9, 3.664298699267654*^9}, {
   3.664298977985433*^9, 3.66429897839007*^9}, 3.665302345342883*^9, {
   3.6653432623102903`*^9, 3.665343305871564*^9}, {3.669446985547181*^9, 
   3.669446988711629*^9}, 3.7265556743389053`*^9, {3.749726817379945*^9, 
   3.7497268178105927`*^9}, {3.7497268580367823`*^9, 3.749726858675519*^9}, {
   3.749727643323049*^9, 3.749727650584684*^9}, {3.7497280243494873`*^9, 
   3.7497280252289248`*^9}, {3.749728369720222*^9, 3.7497283728624372`*^9}, {
   3.7971498898839903`*^9, 3.79714989143758*^9}, 3.797150365002932*^9, {
   3.797151311406044*^9, 3.797151353355817*^9}, 3.797155697224119*^9, {
   3.797156219216156*^9, 3.797156243624489*^9}, {3.800844743292268*^9, 
   3.8008447438098183`*^9}},
 CellLabel->"In[28]:=",ExpressionUUID->"ea920a61-87ac-4e84-ac98-7a875bd478fb"],

Cell[BoxData[
 RowBox[{"MakeRegion", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"$CreateCPackageFunctionLog", "::", "usage"}], "=", "\"\<\>\""}], 
   ";", "\[IndentingNewLine]", 
   RowBox[{"$CreateCPackageFunctionLog", "=", 
    RowBox[{"Association", "[", "]"}]}], ";", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"SetAttributes", "[", 
    RowBox[{"CreateCPackageFunction", ",", "HoldAll"}], "]"}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Options", "[", "CreateCPackageFunction", "]"}], "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
      "\"\<Description\>\"", "\[Rule]", 
       "\"\<Created by CreateCPackageFunction.\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<Public\>\"", "\[Rule]", "True"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
      "\"\<DynamicLibraryPath\>\"", "\[RuleDelayed]", "$TemporaryDirectory"}],
       ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<ExportPseudoCode\>\"", "\[Rule]", "False"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"CompilationOptions", "\[Rule]", "Automatic"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"CompilationTarget", "\[RuleDelayed]", "\"\<C\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}]}], 
     "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateCPackageFunction", "[", 
     RowBox[{"fun_", ",", "arglist0_", ",", "body0_", ",", 
      RowBox[{"opts0", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "clearcode", ",", "heldcf", ",", "loadcode", ",", "Lout", ",", "name", 
        ",", "path", ",", "file", ",", "dylibfile", ",", "tic", ",", "toc", 
        ",", "codefile", ",", "heldcompilecode", ",", "heldbody", ",", 
        "symbolictime", ",", "exporttime"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tic", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"name", "=", 
        RowBox[{"SymbolName", "[", 
         RowBox[{"Unevaluated", "[", "fun", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"path", "=", 
        RowBox[{"OptionValue", "[", "\"\<DynamicLibraryPath\>\"", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"dylibfile", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"path", ",", 
           RowBox[{
           "name", "<>", 
            "CCompilerDriver`CCompilerDriverBase`$PlatformDLLExtension"}]}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"codefile", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"path", ",", 
           RowBox[{"name", "<>", "\"\<.mx\>\""}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FileExistsQ", "[", "dylibfile", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Quiet", "[", 
           RowBox[{"LibraryUnload", "[", "dylibfile", "]"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"DeleteFile", "[", "dylibfile", "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"clearcode", "=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "f", "}"}], ",", 
          RowBox[{
           RowBox[{"Hold", "[", 
            RowBox[{
             RowBox[{"ClearAll", "[", "f", "]"}], ";"}], "]"}], "/.", 
           RowBox[{"f", "\[Rule]", 
            RowBox[{"Unevaluated", "[", "fun", "]"}]}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ReleaseHold", "[", "clearcode", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"heldbody", "=", 
        RowBox[{"Hold", "[", "body0", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"symbolictime", "=", 
        RowBox[{"First", "@", 
         RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"heldcompilecode", "=", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{
               "withlist", ",", "body", ",", "set", ",", "resultingbody", ",",
                 "modifiedbody", ",", "libfuns", ",", "libfunsymbols", ",", 
                "libfunpos", ",", "arglist", ",", "opts", ",", "compile", ",",
                 "libraryfunction"}], "\[IndentingNewLine]", "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"libfunpos", "=", 
                RowBox[{"Position", "[", 
                 RowBox[{"heldbody", ",", "LibraryFunction"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"libfunsymbols", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Unique", "[", "\"\<Compile`cf\>\"", "]"}], ",", 
                  RowBox[{"Length", "[", "libfunpos", "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"libfuns", "=", 
                RowBox[{
                 RowBox[{"Extract", "[", 
                  RowBox[{"heldbody", ",", 
                   RowBox[{"Most", "/@", "libfunpos"}]}], "]"}], "/.", 
                 RowBox[{
                  RowBox[{"LibraryFunction", "[", "x__", "]"}], ":>", 
                  RowBox[{"Hold", "[", 
                   RowBox[{"LibraryFunction", "@@", 
                    RowBox[{"{", "x", "}"}]}], "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"modifiedbody", "=", 
                RowBox[{
                 RowBox[{"ReplacePart", "[", "\[IndentingNewLine]", 
                  RowBox[{"heldbody", ",", 
                   RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Most", "/@", "libfunpos"}], "\[Rule]", 
                    "libfunsymbols"}], "]"}]}], "\[IndentingNewLine]", "]"}], 
                 "/.", 
                 RowBox[{
                  RowBox[{
                  "Experimental`OptimizedExpression", "[", "x_", "]"}], 
                  "\[RuleDelayed]", 
                  RowBox[{"Unevaluated", "[", "x", "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"resultingbody", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"HoldComplete", "[", 
                    RowBox[{"With", "[", 
                    RowBox[{"withlist", ",", "\[IndentingNewLine]", 
                    RowBox[{"compile", "[", 
                    RowBox[{"arglist", ",", "body", ",", "opts"}], "]"}]}], 
                    "]"}], "\[IndentingNewLine]", "]"}], "/.", 
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"withlist", "\[Rule]", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{"set", ",", 
                    RowBox[{"{", 
                    RowBox[{"libfunsymbols", ",", "libfuns"}], "}"}]}], 
                    "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"body", "\[Rule]", 
                    RowBox[{"Unevaluated", "@", "modifiedbody"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"arglist", "\[Rule]", 
                    RowBox[{"Map", "[", 
                    RowBox[{"Hold", ",", 
                    RowBox[{"Unevaluated", "[", "arglist0", "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"compile", "\[Rule]", "Compile"}]}], 
                    "\[IndentingNewLine]", "}"}]}], "/.", 
                  RowBox[{"{", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Hold", "[", "x_", "]"}], "\[RuleDelayed]", 
                    RowBox[{"Unevaluated", "[", "x", "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"set", "\[Rule]", "Set"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"opts", "\[Rule]", 
                    RowBox[{"FilterRules", "[", 
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], 
                    "}"}], ",", 
                    RowBox[{"{", "opts0", "}"}]}], "]"}], ",", 
                    RowBox[{"Options", "[", "Compile", "]"}]}], "]"}]}]}], 
                   "\[IndentingNewLine]", "}"}]}], "/.", 
                 RowBox[{"HoldComplete", "\[Rule]", "Hold"}]}]}]}]}], 
             "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
          "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"exporttime", "=", 
        RowBox[{"First", "@", 
         RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Export", "[", 
            RowBox[{"codefile", ",", "heldcompilecode"}], "]"}], ";"}], 
          "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"loadcode", "=", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "f", ",", "cfile", ",", "dir", ",", "cname", ",", 
              "$libraryDirectory"}], "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Hold", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"f", "[", "args___", "]"}], ":=", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"f", "=", 
                  RowBox[{"LoadCPackageFunction", "[", 
                   RowBox[{"dir", ",", "cname"}], "]"}]}], ";", 
                 RowBox[{"f", "[", "args", "]"}]}], ")"}]}], 
              "\[IndentingNewLine]", "]"}], "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"f", "\[Rule]", 
                RowBox[{"Unevaluated", "[", "fun", "]"}]}], ",", 
               RowBox[{"dir", "->"}], ",", 
               RowBox[{"cname", "\[Rule]", "name"}]}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}]}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"loadcode", "=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", ",", "cfile"}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Hold", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"f", "[", "args___", "]"}], ":=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"f", "=", 
                RowBox[{"LoadCPackageFunction", "[", "cfile", "]"}]}], ";", 
               RowBox[{"f", "[", "args", "]"}]}], ")"}]}], 
            "\[IndentingNewLine]", "]"}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"cfile", "\[Rule]", "codefile"}], ",", 
             RowBox[{"f", "\[Rule]", 
              RowBox[{"Unevaluated", "[", "fun", "]"}]}]}], "}"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"toc", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\\t\\t\>\"", ",", 
           RowBox[{"ToString", "[", 
            RowBox[{"PaddedForm", "[", 
             RowBox[{
              RowBox[{"toc", "-", "tic"}], ",", 
              RowBox[{"{", 
               RowBox[{"4", ",", "4"}], "}"}]}], "]"}], "]"}], ",", 
           RowBox[{
           "\"\< s elapsed while processing \>\"", "<>", "name", "<>", 
            "\"\<.\>\""}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"AssociateTo", "[", "\[IndentingNewLine]", 
        RowBox[{"$CreateCPackageFunctionLog", ",", "\[IndentingNewLine]", 
         RowBox[{"name", "\[Rule]", 
          RowBox[{"Association", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\"\<TotalTime\>\"", "\[Rule]", 
             RowBox[{"toc", "-", "tic"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"\"\<SymbolicTime\>\"", "\[Rule]", "symbolictime"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<ExportTime\>\"", "\[Rule]", "exporttime"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<AtRuntimeQ\>\"", "\[Rule]", "PM`Private`$Runtime"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
            "\"\<AtCompiletimeQ\>\"", "\[Rule]", 
             "PM`Private`$Compiletime"}]}], "\[IndentingNewLine]", "]"}]}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Lout", "=", 
        RowBox[{"\[LeftAssociation]", 
         RowBox[{"\"\<Name\>\"", "\[Rule]", "name"}], 
         "\[RightAssociation]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Public\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"Lout", ",", 
            RowBox[{"\"\<PublicDescription\>\"", "\[Rule]", 
             RowBox[{"Rule", "[", 
              RowBox[{"name", ",", 
               RowBox[{"OptionValue", "[", "\"\<Description\>\"", "]"}]}], 
              "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Lout", ",", 
            RowBox[{"\"\<Private\>\"", "\[Rule]", "loadcode"}]}], "]"}], 
          ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"Lout", ",", 
            RowBox[{"\"\<Private\>\"", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"OptionValue", "[", "\"\<Description\>\"", "]"}], ",", 
               "loadcode"}], "}"}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]",
         "]"}], ";", "\[IndentingNewLine]", "Lout"}]}], "\[IndentingNewLine]",
      "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateCPackageFunctionByName", "::", "usage"}], "=", 
    "\"\<\>\""}], ";", "\[IndentingNewLine]", 
   RowBox[{"SetAttributes", "[", 
    RowBox[{"CreateCPackageFunctionByName", ",", "HoldRest"}], "]"}], ";", 
   RowBox[{
    RowBox[{"CreateCPackageFunctionByName", "[", 
     RowBox[{"name_String", ",", "arglist0_", ",", "body0_", ",", 
      RowBox[{"opts0", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "S"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"s", "=", 
        RowBox[{"{", "name", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ClearAll", "/@", "s"}], ";", "\[IndentingNewLine]", 
       RowBox[{"S", "=", 
        RowBox[{"First", "[", 
         RowBox[{"Symbol", "/@", "s"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"SetCPackageFunction", "[", 
        RowBox[{"S", ",", "arglist0", ",", "body0", ",", "opts0"}], "]"}]}]}],
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.797213041542747*^9, 3.797213045975811*^9}, {
   3.79721316583641*^9, 3.797213168740995*^9}, 3.7972134294508133`*^9, {
   3.79721370810071*^9, 3.797213722430087*^9}, {3.797214424232298*^9, 
   3.7972144257914267`*^9}, {3.797214466664639*^9, 3.797214468343012*^9}, {
   3.797214606075942*^9, 3.797214610433792*^9}, 3.797214665328315*^9, 
   3.797215006912717*^9, 3.797215089298585*^9, 3.7972152929488983`*^9, {
   3.797219613427073*^9, 3.797219622505398*^9}, {3.79722094951357*^9, 
   3.797221127505012*^9}, {3.7972211797198753`*^9, 3.79722123435876*^9}, {
   3.797221321058653*^9, 3.797221335467898*^9}, {3.797221494876155*^9, 
   3.797221497619878*^9}, 3.797221852912224*^9, {3.797221951571563*^9, 
   3.797221951762553*^9}, 3.7972273897724047`*^9, {3.8008447220323057`*^9, 
   3.800844728882618*^9}, {3.8394862650003967`*^9, 3.839486267223559*^9}, {
   3.8394863036405478`*^9, 3.839486311584449*^9}, {3.839486515725812*^9, 
   3.8394865256965523`*^9}, {3.8394865798745317`*^9, 3.839486581899363*^9}, {
   3.839486908103282*^9, 3.839486940743537*^9}, {3.83948733621694*^9, 
   3.839487449596567*^9}, {3.839487686827148*^9, 3.839487691484989*^9}, {
   3.8394877434403963`*^9, 3.839487747922104*^9}, {3.839487847216351*^9, 
   3.839487853734055*^9}, {3.839487898355101*^9, 3.839487901508894*^9}, 
   3.83948811703084*^9},ExpressionUUID->"6502a3d5-d3c9-4d23-b17a-\
d1f7243fcaf1"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"MakeRegion", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"CreateCPackageFunction", ",", "HoldAll"}], "]"}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Options", "[", "CreateCPackageFunction", "]"}], "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "\"\<Description\>\"", "\[Rule]", 
        "\"\<Created by CreateCPackageFunction.\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<Public\>\"", "\[Rule]", "True"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
       "\"\<DynamicLibraryPath\>\"", "\[RuleDelayed]", 
        "$TemporaryDirectory"}], ",", "\[IndentingNewLine]", 
       RowBox[{"\"\<ExportPseudoCode\>\"", "\[Rule]", "False"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"CompilationOptions", "\[Rule]", "Automatic"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"CompilationTarget", "\[RuleDelayed]", "\"\<C\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"RuntimeAttributes", "\[Rule]", 
        RowBox[{"{", "Listable", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"RuntimeOptions", "\[Rule]", "\"\<Speed\>\""}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<OptimizationLevel\>\"", "\[Rule]", "0"}]}], 
      "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"CreateCPackageFunction", "[", 
      RowBox[{"fun_", ",", "arglist0_", ",", "body0_", ",", 
       RowBox[{"opts0", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "clearcode", ",", "body", ",", "arglist", ",", "heldcf", ",", 
         "loadcode", ",", "mxcode", ",", "Lout", ",", "name", ",", "path", 
         ",", "file", ",", "dylibfile", ",", 
         RowBox[{"(*", 
          RowBox[{"mxfile", ","}], "*)"}], "opts", ",", "optlvl", ",", "t", 
         ",", "codefile"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"name", "=", 
         RowBox[{"SymbolName", "[", 
          RowBox[{"Unevaluated", "[", "fun", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"path", "=", 
         RowBox[{"OptionValue", "[", "\"\<DynamicLibraryPath\>\"", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"dylibfile", "=", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{"path", ",", 
            RowBox[{
            "name", "<>", 
             "CCompilerDriver`CCompilerDriverBase`$PlatformDLLExtension"}]}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"codefile", "=", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{"path", ",", 
            RowBox[{"name", "<>", "\"\<.m\>\""}]}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"mxfile", "=", 
           RowBox[{"FileNameJoin", "[", 
            RowBox[{"{", 
             RowBox[{"path", ",", 
              RowBox[{"name", "<>", "\"\<.mx\>\""}]}], "}"}], "]"}]}], ";"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"mxfile2", "=", 
           RowBox[{"FileNameJoin", "[", 
            RowBox[{"{", 
             RowBox[{"path", ",", 
              RowBox[{"name", "<>", "\"\<_2.mx\>\""}]}], "}"}], "]"}]}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FileExistsQ", "[", "dylibfile", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Quiet", "[", 
            RowBox[{"LibraryUnload", "[", "dylibfile", "]"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"DeleteFile", "[", "dylibfile", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Processing \>\"", ",", "name", ",", "\"\<...\>\""}], 
           "]"}], ";"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"opts", "=", 
         RowBox[{"FilterRules", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", "opts0", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "\"\<RuntimeAttributes\>\"", ",", "\"\<CompilationOptions\>\"", 
             ",", "\"\<Parallelization\>\"", ",", "\"\<RuntimeOptions\>\""}], 
            "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"optlvl", "=", 
         RowBox[{"OptionValue", "[", "\"\<OptimizationLevel\>\"", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"arglist", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"Hold", ",", 
           RowBox[{"Unevaluated", "[", "arglist0", "]"}], ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"clearcode", "=", 
         RowBox[{
          RowBox[{"Hold", "[", 
           RowBox[{
            RowBox[{"ClearAll", "[", "\"\<name\>\"", "]"}], ";"}], "]"}], "/.", 
          RowBox[{"\"\<name\>\"", "\[Rule]", 
           RowBox[{"Unevaluated", "[", "fun", "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ReleaseHold", "[", "clearcode", "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"heldarglist", "=", 
         RowBox[{"Hold", "[", "arglist0", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"heldbody", "=", 
         RowBox[{"Hold", "[", "body0", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"heldopts", "=", 
         RowBox[{"Hold", "[", "opts0", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ccf", "=", 
         RowBox[{"Compile", "[", 
          RowBox[{"arglist0", ",", "body0", ",", 
           RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"t", "=", 
         RowBox[{
          RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"heldcf", "=", 
             RowBox[{"Replace", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Hold", "[", "\[IndentingNewLine]", 
                 RowBox[{"With", "[", 
                  RowBox[{"\"\<libs\>\"", ",", "\[IndentingNewLine]", 
                   RowBox[{"Block", "[", 
                    RowBox[{"\"\<args\>\"", ",", "\[IndentingNewLine]", 
                    RowBox[{"Compile", "[", 
                    RowBox[{
                    "\"\<arglist\>\"", ",", "\"\<body\>\"", ",", 
                    "\"\<opts\>\""}], "]"}]}], "\[IndentingNewLine]", "]"}]}],
                   "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "]"}],
                 "/.", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"\"\<args\>\"", "\[Rule]", 
                   RowBox[{"arglist", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{"\"\<arglist\>\"", "\[Rule]", "arglist"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"\"\<body\>\"", "\[Rule]", 
                   RowBox[{"Hold", "[", "body0", "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"\"\<opts\>\"", "\[Rule]", 
                   RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], 
                    "}"}], ",", "opts"}], "]"}]}], ",", "\[IndentingNewLine]", 
                  RowBox[{"\"\<optlvl\>\"", "\[Rule]", "optlvl"}]}], 
                 "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Hold", "[", "w_", "]"}], "\[RuleDelayed]", "w"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"3", ",", "6"}], "}"}]}], "\[IndentingNewLine]", 
              "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"heldcf", "=", 
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "equal", ",", "lfun", ",", "libfunsymbols", ",", 
                 "libfunpos"}], "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"libfunpos", "=", 
                 RowBox[{"Position", "[", 
                  RowBox[{"heldcf", ",", "LibraryFunction"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"libfunsymbols", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Unique", "[", "\"\<cf\>\"", "]"}], ",", 
                   RowBox[{"Length", "[", "libfunpos", "]"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"ReplaceAll", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Replace", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"heldcf", ",", 
                    RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Most", "/@", "libfunpos"}], "\[Rule]", 
                    "libfunsymbols"}], "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\"\<libs\>\"", "\[Rule]", 
                    RowBox[{"MapThread", "[", 
                    RowBox[{"equal", ",", 
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{"libfunsymbols", ",", "\[IndentingNewLine]", 
                    RowBox[{"Extract", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"heldcf", ",", 
                    RowBox[{"Thread", "[", 
                    RowBox[{"libfunpos", "\[Rule]", "lfun"}], "]"}]}], "]"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"Most", "/@", "libfunpos"}]}], 
                    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
                    "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}], 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Evaluate", "[", "equal", "]"}], "\[Rule]", 
                    "Set"}], ",", 
                    RowBox[{"lfun", "\[Rule]", "LibraryFunction"}]}], "}"}]}],
                  "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
              "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"loadcode", "=", 
             RowBox[{
              RowBox[{"Hold", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"\"\<name\>\"", "[", "args___", "]"}], ":=", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\"\<name\>\"", "=", 
                   RowBox[{
                   "LoadCPackageFunction", "[", "\"\<codefile\>\"", "]"}]}], 
                  ";", 
                  RowBox[{"\"\<name\>\"", "[", "args", "]"}]}], ")"}]}], 
               "\[IndentingNewLine]", "]"}], "/.", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\"\<codefile\>\"", "\[Rule]", "codefile"}], ",", 
                RowBox[{"\"\<name\>\"", "\[Rule]", 
                 RowBox[{"Unevaluated", "[", "fun", "]"}]}]}], "}"}]}]}], 
            ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "]"}], "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<\\t\\t\>\"", ",", 
          RowBox[{"ToString", "[", 
           RowBox[{"PaddedForm", "[", 
            RowBox[{"t", ",", 
             RowBox[{"{", 
              RowBox[{"4", ",", "4"}], "}"}]}], "]"}], "]"}], ",", 
          RowBox[{
          "\"\< s elapsed while processing \>\"", "<>", "name", "<>", 
           "\"\<.\>\""}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Lout", "=", 
         RowBox[{"\[LeftAssociation]", 
          RowBox[{"\"\<Name\>\"", "\[Rule]", "name"}], 
          "\[RightAssociation]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<Public\>\"", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"Lout", ",", 
             RowBox[{"\"\<PublicDescription\>\"", "\[Rule]", 
              RowBox[{"Rule", "[", 
               RowBox[{"name", ",", 
                RowBox[{"OptionValue", "[", "\"\<Description\>\"", "]"}]}], 
               "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"Lout", ",", 
             RowBox[{"\"\<Private\>\"", "\[Rule]", "loadcode"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"Lout", ",", 
             RowBox[{"\"\<Private\>\"", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"OptionValue", "[", "\"\<Description\>\"", "]"}], ",",
                 "loadcode"}], "}"}]}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "Lout"}]}],
       "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.746700300877658*^9, 3.746700336514633*^9}, {
   3.746700377984056*^9, 3.746700441888253*^9}, {3.746700938689678*^9, 
   3.74670094451894*^9}, {3.746700999705678*^9, 3.7467010188400927`*^9}, {
   3.746701078183319*^9, 3.746701097380148*^9}, {3.746701168701193*^9, 
   3.74670119618731*^9}, {3.746701234827406*^9, 3.746701240751066*^9}, {
   3.7467012755222597`*^9, 3.746701277014987*^9}, 3.746701307172633*^9, {
   3.74670145884589*^9, 3.746701459588459*^9}, {3.746701592313311*^9, 
   3.7467016012533407`*^9}, {3.746701703326377*^9, 3.746701707899942*^9}, {
   3.746702255530753*^9, 3.746702262703953*^9}, {3.746702349523345*^9, 
   3.746702393318626*^9}, {3.746702610774064*^9, 3.746702611773086*^9}, 
   3.746702840278327*^9, {3.746703048995422*^9, 3.746703050545208*^9}, {
   3.746703148278557*^9, 3.746703154325492*^9}, {3.7467032035304327`*^9, 
   3.746703204447797*^9}, {3.746703323210919*^9, 3.746703374446755*^9}, {
   3.74670350467389*^9, 3.746703506104602*^9}, {3.746704055068762*^9, 
   3.7467041521198587`*^9}, {3.746704454140155*^9, 3.746704467738385*^9}, {
   3.746704652715414*^9, 3.746704676078915*^9}, {3.746704804600751*^9, 
   3.746704806647543*^9}, {3.746704839128085*^9, 3.746704841299058*^9}, {
   3.746704946880419*^9, 3.7467049475430593`*^9}, 3.7467053253609123`*^9, {
   3.746705547960232*^9, 3.7467055784857883`*^9}, {3.746705663228195*^9, 
   3.7467058582417707`*^9}, {3.7467058958507566`*^9, 3.7467059025838633`*^9}, 
   3.7467060134280148`*^9, 3.74670607543944*^9, {3.746706134570237*^9, 
   3.746706143252623*^9}, 3.746707286331052*^9, {3.746707587115995*^9, 
   3.746707589269772*^9}, {3.749726076773597*^9, 3.7497261009116*^9}, {
   3.74972614718572*^9, 3.749726148993186*^9}, {3.7497263047960777`*^9, 
   3.7497263050107727`*^9}, 3.759015461552018*^9, 3.759015499331479*^9, {
   3.797149705902067*^9, 3.797149711964233*^9}, {3.797149817513031*^9, 
   3.797149875102799*^9}, {3.7971502856987467`*^9, 3.797150340717999*^9}, {
   3.7971504963533707`*^9, 3.7971505653318567`*^9}, {3.797150707089048*^9, 
   3.797150764047174*^9}, {3.7971508323559427`*^9, 3.797150864851018*^9}, {
   3.797150928425323*^9, 3.797150977917012*^9}, {3.797151101688134*^9, 
   3.797151102032618*^9}, {3.7971512618186703`*^9, 3.797151274259344*^9}, 
   3.79715154248032*^9, {3.797151581740157*^9, 3.79715174820126*^9}, {
   3.797151933475206*^9, 3.79715212886727*^9}, {3.797152176944415*^9, 
   3.797152322778829*^9}, {3.797152471876316*^9, 3.797152481795136*^9}, {
   3.797154115381014*^9, 3.797154161762021*^9}, 3.79715442661657*^9, 
   3.7971544708901052`*^9, {3.797154501557836*^9, 3.797154507348803*^9}, {
   3.7971545517476873`*^9, 3.797154566932538*^9}, {3.79715510974229*^9, 
   3.797155110788903*^9}, {3.797155160188651*^9, 3.797155283611334*^9}, 
   3.797155340141745*^9, {3.7971554195467*^9, 3.7971554342883167`*^9}, {
   3.797155465711508*^9, 3.7971554871269083`*^9}, {3.797156529464685*^9, 
   3.797156529943411*^9}, {3.7971574025839252`*^9, 3.797157418198435*^9}, 
   3.797157535554063*^9, {3.7971578609120293`*^9, 3.797157862414322*^9}, {
   3.797158968653034*^9, 3.797158983282218*^9}, {3.7971590393683043`*^9, 
   3.7971590832344427`*^9}, {3.7971591137659683`*^9, 3.797159114100424*^9}, 
   3.7971591447177134`*^9, {3.797165182733679*^9, 3.7971651989967737`*^9}, {
   3.79718638374763*^9, 3.797186403497438*^9}, {3.797187697659103*^9, 
   3.797187700867239*^9}, 3.797188048276517*^9, {3.797188084823162*^9, 
   3.797188137321086*^9}, {3.797188204414364*^9, 3.797188214838491*^9}, {
   3.7971882636875553`*^9, 3.797188295388438*^9}, {3.797188335435739*^9, 
   3.797188339050272*^9}, {3.797188537597582*^9, 3.797188549786031*^9}, {
   3.7971887555091267`*^9, 3.797188756130918*^9}, 3.797189326579919*^9, {
   3.7971893583491573`*^9, 3.797189426827972*^9}, {3.797189606494199*^9, 
   3.797189654093934*^9}, {3.797189712799613*^9, 3.797189720328239*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"1e26f108-2691-4fcb-a6ab-ec207dba9a04"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{
  3.797155107587695*^9},ExpressionUUID->"47c33864-f82d-4b5a-b490-\
f40e89014795"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"aloadcode", "=", 
     RowBox[{"loadcode", "=", 
      RowBox[{
       RowBox[{"Hold", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\"\<name\>\"", "[", "args___", "]"}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"\"\<name\>\"", "=", 
            RowBox[{
             RowBox[{"Import", "[", "\"\<mxfile\>\"", "]"}], 
             "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
           RowBox[{"\"\<name\>\"", "[", "args", "]"}]}], ")"}]}], 
        "\[IndentingNewLine]", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<mxfile\>\"", "\[Rule]", "mxfile"}], ",", 
         RowBox[{"\"\<name\>\"", "\[Rule]", 
          RowBox[{"Unevaluated", "[", "fun", "]"}]}]}], "}"}]}]}]}], ";"}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"amxcode", "=", 
     RowBox[{"mxcode", "=", 
      RowBox[{
       RowBox[{"HoldComplete", "[", "\[IndentingNewLine]", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"cf", ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"t", "=", 
            RowBox[{
             RowBox[{"AbsoluteTiming", "[", 
              RowBox[{
               RowBox[{"cf", "=", 
                RowBox[{"Quiet", "[", 
                 RowBox[{
                 "\"\<heldcf\>\"", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], "]"}]}], ";"}], "]"}], 
             "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<\\t\\t\>\"", ",", 
             RowBox[{"ToString", "[", 
              RowBox[{"PaddedForm", "[", 
               RowBox[{"t", ",", 
                RowBox[{"{", 
                 RowBox[{"4", ",", "4"}], "}"}]}], "]"}], "]"}], ",", 
             RowBox[{
             "\"\< s elapsed while compiling \>\"", "<>", 
              "\"\<namestring\>\"", "<>", "\"\<.\>\""}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"CopyFile", "[", 
            RowBox[{
             RowBox[{"cf", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{"-", "1"}], ",", "1"}], "\[RightDoubleBracket]"}], 
             ",", "\"\<dylibfile\>\""}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"cf", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "1"}], "\[RightDoubleBracket]"}], "=", 
            "\"\<dylibfile\>\""}], ";", "\[IndentingNewLine]", 
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"export", "=", 
               RowBox[{"List", "@@", "cf"}]}], "}"}], ",", 
             RowBox[{"Export", "[", 
              RowBox[{"\"\<mxfile\>\"", ",", 
               RowBox[{"Hold", "[", 
                RowBox[{"CompiledFunction", "@@", "export"}], "]"}]}], 
              "]"}]}], "]"}], ";", "\[IndentingNewLine]", "cf"}]}], 
         "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "]"}], "/.", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\"\<mxfile\>\"", "\[Rule]", "mxfile"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<name\>\"", "\[Rule]", 
          RowBox[{"Unevaluated", "[", "fun", "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<dylibfile\>\"", "\[Rule]", "dylibfile"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<heldcf\>\"", "\[Rule]", "heldcf"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<namestring\>\"", "\[Rule]", "name"}]}], 
        "\[IndentingNewLine]", "}"}]}]}]}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{"mxfile", ",", "mxcode"}], "]"}], ";"}], "*)"}]}]], "Input",Expre\
ssionUUID->"e9f1728e-a38a-421f-b1fa-d2f5439e5ac0"]
},
WindowSize->{1440, 851},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (June 19, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"bc2d28f1-6af9-4b49-8984-c53f81935ed8"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 8330, 164, 1117, "Input",ExpressionUUID->"ea920a61-87ac-4e84-ac98-7a875bd478fb"],
Cell[8891, 186, 17430, 371, 2817, "Input",ExpressionUUID->"6502a3d5-d3c9-4d23-b17a-d1f7243fcaf1"],
Cell[26324, 559, 18229, 359, 2592, "Input",ExpressionUUID->"1e26f108-2691-4fcb-a6ab-ec207dba9a04"],
Cell[44556, 920, 128, 3, 41, "Input",ExpressionUUID->"47c33864-f82d-4b5a-b490-f40e89014795"],
Cell[44687, 925, 4147, 96, 692, "Input",ExpressionUUID->"e9f1728e-a38a-421f-b1fa-d2f5439e5ac0"]
}
]
*)

